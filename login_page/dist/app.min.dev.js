"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}function MarkerClusterer(e,t,n){this.extend(MarkerClusterer,google.maps.OverlayView),this.map_=e,this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;var r=n||{};this.gridSize_=r.gridSize||60,this.minClusterSize_=r.minimumClusterSize||2,this.maxZoom_=r.maxZoom||null,this.styles_=r.styles||[],this.imagePath_=r.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=r.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,r.zoomOnClick!==undefined&&(this.zoomOnClick_=r.zoomOnClick),this.averageCenter_=!1,r.averageCenter!==undefined&&(this.averageCenter_=r.averageCenter),this.setupStyles_(),this.setMap(e),this.prevZoom_=this.map_.getZoom();var i=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var e=i.map_.getZoom(),t=i.map_.minZoom||0,n=Math.min(i.map_.maxZoom||100,i.map_.mapTypes[i.map_.getMapTypeId()].maxZoom);e=Math.min(Math.max(e,t),n),i.prevZoom_!=e&&(i.prevZoom_=e,i.resetViewport());}),google.maps.event.addListener(this.map_,"idle",function(){i.redraw();}),t&&(t.length||Object.keys(t).length)&&this.addMarkers(t,!1);}function Cluster(e){this.markerClusterer_=e,this.map_=e.getMap(),this.gridSize_=e.getGridSize(),this.minClusterSize_=e.getMinClusterSize(),this.averageCenter_=e.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,e.getStyles(),e.getGridSize());}function ClusterIcon(e,t,n){e.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.styles_=t,this.padding_=n||0,this.cluster_=e,this.center_=null,this.map_=e.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_);}var requirejs,_require,define;(function(ba){function G(e){return"[object Function]"===K.call(e);}function H(e){return"[object Array]"===K.call(e);}function v(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1){;}}}function T(e,t){if(e){var n;for(n=e.length-1;-1<n&&(!e[n]||!t(e[n],n,e));n-=1){;}}}function t(e,t){return fa.call(e,t);}function m(e,n){return t(e,n)&&e[n];}function B(e,n){for(var r in e){if(t(e,r)&&n(e[r],r))break;}}function U(e,n,r,i){return n&&B(n,function(n,s){if(r||!t(e,s))i&&"object"==_typeof(n)&&n&&!H(n)&&!G(n)&&!(n instanceof RegExp)?(e[s]||(e[s]={}),U(e[s],n,r,i)):e[s]=n;}),e;}function u(e,t){return function(){return t.apply(e,arguments);};}function ca(e){throw e;}function da(e){if(!e)return e;var t=ba;return v(e.split("."),function(e){t=t[e];}),t;}function C(e,t,n,r){return t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e),t.requireType=e,t.requireModules=r,n&&(t.originalError=n),t;}function ga(e){function n(e,t,n){var r,i,s,o,u,a,f,l,t=t&&t.split("/"),c=A.map,h=c&&c["*"];if(e){e=e.split("/"),i=e.length-1,A.nodeIdCompat&&Q.test(e[i])&&(e[i]=e[i].replace(Q,"")),"."===e[0].charAt(0)&&t&&(i=t.slice(0,t.length-1),e=i.concat(e)),i=e;for(s=0;s<i.length;s++){(o=i[s],"."===o)?(i.splice(s,1),s-=1):".."===o&&0!==s&&(1!=s||".."!==i[2])&&".."!==i[s-1]&&0<s&&(i.splice(s-1,2),s-=2);}e=e.join("/");}if(n&&c&&(t||h)){i=e.split("/"),s=i.length;e:for(;0<s;s-=1){u=i.slice(0,s).join("/");if(t)for(o=t.length;0<o;o-=1){if(n=m(c,t.slice(0,o).join("/")))if(n=m(n,u)){r=n,a=s;break e;}}!f&&h&&m(h,u)&&(f=m(h,u),l=s);}!r&&f&&(r=f,a=l),r&&(i.splice(0,a,r),e=i.join("/"));}return(r=m(A.pkgs,e))?r:e;}function r(e){z&&v(document.getElementsByTagName("script"),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===x.contextName)return t.parentNode.removeChild(t),!0;});}function i(e){var t=m(A.paths,e);if(t&&H(t)&&1<t.length)return t.shift(),x.require.undef(e),x.makeRequire(null,{skipMap:!0})([e]),!0;}function s(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e];}function o(e,t,r,i){var o,u,a=null,f=t?t.name:null,l=e,c=!0,h="";return e||(c=!1,e="_@r"+(q+=1)),e=s(e),a=e[0],e=e[1],a&&(a=n(a,f,i),u=m(j,a)),e&&(a?h=u&&u.normalize?u.normalize(e,function(e){return n(e,f,i);}):-1===e.indexOf("!")?n(e,f,i):e:(h=n(e,f,i),e=s(h),a=e[0],h=e[1],r=!0,o=x.nameToUrl(h))),r=a&&!u&&!r?"_unnormalized"+(W+=1):"",{prefix:a,name:h,parentMap:t,unnormalized:!!r,url:o,originalName:l,isDefine:c,id:(a?a+"!"+h:h)+r};}function a(e){var t=e.id,n=m(O,t);return n||(n=O[t]=new x.Module(e)),n;}function f(e,n,r){var i=e.id,s=m(O,i);t(j,i)&&(!s||s.defineEmitComplete)?"defined"===n&&r(j[i]):(s=a(e),s.error&&"error"===n)?r(s.error):s.on(n,r);}function l(e,t){var n=e.requireModules,r=!1;t?t(e):(v(n,function(t){if(t=m(O,t))t.error=e,t.events.error&&(r=!0,t.emit("error",e));}),!r)&&g.onError(e);}function c(){R.length&&(ha.apply(P,[P.length,0].concat(R)),R=[]);}function h(e){delete O[e],delete _[e];}function p(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,v(e.depMaps,function(r,i){var s=r.id,o=m(O,s);o&&!e.depMatched[i]&&!n[s]&&(m(t,s)?(e.defineDep(i,j[s]),e.check()):p(o,t,n));}),n[r]=!0);}function d(){var e,t,n=(e=1e3*A.waitSeconds)&&x.startTime+e<new Date().getTime(),s=[],o=[],u=!1,a=!0;if(!E){E=!0,B(_,function(e){var f=e.map,l=f.id;if(e.enabled&&(f.isDefine||o.push(e),!e.error))if(!e.inited&&n)i(l)?u=t=!0:(s.push(l),r(l));else if(!e.inited&&e.fetched&&f.isDefine&&(u=!0,!f.prefix))return a=!1;});if(n&&s.length)return e=C("timeout","Load timeout for modules: "+s,null,s),e.contextName=x.contextName,l(e);a&&v(o,function(e){p(e,{},{});}),(!n||t)&&u&&(z||ea)&&!L&&(L=setTimeout(function(){L=0,d();},50)),E=!1;}}function y(e){t(j,e[0])||a(o(e[0],null,!0)).init(e[1],e[2]);}function b(e){var e=e.currentTarget||e.srcElement,t=x.onScriptLoad;return e.detachEvent&&!Y?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=x.onScriptError,(!e.detachEvent||Y)&&e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")};}function w(){var e;for(c();P.length;){e=P.shift();if(null===e[0])return l(C("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));y(e);}}var E,S,x,k,L,A={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},O={},_={},D={},P=[],j={},F={},I={},q=1,W=1;return k={require:function require(e){return e.require?e.require:e.require=x.makeRequire(e.map);},exports:function exports(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?j[e.map.id]=e.exports:e.exports=j[e.map.id]={};},module:function module(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function config(){return m(A.config,e.map.id)||{};},exports:e.exports||(e.exports={})};}},S=function S(e){this.events=m(D,e.id)||{},this.map=e,this.shim=m(A.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0;},S.prototype={init:function init(e,t,n,r){r=r||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=u(this,function(e){this.emit("error",e);})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check());},defineDep:function defineDep(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t);},fetch:function fetch(){if(!this.fetched){this.fetched=!0,x.startTime=new Date().getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();x.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return e.prefix?this.callPlugin():this.load();}));}},load:function load(){var e=this.map.url;F[e]||(F[e]=!0,x.load(this.map.id,e));},check:function check(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id;t=this.depExports;var r=this.exports,i=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(G(i)){if(this.events.error&&this.map.isDefine||g.onError!==ca)try{r=x.execCb(n,i,t,r);}catch(s){e=s;}else r=x.execCb(n,i,t,r);this.map.isDefine&&void 0===r&&((t=this.module)?r=t.exports:this.usingExports&&(r=this.exports));if(e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e);}else r=i;this.exports=r,this.map.isDefine&&!this.ignore&&(j[n]=r,g.onResourceLoad)&&g.onResourceLoad(x,this.map,this.depMaps),h(n),this.defined=!0;}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0);}}else this.fetch();}},callPlugin:function callPlugin(){var e=this.map,r=e.id,i=o(e.prefix);this.depMaps.push(i),f(i,"defined",u(this,function(i){var s,c;c=m(I,this.map.id);var p=this.map.name,d=this.map.parentMap?this.map.parentMap.name:null,v=x.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(i.normalize&&(p=i.normalize(p,function(e){return n(e,d,!0);})||""),i=o(e.prefix+"!"+p,this.map.parentMap),f(i,"defined",u(this,function(e){this.init([],function(){return e;},null,{enabled:!0,ignore:!0});})),c=m(O,i.id))this.depMaps.push(i),this.events.error&&c.on("error",u(this,function(e){this.emit("error",e);})),c.enable();}else c?(this.map.url=x.nameToUrl(c),this.load()):(s=u(this,function(e){this.init([],function(){return e;},null,{enabled:!0});}),s.error=u(this,function(e){this.inited=!0,this.error=e,e.requireModules=[r],B(O,function(e){0===e.map.id.indexOf(r+"_unnormalized")&&h(e.map.id);}),l(e);}),s.fromText=u(this,function(n,i){var u=e.name,f=o(u),c=M;i&&(n=i),c&&(M=!1),a(f),t(A.config,r)&&(A.config[u]=A.config[r]);try{g.exec(n);}catch(h){return l(C("fromtexteval","fromText eval for "+r+" failed: "+h,h,[r]));}c&&(M=!0),this.depMaps.push(f),x.completeLoad(u),v([u],s);}),i.load(e.name,v,s,A));})),x.enable(i,this),this.pluginMaps[i.id]=i;},enable:function enable(){_[this.map.id]=this,this.enabling=this.enabled=!0,v(this.depMaps,u(this,function(e,n){var r,i;if("string"==typeof e){e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[n]=e;if(r=m(k,e.id)){this.depExports[n]=r(this);return;}this.depCount+=1,f(e,"defined",u(this,function(e){this.defineDep(n,e),this.check();})),this.errback&&f(e,"error",u(this,this.errback));}r=e.id,i=O[r],!t(k,r)&&i&&!i.enabled&&x.enable(e,this);})),B(this.pluginMaps,u(this,function(e){var t=m(O,e.id);t&&!t.enabled&&x.enable(e,this);})),this.enabling=!1,this.check();},on:function on(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t);},emit:function emit(e,t){v(this.events[e],function(e){e(t);}),"error"===e&&delete this.events[e];}},x={config:A,contextName:e,registry:O,defined:j,urlFetched:F,defQueue:P,Module:S,makeModuleMap:o,nextTick:g.nextTick,onError:l,configure:function configure(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=A.shim,n={paths:!0,bundles:!0,config:!0,map:!0};B(e,function(e,t){n[t]?(A[t]||(A[t]={}),U(A[t],e,!0,!0)):A[t]=e;}),e.bundles&&B(e.bundles,function(e,t){v(e,function(e){e!==t&&(I[e]=t);});}),e.shim&&(B(e.shim,function(e,n){H(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=x.makeShimExports(e)),t[n]=e;}),A.shim=t),e.packages&&v(e.packages,function(e){var t,e="string"==typeof e?{name:e}:e;t=e.name,e.location&&(A.paths[t]=e.location),A.pkgs[t]=e.name+"/"+(e.main||"main").replace(ia,"").replace(Q,"");}),B(O,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=o(t));}),(e.deps||e.callback)&&x.require(e.deps||[],e.callback);},makeShimExports:function makeShimExports(e){return function(){var t;return e.init&&(t=e.init.apply(ba,arguments)),t||e.exports&&da(e.exports);};},makeRequire:function makeRequire(i,s){function u(n,r,f){var c,h;return s.enableBuildCallback&&r&&G(r)&&(r.__requireJsBuild=!0),"string"==typeof n?G(r)?l(C("requireargs","Invalid require call"),f):i&&t(k,n)?k[n](O[i.id]):g.get?g.get(x,n,i,u):(c=o(n,i,!1,!0),c=c.id,t(j,c)?j[c]:l(C("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(i?"":". Use require([])")))):(w(),x.nextTick(function(){w(),h=a(o(null,i)),h.skipMap=s.skipMap,h.init(n,r,f,{enabled:!0}),d();}),u);}return s=s||{},U(u,{isBrowser:z,toUrl:function toUrl(e){var t,r=e.lastIndexOf("."),s=e.split("/")[0];return-1!==r&&("."!==s&&".."!==s||1<r)&&(t=e.substring(r,e.length),e=e.substring(0,r)),x.nameToUrl(n(e,i&&i.id,!0),t,!0);},defined:function defined(e){return t(j,o(e,i,!1,!0).id);},specified:function specified(e){return e=o(e,i,!1,!0).id,t(j,e)||t(O,e);}}),i||(u.undef=function(e){c();var t=o(e,i,!0),n=m(O,e);r(e),delete j[e],delete F[t.url],delete D[e],T(P,function(t,n){t[0]===e&&P.splice(n,1);}),n&&(n.events.defined&&(D[e]=n.events),h(e));}),u;},enable:function enable(e){m(O,e.id)&&a(e).enable();},completeLoad:function completeLoad(e){var n,r,s=m(A.shim,e)||{},o=s.exports;for(c();P.length;){r=P.shift();if(null===r[0]){r[0]=e;if(n)break;n=!0;}else r[0]===e&&(n=!0);y(r);}r=m(O,e);if(!n&&!t(j,e)&&r&&!r.inited){if(A.enforceDefine&&(!o||!da(o)))return i(e)?void 0:l(C("nodefine","No define call for "+e,null,[e]));y([e,s.deps||[],s.exportsFn]);}d();},nameToUrl:function nameToUrl(e,t,n){var r,i,s;(r=m(A.pkgs,e))&&(e=r);if(r=m(I,e))return x.nameToUrl(r,t,n);if(g.jsExtRegExp.test(e))r=e+(t||"");else{r=A.paths,e=e.split("/");for(i=e.length;0<i;i-=1){if(s=e.slice(0,i).join("/"),s=m(r,s)){H(s)&&(s=s[0]),e.splice(0,i,s);break;}}r=e.join("/"),r+=t||(/^data\:|\?/.test(r)||n?"":".js"),r=("/"===r.charAt(0)||r.match(/^[\w\+\.\-]+:/)?"":A.baseUrl)+r;}return A.urlArgs?r+((-1===r.indexOf("?")?"?":"&")+A.urlArgs):r;},load:function load(e,t){g.load(x,e,t);},execCb:function execCb(e,t,n,r){return t.apply(r,n);},onScriptLoad:function onScriptLoad(e){if("load"===e.type||ja.test((e.currentTarget||e.srcElement).readyState))N=null,e=b(e),x.completeLoad(e.id);},onScriptError:function onScriptError(e){var t=b(e);if(!i(t.id))return l(C("scripterror","Script error for: "+t.id,e,[t.id]));}},x.require=x.makeRequire(),x;}var g,x,y,D,I,E,N,J,s,O,ka=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,la=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,Q=/\.js$/,ia=/^\.\//;x=Object.prototype;var K=x.toString,fa=x.hasOwnProperty,ha=Array.prototype.splice,z="undefined"!=typeof window&&"undefined"!=typeof navigator&&!!window.document,ea=!z&&"undefined"!=typeof importScripts,ja=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Y="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),F={},q={},R=[],M=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(G(requirejs))return;q=requirejs,requirejs=void 0;}"undefined"!=typeof _require&&!G(_require)&&(q=_require,_require=void 0),g=requirejs=function requirejs(e,t,n,r){var i,s="_";return!H(e)&&"string"!=typeof e&&(i=e,H(t)?(e=t,t=n,n=r):e=[]),i&&i.context&&(s=i.context),(r=m(F,s))||(r=F[s]=g.s.newContext(s)),i&&r.configure(i),r.require(e,t,n);},g.config=function(e){return g(e);},g.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4);}:function(e){e();},_require||(_require=g),g.version="2.1.14",g.jsExtRegExp=/^\/|:|\?|\.js$/,g.isBrowser=z,x=g.s={contexts:F,newContext:ga},g({}),v(["toUrl","undef","defined","specified"],function(e){g[e]=function(){var t=F._;return t.require[e].apply(t,arguments);};}),z&&(y=x.head=document.getElementsByTagName("head")[0],D=document.getElementsByTagName("base")[0])&&(y=x.head=D.parentNode),g.onError=ca,g.createNode=function(e){var t=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return t.type=e.scriptType||"text/javascript",t.charset="utf-8",t.async=!0,t;},g.load=function(e,t,n){var r=e&&e.config||{};if(z)return r=g.createNode(r,t,n),r.setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),r.attachEvent&&!(r.attachEvent.toString&&0>r.attachEvent.toString().indexOf("[native code"))&&!Y?(M=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)):(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)),r.src=n,J=r,D?y.insertBefore(r,D):y.appendChild(r),J=null,r;if(ea)try{importScripts(n),e.completeLoad(t);}catch(i){e.onError(C("importscripts","importScripts failed for "+t+" at "+n,i,[t]));}},z&&!q.skipDataMain&&T(document.getElementsByTagName("script"),function(e){y||(y=e.parentNode);if(I=e.getAttribute("data-main"))return s=I,q.baseUrl||(E=s.split("/"),s=E.pop(),O=E.length?E.join("/")+"/":"./",q.baseUrl=O),s=s.replace(Q,""),g.jsExtRegExp.test(s)&&(s=I),q.deps=q.deps?q.deps.concat(s):[s],!0;}),define=function define(e,t,n){var r,i;"string"!=typeof e&&(n=t,t=e,e=null),H(t)||(n=t,t=null),!t&&G(n)&&(t=[],n.length&&(n.toString().replace(ka,"").replace(la,function(e,n){t.push(n);}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),M&&((r=J)||(N&&"interactive"===N.readyState||T(document.getElementsByTagName("script"),function(e){if("interactive"===e.readyState)return N=e;}),r=N),r&&(e||(e=r.getAttribute("data-requiremodule")),i=F[r.getAttribute("data-requirecontext")])),(i?i.defQueue:R).push([e,t,n]);},define.amd={jQuery:!0},g.exec=function(b){return eval(b);},g(q);}})(void 0),define("assets/require/require.min.js",function(){}),define("base.app",[],function(){"use strict";function e(e){if(e===undefined)throw new Error("App options not found!");if(e.controllers===undefined)throw new Error("Controllers not found!");this._options=e;}function t(e){var t=e.toLowerCase().split("/");return{controller:t[0],action:t[1]};}return e.prototype.start=function(e,n){var r=t(e);this._options.controllers[r.controller]&&(this._options.beforeStart&&this._options.beforeStart(r,n),this._options.controllers[r.controller].initialize(r.action,n),this._options.afterStart&&this._options.afterStart(r,n));},e;}),define("base.controller",[],function(){"use strict";function e(e){if(e===undefined)throw new Error("Controller options not found!");if(e.actions===undefined)throw new Error("Actions not found!");this._options=e;}return e.prototype.initialize=function(e,t){this._options.actions[e]&&(this._options.beforeStart&&this._options.beforeStart(e,t),this._options.actions[e](t),this._options.afterStart&&this._options.afterStart(e,t));},e;}),define("base.action",[],function(){"use strict";function e(e){if(e===undefined)throw new Error("Action options not found!");if(e.initialize===undefined)throw new Error("Method Initialize not found!");for(var t in e){e.hasOwnProperty(t)&&(this[t]=e[t]);}}return e.prototype.initialize=function(){},e;}),define("base.mediator",[],function(){"use strict";function e(e){this._sep=e||":",this._storage={};}return e.prototype.on=function(e,t,n){return e.length&&this.namespace(e).handlers.push({fn:t,context:n}),this;},e.prototype.off=function(e,t){if(this.has(e)){var n=this.namespace(e);n.handlers=[],t&&(n.nested={});}return this;},e.prototype._runHandlers=function(e,t){for(var n=e.length,r=0;r<n;r++){e[r].fn.call(e[r].context,t);}return this;},e.prototype._runHandlersRecursive=function(e,t){this._runHandlers(e.handlers,t);for(var n in e.nested){e.nested.hasOwnProperty(n)&&this._runHandlersRecursive(e.nested[n],t);}return this;},e.prototype.trigger=function(e,t){return this.has(e)&&this._runHandlers(this.namespace(e).handlers,t),this;},e.prototype.broadcast=function(e,t){return this.has(e)&&this._runHandlersRecursive(this.namespace(e),t),this;},e.prototype.clean=function(){return this._storage={},this;},e.prototype.has=function(e){if(!e.length)return!1;var t=e.split(this._sep),n=t.length,r=0,i=this._storage;for(;r<n;r++){if(i[t[r]]===undefined)return!1;i=i[t[r]].nested;}return!0;},e.prototype.namespace=function(e){function s(){return{nested:{},handlers:[]};}var t=e.split(this._sep),n=t.length,r=0,i=this._storage;for(;r<n;r++){i[t[r]]=i[t[r]]||s(),i=r!==n-1?i[t[r]].nested:i[t[r]];}return i;},e.prototype.getStorage=function(){return this._storage;},e;}),define("base",["require","base.app","base.controller","base.action","base.mediator"],function(e){"use strict";return{App:e("base.app"),Controller:e("base.controller"),Action:e("base.action"),Mediator:e("base.mediator")};}),!function(e,t){"object"==(typeof module==="undefined"?"undefined":_typeof(module))&&"object"==_typeof(module.exports)?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e);}:t(e);}("undefined"!=typeof window?window:void 0,function(a,b){function s(e){var t=e.length,r=n.type(e);return"function"===r||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e;}function x(e,t,r){if(n.isFunction(t))return n.grep(e,function(e,n){return!!t.call(e,n,e)!==r;});if(t.nodeType)return n.grep(e,function(e){return e===t!==r;});if("string"==typeof t){if(w.test(t))return n.filter(t,e,r);t=n.filter(t,e);}return n.grep(e,function(e){return g.call(t,e)>=0!==r;});}function D(e,t){while((e=e[t])&&1!==e.nodeType){;}return e;}function G(e){var t=F[e]={};return n.each(e.match(E)||[],function(e,n){t[n]=!0;}),t;}function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready();}function K(){Object.defineProperty(this.cache={},0,{get:function get(){return{};}}),this.expando=n.expando+Math.random();}function P(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(O,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:N.test(r)?n.parseJSON(r):r;}catch(s){}M.set(e,t,r);}else r=void 0;return r;}function Z(){return!0;}function $(){return!1;}function _(){try{return l.activeElement;}catch(e){}}function jb(e,t){return n.nodeName(e,"table")&&n.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e;}function kb(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e;}function lb(e){var t=gb.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e;}function mb(e,t){for(var n=0,r=e.length;r>n;n++){L.set(e[n],"globalEval",!t||L.get(t[n],"globalEval"));}}function nb(e,t){var r,i,s,o,u,a,f,l;if(1===t.nodeType){if(L.hasData(e)&&(o=L.access(e),u=L.set(t,o),l=o.events)){delete u.handle,u.events={};for(s in l){for(r=0,i=l[s].length;i>r;r++){n.event.add(t,s,l[s][r]);}}}M.hasData(e)&&(a=M.access(e),f=n.extend({},a),M.set(t,f));}}function ob(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&n.nodeName(e,t)?n.merge([e],r):r;}function pb(e,t){var n=t.nodeName.toLowerCase();"input"===n&&T.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue);}function sb(e,t){var r,i=n(t.createElement(e)).appendTo(t.body),s=a.getDefaultComputedStyle&&(r=a.getDefaultComputedStyle(i[0]))?r.display:n.css(i[0],"display");return i.detach(),s;}function tb(e){var t=l,r=rb[e];return r||(r=sb(e,t),"none"!==r&&r||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=qb[0].contentDocument,t.write(),t.close(),r=sb(e,t),qb.detach()),rb[e]=r),r;}function xb(e,t,r){var i,s,o,u,a=e.style;return r=r||wb(e),r&&(u=r.getPropertyValue(t)||r[t]),r&&(""!==u||n.contains(e.ownerDocument,e)||(u=n.style(e,t)),vb.test(u)&&ub.test(t)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=r.width,a.width=i,a.minWidth=s,a.maxWidth=o)),void 0!==u?u+"":u;}function yb(e,t){return{get:function get(){return e()?void delete this.get:(this.get=t).apply(this,arguments);}};}function Fb(e,t){if(t in e)return t;var n=t[0].toUpperCase()+t.slice(1),r=t,i=Eb.length;while(i--){if(t=Eb[i]+n,t in e)return t;}return r;}function Gb(e,t,n){var r=Ab.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t;}function Hb(e,t,r,i,s){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,u=0;4>o;o+=2){"margin"===r&&(u+=n.css(e,r+R[o],!0,s)),i?("content"===r&&(u-=n.css(e,"padding"+R[o],!0,s)),"margin"!==r&&(u-=n.css(e,"border"+R[o]+"Width",!0,s))):(u+=n.css(e,"padding"+R[o],!0,s),"padding"!==r&&(u+=n.css(e,"border"+R[o]+"Width",!0,s)));}return u;}function Ib(e,t,r){var i=!0,s="width"===t?e.offsetWidth:e.offsetHeight,o=wb(e),u="border-box"===n.css(e,"boxSizing",!1,o);if(0>=s||null==s){if(s=xb(e,t,o),(0>s||null==s)&&(s=e.style[t]),vb.test(s))return s;i=u&&(k.boxSizingReliable()||s===e.style[t]),s=parseFloat(s)||0;}return s+Hb(e,t,r||(u?"border":"content"),i,o)+"px";}function Jb(e,t){for(var r,i,s,o=[],u=0,a=e.length;a>u;u++){i=e[u],i.style&&(o[u]=L.get(i,"olddisplay"),r=i.style.display,t?(o[u]||"none"!==r||(i.style.display=""),""===i.style.display&&S(i)&&(o[u]=L.access(i,"olddisplay",tb(i.nodeName)))):(s=S(i),"none"===r&&s||L.set(i,"olddisplay",s?r:n.css(i,"display"))));}for(u=0;a>u;u++){i=e[u],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[u]||"":"none"));}return e;}function Kb(e,t,n,r,i){return new Kb.prototype.init(e,t,n,r,i);}function Sb(){return setTimeout(function(){Lb=void 0;}),Lb=n.now();}function Tb(e,t){var n,r=0,i={height:e};for(t=t?1:0;4>r;r+=2-t){n=R[r],i["margin"+n]=i["padding"+n]=e;}return t&&(i.opacity=i.width=e),i;}function Ub(e,t,n){for(var r,i=(Rb[t]||[]).concat(Rb["*"]),s=0,o=i.length;o>s;s++){if(r=i[s].call(n,t,e))return r;}}function Vb(e,t,r){var i,s,o,u,a,f,l,c,h=this,p={},d=e.style,v=e.nodeType&&S(e),m=L.get(e,"fxshow");r.queue||(a=n._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,f=a.empty.fire,a.empty.fire=function(){a.unqueued||f();}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,n.queue(e,"fx").length||a.empty.fire();});})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[d.overflow,d.overflowX,d.overflowY],l=n.css(e,"display"),c="none"===l?L.get(e,"olddisplay")||tb(e.nodeName):l,"inline"===c&&"none"===n.css(e,"float")&&(d.display="inline-block")),r.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=r.overflow[0],d.overflowX=r.overflow[1],d.overflowY=r.overflow[2];}));for(i in t){if(s=t[i],Nb.exec(s)){if(delete t[i],o=o||"toggle"===s,s===(v?"hide":"show")){if("show"!==s||!m||void 0===m[i])continue;v=!0;}p[i]=m&&m[i]||n.style(e,i);}else l=void 0;}if(n.isEmptyObject(p))"inline"===("none"===l?tb(e.nodeName):l)&&(d.display=l);else{m?"hidden"in m&&(v=m.hidden):m=L.access(e,"fxshow",{}),o&&(m.hidden=!v),v?n(e).show():h.done(function(){n(e).hide();}),h.done(function(){var t;L.remove(e,"fxshow");for(t in p){n.style(e,t,p[t]);}});for(i in p){u=Ub(v?m[i]:0,i,h),i in m||(m[i]=u.start,v&&(u.end=u.start,u.start="width"===i||"height"===i?1:0));}}}function Wb(e,t){var r,i,s,o,u;for(r in e){if(i=n.camelCase(r),s=t[i],o=e[r],n.isArray(o)&&(s=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),u=n.cssHooks[i],u&&"expand"in u){o=u.expand(o),delete e[i];for(r in o){r in e||(e[r]=o[r],t[r]=s);}}else t[i]=s;}}function Xb(e,t,r){var i,s,o=0,u=Qb.length,a=n.Deferred().always(function(){delete f.elem;}),f=function f(){if(s)return!1;for(var t=Lb||Sb(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,i=1-r,o=0,u=l.tweens.length;u>o;o++){l.tweens[o].run(i);}return a.notifyWith(e,[l,i,n]),1>i&&u?n:(a.resolveWith(e,[l]),!1);},l=a.promise({elem:e,props:n.extend({},t),opts:n.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:Lb||Sb(),duration:r.duration,tweens:[],createTween:function createTween(t,r){var i=n.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i;},stop:function stop(t){var n=0,r=t?l.tweens.length:0;if(s)return this;for(s=!0;r>n;n++){l.tweens[n].run(1);}return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this;}}),c=l.props;for(Wb(c,l.opts.specialEasing);u>o;o++){if(i=Qb[o].call(l,e,c,l.opts))return i;}return n.map(c,Ub,l),n.isFunction(l.opts.start)&&l.opts.start.call(e,l),n.fx.timer(n.extend(f,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always);}function rc(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,s=0,o=t.toLowerCase().match(E)||[];if(n.isFunction(r))while(i=o[s++]){"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r);}};}function sc(e,t,r,i){function u(l){var h;return s[l]=!0,n.each(e[l]||[],function(e,n){var a=n(t,r,i);return"string"!=typeof a||o||s[a]?o?!(h=a):void 0:(t.dataTypes.unshift(a),u(a),!1);}),h;}var s={},o=e===oc;return u(t.dataTypes[0])||!s["*"]&&u("*");}function tc(e,t){var r,i,s=n.ajaxSettings.flatOptions||{};for(r in t){void 0!==t[r]&&((s[r]?e:i||(i={}))[r]=t[r]);}return i&&n.extend(!0,e,i),e;}function uc(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0]){a.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));}if(r)for(i in u){if(u[i]&&u[i].test(r)){a.unshift(i);break;}}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break;}o||(o=i);}s=s||o;}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0;}function vc(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters){f[o.toLowerCase()]=e.converters[o];}s=l.shift();while(s){if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f){if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break;}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t);}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s};}}}return{state:"success",data:t};}function Bc(e,t,r,i){var s;if(n.isArray(t))n.each(t,function(t,n){r||xc.test(e)?i(e,n):Bc(e+"["+("object"==_typeof(n)?t:"")+"]",n,r,i);});else if(r||"object"!==n.type(t))i(e,t);else for(s in t){Bc(e+"["+s+"]",t[s],r,i);}}function Kc(e){return n.isWindow(e)?e:9===e.nodeType&&e.defaultView;}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function n(e,t){return new n.fn.init(e,t);},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function r(e,t){return t.toUpperCase();};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function toArray(){return d.call(this);},get:function get(e){return null!=e?0>e?this[e+this.length]:this[e]:d.call(this);},pushStack:function pushStack(e){var t=n.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t;},each:function each(e,t){return n.each(this,e,t);},map:function map(e){return this.pushStack(n.map(this,function(t,n){return e.call(t,n,t);}));},slice:function slice(){return this.pushStack(d.apply(this,arguments));},first:function first(){return this.eq(0);},last:function last(){return this.eq(-1);},eq:function eq(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[]);},end:function end(){return this.prevObject||this.constructor(null);},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[a]||{},a++),"object"==_typeof(u)||n.isFunction(u)||(u={}),a===f&&(u=this,a--);f>a;a++){if(null!=(e=arguments[a]))for(t in e){r=u[t],i=e[t],u!==i&&(l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},u[t]=n.extend(l,o,i)):void 0!==i&&(u[t]=i));}}return u;},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function error(e){throw new Error(e);},noop:function noop(){},isFunction:function isFunction(e){return"function"===n.type(e);},isArray:Array.isArray,isWindow:function isWindow(e){return null!=e&&e===e.window;},isNumeric:function isNumeric(e){return!n.isArray(e)&&e-parseFloat(e)>=0;},isPlainObject:function isPlainObject(e){return"object"!==n.type(e)||e.nodeType||n.isWindow(e)?!1:e.constructor&&!j.call(e.constructor.prototype,"isPrototypeOf")?!1:!0;},isEmptyObject:function isEmptyObject(e){var t;for(t in e){return!1;}return!0;},type:function type(e){return null==e?e+"":"object"==_typeof(e)||"function"==typeof e?h[i.call(e)]||"object":_typeof(e);},globalEval:function globalEval(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a));},camelCase:function camelCase(e){return e.replace(p,"ms-").replace(q,r);},nodeName:function nodeName(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase();},each:function each(e,t,n){var r,i=0,o=e.length,u=s(e);if(n){if(u){for(;o>i;i++){if(r=t.apply(e[i],n),r===!1)break;}}else for(i in e){if(r=t.apply(e[i],n),r===!1)break;}}else if(u){for(;o>i;i++){if(r=t.call(e[i],i,e[i]),r===!1)break;}}else for(i in e){if(r=t.call(e[i],i,e[i]),r===!1)break;}return e;},trim:function trim(e){return null==e?"":(e+"").replace(o,"");},makeArray:function makeArray(e,t){var r=t||[];return null!=e&&(s(Object(e))?n.merge(r,"string"==typeof e?[e]:e):f.call(r,e)),r;},inArray:function inArray(e,t,n){return null==t?-1:g.call(t,e,n);},merge:function merge(e,t){for(var n=+t.length,r=0,i=e.length;n>r;r++){e[i++]=t[r];}return e.length=i,e;},grep:function grep(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++){r=!t(e[s],s),r!==u&&i.push(e[s]);}return i;},map:function map(t,n,r){var i,o=0,u=t.length,a=s(t),f=[];if(a)for(;u>o;o++){i=n(t[o],o,r),null!=i&&f.push(i);}else for(o in t){i=n(t[o],o,r),null!=i&&f.push(i);}return e.apply([],f);},guid:1,proxy:function proxy(e,t){var r,i,s;return"string"==typeof t&&(r=e[t],t=e,e=r),n.isFunction(e)?(i=d.call(arguments,2),s=function s(){return e.apply(t||this,i.concat(d.call(arguments)));},s.guid=e.guid=e.guid||n.guid++,s):void 0;},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){h["[object "+t+"]"]=t.toLowerCase();});var t=function(e){function st(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(l=t.nodeType)&&9!==l)return[];if(v&&!i){if(s=Z.exec(e))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r;}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r;}else{if(s[2])return P.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(f)),r;}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--){d[c]=y+mt(d[c]);}S=et.test(e)&&dt(t.parentNode)||t,x=d.join(",");}if(x)try{return P.apply(r,S.querySelectorAll(x)),r;}catch(T){}finally{g||t.removeAttribute("id");}}}return a(e.replace(z,"$1"),t,r,i);}function ot(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i;}var e=[];return t;}function ut(e){return e[w]=!0,e;}function at(e){var t=p.createElement("div");try{return!!e(t);}catch(n){return!1;}finally{t.parentNode&&t.parentNode.removeChild(t),t=null;}}function ft(e,t){var n=e.split("|"),i=e.length;while(i--){r.attrHandle[n[i]]=t;}}function lt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling){if(n===t)return-1;}return e?1:-1;}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e;};}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e;};}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--){n[i=s[o]]&&(n[i]=!(r[i]=n[i]));}});});}function dt(e){return e&&_typeof(e.getElementsByTagName)!==L&&e;}function vt(){}function mt(e){for(var t=0,n=e.length,r="";n>t;t++){r+=e[t].value;}return r;}function gt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r]){if(1===t.nodeType||i)return e(t,n,s);}}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r]){if((1===t.nodeType||i)&&e(t,n,o))return!0;}}else while(t=t[r]){if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0;}}};}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--){if(!e[i](t,n,r))return!1;}return!0;}:e[0];}function bt(e,t,n){for(var r=0,i=t.length;i>r;r++){st(e,t[r],n);}return n;}function wt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++){(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));}return o;}function Et(e,t,n,r,i,s){return r&&!r[w]&&(r=Et(r)),i&&!i[w]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||bt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--){(c=f[l])&&(g[p[l]]=!(m[p[l]]=c));}}if(s){if(i||e){if(i){f=[],l=g.length;while(l--){(c=g[l])&&f.push(m[l]=c);}i(null,g=[],f,a);}l=g.length;while(l--){(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c));}}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g);});}function St(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=gt(function(e){return e===t;},u,!0),c=gt(function(e){return B.call(t,e)>-1;},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r));}];s>a;a++){if(n=r.relative[e[a].type])h=[gt(yt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++){if(r.relative[e[i].type])break;}return Et(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&St(e.slice(a,i)),s>i&&St(e=e.slice(i)),s>i&&mt(e));}h.push(n);}}return yt(h);}function xt(e,t){var n=t.length>0,i=e.length>0,s=function s(_s2,o,u,a,l){var c,h,d,v=0,m="0",g=_s2&&[],y=[],b=f,w=_s2||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++]){if(d(c,o,u)){a.push(c);break;}}l&&(S=E);}n&&((c=!d&&c)&&v--,_s2&&g.push(c));}if(v+=m,n&&m!==v){h=0;while(d=t[h++]){d(g,y,o,u);}if(_s2){if(v>0)while(m--){g[m]||y[m]||(y[m]=_.call(a));}y=wt(y);}P.apply(a,y),l&&!_s2&&y.length>0&&v+t.length>1&&st.uniqueSort(a);}return l&&(S=E,f=b),g;};return n?ut(s):s;}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+-new Date(),E=e.document,S=0,x=0,T=ot(),N=ot(),C=ot(),k=function k(e,t){return e===t&&(c=!0),0;},L="undefined",A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){for(var t=0,n=this.length;n>t;t++){if(this[t]===e)return t;}return-1;},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),$=new RegExp(U),J=new RegExp("^"+q+"$"),K={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function rt(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320);};try{P.apply(M=H.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType;}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t));}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]){;}e.length=n-1;}};}n=st.support={},s=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1;},h=st.setDocument=function(e){var t,i=e?e.ownerDocument||e:E,o=i.defaultView;return i!==p&&9===i.nodeType&&i.documentElement?(p=i,d=i.documentElement,v=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){h();},!1):o.attachEvent&&o.attachEvent("onunload",function(){h();})),n.attributes=at(function(e){return e.className="i",!e.getAttribute("className");}),n.getElementsByTagName=at(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length;}),n.getElementsByClassName=Y.test(i.getElementsByClassName)&&at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length;}),n.getById=at(function(e){return d.appendChild(e).id=w,!i.getElementsByName||!i.getElementsByName(w).length;}),n.getById?(r.find.ID=function(e,t){if(_typeof(t.getElementById)!==L&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[];}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t;};}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=_typeof(e.getAttributeNode)!==L&&e.getAttributeNode("id");return n&&n.value===t;};}),r.find.TAG=n.getElementsByTagName?function(e,t){return _typeof(t.getElementsByTagName)!==L?t.getElementsByTagName(e):void 0;}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++]){1===n.nodeType&&r.push(n);}return r;}return s;},r.find.CLASS=n.getElementsByClassName&&function(e,t){return _typeof(t.getElementsByClassName)!==L&&v?t.getElementsByClassName(e):void 0;},g=[],m=[],(n.qsa=Y.test(i.querySelectorAll))&&(at(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||m.push(":checked");}),at(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:");})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&at(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",U);}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r));}:function(e,t){if(t)while(t=t.parentNode){if(t===e)return!0;}return!1;},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===E&&b(E,e)?-1:t===i||t.ownerDocument===E&&b(E,t)?1:l?B.call(l,e)-B.call(l,t):0:4&r?-1:1);}:function(e,t){if(e===t)return c=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:l?B.call(l,e)-B.call(l,t):0;if(s===o)return lt(e,t);n=e;while(n=n.parentNode){u.unshift(n);}n=t;while(n=n.parentNode){a.unshift(n);}while(u[r]===a[r]){r++;}return r?lt(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0;},i):p;},st.matches=function(e,t){return st(e,null,null,t);},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r;}catch(i){}return st(t,p,null,[e]).length>0;},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t);},st.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null;},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e);},st.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++]){t===e[s]&&(i=r.push(s));}while(i--){e.splice(r[i],1);}}return l=null,e;},i=st.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling){n+=i(e);}}else if(3===s||4===s)return e.nodeValue;}else while(t=e[r++]){n+=i(t);}return n;},r=st.selectors={cacheLength:50,createPseudo:ut,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function ATTR(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4);},CHILD:function CHILD(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e;},PSEUDO:function PSEUDO(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3));}},filter:{TAG:function TAG(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0;}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t;};},CLASS:function CLASS(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||_typeof(e.getAttribute)!==L&&e.getAttribute("class")||"");});},ATTR:function ATTR(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0;};},CHILD:function CHILD(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode;}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v]){if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;}d=v="only"===e&&!d&&"nextSibling";}return!0;}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop()){if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break;}}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop()){if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;}return h-=i,h===r||h%r===0&&h/r>=0;}};},PSEUDO:function PSEUDO(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var r,s=i(e,t),o=s.length;while(o--){r=B.call(e,s[o]),e[r]=!(n[r]=s[o]);}}):function(e){return i(e,0,n);}):i;}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--){(s=o[u])&&(e[u]=!(t[u]=s));}}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop();};}),has:ut(function(e){return function(t){return st(e,t).length>0;};}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1;};}),lang:ut(function(e){return J.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do{if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");}while((t=t.parentNode)&&1===t.nodeType);return!1;};}),target:function target(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id;},root:function root(e){return e===d;},focus:function focus(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex);},enabled:function enabled(e){return e.disabled===!1;},disabled:function disabled(e){return e.disabled===!0;},checked:function checked(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected;},selected:function selected(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0;},empty:function empty(e){for(e=e.firstChild;e;e=e.nextSibling){if(e.nodeType<6)return!1;}return!0;},parent:function parent(e){return!r.pseudos.empty(e);},header:function header(e){return G.test(e.nodeName);},input:function input(e){return Q.test(e.nodeName);},button:function button(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t;},text:function text(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase());},first:pt(function(){return[0];}),last:pt(function(e,t){return[t-1];}),eq:pt(function(e,t,n){return[0>n?n+t:n];}),even:pt(function(e,t){for(var n=0;t>n;n+=2){e.push(n);}return e;}),odd:pt(function(e,t){for(var n=1;t>n;n+=2){e.push(n);}return e;}),lt:pt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;){e.push(r);}return e;}),gt:pt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;){e.push(r);}return e;})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0}){r.pseudos[t]=ct(t);}for(t in{submit:!0,reset:!0}){r.pseudos[t]=ht(t);}return vt.prototype=r.filters=r.pseudos,r.setFilters=new vt(),o=st.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter){!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));}if(!n)break;}return t?u.length:u?st.error(e):N(e,a).slice(0);},u=st.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--){s=St(t[n]),s[w]?r.push(s):i.push(s);}s=C(e,xt(i,r)),s.selector=e;}return s;},a=st.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length);}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&dt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&mt(f),!e)return P.apply(i,s),i;break;}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&dt(t.parentNode)||t),i;},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=at(function(e){return 1&e.compareDocumentPosition(p.createElement("div"));}),at(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href");})||ft("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2);}),n.attributes&&at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value");})||ft("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue;}),at(function(e){return null==e.getAttribute("disabled");})||ft(j,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null;}),st;}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;n.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?n.find.matchesSelector(i,e)?[i]:[]:n.find.matches(e,n.grep(t,function(e){return 1===e.nodeType;}));},n.fn.extend({find:function find(e){var t,r=this.length,i=[],s=this;if("string"!=typeof e)return this.pushStack(n(e).filter(function(){for(t=0;r>t;t++){if(n.contains(s[t],this))return!0;}}));for(t=0;r>t;t++){n.find(e,s[t],i);}return i=this.pushStack(r>1?n.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i;},filter:function filter(e){return this.pushStack(x(this,e||[],!1));},not:function not(e){return this.pushStack(x(this,e||[],!0));},is:function is(e){return!!x(this,"string"==typeof e&&u.test(e)?n(e):e||[],!1).length;}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||y).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof n?t[0]:t,n.merge(this,n.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:l,!0)),v.test(r[1])&&n.isPlainObject(t))for(r in t){n.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);}return this;}return i=l.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=l,this.selector=e,this;}return e.nodeType?(this.context=this[0]=e,this.length=1,this):n.isFunction(e)?"undefined"!=typeof y.ready?y.ready(e):e(n):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),n.makeArray(e,this));};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function dir(e,t,r){var i=[],s=void 0!==r;while((e=e[t])&&9!==e.nodeType){if(1===e.nodeType){if(s&&n(e).is(r))break;i.push(e);}}return i;},sibling:function sibling(e,t){for(var n=[];e;e=e.nextSibling){1===e.nodeType&&e!==t&&n.push(e);}return n;}}),n.fn.extend({has:function has(e){var t=n(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++){if(n.contains(this,t[e]))return!0;}});},closest:function closest(e,t){for(var r,i=0,s=this.length,o=[],a=u.test(e)||"string"!=typeof e?n(e,t||this.context):0;s>i;i++){for(r=this[i];r&&r!==t;r=r.parentNode){if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&n.find.matchesSelector(r,e))){o.push(r);break;}}}return this.pushStack(o.length>1?n.unique(o):o);},index:function index(e){return e?"string"==typeof e?g.call(n(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1;},add:function add(e,t){return this.pushStack(n.unique(n.merge(this.get(),n(e,t))));},addBack:function addBack(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e));}}),n.each({parent:function parent(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null;},parents:function parents(e){return n.dir(e,"parentNode");},parentsUntil:function parentsUntil(e,t,r){return n.dir(e,"parentNode",r);},next:function next(e){return D(e,"nextSibling");},prev:function prev(e){return D(e,"previousSibling");},nextAll:function nextAll(e){return n.dir(e,"nextSibling");},prevAll:function prevAll(e){return n.dir(e,"previousSibling");},nextUntil:function nextUntil(e,t,r){return n.dir(e,"nextSibling",r);},prevUntil:function prevUntil(e,t,r){return n.dir(e,"previousSibling",r);},siblings:function siblings(e){return n.sibling((e.parentNode||{}).firstChild,e);},children:function children(e){return n.sibling(e.firstChild);},contents:function contents(e){return e.contentDocument||n.merge([],e.childNodes);}},function(e,t){n.fn[e]=function(r,i){var s=n.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(s=n.filter(i,s)),this.length>1&&(C[e]||n.unique(s),B.test(e)&&s.reverse()),this.pushStack(s);};});var E=/\S+/g,F={};n.Callbacks=function(e){e="string"==typeof e?F[e]||G(e):n.extend({},e);var t,r,i,s,o,u,a=[],f=!e.once&&[],l=function l(n){for(t=e.memory&&n,r=!0,u=s||0,s=0,o=a.length,i=!0;a&&o>u;u++){if(a[u].apply(n[0],n[1])===!1&&e.stopOnFalse){t=!1;break;}}i=!1,a&&(f?f.length&&l(f.shift()):t?a=[]:c.disable());},c={add:function add(){if(a){var r=a.length;!function u(t){n.each(t,function(t,r){var i=n.type(r);"function"===i?e.unique&&c.has(r)||a.push(r):r&&r.length&&"string"!==i&&u(r);});}(arguments),i?o=a.length:t&&(s=r,l(t));}return this;},remove:function remove(){return a&&n.each(arguments,function(e,t){var r;while((r=n.inArray(t,a,r))>-1){a.splice(r,1),i&&(o>=r&&o--,u>=r&&u--);}}),this;},has:function has(e){return e?n.inArray(e,a)>-1:!!a&&!!a.length;},empty:function empty(){return a=[],o=0,this;},disable:function disable(){return a=f=t=void 0,this;},disabled:function disabled(){return!a;},lock:function lock(){return f=void 0,t||c.disable(),this;},locked:function locked(){return!f;},fireWith:function fireWith(e,t){return!a||r&&!f||(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this;},fire:function fire(){return c.fireWith(this,arguments),this;},fired:function fired(){return!!r;}};return c;},n.extend({Deferred:function Deferred(e){var t=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],r="pending",i={state:function state(){return r;},always:function always(){return s.done(arguments).fail(arguments),this;},then:function then(){var e=arguments;return n.Deferred(function(r){n.each(t,function(t,o){var u=n.isFunction(e[t])&&e[t];s[o[1]](function(){var e=u&&u.apply(this,arguments);e&&n.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,u?[e]:arguments);});}),e=null;}).promise();},promise:function promise(e){return null!=e?n.extend(e,i):i;}},s={};return i.pipe=i.then,n.each(t,function(e,n){var o=n[2],u=n[3];i[n[1]]=o.add,u&&o.add(function(){r=u;},t[1^e][2].disable,t[2][2].lock),s[n[0]]=function(){return s[n[0]+"With"](this===s?i:this,arguments),this;},s[n[0]+"With"]=o.fireWith;}),i.promise(s),e&&e.call(s,s),s;},when:function when(e){var t=0,r=d.call(arguments),i=r.length,s=1!==i||e&&n.isFunction(e.promise)?i:0,o=1===s?e:n.Deferred(),u=function u(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n);};},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++){r[t]&&n.isFunction(r[t].promise)?r[t].promise().done(u(t,l,r)).fail(o.reject).progress(u(t,f,a)):--s;}return s||o.resolveWith(l,r),o.promise();}});var H;n.fn.ready=function(e){return n.ready.promise().done(e),this;},n.extend({isReady:!1,readyWait:1,holdReady:function holdReady(e){e?n.readyWait++:n.ready(!0);},ready:function ready(e){(e===!0?--n.readyWait:n.isReady)||(n.isReady=!0,e!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))));}}),n.ready.promise=function(e){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(e);},n.ready.promise();var J=n.access=function(e,t,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===n.type(r)){s=!0;for(a in r){n.access(e,t,a,r[a],!0,o,u);}}else if(void 0!==i&&(s=!0,n.isFunction(i)||(u=!0),l&&(u?(t.call(e,i),t=null):(l=t,t=function t(e,_t2,r){return l.call(n(e),r);})),t))for(;f>a;a++){t(e[a],r,u?i:i.call(e[a],a,t(e[a],r)));}return s?e:l?t.call(e):f?t(e[0],r):o;};n.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType;},K.uid=1,K.accepts=n.acceptData,K.prototype={key:function key(e){if(!K.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=K.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t);}catch(i){t[this.expando]=r,n.extend(e,t);}}return this.cache[r]||(this.cache[r]={}),r;},set:function set(e,t,r){var i,s=this.key(e),o=this.cache[s];if("string"==typeof t)o[t]=r;else if(n.isEmptyObject(o))n.extend(this.cache[s],t);else for(i in t){o[i]=t[i];}return o;},get:function get(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t];},access:function access(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,n.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t);},remove:function remove(e,t){var r,i,s,o=this.key(e),u=this.cache[o];if(void 0===t)this.cache[o]={};else{n.isArray(t)?i=t.concat(t.map(n.camelCase)):(s=n.camelCase(t),t in u?i=[t,s]:(i=s,i=i in u?[i]:i.match(E)||[])),r=i.length;while(r--){delete u[i[r]];}}},hasData:function hasData(e){return!n.isEmptyObject(this.cache[e[this.expando]]||{});},discard:function discard(e){e[this.expando]&&delete this.cache[e[this.expando]];}};var L=new K(),M=new K(),N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;n.extend({hasData:function hasData(e){return M.hasData(e)||L.hasData(e);},data:function data(e,t,n){return M.access(e,t,n);},removeData:function removeData(e,t){M.remove(e,t);},_data:function _data(e,t,n){return L.access(e,t,n);},_removeData:function _removeData(e,t){L.remove(e,t);}}),n.fn.extend({data:function data(e,t){var r,i,s,o=this[0],u=o&&o.attributes;if(void 0===e){if(this.length&&(s=M.get(o),1===o.nodeType&&!L.get(o,"hasDataAttrs"))){r=u.length;while(r--){u[r]&&(i=u[r].name,0===i.indexOf("data-")&&(i=n.camelCase(i.slice(5)),P(o,i,s[i])));}L.set(o,"hasDataAttrs",!0);}return s;}return"object"==_typeof(e)?this.each(function(){M.set(this,e);}):J(this,function(t){var r,i=n.camelCase(e);if(o&&void 0===t){if(r=M.get(o,e),void 0!==r)return r;if(r=M.get(o,i),void 0!==r)return r;if(r=P(o,i,void 0),void 0!==r)return r;}else this.each(function(){var n=M.get(this,i);M.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&M.set(this,e,t);});},null,t,arguments.length>1,null,!0);},removeData:function removeData(e){return this.each(function(){M.remove(this,e);});}}),n.extend({queue:function queue(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=L.get(e,t),r&&(!i||n.isArray(r)?i=L.access(e,t,n.makeArray(r)):i.push(r)),i||[]):void 0;},dequeue:function dequeue(e,t){t=t||"fx";var r=n.queue(e,t),i=r.length,s=r.shift(),o=n._queueHooks(e,t),u=function u(){n.dequeue(e,t);};"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===t&&r.unshift("inprogress"),delete o.stop,s.call(e,u,o)),!i&&o&&o.empty.fire();},_queueHooks:function _queueHooks(e,t){var r=t+"queueHooks";return L.get(e,r)||L.access(e,r,{empty:n.Callbacks("once memory").add(function(){L.remove(e,[t+"queue",r]);})});}}),n.fn.extend({queue:function queue(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?n.queue(this[0],e):void 0===t?this:this.each(function(){var r=n.queue(this,e,t);n._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&n.dequeue(this,e);});},dequeue:function dequeue(e){return this.each(function(){n.dequeue(this,e);});},clearQueue:function clearQueue(e){return this.queue(e||"fx",[]);},promise:function promise(e,t){var r,i=1,s=n.Deferred(),o=this,u=this.length,a=function a(){--i||s.resolveWith(o,[o]);};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(u--){r=L.get(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));}return a(),s.promise(t);}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function S(e,t){return e=t||e,"none"===n.css(e,"display")||!n.contains(e.ownerDocument,e);},T=/^(?:checkbox|radio)$/i;!function(){var e=l.createDocumentFragment(),t=e.appendChild(l.createElement("div")),n=l.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),k.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue;}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;n.event={global:{},add:function add(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.get(e);if(g){r.handler&&(o=r,r=o.handler,s=o.selector),r.guid||(r.guid=n.guid++),(f=g.events)||(f=g.events={}),(u=g.handle)||(u=g.handle=function(t){return _typeof(n)!==U&&n.event.triggered!==t.type?n.event.dispatch.apply(e,arguments):void 0;}),t=(t||"").match(E)||[""],l=t.length;while(l--){a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d&&(h=n.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=n.event.special[d]||{},c=n.extend({type:d,origType:m,data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&n.expr.match.needsContext.test(s),namespace:v.join(".")},o),(p=f[d])||(p=f[d]=[],p.delegateCount=0,h.setup&&h.setup.call(e,i,v,u)!==!1||e.addEventListener&&e.addEventListener(d,u,!1)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),n.event.global[d]=!0);}}},remove:function remove(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.hasData(e)&&L.get(e);if(g&&(f=g.events)){t=(t||"").match(E)||[""],l=t.length;while(l--){if(a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d){h=n.event.special[d]||{},d=(i?h.delegateType:h.bindType)||d,p=f[d]||[],a=a[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=p.length;while(o--){c=p[o],!s&&m!==c.origType||r&&r.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(e,c));}u&&!p.length&&(h.teardown&&h.teardown.call(e,v,g.handle)!==!1||n.removeEvent(e,d,g.handle),delete f[d]);}else for(d in f){n.event.remove(e,d+t[l],r,i,!0);}}n.isEmptyObject(f)&&(delete g.handle,L.remove(e,"events"));}},trigger:function trigger(e,t,r,i){var s,o,u,f,c,h,p,d=[r||l],v=j.call(e,"type")?e.type:e,m=j.call(e,"namespace")?e.namespace.split("."):[];if(o=u=r=r||l,3!==r.nodeType&&8!==r.nodeType&&!X.test(v+n.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,e=e[n.expando]?e:new n.Event(v,"object"==_typeof(e)&&e),e.isTrigger=i?2:3,e.namespace=m.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:n.makeArray(t,[e]),p=n.event.special[v]||{},i||!p.trigger||p.trigger.apply(r,t)!==!1)){if(!i&&!p.noBubble&&!n.isWindow(r)){for(f=p.delegateType||v,X.test(f+v)||(o=o.parentNode);o;o=o.parentNode){d.push(o),u=o;}u===(r.ownerDocument||l)&&d.push(u.defaultView||u.parentWindow||a);}s=0;while((o=d[s++])&&!e.isPropagationStopped()){e.type=s>1?f:p.bindType||v,h=(L.get(o,"events")||{})[e.type]&&L.get(o,"handle"),h&&h.apply(o,t),h=c&&o[c],h&&h.apply&&n.acceptData(o)&&(e.result=h.apply(o,t),e.result===!1&&e.preventDefault());}return e.type=v,i||e.isDefaultPrevented()||p._default&&p._default.apply(d.pop(),t)!==!1||!n.acceptData(r)||c&&n.isFunction(r[v])&&!n.isWindow(r)&&(u=r[c],u&&(r[c]=null),n.event.triggered=v,r[v](),n.event.triggered=void 0,u&&(r[c]=u)),e.result;}},dispatch:function dispatch(e){e=n.event.fix(e);var t,r,i,s,o,u=[],a=d.call(arguments),f=(L.get(this,"events")||{})[e.type]||[],l=n.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=n.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,r=0;while((o=s.handlers[r++])&&!e.isImmediatePropagationStopped()){(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((n.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));}}return l.postDispatch&&l.postDispatch.call(this,e),e.result;}},handlers:function handlers(e,t){var r,i,s,o,u=[],a=t.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!==this;f=f.parentNode||this){if(f.disabled!==!0||"click"!==e.type){for(i=[],r=0;a>r;r++){o=t[r],s=o.selector+" ",void 0===i[s]&&(i[s]=o.needsContext?n(s,this).index(f)>=0:n.find(s,this,null,[f]).length),i[s]&&i.push(o);}i.length&&u.push({elem:f,handlers:i});}}return a<t.length&&u.push({elem:this,handlers:t.slice(a)}),u;},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function filter(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e;}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function filter(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||l,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e;}},fix:function fix(e){if(e[n.expando])return e;var t,r,i,s=e.type,o=e,u=this.fixHooks[s];u||(this.fixHooks[s]=u=W.test(s)?this.mouseHooks:V.test(s)?this.keyHooks:{}),i=u.props?this.props.concat(u.props):this.props,e=new n.Event(o),t=i.length;while(t--){r=i[t],e[r]=o[r];}return e.target||(e.target=l),3===e.target.nodeType&&(e.target=e.target.parentNode),u.filter?u.filter(e,o):e;},special:{load:{noBubble:!0},focus:{trigger:function trigger(){return this!==_()&&this.focus?(this.focus(),!1):void 0;},delegateType:"focusin"},blur:{trigger:function trigger(){return this===_()&&this.blur?(this.blur(),!1):void 0;},delegateType:"focusout"},click:{trigger:function trigger(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0;},_default:function _default(e){return n.nodeName(e.target,"a");}},beforeunload:{postDispatch:function postDispatch(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result);}}},simulate:function simulate(e,t,r,i){var s=n.extend(new n.Event(),r,{type:e,isSimulated:!0,originalEvent:{}});i?n.event.trigger(s,null,t):n.event.dispatch.call(t,s),s.isDefaultPrevented()&&r.preventDefault();}},n.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1);},n.Event=function(e,t){return this instanceof n.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?Z:$):this.type=e,t&&n.extend(this,t),this.timeStamp=e&&e.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(e,t);},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function preventDefault(){var e=this.originalEvent;this.isDefaultPrevented=Z,e&&e.preventDefault&&e.preventDefault();},stopPropagation:function stopPropagation(){var e=this.originalEvent;this.isPropagationStopped=Z,e&&e.stopPropagation&&e.stopPropagation();},stopImmediatePropagation:function stopImmediatePropagation(){var e=this.originalEvent;this.isImmediatePropagationStopped=Z,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation();}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){n.event.special[e]={delegateType:t,bindType:t,handle:function handle(e){var r,i=this,s=e.relatedTarget,o=e.handleObj;return(!s||s!==i&&!n.contains(i,s))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r;}};}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function r(e){n.event.simulate(t,e.target,n.event.fix(e),!0);};n.event.special[t]={setup:function setup(){var n=this.ownerDocument||this,i=L.access(n,t);i||n.addEventListener(e,r,!0),L.access(n,t,(i||0)+1);},teardown:function teardown(){var n=this.ownerDocument||this,i=L.access(n,t)-1;i?L.access(n,t,i):(n.removeEventListener(e,r,!0),L.remove(n,t));}};}),n.fn.extend({on:function on(e,t,r,i,s){var o,u;if("object"==_typeof(e)){"string"!=typeof t&&(r=r||t,t=void 0);for(u in e){this.on(u,t,r,e[u],s);}return this;}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=$;else if(!i)return this;return 1===s&&(o=i,i=function i(e){return n().off(e),o.apply(this,arguments);},i.guid=o.guid||(o.guid=n.guid++)),this.each(function(){n.event.add(this,e,i,r,t);});},one:function one(e,t,n,r){return this.on(e,t,n,r,1);},off:function off(e,t,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,n(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==_typeof(e)){for(s in e){this.off(s,t,e[s]);}return this;}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=$),this.each(function(){n.event.remove(this,e,r,t);});},trigger:function trigger(e,t){return this.each(function(){n.event.trigger(e,t,this);});},triggerHandler:function triggerHandler(e,t){var r=this[0];return r?n.event.trigger(e,t,r,!0):void 0;}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td,n.extend({clone:function clone(e,t,r){var i,s,o,u,a=e.cloneNode(!0),f=n.contains(e.ownerDocument,e);if(!(k.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||n.isXMLDoc(e)))for(u=ob(a),o=ob(e),i=0,s=o.length;s>i;i++){pb(o[i],u[i]);}if(t)if(r)for(o=o||ob(e),u=u||ob(a),i=0,s=o.length;s>i;i++){nb(o[i],u[i]);}else nb(e,a);return u=ob(a,"script"),u.length>0&&mb(u,!f&&ob(e,"script")),a;},buildFragment:function buildFragment(e,t,r,i){for(var s,o,u,a,f,l,c=t.createDocumentFragment(),h=[],p=0,d=e.length;d>p;p++){if(s=e[p],s||0===s)if("object"===n.type(s))n.merge(h,s.nodeType?[s]:s);else if(cb.test(s)){o=o||c.appendChild(t.createElement("div")),u=(bb.exec(s)||["",""])[1].toLowerCase(),a=ib[u]||ib._default,o.innerHTML=a[1]+s.replace(ab,"<$1></$2>")+a[2],l=a[0];while(l--){o=o.lastChild;}n.merge(h,o.childNodes),o=c.firstChild,o.textContent="";}else h.push(t.createTextNode(s));}c.textContent="",p=0;while(s=h[p++]){if((!i||-1===n.inArray(s,i))&&(f=n.contains(s.ownerDocument,s),o=ob(c.appendChild(s),"script"),f&&mb(o),r)){l=0;while(s=o[l++]){fb.test(s.type||"")&&r.push(s);}}}return c;},cleanData:function cleanData(e){for(var t,r,i,s,o=n.event.special,u=0;void 0!==(r=e[u]);u++){if(n.acceptData(r)&&(s=r[L.expando],s&&(t=L.cache[s]))){if(t.events)for(i in t.events){o[i]?n.event.remove(r,i):n.removeEvent(r,i,t.handle);}L.cache[s]&&delete L.cache[s];}delete M.cache[r[M.expando]];}}}),n.fn.extend({text:function text(e){return J(this,function(e){return void 0===e?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e);});},null,e,arguments.length);},append:function append(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.appendChild(e);}});},prepend:function prepend(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.insertBefore(e,t.firstChild);}});},before:function before(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this);});},after:function after(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling);});},remove:function remove(e,t){for(var r,i=e?n.filter(e,this):this,s=0;null!=(r=i[s]);s++){t||1!==r.nodeType||n.cleanData(ob(r)),r.parentNode&&(t&&n.contains(r.ownerDocument,r)&&mb(ob(r,"script")),r.parentNode.removeChild(r));}return this;},empty:function empty(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&(n.cleanData(ob(e,!1)),e.textContent="");}return this;},clone:function clone(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return n.clone(this,e,t);});},html:function html(e){return J(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!db.test(e)&&!ib[(bb.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ab,"<$1></$2>");try{for(;i>r;r++){t=this[r]||{},1===t.nodeType&&(n.cleanData(ob(t,!1)),t.innerHTML=e);}t=0;}catch(s){}}t&&this.empty().append(e);},null,e,arguments.length);},replaceWith:function replaceWith(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,n.cleanData(ob(this)),e&&e.replaceChild(t,this);}),e&&(e.length||e.nodeType)?this:this.remove();},detach:function detach(e){return this.remove(e,!0);},domManip:function domManip(t,r){t=e.apply([],t);var i,s,o,u,a,f,l=0,c=this.length,h=this,p=c-1,d=t[0],v=n.isFunction(d);if(v||c>1&&"string"==typeof d&&!k.checkClone&&eb.test(d))return this.each(function(e){var n=h.eq(e);v&&(t[0]=d.call(this,e,n.html())),n.domManip(t,r);});if(c&&(i=n.buildFragment(t,this[0].ownerDocument,!1,this),s=i.firstChild,1===i.childNodes.length&&(i=s),s)){for(o=n.map(ob(i,"script"),kb),u=o.length;c>l;l++){a=i,l!==p&&(a=n.clone(a,!0,!0),u&&n.merge(o,ob(a,"script"))),r.call(this[l],a,l);}if(u)for(f=o[o.length-1].ownerDocument,n.map(o,lb),l=0;u>l;l++){a=o[l],fb.test(a.type||"")&&!L.access(a,"globalEval")&&n.contains(f,a)&&(a.src?n._evalUrl&&n._evalUrl(a.src):n.globalEval(a.textContent.replace(hb,"")));}}return this;}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){n.fn[e]=function(e){for(var r,i=[],s=n(e),o=s.length-1,u=0;o>=u;u++){r=u===o?this:this.clone(!0),n(s[u])[t](r),f.apply(i,r.get());}return this.pushStack(i);};});var qb,rb={},ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function wb(e){return e.ownerDocument.defaultView.getComputedStyle(e,null);};!function(){var e,t,r=l.documentElement,i=l.createElement("div"),s=l.createElement("div");if(s.style){var _o2=function _o2(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(i);var n=a.getComputedStyle(s,null);e="1%"!==n.top,t="4px"===n.width,r.removeChild(i);};s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===s.style.backgroundClip,i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",i.appendChild(s);a.getComputedStyle&&n.extend(k,{pixelPosition:function pixelPosition(){return _o2(),e;},boxSizingReliable:function boxSizingReliable(){return null==t&&_o2(),t;},reliableMarginRight:function reliableMarginRight(){var e,t=s.appendChild(l.createElement("div"));return t.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",s.style.width="1px",r.appendChild(i),e=!parseFloat(a.getComputedStyle(t,null).marginRight),r.removeChild(i),e;}});}}(),n.swap=function(e,t,n,r){var i,s,o={};for(s in t){o[s]=e.style[s],e.style[s]=t[s];}i=n.apply(e,r||[]);for(s in t){e.style[s]=o[s];}return i;};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];n.extend({cssHooks:{opacity:{get:function get(e,t){if(t){var n=xb(e,"opacity");return""===n?"1":n;}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function style(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=n.camelCase(t),f=e.style;return t=n.cssProps[a]||(n.cssProps[a]=Fb(f,a)),u=n.cssHooks[t]||n.cssHooks[a],void 0===r?u&&"get"in u&&void 0!==(s=u.get(e,!1,i))?s:f[t]:(o=_typeof(r),"string"===o&&(s=Bb.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(n.css(e,t)),o="number"),null!=r&&r===r&&("number"!==o||n.cssNumber[a]||(r+="px"),k.clearCloneStyle||""!==r||0!==t.indexOf("background")||(f[t]="inherit"),u&&"set"in u&&void 0===(r=u.set(e,r,i))||(f[t]=r)),void 0);}},css:function css(e,t,r,i){var s,o,u,a=n.camelCase(t);return t=n.cssProps[a]||(n.cssProps[a]=Fb(e.style,a)),u=n.cssHooks[t]||n.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,r)),void 0===s&&(s=xb(e,t,i)),"normal"===s&&t in Db&&(s=Db[t]),""===r||r?(o=parseFloat(s),r===!0||n.isNumeric(o)?o||0:s):s;}}),n.each(["height","width"],function(e,t){n.cssHooks[t]={get:function get(e,r,i){return r?zb.test(n.css(e,"display"))&&0===e.offsetWidth?n.swap(e,Cb,function(){return Ib(e,t,i);}):Ib(e,t,i):void 0;},set:function set(e,r,i){var s=i&&wb(e);return Gb(e,r,i?Hb(e,t,i,"border-box"===n.css(e,"boxSizing",!1,s),s):0);}};}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(e,t){return t?n.swap(e,{display:"inline-block"},xb,[e,"marginRight"]):void 0;}),n.each({margin:"",padding:"",border:"Width"},function(e,t){n.cssHooks[e+t]={expand:function expand(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++){i[e+R[r]+t]=s[r]||s[r-2]||s[0];}return i;}},ub.test(e)||(n.cssHooks[e+t].set=Gb);}),n.fn.extend({css:function css(e,t){return J(this,function(e,t,r){var i,s,o={},u=0;if(n.isArray(t)){for(i=wb(e),s=t.length;s>u;u++){o[t[u]]=n.css(e,t[u],!1,i);}return o;}return void 0!==r?n.style(e,t,r):n.css(e,t);},e,t,arguments.length>1);},show:function show(){return Jb(this,!0);},hide:function hide(){return Jb(this);},toggle:function toggle(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide();});}}),n.Tween=Kb,Kb.prototype={constructor:Kb,init:function init(e,t,r,i,s,o){this.elem=e,this.prop=r,this.easing=s||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(n.cssNumber[r]?"":"px");},cur:function cur(){var e=Kb.propHooks[this.prop];return e&&e.get?e.get(this):Kb.propHooks._default.get(this);},run:function run(e){var t,r=Kb.propHooks[this.prop];return this.pos=t=this.options.duration?n.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):Kb.propHooks._default.set(this),this;}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function get(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=n.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop];},set:function set(e){n.fx.step[e.prop]?n.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[n.cssProps[e.prop]]||n.cssHooks[e.prop])?n.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now;}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function set(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now);}},n.easing={linear:function linear(e){return e;},swing:function swing(e){return .5-Math.cos(e*Math.PI)/2;}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),s=Ob.exec(t),o=s&&s[3]||(n.cssNumber[e]?"":"px"),u=(n.cssNumber[e]||"px"!==o&&+i)&&Ob.exec(n.css(r.elem,e)),a=1,f=20;if(u&&u[3]!==o){o=o||u[3],s=s||[],u=+i||1;do{a=a||".5",u/=a,n.style(r.elem,e,u+o);}while(a!==(a=r.cur()/i)&&1!==a&&--f);}return s&&(u=r.start=+u||+i||0,r.unit=o,r.end=s[1]?u+(s[1]+1)*s[2]:+s[2]),r;}]};n.Animation=n.extend(Xb,{tweener:function tweener(e,t){n.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,s=e.length;s>i;i++){r=e[i],Rb[r]=Rb[r]||[],Rb[r].unshift(t);}},prefilter:function prefilter(e,t){t?Qb.unshift(e):Qb.push(e);}}),n.speed=function(e,t,r){var i=e&&"object"==_typeof(e)?n.extend({},e):{complete:r||!r&&t||n.isFunction(e)&&e,duration:e,easing:r&&t||t&&!n.isFunction(t)&&t};return i.duration=n.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in n.fx.speeds?n.fx.speeds[i.duration]:n.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){n.isFunction(i.old)&&i.old.call(this),i.queue&&n.dequeue(this,i.queue);},i;},n.fn.extend({fadeTo:function fadeTo(e,t,n,r){return this.filter(S).css("opacity",0).show().end().animate({opacity:t},e,n,r);},animate:function animate(e,t,r,i){var s=n.isEmptyObject(e),o=n.speed(t,r,i),u=function u(){var t=Xb(this,n.extend({},e),o);(s||L.get(this,"finish"))&&t.stop(!0);};return u.finish=u,s||o.queue===!1?this.each(u):this.queue(o.queue,u);},stop:function stop(e,t,r){var i=function i(e){var t=e.stop;delete e.stop,t(r);};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",o=n.timers,u=L.get(this);if(s)u[s]&&u[s].stop&&i(u[s]);else for(s in u){u[s]&&u[s].stop&&Pb.test(s)&&i(u[s]);}for(s=o.length;s--;){o[s].elem!==this||null!=e&&o[s].queue!==e||(o[s].anim.stop(r),t=!1,o.splice(s,1));}(t||!r)&&n.dequeue(this,e);});},finish:function finish(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=L.get(this),i=r[e+"queue"],s=r[e+"queueHooks"],o=n.timers,u=i?i.length:0;for(r.finish=!0,n.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=o.length;t--;){o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));}for(t=0;u>t;t++){i[t]&&i[t].finish&&i[t].finish.call(this);}delete r.finish;});}}),n.each(["toggle","show","hide"],function(e,t){var r=n.fn[t];n.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(Tb(t,!0),e,n,i);};}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){n.fn[e]=function(e,n,r){return this.animate(t,e,n,r);};}),n.timers=[],n.fx.tick=function(){var e,t=0,r=n.timers;for(Lb=n.now();t<r.length;t++){e=r[t],e()||r[t]!==e||r.splice(t--,1);}r.length||n.fx.stop(),Lb=void 0;},n.fx.timer=function(e){n.timers.push(e),e()?n.fx.start():n.timers.pop();},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval));},n.fx.stop=function(){clearInterval(Mb),Mb=null;},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(e,t){return e=n.fx?n.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r);};});},function(){var e=l.createElement("input"),t=l.createElement("select"),n=t.appendChild(l.createElement("option"));e.type="checkbox",k.checkOn=""!==e.value,k.optSelected=n.selected,t.disabled=!0,k.optDisabled=!n.disabled,e=l.createElement("input"),e.value="t",e.type="radio",k.radioValue="t"===e.value;}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function attr(e,t){return J(this,n.attr,e,t,arguments.length>1);},removeAttr:function removeAttr(e){return this.each(function(){n.removeAttr(this,e);});}}),n.extend({attr:function attr(e,t,r){var i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return _typeof(e.getAttribute)===U?n.prop(e,t,r):(1===o&&n.isXMLDoc(e)||(t=t.toLowerCase(),i=n.attrHooks[t]||(n.expr.match.bool.test(t)?Zb:Yb)),void 0===r?i&&"get"in i&&null!==(s=i.get(e,t))?s:(s=n.find.attr(e,t),null==s?void 0:s):null!==r?i&&"set"in i&&void 0!==(s=i.set(e,r,t))?s:(e.setAttribute(t,r+""),r):void n.removeAttr(e,t));},removeAttr:function removeAttr(e,t){var r,i,s=0,o=t&&t.match(E);if(o&&1===e.nodeType)while(r=o[s++]){i=n.propFix[r]||r,n.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r);}},attrHooks:{type:{set:function set(e,t){if(!k.radioValue&&"radio"===t&&n.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t;}}}}}),Zb={set:function set(e,t,r){return t===!1?n.removeAttr(e,r):e.setAttribute(r,r),r;}},n.each(n.expr.match.bool.source.match(/\w+/g),function(e,t){var r=$b[t]||n.find.attr;$b[t]=function(e,t,n){var i,s;return n||(s=$b[t],$b[t]=i,i=null!=r(e,t,n)?t.toLowerCase():null,$b[t]=s),i;};});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function prop(e,t){return J(this,n.prop,e,t,arguments.length>1);},removeProp:function removeProp(e){return this.each(function(){delete this[n.propFix[e]||e];});}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function prop(e,t,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!n.isXMLDoc(e),o&&(t=n.propFix[t]||t,s=n.propHooks[t]),void 0!==r?s&&"set"in s&&void 0!==(i=s.set(e,r,t))?i:e[t]=r:s&&"get"in s&&null!==(i=s.get(e,t))?i:e[t];},propHooks:{tabIndex:{get:function get(e){return e.hasAttribute("tabindex")||_b.test(e.nodeName)||e.href?e.tabIndex:-1;}}}}),k.optSelected||(n.propHooks.selected={get:function get(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null;}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this;});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function addClass(e){var t,r,i,s,o,u,a="string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).addClass(e.call(this,t,this.className));});if(a)for(t=(e||"").match(E)||[];l>f;f++){if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):" ")){o=0;while(s=t[o++]){i.indexOf(" "+s+" ")<0&&(i+=s+" ");}u=n.trim(i),r.className!==u&&(r.className=u);}}return this;},removeClass:function removeClass(e){var t,r,i,s,o,u,a=0===arguments.length||"string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).removeClass(e.call(this,t,this.className));});if(a)for(t=(e||"").match(E)||[];l>f;f++){if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):"")){o=0;while(s=t[o++]){while(i.indexOf(" "+s+" ")>=0){i=i.replace(" "+s+" "," ");}}u=e?n.trim(i):"",r.className!==u&&(r.className=u);}}return this;},toggleClass:function toggleClass(e,t){var r=_typeof(e);return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(n.isFunction(e)?function(r){n(this).toggleClass(e.call(this,r,this.className,t),t);}:function(){if("string"===r){var t,i=0,s=n(this),o=e.match(E)||[];while(t=o[i++]){s.hasClass(t)?s.removeClass(t):s.addClass(t);}}else(r===U||"boolean"===r)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||e===!1?"":L.get(this,"__className__")||"");});},hasClass:function hasClass(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++){if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ac," ").indexOf(t)>=0)return!0;}return!1;}});var bc=/\r/g;n.fn.extend({val:function val(e){var t,r,i,s=this[0];if(arguments.length)return i=n.isFunction(e),this.each(function(r){var s;1===this.nodeType&&(s=i?e.call(this,r,n(this).val()):e,null==s?s="":"number"==typeof s?s+="":n.isArray(s)&&(s=n.map(s,function(e){return null==e?"":e+"";})),t=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s));});if(s)return t=n.valHooks[s.type]||n.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(s,"value"))?r:(r=s.value,"string"==typeof r?r.replace(bc,""):null==r?"":r);}}),n.extend({valHooks:{option:{get:function get(e){var t=n.find.attr(e,"value");return null!=t?t:n.trim(n.text(e));}},select:{get:function get(e){for(var t,r,i=e.options,s=e.selectedIndex,o="select-one"===e.type||0>s,u=o?null:[],a=o?s+1:i.length,f=0>s?a:o?s:0;a>f;f++){if(r=i[f],!(!r.selected&&f!==s||(k.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&n.nodeName(r.parentNode,"optgroup"))){if(t=n(r).val(),o)return t;u.push(t);}}return u;},set:function set(e,t){var r,i,s=e.options,o=n.makeArray(t),u=s.length;while(u--){i=s[u],(i.selected=n.inArray(i.value,o)>=0)&&(r=!0);}return r||(e.selectedIndex=-1),o;}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function set(e,t){return n.isArray(t)?e.checked=n.inArray(n(e).val(),t)>=0:void 0;}},k.checkOn||(n.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value;});}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){n.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t);};}),n.fn.extend({hover:function hover(e,t){return this.mouseenter(e).mouseleave(t||e);},bind:function bind(e,t,n){return this.on(e,null,t,n);},unbind:function unbind(e,t){return this.off(e,null,t);},delegate:function delegate(e,t,n,r){return this.on(t,e,n,r);},undelegate:function undelegate(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n);}});var cc=n.now(),dc=/\?/;n.parseJSON=function(e){return JSON.parse(e+"");},n.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser(),t=r.parseFromString(e,"text/xml");}catch(i){t=void 0;}return(!t||t.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+e),t;};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href;}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href;}ec=mc.exec(fc.toLowerCase())||[],n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function ajaxSetup(e,t){return t?tc(tc(e,n.ajaxSettings),t):tc(n.ajaxSettings,e);},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function ajax(e,t){function T(e,t,o,a){var l,g,y,w,E,x=t;2!==b&&(b=2,u&&clearTimeout(u),r=void 0,s=a||"",S.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(w=uc(c,S,o)),w=vc(c,w,S,l),l?(c.ifModified&&(E=S.getResponseHeader("Last-Modified"),E&&(n.lastModified[i]=E),E=S.getResponseHeader("etag"),E&&(n.etag[i]=E)),204===e||"HEAD"===c.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,l=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),S.status=e,S.statusText=(t||x)+"",l?d.resolveWith(h,[g,x,S]):d.rejectWith(h,[S,x,y]),S.statusCode(m),m=void 0,f&&p.trigger(l?"ajaxSuccess":"ajaxError",[S,c,l?g:y]),v.fireWith(h,[S,x]),f&&(p.trigger("ajaxComplete",[S,c]),--n.active||n.event.trigger("ajaxStop")));}"object"==_typeof(e)&&(t=e,e=void 0),t=t||{};var r,i,s,o,u,a,f,l,c=n.ajaxSetup({},t),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?n(h):n.event,d=n.Deferred(),v=n.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,w="canceled",S={readyState:0,getResponseHeader:function getResponseHeader(e){var t;if(2===b){if(!o){o={};while(t=ic.exec(s)){o[t[1].toLowerCase()]=t[2];}}t=o[e.toLowerCase()];}return null==t?null:t;},getAllResponseHeaders:function getAllResponseHeaders(){return 2===b?s:null;},setRequestHeader:function setRequestHeader(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this;},overrideMimeType:function overrideMimeType(e){return b||(c.mimeType=e),this;},statusCode:function statusCode(e){var t;if(e)if(2>b)for(t in e){m[t]=[m[t],e[t]];}else S.always(e[S.status]);return this;},abort:function abort(e){var t=e||w;return r&&r.abort(t),T(0,t),this;}};if(d.promise(S).complete=v.add,S.success=S.done,S.error=S.fail,c.url=((e||c.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=n.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(a=mc.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ec[1]&&a[2]===ec[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=n.param(c.data,c.traditional)),sc(nc,c,t,S),2===b)return S;f=c.global,f&&0===n.active++&&n.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!kc.test(c.type),i=c.url,c.hasContent||(c.data&&(i=c.url+=(dc.test(i)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=hc.test(i)?i.replace(hc,"$1_="+cc++):i+(dc.test(i)?"&":"?")+"_="+cc++)),c.ifModified&&(n.lastModified[i]&&S.setRequestHeader("If-Modified-Since",n.lastModified[i]),n.etag[i]&&S.setRequestHeader("If-None-Match",n.etag[i])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&S.setRequestHeader("Content-Type",c.contentType),S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+pc+"; q=0.01":""):c.accepts["*"]);for(l in c.headers){S.setRequestHeader(l,c.headers[l]);}if(!c.beforeSend||c.beforeSend.call(h,S,c)!==!1&&2!==b){w="abort";for(l in{success:1,error:1,complete:1}){S[l](c[l]);}if(r=sc(oc,c,t,S)){S.readyState=1,f&&p.trigger("ajaxSend",[S,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){S.abort("timeout");},c.timeout));try{b=1,r.send(g,T);}catch(x){if(!(2>b))throw x;T(-1,x);}}else T(-1,"No Transport");return S;}return S.abort();},getJSON:function getJSON(e,t,r){return n.get(e,t,r,"json");},getScript:function getScript(e,t){return n.get(e,void 0,t,"script");}}),n.each(["get","post"],function(e,t){n[t]=function(e,r,i,s){return n.isFunction(r)&&(s=s||i,i=r,r=void 0),n.ajax({url:e,type:t,dataType:s,data:r,success:i});};}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){n.fn[t]=function(e){return this.on(t,e);};}),n._evalUrl=function(e){return n.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0});},n.fn.extend({wrapAll:function wrapAll(e){var t;return n.isFunction(e)?this.each(function(t){n(this).wrapAll(e.call(this,t));}):(this[0]&&(t=n(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild){e=e.firstElementChild;}return e;}).append(this)),this);},wrapInner:function wrapInner(e){return this.each(n.isFunction(e)?function(t){n(this).wrapInner(e.call(this,t));}:function(){var t=n(this),r=t.contents();r.length?r.wrapAll(e):t.append(e);});},wrap:function wrap(e){var t=n.isFunction(e);return this.each(function(r){n(this).wrapAll(t?e.call(this,r):e);});},unwrap:function unwrap(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes);}).end();}}),n.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0;},n.expr.filters.visible=function(e){return!n.expr.filters.hidden(e);};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;n.param=function(e,t){var r,i=[],s=function s(e,t){t=n.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t);};if(void 0===t&&(t=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(e)||e.jquery&&!n.isPlainObject(e))n.each(e,function(){s(this.name,this.value);});else for(r in e){Bc(r,e[r],t,s);}return i.join("&").replace(wc,"+");},n.fn.extend({serialize:function serialize(){return n.param(this.serializeArray());},serializeArray:function serializeArray(){return this.map(function(){var e=n.prop(this,"elements");return e?n.makeArray(e):this;}).filter(function(){var e=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(e)&&(this.checked||!T.test(e));}).map(function(e,t){var r=n(this).val();return null==r?null:n.isArray(r)?n.map(r,function(e){return{name:t.name,value:e.replace(yc,"\r\n")};}):{name:t.name,value:r.replace(yc,"\r\n")};}).get();}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest();}catch(e){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var e in Dc){Dc[e]();}}),k.cors=!!Fc&&"withCredentials"in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(e){var _t3;return k.cors||Fc&&!e.crossDomain?{send:function send(n,r){var i,s=e.xhr(),o=++Cc;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields){s[i]=e.xhrFields[i];}e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n){s.setRequestHeader(i,n[i]);}_t3=function t(e){return function(){_t3&&(delete Dc[o],_t3=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status,s.statusText):r(Ec[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:void 0,s.getAllResponseHeaders()));};},s.onload=_t3(),s.onerror=_t3("error"),_t3=Dc[o]=_t3("abort");try{s.send(e.hasContent&&e.data||null);}catch(u){if(_t3)throw u;}},abort:function abort(){_t3&&_t3();}}:void 0;}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function textScript(e){return n.globalEval(e),e;}}}),n.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET");}),n.ajaxTransport("script",function(e){if(e.crossDomain){var t,_r2;return{send:function send(i,s){t=n("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",_r2=function r(e){t.remove(),_r2=null,e&&s("error"===e.type?404:200,e.type);}),l.head.appendChild(t[0]);},abort:function abort(){_r2&&_r2();}};}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function jsonpCallback(){var e=Gc.pop()||n.expando+"_"+cc++;return this[e]=!0,e;}}),n.ajaxPrefilter("json jsonp",function(e,t,r){var i,s,o,u=e.jsonp!==!1&&(Hc.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(e.data)&&"data");return u||"jsonp"===e.dataTypes[0]?(i=e.jsonpCallback=n.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,u?e[u]=e[u].replace(Hc,"$1"+i):e.jsonp!==!1&&(e.url+=(dc.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||n.error(i+" was not called"),o[0];},e.dataTypes[0]="json",s=a[i],a[i]=function(){o=arguments;},r.always(function(){a[i]=s,e[i]&&(e.jsonpCallback=t.jsonpCallback,Gc.push(i)),o&&n.isFunction(s)&&s(o[0]),o=s=void 0;}),"script"):void 0;}),n.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||l;var i=v.exec(e),s=!r&&[];return i?[t.createElement(i[1])]:(i=n.buildFragment([e],t,s),s&&s.length&&n(s).remove(),n.merge([],i.childNodes));};var Ic=n.fn.load;n.fn.load=function(e,t,r){if("string"!=typeof e&&Ic)return Ic.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=n.trim(e.slice(a)),e=e.slice(0,a)),n.isFunction(t)?(r=t,t=void 0):t&&"object"==_typeof(t)&&(s="POST"),u.length>0&&n.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){o=arguments,u.html(i?n("<div>").append(n.parseHTML(e)).find(i):e);}).complete(r&&function(e,t){u.each(r,o||[e.responseText,t,e]);}),this;},n.expr.filters.animated=function(e){return n.grep(n.timers,function(t){return e===t.elem;}).length;};var Jc=a.document.documentElement;n.offset={setOffset:function setOffset(e,t,r){var i,s,o,u,a,f,l,c=n.css(e,"position"),h=n(e),p={};"static"===c&&(e.style.position="relative"),a=h.offset(),o=n.css(e,"top"),f=n.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+f).indexOf("auto")>-1,l?(i=h.position(),u=i.top,s=i.left):(u=parseFloat(o)||0,s=parseFloat(f)||0),n.isFunction(t)&&(t=t.call(e,r,a)),null!=t.top&&(p.top=t.top-a.top+u),null!=t.left&&(p.left=t.left-a.left+s),"using"in t?t.using.call(e,p):h.css(p);}},n.fn.extend({offset:function offset(e){if(arguments.length)return void 0===e?this:this.each(function(t){n.offset.setOffset(this,e,t);});var t,r,i=this[0],s={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,n.contains(t,i)?(_typeof(i.getBoundingClientRect)!==U&&(s=i.getBoundingClientRect()),r=Kc(o),{top:s.top+r.pageYOffset-t.clientTop,left:s.left+r.pageXOffset-t.clientLeft}):s;},position:function position(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===n.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),n.nodeName(e[0],"html")||(i=e.offset()),i.top+=n.css(e[0],"borderTopWidth",!0),i.left+=n.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-n.css(r,"marginTop",!0),left:t.left-i.left-n.css(r,"marginLeft",!0)};}},offsetParent:function offsetParent(){return this.map(function(){var e=this.offsetParent||Jc;while(e&&!n.nodeName(e,"html")&&"static"===n.css(e,"position")){e=e.offsetParent;}return e||Jc;});}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var r="pageYOffset"===t;n.fn[e]=function(n){return J(this,function(e,n,i){var s=Kc(e);return void 0===i?s?s[t]:e[n]:void(s?s.scrollTo(r?a.pageXOffset:i,r?i:a.pageYOffset):e[n]=i);},e,n,arguments.length,null);};}),n.each(["top","left"],function(e,t){n.cssHooks[t]=yb(k.pixelPosition,function(e,r){return r?(r=xb(e,t),vb.test(r)?n(e).position()[t]+"px":r):void 0;});}),n.each({Height:"height",Width:"width"},function(e,t){n.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){n.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return J(this,function(t,r,i){var s;return n.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===i?n.css(t,r,u):n.style(t,r,i,u);},t,o?i:void 0,o,null);};});}),n.fn.size=function(){return this.length;},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n;});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(e){return a.$===n&&(a.$=Mc),e&&a.jQuery===n&&(a.jQuery=Lc),n;},_typeof(b)===U&&(a.jQuery=a.$=n),n;}),(typeof JSON==="undefined"?"undefined":_typeof(JSON))!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e;}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+e+'"';}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&_typeof(a)=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(_typeof(a)){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null";}return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i;}if(rep&&_typeof(rep)=="object"){s=rep.length;for(n=0;n<s;n+=1){typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));}}else for(r in a){Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));}return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i;}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf();});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1){indent+=" ";}else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||_typeof(t)=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify");}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&_typeof(i)=="object")for(n in i){Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);}return reviver.call(e,t,i);}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4);}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse");});}(),define("json",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function x(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e);};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++){if(t.call(r,e[i],i,e)===n)return;}}else for(var o in e){if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return;}};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s);}),r);};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0);}),!i)throw new TypeError(N);return n;},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length;}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0);}),!i)throw new TypeError(N);return n;},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0;}),r;},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e);}),r);},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i);},n);},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n;}),!!i);};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0;}),!!i);};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t;});},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n);});},x.pluck=function(e,t){return x.map(e,function(e){return e[t];});},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t){if(t[n]!==e[n])return!1;}return!0;});},x.findWhere=function(e,t){return x.where(e,t,!0);},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o});}),r.value;},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o});}),r.value;},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e;}),r;};var k=function k(e){return x.isFunction(e)?e:function(t){return t[e];};};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)};}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1;}return e.index<t.index?-1:1;}),"value");};var L=function L(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t);}),i;};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n);});},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++;});},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u;}return s;},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[];},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length;},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t);},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t));},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0));},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t);},x.compact=function(e){return x.filter(e,x.identity);};var A=function A(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e);}),n;};x.flatten=function(e,t){return A(e,t,[]);},x.without=function(e){return x.difference(e,u.call(arguments,1));},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]));}),s;},x.union=function(){return x.uniq(a.apply(r,arguments));},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0;});});},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e);});},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++){n[r]=x.pluck(e,""+r);}return n;},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++){t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];}return n;},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n;}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++){if(e[r]===t)return r;}return-1;},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;){if(e[i]===t)return i;}return-1;},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;){s[i++]=e,e+=n;}return s;},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)));};},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)));};},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e);}),e;},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments);};},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n);},t);},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)));},x.throttle=function(e,t){var n,r,i,s,o=0,u=function u(){o=new Date(),i=null,s=e.apply(n,r);};return function(){var a=new Date(),f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s;};},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function u(){r=null,n||(i=e.apply(s,o));},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i;};},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t);};},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n);};},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--){t=[e[n].apply(this,t)];}return t[0];};},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0;};},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e){x.has(e,n)&&(t[t.length]=n);}return t;},x.values=function(e){var t=[];for(var n in e){x.has(e,n)&&t.push(e[n]);}return t;},x.pairs=function(e){var t=[];for(var n in e){x.has(e,n)&&t.push([n,e[n]]);}return t;},x.invert=function(e){var t={};for(var n in e){x.has(e,n)&&(t[e[n]]=n);}return t;},x.functions=x.methods=function(e){var t=[];for(var n in e){x.isFunction(e[n])&&t.push(n);}return t.sort();},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t){e[n]=t[n];}}),e;},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n]);}),t;},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e){x.contains(n,i)||(t[i]=e[i]);}return t;},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t){null==e[n]&&(e[n]=t[n]);}}),e;},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e;},x.tap=function(e,t){return t(e),e;};var O=function O(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase;}if("object"!=_typeof(e)||"object"!=_typeof(t))return!1;for(var s=n.length;s--;){if(n[s]==e)return r[s]==t;}n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=O(e[o],t[o],n,r));){;}}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e){if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r))))break;}if(u){for(c in t){if(x.has(t,c)&&!o--)break;}u=!o;}}return n.pop(),r.pop(),u;};x.isEqual=function(e,t){return O(e,t,[],[]);},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e){if(x.has(e,t))return!1;}return!0;},x.isElement=function(e){return!!e&&1===e.nodeType;},x.isArray=w||function(e){return"[object Array]"==f.call(e);},x.isObject=function(e){return e===Object(e);},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]";};}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee");}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e;}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e));},x.isNaN=function(e){return x.isNumber(e)&&e!=+e;},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e);},x.isNull=function(e){return null===e;},x.isUndefined=function(e){return e===void 0;},x.has=function(e,t){return l.call(e,t);},x.noConflict=function(){return e._=t,this;},x.identity=function(e){return e;},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++){r[i]=t.call(n,i);}return r;},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1));};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t];});};}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n;},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e));};});};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t;},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e];}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t;}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=Function(n.variable||"obj","_",o);}catch(u){throw u.source=o,u;}if(t)return r(t,x);var a=function a(e){return r.call(this,e,x);};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a;},x.chain=function(e){return x(e).chain();};var j=function j(e){return this._chain?x(e).chain():e;};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n);};}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments));};}),x.extend(x.prototype,{chain:function chain(){return this._chain=!0,this;},value:function value(){return this._wrapped;}});}.call(void 0),define("underscore",["jquery","json"],function(e){return function(){var t,n;return t||e._;};}(void 0)),define("popup",["jquery","underscore"],function(e,t){"use strict";function s(){return Math.round(Math.random()*Math.random()*1e8);}var n=e(window),r=e(document),i=e(document.body);return function(o){var u=this,a=e.extend({name:"popup"+s(),closeLink:"a.popup__close",bodyClass:"popup__body",containerClass:"",headerTextEl:"span.popup__head-text",overlayClass:"popupOverlay",overlayOpacity:1,templateId:"#popup",minTopPosition:15,minBottomPosition:15,minLeftPosition:15,minRightPosition:15,zIndexFront:1107,zIndexBack:1101,showHeader:!0,headerText:"",hideByOverlay:!0,hideByEscape:!0,callbacks:{}},o||{});e.extend(this,{init:function init(){this.initOverlay(),this.initContainers(),this.initCloseLink(),this.setEvents(),this.width=this.$el.width();},initOverlay:function initOverlay(){this.$overlay=e("<div/>").addClass(a.overlayClass).css({opacity:a.overlayOpacity}).on("click",function(){return a.hideByOverlay&&u.hide(),!1;}),i.append(this.$overlay);},showOverlay:function showOverlay(){this.$overlay.show().animate({opacity:a.overlayOpacity},150);},hideOverlay:function hideOverlay(){this.$overlay.animate({opacity:0},150,function(){u.$overlay.hide();});},initContainers:function initContainers(){var n=t.template(e(a.templateId).html());this.$el=e(n(a)),this.$elBody=this.$el.find(">."+a.bodyClass),i.append(this.$el),this.$loader=this.$el.find(">span.loader");},initCloseLink:function initCloseLink(){this.$el.find(a.closeLink).on("click",function(){return u.hide(),!1;});},setEvents:function setEvents(){var e=a.name?"."+a.name:"";n.on("resize"+e,function(){u.resize(u.bodyMaxHeight);}).on("scroll"+e,function(){u.setPositionX(),u.setPositionY();}).on("Popup_Close"+e,function(){u.hide();}),r.on("keydown"+e,function(e){e.keyCode==27&&a.hideByEscape&&u.hide();});},removeEvents:function removeEvents(){var e=a.name?"."+a.name:"";n.off("resize"+e).off("scroll"+e).off("Popup_Close"+e),r.off("keydown"+e);},addContent:function addContent(e){u.$elBody.find(">div").append(e);},replaceContent:function replaceContent(e){u.$elBody.find(">div").html(e);},toFront:function toFront(){u.$overlay.css("z-index",a.zIndexFront),u.$el.css("z-index",a.zIndexFront);},toBack:function toBack(){u.$overlay.css("z-index",a.zIndexBack),u.$el.css("z-index",a.zIndexBack);},showLoader:function showLoader(){u.$loader.show();},hideLoader:function hideLoader(){u.$loader.hide();},changeHeaderText:function changeHeaderText(e){this.$el.find(a.headerTextEl).html(e);},useCallback:function useCallback(e){typeof a.callbacks[e]=="function"&&a.callbacks[e]();},show:function show(){u.useCallback("beforeShow"),u.showOverlay(),u.$el.show(),u.resize(),u.isShowed=!0;},hide:function hide(){if(!u.isShowed)return;u.hideOverlay(),u.$el.hide(),u.useCallback("afterHide"),u.isShowed=!1;},resize:function resize(e){this.bodyMaxHeight=e;var t=n.height()-a.minTopPosition-a.minBottomPosition-parseInt(this.$elBody.css("margin-top"),10)-parseInt(this.$elBody.css("margin-bottom"),10);e?this.$elBody.css({height:Math.min(e,t),"max-height":"inherit"}):this.$elBody.css({height:"auto","max-height":t}),this.setPositionX(),this.setPositionY();},setPositionX:function setPositionX(){var e=(n.width()-this.width-a.minRightPosition)/2;this.$el.css("left",Math.round(e<a.minLeftPosition?a.minLeftPosition:e+n.scrollLeft()));},setPositionY:function setPositionY(){var e=(n.height()-this.$el.height())/2;this.$el.css("top",Math.round(e<a.minTopPosition?a.minTopPosition:e)+n.scrollTop());},destroy:function destroy(){this.removeEvents(),this.$el.remove(),this.$overlay.remove();}}),this.init();};}),define("adBlockMessage",["require","popup"],function(e){"use strict";var t=e("popup"),n=window.langResource;return function(){var e=this,r=n.adBlock.attention,i=n.adBlock.adBlockText,s=n.adBlock.notified;if(!window.isAdBlockAbsent){this.popup=new t({containerClass:"popup_adBlock",headerText:r,hideByOverlay:!1,hideByEscape:!1}),this.popup.addContent("<p>"+i+"</p>");var o=$('<a class="button button_submit" href="#" onclick="return false">').text(s).click(function(){return e.popup.hide(),!1;});this.popup.addContent(o),this.popup.show();}};}),define("urls",[],function(){"use strict";function t(t){return e[t]?e[t].apply(undefined,Array.prototype.slice.call(arguments,1)):undefined;}var e={payForManyPartners:function payForManyPartners(){return"/Payment/PayForManyPartners";},partnerList:function partnerList(){return"/Partner/List";},partnerHide:function partnerHide(){return"/Partner/Hide";},changePaymentDate:function changePaymentDate(){return"/Payment/ChangePaymentDate";},partnerDiskUsageInfo:function partnerDiskUsageInfo(){return"/Partner/DiskUsageInfo";},partnerSaveDiskCleanOptions:function partnerSaveDiskCleanOptions(){return"/Partner/SaveDiskCleanOptions";},partnerCleanDiskSpace:function partnerCleanDiskSpace(){return"/Partner/CleanDiskSpace";},citySearch:function citySearch(){return"/City/Search";},isCampaignCreatable:function isCampaignCreatable(){return"/Campaign/IsCampaignCreatable";},campaignCreate:function campaignCreate(){return"/Campaign/Create";},campaignStop:function campaignStop(){return"/Campaign/Stop";},campaignConfirm:function campaignConfirm(){return"/Campaign/Confirm";},campaignRemove:function campaignRemove(){return"/Campaign/Remove";},makeCampaignArchived:function makeCampaignArchived(){return"/Campaign/MakeArchived";},uploadImage:function uploadImage(){return"/Image/UploadImage";},generateImage:function generateImage(){return"/Image/GenerateImage";},uploadVideo:function uploadVideo(){return"/Video/UploadVideo";},uploadAudio:function uploadAudio(){return"/Audio/UploadAudio";},campaignWorkload:function campaignWorkload(){return"/Campaign/GetCampaignWorkload";},monitorHistory:function monitorHistory(e){return"/Monitor/History/"+e;},monitorFullHistory:function monitorFullHistory(e){return"/Monitor/History/"+e+"?isShort=false";},monitorHistoryData:function monitorHistoryData(e,t){return"/Monitor/GetHistoryData/"+e+"?code="+t;},monitorHistoryFullData:function monitorHistoryFullData(e,t){return"/Monitor/GetHistoryData/"+e+"?code="+t+"&isShort=false";},monitorWorkingData:function monitorWorkingData(e){return"/Monitor/GetMonitorWorkingData/"+e;},monitorFullWorkingData:function monitorFullWorkingData(e){return"/Monitor/GetMonitorWorkingData/"+e+"?isShort=false";},getMonitorsListInfo:function getMonitorsListInfo(){return"/Monitor/GetMonitorsInfo";},getMonitorTimelineHistory:function getMonitorTimelineHistory(e){return"/Monitor/MonitorTimelineHistory/"+e;},monitorsForAdvertiser:function monitorsForAdvertiser(e){return"/Monitor/GetMonitorsInfoForAdvertiser?campaignToken="+e;},editMonitor:function editMonitor(){return"/Monitor/EditMonitor";},replaceMonitor:function replaceMonitor(){return"/Monitor/ReplaceMonitor";},removeMonitor:function removeMonitor(e){return"/Monitor/Remove/"+e;},monitorPrintScreen:function monitorPrintScreen(e){return"/Monitor/PrintScreen/"+e;},changeMonitorPosition:function changeMonitorPosition(){return"/monitor/replace";},nonCommercialSetDates:function nonCommercialSetDates(){return"/NonCommercial/SetDates";},nonCommercialChangeEnabled:function nonCommercialChangeEnabled(){return"/NonCommercial/ChangeEnabled";},nonCommercialRemoveVideo:function nonCommercialRemoveVideo(){return"/Video/RemoveNoncommercial";},nonCommercialSubscriptionSetDates:function nonCommercialSubscriptionSetDates(){return"/Subscription/SetDates";},getPartnersMonitorsVersions:function getPartnersMonitorsVersions(){return"/Administrator/GetPartnersMonitorsVersions";},removeAllArchiveVideo:function removeAllArchiveVideo(){return"/Video/RemoveAllArchive";},routesList:function routesList(){return"/Route/List";},monitorGpsCoordinates:function monitorGpsCoordinates(){return"/Route/MonitorGpsCoordinates";},routeTransportStops:function routeTransportStops(){return"/Route/TransportStops";},routeAddOrEdit:function routeAddOrEdit(e){return"/Route/AddOrEdit/"+e;},routeWithStops:function routeWithStops(){return"/Route/RouteWithStops";},getTotalShowsResult:function getTotalShowsResult(e,t,n){return"/"+e+"/GetTotalShowsResult"+t+"?id="+n;},getCityShowsResult:function getCityShowsResult(e,t,n,r,i){var s="/"+e+"/GetCityShowsResult"+t+"?id="+n+"&cityId="+r;return i&&(s+="&monthYear="+i),s;},getGpsResult:function getGpsResult(e,t){return"/"+e+"/GetGpsResult"+"?id="+t;},getWidgetData:function getWidgetData(){return"/Widget/GetWidgetData";},saveWidget:function saveWidget(){return"/Widget/SaveWidget";},emergencyAddOrEdit:function emergencyAddOrEdit(){return"/Emergency/AddOrEdit";},emergencyRemove:function emergencyRemove(){return"/Emergency/Remove";},emergencyMessagesList:function emergencyMessagesList(){return"/Emergency/MessageList";},emergencyFinishMessage:function emergencyFinishMessage(){return"/Emergency/FinishMessage";},monitorsListForEmergency:function monitorsListForEmergency(){return"/Monitor/GetMonitorsInfoForEmergency";},federalAgentList:function federalAgentList(){return"/FederalAgent/List";},federalAgentAddOrEdit:function federalAgentAddOrEdit(){return"/FederalAgent/AddOrEdit";},federalAgentRemove:function federalAgentRemove(){return"/FederalAgent/Remove";},getNotifications:function getNotifications(){return"/Notification/GetNotifications";},markNotificationAsShowed:function markNotificationAsShowed(){return"/Notification/NotificationShowed";},getMonitorCommands:function getMonitorCommands(e){return"/Administrator/GetMonitorsConsoleCommands?page="+e;},getLogEntries:function getLogEntries(e){return"/ActionLog/GetLogListPage?page="+e;}};return{get:t};}),define("tools.is",[],function(){"use strict";var e=Object.prototype.toString;return function(){function t(e){this._value=e;}return t.prototype.array=function(){return e.call(this._value)==="[object Array]";},t.prototype["boolean"]=function(){return e.call(this._value)==="[object Boolean]";},t.prototype.date=function(){return e.call(this._value)==="[object Date]"||this._value instanceof Date;},t.prototype.defined=function(){return typeof this._value!="undefined";},t.prototype["float"]=function(){return this.number()&&this._value%1!==0;},t.prototype.fn=function(){return e.call(this._value)==="[object Function]";},t.prototype["int"]=function(){return this.number()&&this._value%1===0;},t.prototype.number=function(){return e.call(this._value)==="[object Number]";},t.prototype.object=function(){return e.call(this._value)==="[object Object]";},t.prototype.string=function(){return e.call(this._value)==="[object String]";},t;}();}),define("tools.list",["require","tools.is"],function(e){"use strict";var t=e("tools.is");return function(){function e(e){this.isChain=!1,this._value=e;}return e.prototype.chain=function(){return this.isChain=!0,this;},e.prototype.value=e.prototype.valueOf=function(){return this.isChain=!1,this._value;},e.prototype.clone=function(){return this._value=Array.prototype.concat([],this._value),this.isChain?this:this._value;},e.prototype.each=function(e,n){var r,i;if(!new t(e).fn()||!new t(this._value).defined())throw new TypeError();for(r=0,i=this._value.length;r<i;r++){if(e.call(n||this,this._value[r],r)===!1)break;}},e.prototype.find=function(e){var t;return this.each(function(n,r){if(n==e)return t=r,!1;}),t;},e.prototype.findIndex=function(e){if(typeof e!="function")throw new TypeError("predicate must be a function");var t=this._value,n;for(var r=0,i=t.length;r<i;r++){n=t[r];if(e.call(this,n,r,t))return r;}return-1;},e.prototype.add=function(n,r){var i=new t(n).array()?n:[n];if(r){var s=this,o=new e(this._value).clone();new e(i).each(function(e){s.find(e)===undefined&&o.push(e);}),this._value=o;}else this._value=Array.prototype.concat([],this._value,i);return this.isChain?this:this._value;},e.prototype.remove=function(n){var r=this,i=new e(this._value).clone(),s=new t(n).array()?n:[n],o;return new e(s).each(function(e){o=r.find(e),o!=undefined&&i.splice(o,1);}),this._value=i,this.isChain?this:this._value;},e;}();}),define("tools.object",[],function(){"use strict";return function(){function e(e){this.isChain=!1,this._value=e;}return e.prototype.chain=function(){return this.isChain=!0,this;},e.prototype.value=function(){return this._value;},e.prototype.clone=function(){var e={};for(var t in this._value){this._value.hasOwnProperty(t)&&(e[t]=this._value[t]);}return this._value=e,this.isChain?this:this._value;},e.prototype.each=function(e,t){var n=0;for(var r in this._value){if(this._value.hasOwnProperty(r)&&e.call(t||this,r,this._value[r],n++)===!1)break;}return this.isChain?this:this._value;},e.prototype.first=function(){for(var e in this._value){if(this._value.hasOwnProperty(e)){this._value={key:e,value:this._value[e]};break;}}return this.isChain?this:this._value;},e.prototype.getProperties=function(e){var t={},n;for(var r=0,i=e.length;r<i;r++){n=e[r],this._value.hasOwnProperty(n)&&(t[n]=this._value[n]);}return t;},e;}();}),define("tools.string",[],function(){"use strict";return function(){function e(e){this._value=e;}return e.prototype.trim=function(e){return!e&&String.prototype.trim?String.prototype.trim.call(this._value):(e=e||"\\s",this._value.replace(new RegExp("^"+e+"+|"+e+"+$","g"),""));},e.prototype.capitalize=function(){return this._value=this._value.substr(0,1).toUpperCase()+this._value.substr(1),this._value;},e;}();}),define("tools.number",[],function(){"use strict";return function(){function e(e){this.isChain=!1,this._value=e;}return e.prototype.chain=function(){return this.isChain=!0,this;},e.prototype.value=function(){return this._value;},e.prototype.truncateFloat=function(e){var t=0,n=1;for(;t<e;t++){n*=10;}return this._value=Math.round(parseFloat(this._value)*n)/n,this.isChain?this:this._value;},e.prototype.formatToNumber=function(e){var t=e||".",n=/[^\-0-9]/g,r=String(this._value).split(t);return r.length<=2&&(r[0]=r[0].replace(n,""),r.length==2?(r[1]=r[1].replace(n,""),this._value=r.join(t)):this._value=r[0]),this.isChain?this:this._value;},e.prototype.range=function(e,t){var n=e||" ",r=t||".",i=String(this._value).split(r);return i.length<=2&&(i[0]=i[0].replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1"+n),i.length==2?this._value=i.join(r):this._value=i[0]),this.isChain?this:this._value;},e.prototype.decline=function(e){var t=[2,0,1,1,1,2];return e[this._value%100>4&&this._value%100<20?2:t[this._value%10<5?this._value%10:5]];},e.prototype.changeSep=function(e,t){return this._value=String(this._value).replace(e,t),this.isChain?this:this._value;},e.prototype.toTimeString=function(e){var t=e||":",n=Math.floor(this._value/3600),r=Math.floor(this._value/60)%60,i=this._value%60;return n>0&&String(n).length==1&&(n="0"+n),String(r).length==1&&(r="0"+r),String(i).length==1&&(i="0"+i),(n?n+t:"")+r+t+i;},e;}();}),function(e){"function"==typeof define&&define.amd?define("jqueryUI",["jquery"],e):e(jQuery);}(function(e){function t(t,r){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(o=e("img[usemap='#"+s+"']")[0],!!o&&n(o)):!1):(/^(input|select|textarea|button|object)$/.test(u)?!t.disabled:"a"===u?t.href||r:r)&&n(t);}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility");}).length;}function r(e){for(var t,n;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(n=parseInt(e.css("zIndex"),10),!isNaN(n)&&0!==n))return n;e=e.parent();}return 0;}function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=s(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));}function s(t){var n="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(n,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover");}).delegate(n,"mouseover",o);}function o(){e.datepicker._isDisabledDatepicker(c.inline?c.dpDiv.parent()[0]:c.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"));}function u(t,n){e.extend(t,n);for(var r in n){null==n[r]&&(t[r]=n[r]);}return t;}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function scrollParent(t){var n=this.css("position"),r="absolute"===n,i=t?/(auto|scroll|hidden)/:/(auto|scroll)/,s=this.parents().filter(function(){var t=e(this);return r&&"static"===t.css("position")?!1:i.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"));}).eq(0);return"fixed"!==n&&s.length?s:e(this[0].ownerDocument||document);},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e);});};}(),removeUniqueId:function removeUniqueId(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id");});}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t);};}):function(t,n,r){return!!e.data(t,r[3]);},focusable:function focusable(n){return t(n,!isNaN(e.attr(n,"tabindex")));},tabbable:function tabbable(n){var r=e.attr(n,"tabindex"),i=isNaN(r);return(i||r>=0)&&t(n,!i);}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,n){function r(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0);}),n;}var i="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(t){return void 0===t?o["inner"+n].call(this):this.each(function(){e(this).css(s,r(this,t)+"px");});},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?o["outer"+n].call(this,t):this.each(function(){e(this).css(s,r(this,t,!0,i)+"px");});};}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e));}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this);};}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t);},n);}):t.apply(this,arguments);};}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault();});};}(),enableSelection:function enableSelection(){return this.unbind(".ui-disableSelection");},zIndex:function zIndex(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var n,r,i=e(this[0]);i.length&&i[0]!==document;){if(n=i.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(i.css("zIndex"),10),!isNaN(r)&&0!==r))return r;i=i.parent();}return 0;}}),e.ui.plugin={add:function add(t,n,r){var i,s=e.ui[t].prototype;for(i in r){s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]]);}},call:function call(e,t,n,r){var i,s=e.plugins[t];if(s&&(r||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(i=0;s.length>i;i++){e.options[s[i][0]]&&s[i][1].apply(e.element,n);}}};var a=0,f=Array.prototype.slice;e.cleanData=function(t){return function(n){var r,i,s;for(s=0;null!=(i=n[s]);s++){try{r=e._data(i,"events"),r&&r.remove&&e(i).triggerHandler("remove");}catch(o){}}t(n);};}(e.cleanData),e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];return t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i);},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t);},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n(),u.options=e.widget.extend({},u.options),e.each(r,function(t,r){return e.isFunction(r)?(a[t]=function(){var e=function e(){return n.prototype[t].apply(this,arguments);},i=function i(e){return n.prototype[t].apply(this,e);};return function(){var t,n=this._super,s=this._superApply;return this._super=e,this._superApply=i,t=r.apply(this,arguments),this._super=n,this._superApply=s,t;};}(),void 0):(a[t]=r,void 0);}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix||t:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto);}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o),o;},e.widget.extend=function(t){for(var n,r,i=f.call(arguments,1),s=0,o=i.length;o>s;s++){for(n in i[s]){r=i[s][n],i[s].hasOwnProperty(n)&&void 0!==r&&(t[n]=e.isPlainObject(r)?e.isPlainObject(t[n])?e.widget.extend({},t[n],r):e.widget.extend({},r):r);}}return t;},e.widget.bridge=function(t,n){var r=n.prototype.widgetFullName||t;e.fn[t]=function(i){var s="string"==typeof i,o=f.call(arguments,1),u=this;return s?this.each(function(){var n,s=e.data(this,r);return"instance"===i?(u=s,!1):s?e.isFunction(s[i])&&"_"!==i.charAt(0)?(n=s[i].apply(s,o),n!==s&&void 0!==n?(u=n&&n.jquery?u.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+i+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+i+"'");}):(o.length&&(i=e.widget.extend.apply(null,[i].concat(o))),this.each(function(){var t=e.data(this,r);t?(t.option(i||{}),t._init&&t._init()):e.data(this,r,new n(i,this));})),u;};},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function _createWidget(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=a++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function remove(e){e.target===n&&this.destroy();}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init();},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function destroy(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus");},_destroy:e.noop,widget:function widget(){return this.element;},option:function option(t,n){var r,i,s,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},r=t.split("."),t=r.shift(),r.length){for(i=o[t]=e.widget.extend({},this.options[t]),s=0;r.length-1>s;s++){i[r[s]]=i[r[s]]||{},i=i[r[s]];}if(t=r.pop(),1===arguments.length)return void 0===i[t]?null:i[t];i[t]=n;}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=n;}return this._setOptions(o),this;},_setOptions:function _setOptions(e){var t;for(t in e){this._setOption(t,e[t]);}return this;},_setOption:function _setOption(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this;},enable:function enable(){return this._setOptions({disabled:!1});},disable:function disable(){return this._setOptions({disabled:!0});},_on:function _on(t,n,r){var i,s=this;"boolean"!=typeof t&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){return t||s.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?s[o]:o).apply(s,arguments):void 0;}"string"!=typeof o&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^([\w:-]*)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u);});},_off:function _off(t,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(n).undelegate(n),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get());},_delay:function _delay(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments);}var r=this;return setTimeout(n,t||0);},_hoverable:function _hoverable(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function mouseenter(t){e(t.currentTarget).addClass("ui-state-hover");},mouseleave:function mouseleave(t){e(t.currentTarget).removeClass("ui-state-hover");}});},_focusable:function _focusable(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function focusin(t){e(t.currentTarget).addClass("ui-state-focus");},focusout:function focusout(t){e(t.currentTarget).removeClass("ui-state-focus");}});},_trigger:function _trigger(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(i in s){i in n||(n[i]=s[i]);}return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented());}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var o,u=i?i===!0||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n();});};}),e.widget;var l=!1;e(document).mouseup(function(){l=!1;}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function _mouseInit(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e);}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0;}),this.started=!1;},_mouseDestroy:function _mouseDestroy(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);},_mouseDown:function _mouseDown(t){if(!l){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var n=this,r=1===t.which,i="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return r&&!i&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0;},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e);},this._mouseUpDelegate=function(e){return n._mouseUp(e);},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),l=!0,!0)):!0;}},_mouseMove:function _mouseMove(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t);}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted);},_mouseUp:function _mouseUp(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),l=!1,!1;},_mouseDistanceMet:function _mouseDistanceMet(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance;},_mouseDelayMet:function _mouseDelayMet(){return this.mouseDelayMet;},_mouseStart:function _mouseStart(){},_mouseDrag:function _mouseDrag(){},_mouseStop:function _mouseStop(){},_mouseCapture:function _mouseCapture(){return!0;}}),e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function _create(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit();},_setOption:function _setOption(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName());},_destroy:function _destroy(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0);},_mouseCapture:function _mouseCapture(t){var n=this.options;return this._blurActiveElement(t),this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(n.iframeFix===!0?"iframe":n.iframeFix),!0):!1);},_blockFrames:function _blockFrames(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0];});},_unblockFrames:function _unblockFrames(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks);},_blurActiveElement:function _blurActiveElement(t){var n=this.document[0];if(this.handleElement.is(t.target))try{n.activeElement&&"body"!==n.activeElement.nodeName.toLowerCase()&&e(n.activeElement).blur();}catch(r){}},_mouseStart:function _mouseStart(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position");}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0);},_refreshOffsets:function _refreshOffsets(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top};},_mouseDrag:function _mouseDrag(t,n){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position;}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1;},_mouseStop:function _mouseStop(t){var n=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear();}):this._trigger("stop",t)!==!1&&this._clear(),!1;},_mouseUp:function _mouseUp(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t);},cancel:function cancel(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this;},_getHandle:function _getHandle(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0;},_setHandleClassName:function _setHandleClassName(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle");},_removeHandleClassName:function _removeHandleClassName(){this.handleElement.removeClass("ui-draggable-handle");},_createHelper:function _createHelper(t){var n=this.options,r=e.isFunction(n.helper),i=r?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),r&&i[0]===this.element[0]&&this._setPositionRelative(),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i;},_setPositionRelative:function _setPositionRelative(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative");},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);},_isRootNode:function _isRootNode(e){return /(html|body)/i.test(e.tagName)||e===this.document[0];},_getParentOffset:function _getParentOffset(){var t=this.offsetParent.offset(),n=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==n&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function _getRelativeOffset(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())};},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0};},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function _setContainment(){var t,n,r,i=this.options,s=this.document[0];return this.relativeContainer=null,i.containment?"window"===i.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===i.containment?(this.containment=[0,0,e(s).width()-this.helperProportions.width-this.margins.left,(e(s).height()||s.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):i.containment.constructor===Array?(this.containment=i.containment,void 0):("parent"===i.containment&&(i.containment=this.helper[0].parentNode),n=e(i.containment),r=n[0],r&&(t=/(scroll|auto)/.test(n.css("overflow")),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=n),void 0):(this.containment=null,void 0);},_convertPositionTo:function _convertPositionTo(e,t){t||(t=this.position);var n="absolute"===e?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top)*n,left:t.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)*n};},_generatePosition:function _generatePosition(e,t){var n,r,i,s,o=this.options,u=this._isRootNode(this.scrollParent[0]),a=e.pageX,f=e.pageY;return u&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(r=this.relativeContainer.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,e.pageX-this.offset.click.left<n[0]&&(a=n[0]+this.offset.click.left),e.pageY-this.offset.click.top<n[1]&&(f=n[1]+this.offset.click.top),e.pageX-this.offset.click.left>n[2]&&(a=n[2]+this.offset.click.left),e.pageY-this.offset.click.top>n[3]&&(f=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((f-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,f=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,a=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s),"y"===o.axis&&(a=this.originalPageX),"x"===o.axis&&(f=this.originalPageY)),{top:f-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:u?0:this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:u?0:this.offset.scroll.left)};},_clear:function _clear(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy();},_normalizeRightBottom:function _normalizeRightBottom(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"));},_trigger:function _trigger(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,n,r);},plugins:{},_uiHash:function _uiHash(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}}),e.ui.plugin.add("draggable","connectToSortable",{start:function start(t,n,r){var i=e.extend({},n,{item:r.element});r.sortables=[],e(r.options.connectToSortable).each(function(){var n=e(this).sortable("instance");n&&!n.options.disabled&&(r.sortables.push(n),n.refreshPositions(),n._trigger("activate",t,i));});},stop:function stop(t,n,r){var i=e.extend({},n,{item:r.element});r.cancelHelperRemoval=!1,e.each(r.sortables,function(){var e=this;e.isOver?(e.isOver=0,r.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,i));});},drag:function drag(t,n,r){e.each(r.sortables,function(){var i=!1,s=this;s.positionAbs=r.positionAbs,s.helperProportions=r.helperProportions,s.offset.click=r.offset.click,s._intersectsWith(s.containerCache)&&(i=!0,e.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==s&&this._intersectsWith(this.containerCache)&&e.contains(s.element[0],this.element[0])&&(i=!1),i;})),i?(s.isOver||(s.isOver=1,r._parent=n.helper.parent(),s.currentItem=n.helper.appendTo(s.element).data("ui-sortable-item",!0),s.options._helper=s.options.helper,s.options.helper=function(){return n.helper[0];},t.target=s.currentItem[0],s._mouseCapture(t,!0),s._mouseStart(t,!0,!0),s.offset.click.top=r.offset.click.top,s.offset.click.left=r.offset.click.left,s.offset.parent.left-=r.offset.parent.left-s.offset.parent.left,s.offset.parent.top-=r.offset.parent.top-s.offset.parent.top,r._trigger("toSortable",t),r.dropped=s.element,e.each(r.sortables,function(){this.refreshPositions();}),r.currentItem=r.element,s.fromOutside=r),s.currentItem&&(s._mouseDrag(t),n.position=s.position)):s.isOver&&(s.isOver=0,s.cancelHelperRemoval=!0,s.options._revert=s.options.revert,s.options.revert=!1,s._trigger("out",t,s._uiHash(s)),s._mouseStop(t,!0),s.options.revert=s.options._revert,s.options.helper=s.options._helper,s.placeholder&&s.placeholder.remove(),n.helper.appendTo(r._parent),r._refreshOffsets(t),n.position=r._generatePosition(t,!0),r._trigger("fromSortable",t),r.dropped=!1,e.each(r.sortables,function(){this.refreshPositions();}));});}}),e.ui.plugin.add("draggable","cursor",{start:function start(t,n,r){var i=e("body"),s=r.options;i.css("cursor")&&(s._cursor=i.css("cursor")),i.css("cursor",s.cursor);},stop:function stop(t,n,r){var i=r.options;i._cursor&&e("body").css("cursor",i._cursor);}}),e.ui.plugin.add("draggable","opacity",{start:function start(t,n,r){var i=e(n.helper),s=r.options;i.css("opacity")&&(s._opacity=i.css("opacity")),i.css("opacity",s.opacity);},stop:function stop(t,n,r){var i=r.options;i._opacity&&e(n.helper).css("opacity",i._opacity);}}),e.ui.plugin.add("draggable","scroll",{start:function start(e,t,n){n.scrollParentNotHidden||(n.scrollParentNotHidden=n.helper.scrollParent(!1)),n.scrollParentNotHidden[0]!==n.document[0]&&"HTML"!==n.scrollParentNotHidden[0].tagName&&(n.overflowOffset=n.scrollParentNotHidden.offset());},drag:function drag(t,n,r){var i=r.options,s=!1,o=r.scrollParentNotHidden[0],u=r.document[0];o!==u&&"HTML"!==o.tagName?(i.axis&&"x"===i.axis||(r.overflowOffset.top+o.offsetHeight-t.pageY<i.scrollSensitivity?o.scrollTop=s=o.scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(o.scrollTop=s=o.scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(r.overflowOffset.left+o.offsetWidth-t.pageX<i.scrollSensitivity?o.scrollLeft=s=o.scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(o.scrollLeft=s=o.scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(t.pageY-e(u).scrollTop()<i.scrollSensitivity?s=e(u).scrollTop(e(u).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(u).scrollTop())<i.scrollSensitivity&&(s=e(u).scrollTop(e(u).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(t.pageX-e(u).scrollLeft()<i.scrollSensitivity?s=e(u).scrollLeft(e(u).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(u).scrollLeft())<i.scrollSensitivity&&(s=e(u).scrollLeft(e(u).scrollLeft()+i.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t);}}),e.ui.plugin.add("draggable","snap",{start:function start(t,n,r){var i=r.options;r.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left});});},drag:function drag(t,n,r){var i,s,o,u,a,f,l,c,h,p,d=r.options,v=d.snapTolerance,m=n.offset.left,g=m+r.helperProportions.width,y=n.offset.top,b=y+r.helperProportions.height;for(h=r.snapElements.length-1;h>=0;h--){a=r.snapElements[h].left-r.margins.left,f=a+r.snapElements[h].width,l=r.snapElements[h].top-r.margins.top,c=l+r.snapElements[h].height,a-v>g||m>f+v||l-v>b||y>c+v||!e.contains(r.snapElements[h].item.ownerDocument,r.snapElements[h].item)?(r.snapElements[h].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[h].item})),r.snapElements[h].snapping=!1):("inner"!==d.snapMode&&(i=v>=Math.abs(l-b),s=v>=Math.abs(c-y),o=v>=Math.abs(a-g),u=v>=Math.abs(f-m),i&&(n.position.top=r._convertPositionTo("relative",{top:l-r.helperProportions.height,left:0}).top),s&&(n.position.top=r._convertPositionTo("relative",{top:c,left:0}).top),o&&(n.position.left=r._convertPositionTo("relative",{top:0,left:a-r.helperProportions.width}).left),u&&(n.position.left=r._convertPositionTo("relative",{top:0,left:f}).left)),p=i||s||o||u,"outer"!==d.snapMode&&(i=v>=Math.abs(l-y),s=v>=Math.abs(c-b),o=v>=Math.abs(a-m),u=v>=Math.abs(f-g),i&&(n.position.top=r._convertPositionTo("relative",{top:l,left:0}).top),s&&(n.position.top=r._convertPositionTo("relative",{top:c-r.helperProportions.height,left:0}).top),o&&(n.position.left=r._convertPositionTo("relative",{top:0,left:a}).left),u&&(n.position.left=r._convertPositionTo("relative",{top:0,left:f-r.helperProportions.width}).left)),!r.snapElements[h].snapping&&(i||s||o||u||p)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[h].item})),r.snapElements[h].snapping=i||s||o||u||p);}}}),e.ui.plugin.add("draggable","stack",{start:function start(t,n,r){var i,s=r.options,o=e.makeArray(e(s.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0);});o.length&&(i=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",i+t);}),this.css("zIndex",i+o.length));}}),e.ui.plugin.add("draggable","zIndex",{start:function start(t,n,r){var i=e(n.helper),s=r.options;i.css("zIndex")&&(s._zIndex=i.css("zIndex")),i.css("zIndex",s.zIndex);},stop:function stop(t,n,r){var i=r.options;i._zIndex&&e(n.helper).css("zIndex",i._zIndex);}}),e.ui.draggable,e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function _create(){var t,n=this.options,r=n.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(r)?r:function(e){return e.is(r);},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};},this._addToManager(n.scope),n.addClasses&&this.element.addClass("ui-droppable");},_addToManager:function _addToManager(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this);},_splice:function _splice(e){for(var t=0;e.length>t;t++){e[t]===this&&e.splice(t,1);}},_destroy:function _destroy(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled");},_setOption:function _setOption(t,n){if("accept"===t)this.accept=e.isFunction(n)?n:function(e){return e.is(n);};else if("scope"===t){var r=e.ui.ddmanager.droppables[this.options.scope];this._splice(r),this._addToManager(n);}this._super(t,n);},_activate:function _activate(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n));},_deactivate:function _deactivate(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n));},_over:function _over(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)));},_out:function _out(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)));},_drop:function _drop(t,n){var r=n||e.ui.ddmanager.current,i=!1;return r&&(r.currentItem||r.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var n=e(this).droppable("instance");return n.options.greedy&&!n.options.disabled&&n.options.scope===r.options.scope&&n.accept.call(n.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(n,{offset:n.element.offset()}),n.options.tolerance,t)?(i=!0,!1):void 0;}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1):!1;},ui:function ui(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs};}}),e.ui.intersect=function(){function e(e,t,n){return e>=t&&t+n>e;}return function(t,n,r,i){if(!n.offset)return!1;var s=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,u=s+t.helperProportions.width,a=o+t.helperProportions.height,f=n.offset.left,l=n.offset.top,c=f+n.proportions().width,h=l+n.proportions().height;switch(r){case"fit":return s>=f&&c>=u&&o>=l&&h>=a;case"intersect":return s+t.helperProportions.width/2>f&&c>u-t.helperProportions.width/2&&o+t.helperProportions.height/2>l&&h>a-t.helperProportions.height/2;case"pointer":return e(i.pageY,l,n.proportions().height)&&e(i.pageX,f,n.proportions().width);case"touch":return(o>=l&&h>=o||a>=l&&h>=a||l>o&&a>h)&&(s>=f&&c>=s||u>=f&&c>=u||f>s&&u>c);default:return!1;}};}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function prepareOffsets(t,n){var r,i,s=e.ui.ddmanager.droppables[t.options.scope]||[],o=n?n.type:null,u=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;s.length>r;r++){if(!(s[r].options.disabled||t&&!s[r].accept.call(s[r].element[0],t.currentItem||t.element))){for(i=0;u.length>i;i++){if(u[i]===s[r].element[0]){s[r].proportions().height=0;continue e;}}s[r].visible="none"!==s[r].element.css("display"),s[r].visible&&("mousedown"===o&&s[r]._activate.call(s[r],n),s[r].offset=s[r].element.offset(),s[r].proportions({width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight}));}}},drop:function drop(t,n){var r=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,n)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n)));}),r;},dragStart:function dragStart(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n);});},drag:function drag(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,i,s,o=e.ui.intersect(t,this,this.options.tolerance,n),u=!o&&this.isover?"isout":o&&!this.isover?"isover":null;u&&(this.options.greedy&&(i=this.options.scope,s=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===i;}),s.length&&(r=e(s[0]).droppable("instance"),r.greedyChild="isover"===u)),r&&"isover"===u&&(r.isover=!1,r.isout=!0,r._out.call(r,n)),this[u]=!0,this["isout"===u?"isover":"isout"]=!1,this["isover"===u?"_over":"_out"].call(this,n),r&&"isout"===u&&(r.isout=!1,r.isover=!0,r._over.call(r,n)));}});},dragStop:function dragStop(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n);}},e.ui.droppable,e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function _isOverAxis(e,t,n){return e>=t&&t+n>e;},_isFloating:function _isFloating(e){return /left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"));},_create:function _create(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0;},_setOption:function _setOption(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName();},_setHandleClassName:function _setHandleClassName(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle");});},_destroy:function _destroy(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--){this.items[e].item.removeData(this.widgetName+"-item");}return this;},_mouseCapture:function _mouseCapture(t,n){var r=null,i=!1,s=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,s.widgetName+"-item")===s?(r=e(this),!1):void 0;}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target)),r?!this.options.handle||n||(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0);}),i)?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1:!1);},_mouseStart:function _mouseStart(t,n,r){var i,s,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",t,this._uiHash(this));}return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0;},_mouseDrag:function _mouseDrag(t){var n,r,i,s,o=this.options,u=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?u=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(u=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?u=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(u=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--){if(r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r),s&&r.instance===this.currentContainer&&i!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],i):!0)){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break;}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1;},_mouseStop:function _mouseStop(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,i=this.placeholder.offset(),s=this.options.axis,o={};s&&"x"!==s||(o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(t);});}else this._clear(t,n);return!1;}},cancel:function cancel(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--){this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0);}}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this;},serialize:function serialize(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]));}),!r.length&&t.key&&r.push(t.key+"="),r.join("&");},toArray:function toArray(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"");}),r;},_intersectsWith:function _intersectsWith(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c="x"===this.options.axis||r+f>u&&a>r+f,h="y"===this.options.axis||t+l>s&&o>t+l,p=c&&h;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>s&&o>n-this.helperProportions.width/2&&r+this.helperProportions.height/2>u&&a>i-this.helperProportions.height/2;},_intersectsWithPointer:function _intersectsWithPointer(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=t&&n,i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return r?this.floating?s&&"right"===s||"down"===i?2:1:i&&("down"===i?2:1):!1;},_intersectsWithSides:function _intersectsWithSides(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection();return this.floating&&i?"right"===i&&n||"left"===i&&!n:r&&("down"===r&&t||"up"===r&&!t);},_getDragVerticalDirection:function _getDragVerticalDirection(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up");},_getDragHorizontalDirection:function _getDragHorizontalDirection(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left");},refresh:function refresh(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this;},_connectWith:function _connectWith(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith;},_getItemsAsjQuery:function _getItemsAsjQuery(t){function n(){u.push(this);}var r,i,s,o,u=[],a=[],f=this._connectWith();if(f&&t)for(r=f.length-1;r>=0;r--){for(s=e(f[r],this.document[0]),i=s.length-1;i>=0;i--){o=e.data(s[i],this.widgetFullName),o&&o!==this&&!o.options.disabled&&a.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);}}for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=a.length-1;r>=0;r--){a[r][0].each(n);}return e(u);},_removeCurrentsFromItems:function _removeCurrentsFromItems(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;t.length>n;n++){if(t[n]===e.item[0])return!1;}return!0;});},_refreshItems:function _refreshItems(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--){for(i=e(h[n],this.document[0]),r=i.length-1;r>=0;r--){s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s));}}for(n=c.length-1;n>=0;n--){for(o=c[n][1],u=c[n][0],r=0,f=u.length;f>r;r++){a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0});}}},refreshPositions:function refreshPositions(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--){r=this.items[n],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top);}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--){s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();}return this;},_createPlaceholder:function _createPlaceholder(t){t=t||this;var n,r=t.options;r.placeholder&&r.placeholder.constructor!==String||(n=r.placeholder,r.placeholder={element:function element(){var r=t.currentItem[0].nodeName.toLowerCase(),i=e("<"+r+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===r?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(i)):"tr"===r?t._createTrPlaceholder(t.currentItem,i):"img"===r&&i.attr("src",t.currentItem.attr("src")),n||i.css("visibility","hidden"),i;},update:function update(e,i){(!n||r.forcePlaceholderSize)&&(i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)));}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder);},_createTrPlaceholder:function _createTrPlaceholder(t,n){var r=this;t.children().each(function(){e("<td>&#160;</td>",r.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n);});},_contactContainers:function _contactContainers(t){var n,r,i,s,o,u,a,f,l,c,h=null,p=null;for(n=this.containers.length-1;n>=0;n--){if(!e.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(h&&e.contains(this.containers[n].element[0],h.element[0]))continue;h=this.containers[n],p=n;}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",t,this._uiHash(this)),this.containers[n].containerCache.over=0);}if(h)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(i=1e4,s=null,l=h.floating||this._isFloating(this.currentItem),o=l?"left":"top",u=l?"width":"height",c=l?"clientX":"clientY",r=this.items.length-1;r>=0;r--){e.contains(this.containers[p].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(a=this.items[r].item.offset()[o],f=!1,t[c]-a>this.items[r][u]/2&&(f=!0),i>Math.abs(t[c]-a)&&(i=Math.abs(t[c]-a),s=this.items[r],this.direction=f?"up":"down"));}if(!s&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;s?this._rearrange(t,s,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1;}},_createHelper:function _createHelper(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r;},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);},_getParentOffset:function _getParentOffset(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function _getRelativeOffset(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}return{top:0,left:0};},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0};},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function _setContainment(){var t,n,r,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),("document"===i.containment||"window"===i.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===i.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===i.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]);},_convertPositionTo:function _convertPositionTo(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r};},_generatePosition:function _generatePosition(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())};},_rearrange:function _rearrange(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r);});},_clear:function _clear(e,t){function n(e,t,n){return function(r){n._trigger(e,r,t._uiHash(t));};}this.reverting=!1;var r,i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS){("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else this.currentItem.show();for(this.fromOutside&&!t&&i.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside));}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||i.push(function(e){this._trigger("update",e,this._uiHash());}),this!==this.currentContainer&&(t||(i.push(function(e){this._trigger("remove",e,this._uiHash());}),i.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this));};}.call(this,this.currentContainer)),i.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this));};}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--){t||i.push(n("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(n("out",this,this.containers[r])),this.containers[r].containerCache.over=0);}if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(r=0;i.length>r;r++){i[r].call(this,e);}this._trigger("stop",e,this._uiHash());}return this.fromOutside=!1,!this.cancelHelperRemoval;},_trigger:function _trigger(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel();},_uiHash:function _uiHash(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null};}}),e.extend(e.ui,{datepicker:{version:"1.11.4"}});var c;e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function _widgetDatepicker(){return this.dpDiv;},setDefaults:function setDefaults(e){return u(this._defaults,e||{}),this;},_attachDatepicker:function _attachDatepicker(t,n){var r,i,s;r=t.nodeName.toLowerCase(),i="div"===r||"span"===r,t.id||(this.uuid+=1,t.id="dp"+this.uuid),s=this._newInst(e(t),i),s.settings=e.extend({},n||{}),"input"===r?this._connectDatepicker(t,s):i&&this._inlineDatepicker(t,s);},_newInst:function _newInst(t,n){var r=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:n,dpDiv:n?s(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv};},_connectDatepicker:function _connectDatepicker(t,n){var r=e(t);n.append=e([]),n.trigger=e([]),r.hasClass(this.markerClassName)||(this._attachments(r,n),r.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(n),e.data(t,"datepicker",n),n.settings.disabled&&this._disableDatepicker(t));},_attachments:function _attachments(t,n){var r,i,s,o=this._get(n,"appendText"),u=this._get(n,"isRTL");n.append&&n.append.remove(),o&&(n.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[u?"before":"after"](n.append)),t.unbind("focus",this._showDatepicker),n.trigger&&n.trigger.remove(),r=this._get(n,"showOn"),("focus"===r||"both"===r)&&t.focus(this._showDatepicker),("button"===r||"both"===r)&&(i=this._get(n,"buttonText"),s=this._get(n,"buttonImage"),n.trigger=e(this._get(n,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:s,alt:i,title:i}):e("<button type='button'></button>").addClass(this._triggerClass).html(s?e("<img/>").attr({src:s,alt:i,title:i}):i)),t[u?"before":"after"](n.trigger),n.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1;}));},_autoSize:function _autoSize(e){if(this._get(e,"autoSize")&&!e.inline){var t,n,r,i,s=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function t(e){for(n=0,r=0,i=0;e.length>i;i++){e[i].length>n&&(n=e[i].length,r=i);}return r;},s.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),e.input.attr("size",this._formatDate(e,s).length);}},_inlineDatepicker:function _inlineDatepicker(t,n){var r=e(t);r.hasClass(this.markerClassName)||(r.addClass(this.markerClassName).append(n.dpDiv),e.data(t,"datepicker",n),this._setDate(n,this._getDefaultDate(n),!0),this._updateDatepicker(n),this._updateAlternate(n),n.settings.disabled&&this._disableDatepicker(t),n.dpDiv.css("display","block"));},_dialogDatepicker:function _dialogDatepicker(t,n,r,i,s){var o,a,f,l,c,h=this._dialogInst;return h||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),h=this._dialogInst=this._newInst(this._dialogInput,!1),h.settings={},e.data(this._dialogInput[0],"datepicker",h)),u(h.settings,i||{}),n=n&&n.constructor===Date?this._formatDate(h,n):n,this._dialogInput.val(n),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,this._pos||(a=document.documentElement.clientWidth,f=document.documentElement.clientHeight,l=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[a/2-100+l,f/2-150+c]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),h.settings.onSelect=r,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",h),this;},_destroyDatepicker:function _destroyDatepicker(t){var n,r=e(t),i=e.data(t,"datepicker");r.hasClass(this.markerClassName)&&(n=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===n?(i.append.remove(),i.trigger.remove(),r.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===n||"span"===n)&&r.removeClass(this.markerClassName).empty(),c===i&&(c=null));},_enableDatepicker:function _enableDatepicker(t){var n,r,i=e(t),s=e.data(t,"datepicker");i.hasClass(this.markerClassName)&&(n=t.nodeName.toLowerCase(),"input"===n?(t.disabled=!1,s.trigger.filter("button").each(function(){this.disabled=!1;}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===n||"span"===n)&&(r=i.children("."+this._inlineClass),r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e;}));},_disableDatepicker:function _disableDatepicker(t){var n,r,i=e(t),s=e.data(t,"datepicker");i.hasClass(this.markerClassName)&&(n=t.nodeName.toLowerCase(),"input"===n?(t.disabled=!0,s.trigger.filter("button").each(function(){this.disabled=!0;}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===n||"span"===n)&&(r=i.children("."+this._inlineClass),r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e;}),this._disabledInputs[this._disabledInputs.length]=t);},_isDisabledDatepicker:function _isDisabledDatepicker(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++){if(this._disabledInputs[t]===e)return!0;}return!1;},_getInst:function _getInst(t){try{return e.data(t,"datepicker");}catch(n){throw"Missing instance data for this datepicker";}},_optionDatepicker:function _optionDatepicker(t,n,r){var i,s,o,a,f=this._getInst(t);return 2===arguments.length&&"string"==typeof n?"defaults"===n?e.extend({},e.datepicker._defaults):f?"all"===n?e.extend({},f.settings):this._get(f,n):null:(i=n||{},"string"==typeof n&&(i={},i[n]=r),f&&(this._curInst===f&&this._hideDatepicker(),s=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(f,"min"),a=this._getMinMaxDate(f,"max"),u(f.settings,i),null!==o&&void 0!==i.dateFormat&&void 0===i.minDate&&(f.settings.minDate=this._formatDate(f,o)),null!==a&&void 0!==i.dateFormat&&void 0===i.maxDate&&(f.settings.maxDate=this._formatDate(f,a)),"disabled"in i&&(i.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),f),this._autoSize(f),this._setDate(f,s),this._updateAlternate(f),this._updateDatepicker(f)),void 0);},_changeDatepicker:function _changeDatepicker(e,t,n){this._optionDatepicker(e,t,n);},_refreshDatepicker:function _refreshDatepicker(e){var t=this._getInst(e);t&&this._updateDatepicker(t);},_setDateDatepicker:function _setDateDatepicker(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n));},_getDateDatepicker:function _getDateDatepicker(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null;},_doKeyDown:function _doKeyDown(t){var n,r,i,s=e.datepicker._getInst(t.target),o=!0,u=s.dpDiv.is(".ui-datepicker-rtl");if(s._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return i=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",s.dpDiv),i[0]&&e.datepicker._selectDay(t.target,s.selectedMonth,s.selectedYear,i[0]),n=e.datepicker._get(s,"onSelect"),n?(r=e.datepicker._formatDate(s),n.apply(s.input?s.input[0]:null,[r,s])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,u?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,u?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1;}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation());},_doKeyPress:function _doKeyPress(t){var n,r,i=e.datepicker._getInst(t.target);return e.datepicker._get(i,"constrainInput")?(n=e.datepicker._possibleChars(e.datepicker._get(i,"dateFormat")),r=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">r||!n||n.indexOf(r)>-1):void 0;},_doKeyUp:function _doKeyUp(t){var n,r=e.datepicker._getInst(t.target);if(r.input.val()!==r.lastVal)try{n=e.datepicker.parseDate(e.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,e.datepicker._getFormatConfig(r)),n&&(e.datepicker._setDateFromField(r),e.datepicker._updateAlternate(r),e.datepicker._updateDatepicker(r));}catch(i){}return!0;},_showDatepicker:function _showDatepicker(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var n,i,s,o,a,f,l;n=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==n&&(e.datepicker._curInst.dpDiv.stop(!0,!0),n&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),i=e.datepicker._get(n,"beforeShow"),s=i?i.apply(t,[t,n]):{},s!==!1&&(u(n.settings,s),n.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(n),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o;}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(n),a=e.datepicker._checkOffset(n,a,o),n.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),n.inline||(f=e.datepicker._get(n,"showAnim"),l=e.datepicker._get(n,"duration"),n.dpDiv.css("z-index",r(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[f]?n.dpDiv.show(f,e.datepicker._get(n,"showOptions"),l):n.dpDiv[f||"show"](f?l:null),e.datepicker._shouldFocusInput(n)&&n.input.focus(),e.datepicker._curInst=n));}},_updateDatepicker:function _updateDatepicker(t){this.maxRows=4,c=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var n,r=this._getNumberOfMonths(t),i=r[1],s=17,u=t.dpDiv.find("."+this._dayOverClass+" a");u.length>0&&o.apply(u.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),i>1&&t.dpDiv.addClass("ui-datepicker-multi-"+i).css("width",s*i+"em"),t.dpDiv[(1!==r[0]||1!==r[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(n=t.yearshtml,setTimeout(function(){n===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),n=t.yearshtml=null;},0));},_shouldFocusInput:function _shouldFocusInput(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus");},_checkOffset:function _checkOffset(t,n,r){var i=t.dpDiv.outerWidth(),s=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,u=t.input?t.input.outerHeight():0,a=document.documentElement.clientWidth+(r?0:e(document).scrollLeft()),f=document.documentElement.clientHeight+(r?0:e(document).scrollTop());return n.left-=this._get(t,"isRTL")?i-o:0,n.left-=r&&n.left===t.input.offset().left?e(document).scrollLeft():0,n.top-=r&&n.top===t.input.offset().top+u?e(document).scrollTop():0,n.left-=Math.min(n.left,n.left+i>a&&a>i?Math.abs(n.left+i-a):0),n.top-=Math.min(n.top,n.top+s>f&&f>s?Math.abs(s+u):0),n;},_findPos:function _findPos(t){for(var n,r=this._getInst(t),i=this._get(r,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));){t=t[i?"previousSibling":"nextSibling"];}return n=e(t).offset(),[n.left,n.top];},_hideDatepicker:function _hideDatepicker(t){var n,r,i,s,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(n=this._get(o,"showAnim"),r=this._get(o,"duration"),i=function i(){e.datepicker._tidyDialog(o);},e.effects&&(e.effects.effect[n]||e.effects[n])?o.dpDiv.hide(n,e.datepicker._get(o,"showOptions"),r,i):o.dpDiv["slideDown"===n?"slideUp":"fadeIn"===n?"fadeOut":"hide"](n?r:null,i),n||i(),this._datepickerShowing=!1,s=this._get(o,"onClose"),s&&s.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1);},_tidyDialog:function _tidyDialog(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar");},_checkExternalClick:function _checkExternalClick(t){if(e.datepicker._curInst){var n=e(t.target),r=e.datepicker._getInst(n[0]);(n[0].id!==e.datepicker._mainDivId&&0===n.parents("#"+e.datepicker._mainDivId).length&&!n.hasClass(e.datepicker.markerClassName)&&!n.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||n.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==r)&&e.datepicker._hideDatepicker();}},_adjustDate:function _adjustDate(t,n,r){var i=e(t),s=this._getInst(i[0]);this._isDisabledDatepicker(i[0])||(this._adjustInstDate(s,n+("M"===r?this._get(s,"showCurrentAtPos"):0),r),this._updateDatepicker(s));},_gotoToday:function _gotoToday(t){var n,r=e(t),i=this._getInst(r[0]);this._get(i,"gotoCurrent")&&i.currentDay?(i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear):(n=new Date(),i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()),this._notifyChange(i),this._adjustDate(r);},_selectMonthYear:function _selectMonthYear(t,n,r){var i=e(t),s=this._getInst(i[0]);s["selected"+("M"===r?"Month":"Year")]=s["draw"+("M"===r?"Month":"Year")]=parseInt(n.options[n.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(i);},_selectDay:function _selectDay(t,n,r,i){var s,o=e(t);e(i).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(s=this._getInst(o[0]),s.selectedDay=s.currentDay=e("a",i).html(),s.selectedMonth=s.currentMonth=n,s.selectedYear=s.currentYear=r,this._selectDate(t,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear)));},_clearDate:function _clearDate(t){var n=e(t);this._selectDate(n,"");},_selectDate:function _selectDate(t,n){var r,i=e(t),s=this._getInst(i[0]);n=null!=n?n:this._formatDate(s),s.input&&s.input.val(n),this._updateAlternate(s),r=this._get(s,"onSelect"),r?r.apply(s.input?s.input[0]:null,[n,s]):s.input&&s.input.trigger("change"),s.inline?this._updateDatepicker(s):(this._hideDatepicker(),this._lastInput=s.input[0],"object"!=_typeof(s.input[0])&&s.input.focus(),this._lastInput=null);},_updateAlternate:function _updateAlternate(t){var n,r,i,s=this._get(t,"altField");s&&(n=this._get(t,"altFormat")||this._get(t,"dateFormat"),r=this._getDate(t),i=this.formatDate(n,r,this._getFormatConfig(t)),e(s).each(function(){e(this).val(i);}));},noWeekends:function noWeekends(e){var t=e.getDay();return[t>0&&6>t,""];},iso8601Week:function iso8601Week(e){var t,n=new Date(e.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),t=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((t-n)/864e5)/7)+1;},parseDate:function parseDate(t,n,r){if(null==t||null==n)throw"Invalid arguments";if(n="object"==_typeof(n)?""+n:n+"",""===n)return null;var i,s,o,u,a=0,f=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,l="string"!=typeof f?f:new Date().getFullYear()%100+parseInt(f,10),c=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,h=(r?r.dayNames:null)||this._defaults.dayNames,p=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,d=(r?r.monthNames:null)||this._defaults.monthNames,v=-1,m=-1,g=-1,y=-1,b=!1,w=function w(e){var n=t.length>i+1&&t.charAt(i+1)===e;return n&&i++,n;},E=function E(e){var t=w(e),r="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,i="y"===e?r:1,s=RegExp("^\\d{"+i+","+r+"}"),o=n.substring(a).match(s);if(!o)throw"Missing number at position "+a;return a+=o[0].length,parseInt(o[0],10);},S=function S(t,r,i){var s=-1,o=e.map(w(t)?i:r,function(e,t){return[[t,e]];}).sort(function(e,t){return-(e[1].length-t[1].length);});if(e.each(o,function(e,t){var r=t[1];return n.substr(a,r.length).toLowerCase()===r.toLowerCase()?(s=t[0],a+=r.length,!1):void 0;}),-1!==s)return s+1;throw"Unknown name at position "+a;},x=function x(){if(n.charAt(a)!==t.charAt(i))throw"Unexpected literal at position "+a;a++;};for(i=0;t.length>i;i++){if(b)"'"!==t.charAt(i)||w("'")?x():b=!1;else switch(t.charAt(i)){case"d":g=E("d");break;case"D":S("D",c,h);break;case"o":y=E("o");break;case"m":m=E("m");break;case"M":m=S("M",p,d);break;case"y":v=E("y");break;case"@":u=new Date(E("@")),v=u.getFullYear(),m=u.getMonth()+1,g=u.getDate();break;case"!":u=new Date((E("!")-this._ticksTo1970)/1e4),v=u.getFullYear(),m=u.getMonth()+1,g=u.getDate();break;case"'":w("'")?x():b=!0;break;default:x();}}if(n.length>a&&(o=n.substr(a),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===v?v=new Date().getFullYear():100>v&&(v+=new Date().getFullYear()-new Date().getFullYear()%100+(l>=v?0:-100)),y>-1)for(m=1,g=y;;){if(s=this._getDaysInMonth(v,m-1),s>=g)break;m++,g-=s;}if(u=this._daylightSavingAdjust(new Date(v,m-1,g)),u.getFullYear()!==v||u.getMonth()+1!==m||u.getDate()!==g)throw"Invalid date";return u;},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function formatDate(e,t,n){if(!t)return"";var r,i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=function a(t){var n=e.length>r+1&&e.charAt(r+1)===t;return n&&r++,n;},f=function f(e,t,n){var r=""+t;if(a(e))for(;n>r.length;){r="0"+r;}return r;},l=function l(e,t,n,r){return a(e)?r[t]:n[t];},c="",h=!1;if(t)for(r=0;e.length>r;r++){if(h)"'"!==e.charAt(r)||a("'")?c+=e.charAt(r):h=!1;else switch(e.charAt(r)){case"d":c+=f("d",t.getDate(),2);break;case"D":c+=l("D",t.getDay(),i,s);break;case"o":c+=f("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=f("m",t.getMonth()+1,2);break;case"M":c+=l("M",t.getMonth(),o,u);break;case"y":c+=a("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":c+=t.getTime();break;case"!":c+=1e4*t.getTime()+this._ticksTo1970;break;case"'":a("'")?c+="'":h=!0;break;default:c+=e.charAt(r);}}return c;},_possibleChars:function _possibleChars(e){var t,n="",r=!1,i=function i(n){var r=e.length>t+1&&e.charAt(t+1)===n;return r&&t++,r;};for(t=0;e.length>t;t++){if(r)"'"!==e.charAt(t)||i("'")?n+=e.charAt(t):r=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":n+="0123456789";break;case"D":case"M":return null;case"'":i("'")?n+="'":r=!0;break;default:n+=e.charAt(t);}}return n;},_get:function _get(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t];},_setDateFromField:function _setDateFromField(e,t){if(e.input.val()!==e.lastVal){var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i=this._getDefaultDate(e),s=i,o=this._getFormatConfig(e);try{s=this.parseDate(n,r,o)||i;}catch(u){r=t?"":r;}e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),e.currentDay=r?s.getDate():0,e.currentMonth=r?s.getMonth():0,e.currentYear=r?s.getFullYear():0,this._adjustInstDate(e);}},_getDefaultDate:function _getDefaultDate(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date()));},_determineDate:function _determineDate(t,n,r){var i=function i(e){var t=new Date();return t.setDate(t.getDate()+e),t;},s=function s(n){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),n,e.datepicker._getFormatConfig(t));}catch(r){}for(var i=(n.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date(),s=i.getFullYear(),o=i.getMonth(),u=i.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,f=a.exec(n);f;){switch(f[2]||"d"){case"d":case"D":u+=parseInt(f[1],10);break;case"w":case"W":u+=7*parseInt(f[1],10);break;case"m":case"M":o+=parseInt(f[1],10),u=Math.min(u,e.datepicker._getDaysInMonth(s,o));break;case"y":case"Y":s+=parseInt(f[1],10),u=Math.min(u,e.datepicker._getDaysInMonth(s,o));}f=a.exec(n);}return new Date(s,o,u);},o=null==n||""===n?r:"string"==typeof n?s(n):"number"==typeof n?isNaN(n)?r:i(n):new Date(n.getTime());return o=o&&"Invalid Date"==""+o?r:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o);},_daylightSavingAdjust:function _daylightSavingAdjust(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null;},_setDate:function _setDate(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date()));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),i===e.selectedMonth&&s===e.selectedYear||n||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e));},_getDate:function _getDate(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t;},_attachHandlers:function _attachHandlers(t){var n=this._get(t,"stepMonths"),r="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function prev(){e.datepicker._adjustDate(r,-n,"M");},next:function next(){e.datepicker._adjustDate(r,+n,"M");},hide:function hide(){e.datepicker._hideDatepicker();},today:function today(){e.datepicker._gotoToday(r);},selectDay:function selectDay(){return e.datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1;},selectMonth:function selectMonth(){return e.datepicker._selectMonthYear(r,this,"M"),!1;},selectYear:function selectYear(){return e.datepicker._selectMonthYear(r,this,"Y"),!1;}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")]);});},_generateHTML:function _generateHTML(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=new Date(),R=this._daylightSavingAdjust(new Date(q.getFullYear(),q.getMonth(),q.getDate())),U=this._get(e,"isRTL"),z=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),X=this._get(e,"navigationAsDateFormat"),V=this._getNumberOfMonths(e),$=this._get(e,"showCurrentAtPos"),J=this._get(e,"stepMonths"),K=1!==V[0]||1!==V[1],Q=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),G=this._getMinMaxDate(e,"min"),Y=this._getMinMaxDate(e,"max"),Z=e.drawMonth-$,et=e.drawYear;if(0>Z&&(Z+=12,et--),Y)for(t=this._daylightSavingAdjust(new Date(Y.getFullYear(),Y.getMonth()-V[0]*V[1]+1,Y.getDate())),t=G&&G>t?G:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;){Z--,0>Z&&(Z=11,et--);}for(e.drawMonth=Z,e.drawYear=et,n=this._get(e,"prevText"),n=X?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z-J,1)),this._getFormatConfig(e)):n,r=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+n+"</span></a>",i=this._get(e,"nextText"),i=X?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z+J,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+i+"</span></a>",o=this._get(e,"currentText"),u=this._get(e,"gotoCurrent")&&e.currentDay?Q:R,o=X?this.formatDate(o,u,this._getFormatConfig(e)):o,a=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",f=z?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?a:"")+(this._isInRange(e,u)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(U?"":a)+"</div>":"",l=parseInt(this._get(e,"firstDay"),10),l=isNaN(l)?0:l,c=this._get(e,"showWeek"),h=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),d=this._get(e,"monthNames"),v=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),g=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),w="",S=0;V[0]>S;S++){for(x="",this.maxRows=4,T=0;V[1]>T;T++){if(N=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),C=" ui-corner-all",k="",K){if(k+="<div class='ui-datepicker-group",V[1]>1)switch(T){case 0:k+=" ui-datepicker-group-first",C=" ui-corner-"+(U?"right":"left");break;case V[1]-1:k+=" ui-datepicker-group-last",C=" ui-corner-"+(U?"left":"right");break;default:k+=" ui-datepicker-group-middle",C="";}k+="'>";}for(k+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+C+"'>"+(/all|left/.test(C)&&0===S?U?s:r:"")+(/all|right/.test(C)&&0===S?U?r:s:"")+this._generateMonthYearHeader(e,Z,et,G,Y,S>0||T>0,d,v)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",L=c?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",E=0;7>E;E++){A=(E+l)%7,L+="<th scope='col'"+((E+l+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+h[A]+"'>"+p[A]+"</span></th>";}for(k+=L+"</tr></thead><tbody>",O=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,O)),M=(this._getFirstDayOfMonth(et,Z)-l+7)%7,_=Math.ceil((M+O)/7),D=K?this.maxRows>_?this.maxRows:_:_,this.maxRows=D,P=this._daylightSavingAdjust(new Date(et,Z,1-M)),H=0;D>H;H++){for(k+="<tr>",B=c?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(P)+"</td>":"",E=0;7>E;E++){j=m?m.apply(e.input?e.input[0]:null,[P]):[!0,""],F=P.getMonth()!==Z,I=F&&!y||!j[0]||G&&G>P||Y&&P>Y,B+="<td class='"+((E+l+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(P.getTime()===N.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===P.getTime()&&b.getTime()===N.getTime()?" "+this._dayOverClass:"")+(I?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!g?"":" "+j[1]+(P.getTime()===Q.getTime()?" "+this._currentClass:"")+(P.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(F&&!g||!j[2]?"":" title='"+j[2].replace(/'/g,"&#39;")+"'")+(I?"":" data-handler='selectDay' data-event='click' data-month='"+P.getMonth()+"' data-year='"+P.getFullYear()+"'")+">"+(F&&!g?"&#xa0;":I?"<span class='ui-state-default'>"+P.getDate()+"</span>":"<a class='ui-state-default"+(P.getTime()===R.getTime()?" ui-state-highlight":"")+(P.getTime()===Q.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+P.getDate()+"</a>")+"</td>",P.setDate(P.getDate()+1),P=this._daylightSavingAdjust(P);}k+=B+"</tr>";}Z++,Z>11&&(Z=0,et++),k+="</tbody></table>"+(K?"</div>"+(V[0]>0&&T===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=k;}w+=x;}return w+=f,e._keyEvent=!1,w;},_generateMonthYearHeader:function _generateMonthYearHeader(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m=this._get(e,"changeMonth"),g=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",w="";if(s||!m)w+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(a=r&&r.getFullYear()===n,f=i&&i.getFullYear()===n,w+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",l=0;12>l;l++){(!a||l>=r.getMonth())&&(!f||i.getMonth()>=l)&&(w+="<option value='"+l+"'"+(l===t?" selected='selected'":"")+">"+u[l]+"</option>");}w+="</select>";}if(y||(b+=w+(!s&&m&&g?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",s||!g)b+="<span class='ui-datepicker-year'>"+n+"</span>";else{for(c=this._get(e,"yearRange").split(":"),h=new Date().getFullYear(),p=function p(e){var t=e.match(/c[+\-].*/)?n+parseInt(e.substring(1),10):e.match(/[+\-].*/)?h+parseInt(e,10):parseInt(e,10);return isNaN(t)?h:t;},d=p(c[0]),v=Math.max(d,p(c[1]||"")),d=r?Math.max(d,r.getFullYear()):d,v=i?Math.min(v,i.getFullYear()):v,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";v>=d;d++){e.yearshtml+="<option value='"+d+"'"+(d===n?" selected='selected'":"")+">"+d+"</option>";}e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null;}return b+=this._get(e,"yearSuffix"),y&&(b+=(!s&&m&&g?"":"&#xa0;")+w),b+="</div>";},_adjustInstDate:function _adjustInstDate(e,t,n){var r=e.drawYear+("Y"===n?t:0),i=e.drawMonth+("M"===n?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+("D"===n?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===n||"Y"===n)&&this._notifyChange(e);},_restrictMinMax:function _restrictMinMax(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),i=n&&n>t?n:t;return r&&i>r?r:i;},_notifyChange:function _notifyChange(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e]);},_getNumberOfMonths:function _getNumberOfMonths(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t;},_getMinMaxDate:function _getMinMaxDate(e,t){return this._determineDate(e,this._get(e,t+"Date"),null);},_getDaysInMonth:function _getDaysInMonth(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate();},_getFirstDayOfMonth:function _getFirstDayOfMonth(e,t){return new Date(e,t,1).getDay();},_canAdjustMonth:function _canAdjustMonth(e,t,n,r){var i=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(n,r+(0>t?t:i[0]*i[1]),1));return 0>t&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s);},_isInRange:function _isInRange(e,t){var n,r,i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),o=null,u=null,a=this._get(e,"yearRange");return a&&(n=a.split(":"),r=new Date().getFullYear(),o=parseInt(n[0],10),u=parseInt(n[1],10),n[0].match(/[+\-].*/)&&(o+=r),n[1].match(/[+\-].*/)&&(u+=r)),(!i||t.getTime()>=i.getTime())&&(!s||t.getTime()<=s.getTime())&&(!o||t.getFullYear()>=o)&&(!u||u>=t.getFullYear());},_getFormatConfig:function _getFormatConfig(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:new Date().getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")};},_formatDate:function _formatDate(e,t,n,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var i=t?"object"==_typeof(t)?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e));}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var n=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(n)):e.datepicker._attachDatepicker(this,t);}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n));},e.datepicker=new i(),e.datepicker.initialized=!1,e.datepicker.uuid=new Date().getTime(),e.datepicker.version="1.11.4",e.datepicker;}),define("jqueryUI.DatePicker",["require","jquery","jqueryUI"],function(e){"use strict";var t=e("jquery");e("jqueryUI"),t.datepicker.regional["ru-RU"]={closeText:"",prevText:"<",nextText:">",currentText:"",monthNames:["","","","","","","","","","","",""],monthNamesShort:["","","","","","","","","","","",""],dayNames:["","","","","","",""],dayNamesShort:["","","","","","",""],dayNamesMin:["","","","","","",""],weekHeader:"",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""};var n=window.langResource.currentLocale,r={"ru-RU":"dd M yy","en-EN":"M dd yy"};t.datepicker.setDefaults(t.datepicker.regional[n]),t.datepicker.setDefaults({dateFormat:r[n]});}),define("tools.date",["require","jquery","tools.is","jqueryUI.DatePicker"],function(e){"use strict";function s(e){var t=r[0];return e.indexOf(".")!==-1&&(t=r[1]),t;}var t=e("jquery"),n=e("tools.is");e("jqueryUI.DatePicker");var r=["yy/mm/dd","yy.mm.dd"],i=864e5;return function(){function e(e){this.isChain=!1,this._value=e;}return e.prototype.chain=function(){return this.isChain=!0,this;},e.prototype.value=function(){return this._value;},e.prototype.parse=function(e){return this._value=t.datepicker.parseDate(e||s(this._value),this._value),this.isChain?this:this._value;},e.prototype.format=function(e){return this._value=t.datepicker.formatDate(e,this._value),this.isChain?this:this._value;},e.prototype.getDateOffset=function(t){var r=new n(this._value).date()?this._value:new e(this._value).parse(),i=new Date(r);return i.setDate(r.getDate()+t),this._value=i,this.isChain?this:this._value;},e.prototype.getDaysOffset=function(t,r){var o,u=new n(this._value).date()?this._value:new e(this._value).parse();return new n(t).date()?o=new e(t).chain().format(s(this._value)).parse().value():o=new e(t).parse(r||s(this._value)),this._value=(u-o)/i,this.isChain?this:this._value;},e;}();}),define("tools.browser",[],function(){"use strict";return function(){function e(){this._agent=window.navigator.userAgent;}return e.prototype.msie=function(){return /msie|trident/i.test(this._agent);},e;}();}),define("tools.random",[],function(){"use strict";var e=2147483647,t=e,n=-e;return function(){function e(e,r){e=e!==undefined?~~e:n,r=r!==undefined?~~r:t;if(e>r)throw new Error("Minimum value cannot be greater than maximum value.");this._value=Math.random()*(r-e+1)+e;}return e.prototype.chain=function(){return this.isChain=!0,this;},e.prototype.value=function(){return this._value;},e.prototype.number=function(){return this.isChain?this:Math.floor(this._value);},e;}();}),define("tools",["require","tools.is","tools.list","tools.object","tools.string","tools.number","tools.date","tools.browser","tools.random"],function(e){"use strict";var t={},n=e("tools.is"),r=e("tools.list"),i=e("tools.object"),s=e("tools.string"),o=e("tools.number"),u=e("tools.date"),a=e("tools.browser"),f=e("tools.random");return t.is=function(e){return new n(e);},t.list=function(e){return new r(e);},t.object=function(e){return new i(e);},t.string=function(e){return new s(e);},t.number=function(e){return new o(e);},t.date=function(e){return new u(e);},t.browser=function(){return new a();},t.random=function(e,t){return new f(e,t);},t;}),define("events",["require","base"],function(e){"use strict";var t=e("base");return new t.Mediator();}),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;o="undefined"!=typeof exports?exports:e.Backbone={},o.VERSION="0.9.10";var u=e._;!u&&"undefined"!=typeof _require&&(u=_require("underscore")),o.$=e.jQuery||e.Zepto||e.ender,o.noConflict=function(){return e.Backbone=t,this;},o.emulateHTTP=!1,o.emulateJSON=!1;var a=/\s+/,f=function f(e,t,n,r){if(!n)return!0;if("object"==_typeof(n))for(var i in n){e[t].apply(e,[i,n[i]].concat(r));}else{if(!a.test(n))return!0;n=n.split(a),i=0;for(var s=n.length;i<s;i++){e[t].apply(e,[n[i]].concat(r));}}},l=function l(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:for(;++r<i;){(n=e[r]).callback.call(n.ctx);}break;case 1:for(;++r<i;){(n=e[r]).callback.call(n.ctx,t[0]);}break;case 2:for(;++r<i;){(n=e[r]).callback.call(n.ctx,t[0],t[1]);}break;case 3:for(;++r<i;){(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);}break;default:for(;++r<i;){(n=e[r]).callback.apply(n.ctx,t);}}},n=o.Events={on:function on(e,t,n){return!f(this,"on",e,[t,n])||!t?this:(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this);},once:function once(e,t,n){if(!f(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments);});return i._callback=t,this.on(e,i,n),this;},off:function off(e,t,n){var r,i,s,o,a,l,c,h;if(!this._events||!f(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events),a=0;for(l=o.length;a<l;a++){if(e=o[a],r=this._events[e]){s=[];if(t||n){c=0;for(h=r.length;c<h;c++){i=r[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&s.push(i);}}this._events[e]=s;}}return this;},trigger:function trigger(e){if(!this._events)return this;var t=i.call(arguments,1);if(!f(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this;},listenTo:function listenTo(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=u.uniqueId("l"));return r[i]=e,e.on(t,"object"==_typeof(t)?this:n,this),this;},stopListening:function stopListening(e,t,n){var r=this._listeners;if(r){if(e)e.off(t,"object"==_typeof(t)?this:n,this),!t&&!n&&delete r[e._listenerId];else{"object"==_typeof(t)&&(n=this);for(var i in r){r[i].off(t,n,this);}this._listeners={};}return this;}}};n.bind=n.on,n.unbind=n.off,u.extend(o,n);var c=o.Model=function(e,t){var n,r=e||{};this.cid=u.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments);};u.extend(c.prototype,n,{changed:null,idAttribute:"id",initialize:function initialize(){},toJSON:function toJSON(){return u.clone(this.attributes);},sync:function sync(){return o.sync.apply(this,arguments);},get:function get(e){return this.attributes[e];},escape:function escape(e){return u.escape(this.get(e));},has:function has(e){return null!=this.get(e);},set:function set(e,t,n){var r,i,s,o,a,f,l;if(null==e)return this;"object"==_typeof(e)?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,o=n.silent,e=[],a=this._changing,this._changing=!0,a||(this._previousAttributes=u.clone(this.attributes),this.changed={}),l=this.attributes,f=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i){t=i[r],u.isEqual(l[r],t)||e.push(r),u.isEqual(f[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete l[r]:l[r]=t;}if(!o){e.length&&(this._pending=!0),t=0;for(r=e.length;t<r;t++){this.trigger("change:"+e[t],this,l[e[t]],n);}}if(a)return this;if(!o)for(;this._pending;){this._pending=!1,this.trigger("change",this,n);}return this._changing=this._pending=!1,this;},unset:function unset(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}));},clear:function clear(e){var t={},n;for(n in this.attributes){t[n]=void 0;}return this.set(t,u.extend({},e,{unset:!0}));},hasChanged:function hasChanged(e){return null==e?!u.isEmpty(this.changed):u.has(this.changed,e);},changedAttributes:function changedAttributes(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes,i;for(i in e){u.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);}return n;},previous:function previous(e){return null==e||!this._previousAttributes?null:this._previousAttributes[e];},previousAttributes:function previousAttributes(){return u.clone(this._previousAttributes);},fetch:function fetch(e){e=e?u.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r);},this.sync("read",this,e);},save:function save(e,t,n){var r,i,s=this.attributes;return null==e||"object"==_typeof(e)?(r=e,n=t):(r={})[e]=t,r&&(!n||!n.wait)&&!this.set(r,n)?!1:(n=u.extend({validate:!0},n),this._validate(r,n)?(r&&n.wait&&(this.attributes=u.extend({},s,r)),void 0===n.parse&&(n.parse=!0),i=n.success,n.success=function(e,t,n){e.attributes=s;var o=e.parse(t,n);n.wait&&(o=u.extend(r||{},o));if(u.isObject(o)&&!e.set(o,n))return!1;i&&i(e,t,n);},e=this.isNew()?"create":n.patch?"patch":"update","patch"===e&&(n.attrs=r),e=this.sync(e,this,n),r&&n.wait&&(this.attributes=s),e):!1);},destroy:function destroy(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function r(){t.trigger("destroy",t,t.collection,e);};e.success=function(e,t,i){(i.wait||e.isNew())&&r(),n&&n(e,t,i);};if(this.isNew())return e.success(this,null,e),!1;var i=this.sync("delete",this,e);return e.wait||r(),i;},url:function url(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||k();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id);},parse:function parse(e){return e;},clone:function clone(){return new this.constructor(this.attributes);},isNew:function isNew(){return null==this.id;},isValid:function isValid(e){return!this.validate||!this.validate(this.attributes,e);},_validate:function _validate(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,t||{}),!1):!0;}});var h=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t));};u.extend(h.prototype,n,{model:c,initialize:function initialize(){},toJSON:function toJSON(e){return this.map(function(t){return t.toJSON(e);});},sync:function sync(){return o.sync.apply(this,arguments);},add:function add(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,i,o,a,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&null==h&&0!=t.sort,d=u.isString(this.comparator)?this.comparator:null,n=0;for(i=e.length;n<i;n++){(o=this._prepareModel(a=e[n],t))?(f=this.get(o))?t.merge&&(f.set(a===o?o.attributes:a,t),p&&!l&&f.hasChanged(d)&&(l=!0)):(c.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)):this.trigger("invalid",this,a,t);}c.length&&(p&&(l=!0),this.length+=c.length,null!=h?s.apply(this.models,[h,0].concat(c)):r.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;n=0;for(i=c.length;n<i;n++){(o=c[n]).trigger("add",o,this,t);}return l&&this.trigger("sort",this,t),this;},remove:function remove(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;n=0;for(r=e.length;n<r;n++){if(s=this.get(e[n]))delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s);}return this;},push:function push(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e;},pop:function pop(e){var t=this.at(this.length-1);return this.remove(t,e),t;},unshift:function unshift(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e;},shift:function shift(e){var t=this.at(0);return this.remove(t,e),t;},slice:function slice(e,t){return this.models.slice(e,t);},get:function get(e){if(null!=e)return this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e];},at:function at(e){return this.models[e];},where:function where(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e){if(e[n]!==t.get(n))return!1;}return!0;});},sort:function sort(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this;},pluck:function pluck(e){return u.invoke(this.models,"get",e);},update:function update(e,t){t=u.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var n,r,i,s,o=[],a=[],f={};u.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);r=0;for(i=e.length;r<i;r++){n=e[r],s=this.get(n),t.remove&&s&&(f[s.cid]=!0),(t.add&&!s||t.merge&&s)&&o.push(n);}if(t.remove){r=0;for(i=this.models.length;r<i;r++){n=this.models[r],f[n.cid]||a.push(n);}}return a.length&&this.remove(a,t),o.length&&this.add(o,t),this;},reset:function reset(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var n=0,r=this.models.length;n<r;n++){this._removeReference(this.models[n]);}return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this;},fetch:function fetch(e){e=e?u.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){e[r.update?"update":"reset"](n,r),t&&t(e,n,r);},this.sync("read",this,e);},create:function create(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i);},e.save(null,t),e;},parse:function parse(e){return e;},clone:function clone(){return new this.constructor(this.models);},_reset:function _reset(){this.length=0,this.models.length=0,this._byId={};},_prepareModel:function _prepareModel(e,t){if(e instanceof c)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1;},_removeReference:function _removeReference(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this);},_onModelEvent:function _onModelEvent(e,t,n,r){("add"===e||"remove"===e)&&n!==this||("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments));},sortedIndex:function sortedIndex(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t);};return u.sortedIndex(this.models,e,r,n);}}),u.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(e){h.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t);};}),u.each(["groupBy","countBy","sortBy"],function(e){h.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t);};return u[e](this.models,r,n);};});var p=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments);},d=/\((.*?)\)/g,v=/(\(\?)?:\w+/g,m=/\*\w+/g,g=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(p.prototype,n,{initialize:function initialize(){},route:function route(e,t,n){return u.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),o.history.route(e,u.bind(function(r){r=this._extractParameters(e,r),n&&n.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r)),this.trigger("route",t,r),o.history.trigger("route",this,t,r);},this)),this;},navigate:function navigate(e,t){return o.history.navigate(e,t),this;},_bindRoutes:function _bindRoutes(){if(this.routes)for(var e,t=u.keys(this.routes);null!=(e=t.pop());){this.route(e,this.routes[e]);}},_routeToRegExp:function _routeToRegExp(e){return e=e.replace(g,"\\$&").replace(d,"(?:$1)?").replace(v,function(e,t){return t?e:"([^/]+)";}).replace(m,"(.*?)"),RegExp("^"+e+"$");},_extractParameters:function _extractParameters(e,t){return e.exec(t).slice(1);}});var y=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history);},b=/^[#\/]|\s+$/g,w=/^\/+|\/+$/g,E=/msie [\w.]+/,S=/\/$/;y.started=!1,u.extend(y.prototype,n,{interval:50,getHash:function getHash(e){return(e=(e||this).location.href.match(/#(.*)$/))?e[1]:"";},getFragment:function getFragment(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(S,"");e.indexOf(n)||(e=e.substr(n.length));}else e=this.getHash();return e.replace(b,"");},start:function start(e){if(y.started)throw Error("Backbone.history has already been started");y.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState),e=this.getFragment();var t=document.documentMode,t=E.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t);this.root=("/"+this.root+"/").replace(w,"/"),t&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,e=this.location,t=e.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=this.getHash().replace(b,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search));if(!this.options.silent)return this.loadUrl();},stop:function stop(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),y.started=!1;},route:function route(e,t){this.handlers.unshift({route:e,callback:t});},checkUrl:function checkUrl(){var e=this.getFragment();e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe)));if(e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash());},loadUrl:function loadUrl(e){var t=this.fragment=this.getFragment(e);return u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0;});},navigate:function navigate(e,t){if(!y.started)return!1;if(!t||!0===t)t={trigger:t};e=this.getFragment(e||"");if(this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace));}t.trigger&&this.loadUrl(e);}},_updateHash:function _updateHash(e,t,n){n?(n=e.href.replace(/(javascript:|#).*$/,""),e.replace(n+"#"+t)):e.hash="#"+t;}}),o.history=new y();var x=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents();},T=/^(\S+)\s*(.*)$/,N="model collection el id attributes className tagName events".split(" ");u.extend(x.prototype,n,{tagName:"div",$:function $(e){return this.$el.find(e);},initialize:function initialize(){},render:function render(){return this;},remove:function remove(){return this.$el.remove(),this.stopListening(),this;},setElement:function setElement(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this;},delegateEvents:function delegateEvents(e){if(e||(e=u.result(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw Error('Method "'+e[t]+'" does not exist');var r=t.match(T),i=r[1],r=r[2],n=u.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.on(i,n):this.$el.on(i,r,n);}}},undelegateEvents:function undelegateEvents(){this.$el.off(".delegateEvents"+this.cid);},_configure:function _configure(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,N)),this.options=e;},_ensureElement:function _ensureElement(){if(this.el)this.setElement(u.result(this,"el"),!1);else{var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className")),e=o.$("<"+u.result(this,"tagName")+">").attr(e),this.setElement(e,!1);}}});var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=C[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||k()),null==n.data&&t&&("create"===e||"update"===e||"patch"===e)&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments);};}"GET"!==i.type&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e){a&&a(t,e,n),t.trigger("sync",t,e,n);};var f=n.error;return n.error=function(e){f&&f(t,e,n),t.trigger("error",t,e,n);},e=n.xhr=o.ajax(u.extend(i,n)),t.trigger("request",t,e,n),e;},o.ajax=function(){return o.$.ajax.apply(o.$,arguments);},c.extend=h.extend=p.extend=x.extend=y.extend=function(e,t){var n=this,r;r=e&&u.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments);},u.extend(r,n,t);var i=function i(){this.constructor=r;};return i.prototype=n.prototype,r.prototype=new i(),e&&u.extend(r.prototype,e),r.__super__=n.prototype,r;};var k=function k(){throw Error('A "url" property or function must be specified');};}.call(void 0),define("backbone",["underscore"],function(e){return function(){var t,n;return t||e.Backbone;};}(void 0)),define("templates.storage",["require","jquery","underscore"],function(e){"use strict";function i(e){var i=t(e);return i.length===1?(r[e]=n.template(i.html()),r[e]):undefined;}function s(e){return r[e]?r[e]:i(e);}var t=e("jquery"),n=e("underscore"),r={};return{get:s};}),define("archive",["require","jquery","urls","tools","events","backbone","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("events"),s=e("backbone"),o=e("templates.storage"),u=window.langResource;return function(){var e=this,a={container:"#archive",info:".js-archive-info",tooltip:".js-archive-tooltip",tooltipNav:".js-archive-tooltip-nav",tooltipTabs:".js-archive-tooltip-tab",tooltipButtonClose:".js-archive-tooltip-close",tooltipBar:".js-archive-tooltip-bar",tooltipBtnSetRules:".js-archive-set-rules",tooltipCleanOptions:".js-archive-clean-options",tooltipCleanAds:".js-archive-clean-ads",tooltipCleanNonCommercial:".js-archive-clean-noncommercial",tooltipBtnClean:".js-archive-clean"},f={hidden:"is-hidden",disabled:"is-disabled"},l={info:"#template_archive_info",tooltip:"#template_archive_tooltip",tooltipBar:"#template_archive_tooltip_bar",tooltipCleanAds:"#template_archive_tooltip_clean_ads",tooltipCleanNonCommercial:"#template_archive_tooltip_noncommercial"},c=t(a.container);if(!c.length)return;t.extend(this,{initialize:function initialize(){this.model=new s.Model(),this.loadData(function(t){e.model.set(e.processData(t)),e.model.on("change:SpentSize",function(){var t=e.processData(e.model.toJSON());e.model.set(t);}),e.initControls();});},updateState:function updateState(){this.loadData(function(t){e.model.set(e.processData(t));});},loadData:function loadData(e){t.get(n.get("partnerDiskUsageInfo")).done(function(t){typeof e=="function"&&e(t);}).fail(function(){alert(u.archive.loadingDataError);});},processData:function processData(t){return t.AvailableSizeText=e.convertSize(t.AvailableSize),t.SpentSizeText=e.convertSize(t.SpentSize),t.SpentPercents=Math.min(100,Math.round(t.SpentSize/t.AvailableSize*100)),r.list([t.AdsSize,t.NonCommercialSize]).each(function(n){r.object(n).each(function(r,i){n[r+"Text"]=e.convertSize(i),n[r+"Percents"]=Math.min(100,Math.round(i/t.AvailableSize*100));});}),t;},initControls:function initControls(){this.initInfo(),this.initTooltip(),c.removeClass(f.hidden),i.on("nkVideoBlock:afterRemove",function(){e.updateState();}),t(document).on("click.archiveTooltip",function(n){n.target!==c[0]&&!t(n.target).parents(a.container).length&&e.hideTooltip();});},initInfo:function initInfo(){this.templateInfo||(this.templateInfo=o.get(l.info),this.$info=c.find(a.info),this.model.on("change:SpentSize",function(){e.initInfo();}));var n=t(this.templateInfo(this.model.toJSON()));n.click(function(){e.toggleTooltip();}),this.$info.html(n);},initTooltip:function initTooltip(){var t=o.get(l.tooltip);this.$tooltip=c.find(a.tooltip).html(t(this.model.toJSON())),this.$tooltip.find(a.tooltipButtonClose).click(function(){e.hideTooltip();}),i.on("archive:showTooltip",function(t){t&&t.tab!==undefined&&e.showTooltipTab(t.tab),e.showTooltip();}),this.isTooltipVisible=!1,this.initTooltipBar(),this.initTootipTabs(),this.initTooltipRules(),this.initTooltipClean();},initTootipTabs:function initTootipTabs(){this.$tooltipTabs=this.$tooltip.find(a.tooltipTabs),this.$tooltip.find(a.tooltipNav).designForms().change(function(t){e.$tooltipTabs.addClass(f.hidden).eq(t.target.value).removeClass(f.hidden);});},showTooltipTab:function showTooltipTab(e){this.$tooltip.find(a.tooltipNav).eq(e).prop("checked",!0).change();},initTooltipBar:function initTooltipBar(){this.$tooltipBar||(this.$tooltipBar=this.$tooltip.find(a.tooltipBar),this.templateTooltipBar=o.get(l.tooltipBar),this.model.on("change:SpentSize",function(){e.initTooltipBar();})),this.$tooltipBar.html(this.templateTooltipBar(this.model.toJSON()));},initTooltipRules:function initTooltipRules(){var t=this.$tooltipTabs.eq(0),n=t.find("input:radio"),r=t.find(a.tooltipBtnSetRules);this.model.on("change:AdsCleanRule change:NonCommercialCleanRule",function(){r.removeClass(f.disabled);}),n.change(function(){e.model.set(this.name,this.value);}),r.click(function(){r.hasClass(f.disabled)||(e.saveRules(),r.addClass(f.disabled));});},saveRules:function saveRules(){var e={AdsCleanRule:this.model.get("AdsCleanRule"),NonCommercialCleanRule:this.model.get("NonCommercialCleanRule")};t.post(n.get("partnerSaveDiskCleanOptions"),e).fail(function(){alert(u.requestError);});},initTooltipClean:function initTooltipClean(){this.$tooltip.find(a.tooltipCleanOptions).designForms().each(function(){e.model.set(this.name,t(this).is(":checked"));}).change(function(){e.model.set(this.name,t(this).is(":checked"));}),this.model.set("CleanOptions",{AdsSize:"OlderThanYear",NonCommercialSize:"OlderThanQuarter"}),this.initTooltipCleanAds(),this.initTooltipCleanNonCommercial(),this.initTooltipCleanButton();},initTooltipCleanAds:function initTooltipCleanAds(){this.templateCleanAds||(this.templateCleanAds=o.get(l.tooltipCleanAds),this.$tooltipCleanAds=c.find(a.tooltipCleanAds),this.model.on("change:CleanAdsContent change:SpentSize",function(){e.initTooltipCleanAds();}));var n=t(this.templateCleanAds(this.model.toJSON()));this.setTooltipCleanControlsEvents(n),this.$tooltipCleanAds.html(n);},initTooltipCleanNonCommercial:function initTooltipCleanNonCommercial(){this.templateCleanNonCommercial||(this.templateCleanNonCommercial=o.get(l.tooltipCleanNonCommercial),this.$tooltipCleanNonCommercial=c.find(a.tooltipCleanNonCommercial),this.model.on("change:CleanNonCommercialContent change:SpentSize",function(){e.initTooltipCleanNonCommercial();}));var n=t(this.templateCleanNonCommercial(this.model.toJSON()));this.setTooltipCleanControlsEvents(n),this.$tooltipCleanNonCommercial.html(n);},setTooltipCleanControlsEvents:function setTooltipCleanControlsEvents(t){t.find("input:radio").change(function(){var t=e.model.get("CleanOptions");t[this.name]=this.value,e.model.set("CleanOptions",t);});},initTooltipCleanButton:function initTooltipCleanButton(){var t=this.$tooltip.find(a.tooltipBtnClean);this.model.on("change:CleanAdsContent change:CleanNonCommercialContent",function(e){t[e.get("CleanAdsContent")||e.get("CleanNonCommercialContent")?"removeClass":"addClass"](f.disabled);}),t.click(function(){e.cleanArchive();});},cleanArchive:function cleanArchive(){if(e.model.get("CleanAdsContent")||e.model.get("CleanNonCommercialContent")){var r=this.model.get("CleanOptions"),s={};e.model.get("CleanAdsContent")&&(s.AdsSize=r.AdsSize),e.model.get("CleanNonCommercialContent")&&(s.NonCommercialSize=r.NonCommercialSize),t.post(n.get("partnerCleanDiskSpace"),s).done(function(t){e.updateState(),i.trigger("archive:clean",{ads:s.AdsSize!==undefined,nonCommercial:s.NonCommercialSize!==undefined});}).fail(function(){alert(u.requestError);});}},toggleTooltip:function toggleTooltip(){this[this.isTooltipVisible?"hideTooltip":"showTooltip"]();},showTooltip:function showTooltip(){this.isTooltipVisible=!0,this.$tooltip.removeClass(f.hidden);},hideTooltip:function hideTooltip(){this.isTooltipVisible=!1,this.$tooltip.addClass(f.hidden);},convertSize:function convertSize(e){if(e===0)return e;var t=Math.round(e/1024/1024);return t>=1024?t=Math.round(t/1024*100)/100+" "+u.archive.sizeTextGB:t+=" "+u.archive.sizeTextMB,t;}}),this.initialize();};}),define("popup.notifications",["require","jquery","urls","tools","popup","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("popup"),s=e("templates.storage"),o=window.langResource,u={buttonClose:""},a=!1,f="disabled";return function(){var e=this;t.extend(this,{initialize:function initialize(){this.load(function(t,n){n==="success"&&t&&t.length&&e.showPopup(t);});},load:function load(e){t.get(n.get("getNotifications")).done(e).fail(function(){throw new Error("Notifications not loaded!!!");});},closeNotifications:function closeNotifications(e,r,i){t.post(n.get("markNotificationAsShowed"),{NotificationId:e}).done(r).fail(i);},renderMesssages:function renderMesssages(e){var n=t("<div>");return r.list(e).each(function(e){n.append("<p>"+e.Text.replace(/\n/g,"<br>")+"</p>");}),n;},showPopup:function showPopup(n){this.popup=new i({containerClass:"popup_notifications",headerText:n[0].Caption,hideByOverlay:!1,hideByEscape:!1}),this.popup.addContent(this.renderMesssages(n));var r=t('<a class="button button_submit" href="#" onclick="return false">').text(u.buttonClose).click(function(){return a||(a=!0,r.addClass(f),e.closeNotifications(n[0].Id,function(){e.popup.hide();},function(){a=!1,r.removeClass(f),alert(o.requestError);})),!1;});this.popup.addContent(t('<div class="popup__buttons">').append(r)),this.popup.show();}}),this.initialize();};}),define("ajaxPool",["require","jquery"],function(e){"use strict";var t=e("jquery");t.ajaxSetup({cache:!1}),t.xhrPool={abortAll:function abortAll(){t.each(this,function(e,n){t.each(n,function(n,r){r.abort(),t.xhrPool[e].splice(n,1);});});},abort:function abort(e){typeof this[e]!="undefined"&&t.each(this[e],function(n,r){try{r.abort();}catch(i){}t.xhrPool[e].splice(n,1);});}},t.ajaxPrefilter(function(e,n,r){e.success&&(e.success=function(e){return function(t,n,r){if(r.getResponseHeader("X-Unauthorized")=="True"){window.location.reload();return;}e(t,n,r);};}(e.success)),e.error&&(e.error=function(e){return function(t,n,r){e(t,n,r);};}(e.error));if(!e.poolName)return;var i=e.poolName;t.xhrPool[i]||(t.xhrPool[i]=[]),e.poolReplace!=0&&t.xhrPool[i].length&&t.xhrPool.abort(i),t.xhrPool[i].push(r);});}),function(e){e.extend(e.fn,{validate:function validate(t){if(!this.length){t&&t.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return;}var n=e.data(this[0],"validator");return n?n:(n=new e.validator(t,this[0]),e.data(this[0],"validator",n),n.settings.onsubmit&&(this.find("input, button").filter(".cancel").click(function(){n.cancelSubmit=!0;}),n.settings.submitHandler&&this.find("input, button").filter(":submit").click(function(){n.submitButton=this;}),this.submit(function(t){function r(){if(n.settings.submitHandler){if(n.submitButton)var t=e("<input type='hidden'/>").attr("name",n.submitButton.name).val(n.submitButton.value).appendTo(n.currentForm);return n.settings.submitHandler.call(n,n.currentForm),n.submitButton&&t.remove(),!1;}return!0;}return n.settings.debug&&t.preventDefault(),n.cancelSubmit?(n.cancelSubmit=!1,r()):n.form()?n.pendingRequest?(n.formSubmitted=!0,!1):r():(n.focusInvalid(),!1);})),n);},valid:function valid(){if(e(this[0]).is("form"))return this.validate().form();var t=!0,n=e(this[0].form).validate();return this.each(function(){t&=n.element(this);}),t;},removeAttrs:function removeAttrs(t){var n={},r=this;return e.each(t.split(/\s/),function(e,t){n[t]=r.attr(t),r.removeAttr(t);}),n;},rules:function rules(t,n){var r=this[0];if(t){var i=e.data(r.form,"validator").settings,s=i.rules,o=e.validator.staticRules(r);switch(t){case"add":e.extend(o,e.validator.normalizeRule(n)),s[r.name]=o,n.messages&&(i.messages[r.name]=e.extend(i.messages[r.name],n.messages));break;case"remove":if(!n)return delete s[r.name],o;var u={};return e.each(n.split(/\s/),function(e,t){u[t]=o[t],delete o[t];}),u;}}var a=e.validator.normalizeRules(e.extend({},e.validator.metadataRules(r),e.validator.classRules(r),e.validator.attributeRules(r),e.validator.staticRules(r)),r);if(a.required){var f=a.required;delete a.required,a=e.extend({required:f},a);}return a;}}),e.extend(e.expr[":"],{blank:function blank(t){return!e.trim(""+t.value);},filled:function filled(t){return!!e.trim(""+t.value);},unchecked:function unchecked(e){return!e.checked;}}),e.validator=function(t,n){this.settings=e.extend(!0,{},e.validator.defaults,t),this.currentForm=n,this.init();},e.validator.format=function(t,n){return arguments.length==1?function(){var n=e.makeArray(arguments);return n.unshift(t),e.validator.format.apply(this,n);}:(arguments.length>2&&n.constructor!=Array&&(n=e.makeArray(arguments).slice(1)),n.constructor!=Array&&(n=[n]),e.each(n,function(e,n){t=t.replace(new RegExp("\\{"+e+"\\}","g"),n);}),t);},e.extend(e.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:e([]),errorLabelContainer:e([]),onsubmit:!0,ignore:[],ignoreTitle:!1,onfocusin:function onfocusin(e){this.lastActive=e,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(e)).hide());},onfocusout:function onfocusout(e){!this.checkable(e)&&(e.name in this.submitted||!this.optional(e))&&this.element(e);},onkeyup:function onkeyup(e){(e.name in this.submitted||e==this.lastElement)&&this.element(e);},onclick:function onclick(e){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode);},highlight:function highlight(t,n,r){t.type==="radio"?this.findByName(t.name).addClass(n).removeClass(r):e(t).addClass(n).removeClass(r);},unhighlight:function unhighlight(t,n,r){t.type==="radio"?this.findByName(t.name).removeClass(n).addClass(r):e(t).removeClass(n).addClass(r);}},setDefaults:function setDefaults(t){e.extend(e.validator.defaults,t);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:e.validator.format("Please enter no more than {0} characters."),minlength:e.validator.format("Please enter at least {0} characters."),rangelength:e.validator.format("Please enter a value between {0} and {1} characters long."),range:e.validator.format("Please enter a value between {0} and {1}."),max:e.validator.format("Please enter a value less than or equal to {0}."),min:e.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function init(){function r(t){var n=e.data(this[0].form,"validator"),r="on"+t.type.replace(/^validate/,"");n.settings[r]&&n.settings[r].call(n,this[0]);}this.labelContainer=e(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||e(this.currentForm),this.containers=e(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var t=this.groups={};e.each(this.settings.groups,function(n,r){e.each(r.split(/\s/),function(e,r){t[r]=n;});});var n=this.settings.rules;e.each(n,function(t,r){n[t]=e.validator.normalizeRule(r);}),e(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",r).validateDelegate(":radio, :checkbox, select, option","click",r),this.settings.invalidHandler&&e(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);},form:function form(){return this.checkForm(),e.extend(this.submitted,this.errorMap),this.invalid=e.extend({},this.errorMap),this.valid()||e(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid();},checkForm:function checkForm(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++){this.check(t[e]);}return this.valid();},element:function element(t){t=this.clean(t),this.lastElement=t,this.prepareElement(t),this.currentElements=e(t);var n=this.check(t);return n?delete this.invalid[t.name]:this.invalid[t.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),n;},showErrors:function showErrors(t){if(t){e.extend(this.errorMap,t),this.errorList=[];for(var n in t){this.errorList.push({message:t[n],element:this.findByName(n)[0]});}this.successList=e.grep(this.successList,function(e){return!(e.name in t);});}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors();},resetForm:function resetForm(){e.fn.resetForm&&e(this.currentForm).resetForm(),this.submitted={},this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass);},numberOfInvalids:function numberOfInvalids(){return this.objectLength(this.invalid);},objectLength:function objectLength(e){var t=0;for(var n in e){t++;}return t;},hideErrors:function hideErrors(){this.addWrapper(this.toHide).hide();},valid:function valid(){return this.size()==0;},size:function size(){return this.errorList.length;},focusInvalid:function focusInvalid(){if(this.settings.focusInvalid)try{e(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(t){}},findLastActive:function findLastActive(){var t=this.lastActive;return t&&e.grep(this.errorList,function(e){return e.element.name==t.name;}).length==1&&t;},elements:function elements(){var t=this,n={};return e(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in n||!t.objectLength(e(this).rules())?!1:(n[this.name]=!0,!0);});},clean:function clean(t){return e(t)[0];},errors:function errors(){return e(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext);},reset:function reset(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=e([]),this.toHide=e([]),this.currentElements=e([]);},prepareForm:function prepareForm(){this.reset(),this.toHide=this.errors().add(this.containers);},prepareElement:function prepareElement(e){this.reset(),this.toHide=this.errorsFor(e);},check:function check(t){t=this.clean(t),this.checkable(t)&&(t=this.findByName(t.name).not(this.settings.ignore)[0]);var n=e(t).rules(),r=!1;for(var i in n){var s={method:i,parameters:n[i]};try{var o=e.validator.methods[i].call(this,t.value.replace(/\r/g,""),t,s.parameters);if(o=="dependency-mismatch"){r=!0;continue;}r=!1;if(o=="pending"){this.toHide=this.toHide.not(this.errorsFor(t));return;}if(!o)return this.formatAndAdd(t,s),!1;}catch(u){throw this.settings.debug&&window.console&&console.log("exception occured when checking element "+t.id+", check the '"+s.method+"' method",u),u;}}if(r)return;return this.objectLength(n)&&this.successList.push(t),!0;},customMetaMessage:function customMetaMessage(t,n){if(!e.metadata)return;var r=this.settings.meta?e(t).metadata()[this.settings.meta]:e(t).metadata();return r&&r.messages&&r.messages[n];},customMessage:function customMessage(e,t){var n=this.settings.messages[e];return n&&(n.constructor==String?n:n[t]);},findDefined:function findDefined(){for(var e=0;e<arguments.length;e++){if(arguments[e]!==undefined)return arguments[e];}return undefined;},defaultMessage:function defaultMessage(t,n){return this.findDefined(this.customMessage(t.name,n),this.customMetaMessage(t,n),!this.settings.ignoreTitle&&t.title||undefined,e.validator.messages[n],"<strong>Warning: No message defined for "+t.name+"</strong>");},formatAndAdd:function formatAndAdd(e,t){var n=this.defaultMessage(e,t.method),r=/\$?\{(\d+)\}/g;typeof n=="function"?n=n.call(this,t.parameters,e):r.test(n)&&(n=jQuery.format(n.replace(r,"{$1}"),t.parameters)),this.errorList.push({message:n,element:e}),this.errorMap[e.name]=n,this.submitted[e.name]=n;},addWrapper:function addWrapper(e){return this.settings.wrapper&&(e=e.add(e.parent(this.settings.wrapper))),e;},defaultShowErrors:function defaultShowErrors(){for(var e=0;this.errorList[e];e++){var t=this.errorList[e];this.settings.highlight&&this.settings.highlight.call(this,t.element,this.settings.errorClass,this.settings.validClass),this.showLabel(t.element,t.message);}this.errorList.length&&(this.toShow=this.toShow.add(this.containers));if(this.settings.success)for(var e=0;this.successList[e];e++){this.showLabel(this.successList[e]);}if(this.settings.unhighlight)for(var e=0,n=this.validElements();n[e];e++){this.settings.unhighlight.call(this,n[e],this.settings.errorClass,this.settings.validClass);}this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show();},validElements:function validElements(){return this.currentElements.not(this.invalidElements());},invalidElements:function invalidElements(){return e(this.errorList).map(function(){return this.element;});},showLabel:function showLabel(t,n){var r=this.errorsFor(t);r.length?(r.removeClass().addClass(this.settings.errorClass),r.attr("generated")&&r.html(n)):(r=e("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(t),generated:!0}).addClass(this.settings.errorClass).html(n||""),this.settings.wrapper&&(r=r.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(r).length||(this.settings.errorPlacement?this.settings.errorPlacement(r,e(t)):r.insertAfter(t))),!n&&this.settings.success&&(r.text(""),typeof this.settings.success=="string"?r.addClass(this.settings.success):this.settings.success(r)),this.toShow=this.toShow.add(r);},errorsFor:function errorsFor(t){var n=this.idOrName(t);return this.errors().filter(function(){return e(this).attr("for")==n;});},idOrName:function idOrName(e){return this.groups[e.name]||(this.checkable(e)?e.name:e.id||e.name);},checkable:function checkable(e){return /radio|checkbox/i.test(e.type);},findByName:function findByName(t){var n=this.currentForm;return e(document.getElementsByName(t)).map(function(e,r){return r.form==n&&r.name==t&&r||null;});},getLength:function getLength(t,n){switch(n.nodeName.toLowerCase()){case"select":return e("option:selected",n).length;case"input":if(this.checkable(n))return this.findByName(n.name).filter(":checked").length;}return t.length;},depend:function depend(e,t){return this.dependTypes[_typeof(e)]?this.dependTypes[_typeof(e)](e,t):!0;},dependTypes:{"boolean":function boolean(e,t){return e;},string:function string(t,n){return!!e(t,n.form).length;},"function":function _function(e,t){return e(t);}},optional:function optional(t){return!e.validator.methods.required.call(this,e.trim(t.value),t)&&"dependency-mismatch";},startRequest:function startRequest(e){this.pending[e.name]||(this.pendingRequest++,this.pending[e.name]=!0);},stopRequest:function stopRequest(t,n){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[t.name],n&&this.pendingRequest==0&&this.formSubmitted&&this.form()?(e(this.currentForm).submit(),this.formSubmitted=!1):!n&&this.pendingRequest==0&&this.formSubmitted&&(e(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1);},previousValue:function previousValue(t){return e.data(t,"previousValue")||e.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")});}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},dateDE:{dateDE:!0},number:{number:!0},numberDE:{numberDE:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function addClassRules(t,n){t.constructor==String?this.classRuleSettings[t]=n:e.extend(this.classRuleSettings,t);},classRules:function classRules(t){var n={},r=e(t).attr("class");return r&&e.each(r.split(" "),function(){this in e.validator.classRuleSettings&&e.extend(n,e.validator.classRuleSettings[this]);}),n;},attributeRules:function attributeRules(t){var n={},r=e(t);for(var i in e.validator.methods){var s=r.attr(i);s&&(n[i]=s);}return n.maxlength&&/-1|2147483647|524288/.test(n.maxlength)&&delete n.maxlength,n;},metadataRules:function metadataRules(t){if(!e.metadata)return{};var n=e.data(t.form,"validator").settings.meta;return n?e(t).metadata()[n]:e(t).metadata();},staticRules:function staticRules(t){var n={},r=e.data(t.form,"validator");return r.settings.rules&&(n=e.validator.normalizeRule(r.settings.rules[t.name])||{}),n;},normalizeRules:function normalizeRules(t,n){return e.each(t,function(r,i){if(i===!1){delete t[r];return;}if(i.param||i.depends){var s=!0;switch(_typeof(i.depends)){case"string":s=!!e(i.depends,n.form).length;break;case"function":s=i.depends.call(n,n);}s?t[r]=i.param!==undefined?i.param:!0:delete t[r];}}),e.each(t,function(r,i){t[r]=e.isFunction(i)?i(n):i;}),e.each(["minlength","maxlength","min","max"],function(){t[this]&&(t[this]=Number(t[this]));}),e.each(["rangelength","range"],function(){t[this]&&(t[this]=[Number(t[this][0]),Number(t[this][1])]);}),e.validator.autoCreateRanges&&(t.min&&t.max&&(t.range=[t.min,t.max],delete t.min,delete t.max),t.minlength&&t.maxlength&&(t.rangelength=[t.minlength,t.maxlength],delete t.minlength,delete t.maxlength)),t.messages&&delete t.messages,t;},normalizeRule:function normalizeRule(t){if(typeof t=="string"){var n={};e.each(t.split(/\s/),function(){n[this]=!0;}),t=n;}return t;},addMethod:function addMethod(t,n,r){e.validator.methods[t]=n,e.validator.messages[t]=r!=undefined?r:e.validator.messages[t],n.length<3&&e.validator.addClassRules(t,e.validator.normalizeRule(t));},methods:{required:function required(t,n,r){if(!this.depend(r,n))return"dependency-mismatch";switch(n.nodeName.toLowerCase()){case"select":var i=e(n).val();return i&&i.length>0;case"input":if(this.checkable(n))return this.getLength(t,n)>0;default:return e.trim(t).length>0;}},remote:function remote(t,n,r){if(this.optional(n))return"dependency-mismatch";var i=this.previousValue(n);this.settings.messages[n.name]||(this.settings.messages[n.name]={}),i.originalMessage=this.settings.messages[n.name].remote,this.settings.messages[n.name].remote=i.message,r=typeof r=="string"&&{url:r}||r;if(this.pending[n.name])return"pending";if(i.old===t)return i.valid;i.old=t;var s=this;this.startRequest(n);var o={};return o[n.name]=t,e.ajax(e.extend(!0,{url:r,mode:"abort",port:"validate"+n.name,dataType:"json",data:o,success:function success(r){s.settings.messages[n.name].remote=i.originalMessage;var o=r===!0;if(o){var u=s.formSubmitted;s.prepareElement(n),s.formSubmitted=u,s.successList.push(n),s.showErrors();}else{var a={},f=r||s.defaultMessage(n,"remote");a[n.name]=i.message=e.isFunction(f)?f(t):f,s.showErrors(a);}i.valid=o,s.stopRequest(n,o);}},r)),"pending";},minlength:function minlength(t,n,r){return this.optional(n)||this.getLength(e.trim(t),n)>=r;},maxlength:function maxlength(t,n,r){return this.optional(n)||this.getLength(e.trim(t),n)<=r;},rangelength:function rangelength(t,n,r){var i=this.getLength(e.trim(t),n);return this.optional(n)||i>=r[0]&&i<=r[1];},min:function min(e,t,n){return this.optional(t)||e>=n;},max:function max(e,t,n){return this.optional(t)||e<=n;},range:function range(e,t,n){return this.optional(t)||e>=n[0]&&e<=n[1];},email:function email(e,t){return this.optional(t)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e);},url:function url(e,t){return this.optional(t)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e);},date:function date(e,t){return this.optional(t)||!/Invalid|NaN/.test(new Date(e));},dateISO:function dateISO(e,t){return this.optional(t)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(e);},number:function number(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(e);},digits:function digits(e,t){return this.optional(t)||/^\d+$/.test(e);},creditcard:function creditcard(e,t){if(this.optional(t))return"dependency-mismatch";if(/[^0-9-]+/.test(e))return!1;var n=0,r=0,i=!1;e=e.replace(/\D/g,"");for(var s=e.length-1;s>=0;s--){var o=e.charAt(s),r=parseInt(o,10);i&&(r*=2)>9&&(r-=9),n+=r,i=!i;}return n%10==0;},accept:function accept(e,t,n){return n=typeof n=="string"?n.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(t)||e.match(new RegExp(".("+n+")$","i"));},equalTo:function equalTo(t,n,r){var i=e(r).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){e(n).valid();});return t==i.val();}}}),e.format=e.validator.format;}(jQuery),function(e){var t={};if(e.ajaxPrefilter)e.ajaxPrefilter(function(e,n,r){var i=e.port;e.mode=="abort"&&(t[i]&&t[i].abort(),t[i]=r);});else{var n=e.ajax;e.ajax=function(r){var i=("mode"in r?r:e.ajaxSettings).mode,s=("port"in r?r:e.ajaxSettings).port;return i=="abort"?(t[s]&&t[s].abort(),t[s]=n.apply(this,arguments)):n.apply(this,arguments);};}}(jQuery),function(e){!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener&&e.each({focus:"focusin",blur:"focusout"},function(t,n){function r(t){return t=e.event.fix(t),t.type=n,e.event.dispatch.call(this,t);}e.event.special[n]={setup:function setup(){this.addEventListener(t,r,!0);},teardown:function teardown(){this.removeEventListener(t,r,!0);},handler:function handler(t){return arguments[0]=e.event.fix(t),arguments[0].type=n,e.event.handle.apply(this,arguments);}};}),e.extend(e.fn,{validateDelegate:function validateDelegate(t,n,r){return this.bind(n,function(n){var i=e(n.target);if(i.is(t))return r.apply(i,arguments);});}});}(jQuery),define("jquery.validate",["jquery"],function(){}),function(e){function i(e,t,n){e.rules[t]=n,e.message&&(e.messages[t]=e.message);}function s(e){return e.replace(/^\s+|\s+$/g,"").split(/\s*,\s*/g);}function o(e){return e.replace(/([!"#$%&'()*+,./:;<=>?@\[\\\]^`{|}~])/g,"\\$1");}function u(e){return e.substr(0,e.lastIndexOf(".")+1);}function a(e,t){return e.indexOf("*.")===0&&(e=e.replace("*.",t)),e;}function f(t,n){var r=e(this).find("[data-valmsg-for='"+o(n[0].name)+"']"),i=r.attr("data-valmsg-replace"),s=i?e.parseJSON(i)!==!1:null;r.removeClass("field-validation-valid").addClass("field-validation-error"),t.data("unobtrusiveContainer",r),s?(r.empty(),t.removeClass("input-validation-error").appendTo(r)):t.hide();}function l(t,n){var r=e(this).find("[data-valmsg-summary=true]"),i=r.find("ul");i&&i.length&&n.errorList.length&&(i.empty(),r.addClass("validation-summary-errors").removeClass("validation-summary-valid"),e.each(n.errorList,function(){e("<li />").html(this.message).appendTo(i);}));}function c(t){var n=t.data("unobtrusiveContainer"),r=n.attr("data-valmsg-replace"),i=r?e.parseJSON(r):null;n&&(n.addClass("field-validation-valid").removeClass("field-validation-error"),t.removeData("unobtrusiveContainer"),i&&n.empty());}function h(t){var n=e(this);n.data("validator").resetForm(),n.find(".validation-summary-errors").addClass("validation-summary-valid").removeClass("validation-summary-errors"),n.find(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error").removeData("unobtrusiveContainer").find(">*").removeData("unobtrusiveContainer");}function p(n){var i=e(n),s=i.data(r),o=e.proxy(h,n),u=t.unobtrusive.options||{},a=function a(t,r){var i=u[t];i&&e.isFunction(i)&&i.apply(n,r);};return s||(s={options:{errorClass:u.errorClass||"input-validation-error",errorElement:u.errorElement||"span",errorPlacement:function errorPlacement(){f.apply(n,arguments),a("errorPlacement",arguments);},invalidHandler:function invalidHandler(){l.apply(n,arguments),a("invalidHandler",arguments);},messages:{},rules:{},success:function success(){c.apply(n,arguments),a("success",arguments);}},attachValidation:function attachValidation(){i.off("reset."+r,o).on("reset."+r,o).validate(this.options);},validate:function validate(){return i.validate(),i.valid();}},i.data(r,s)),s;}var t=e.validator,n,r="unobtrusiveValidation";t.unobtrusive={adapters:[],parseElement:function parseElement(t,n){var r=e(t),i=r.parents("form")[0],s,o,u;if(!i)return;s=p(i),s.options.rules[t.name]=o={},s.options.messages[t.name]=u={},e.each(this.adapters,function(){var n="data-val-"+this.name,s=r.attr(n),a={};s!==undefined&&(n+="-",e.each(this.params,function(){a[this]=r.attr(n+this);}),this.adapt({element:t,form:i,message:s,params:a,rules:o,messages:u}));}),e.extend(o,{__dummy__:!0}),n||s.attachValidation();},parse:function parse(n){var r=e(n),i=r.parents().addBack().filter("form").add(r.find("form")).has("[data-val=true]");r.find("[data-val=true]").each(function(){t.unobtrusive.parseElement(this,!0);}),i.each(function(){var e=p(this);e&&e.attachValidation();});}},n=t.unobtrusive.adapters,n.add=function(e,t,n){return n||(n=t,t=[]),this.push({name:e,params:t,adapt:n}),this;},n.addBool=function(e,t){return this.add(e,function(n){i(n,t||e,!0);});},n.addMinMax=function(e,t,n,r,s,o){return this.add(e,[s||"min",o||"max"],function(e){var s=e.params.min,o=e.params.max;s&&o?i(e,r,[s,o]):s?i(e,t,s):o&&i(e,n,o);});},n.addSingleVal=function(e,t,n){return this.add(e,[t||"val"],function(r){i(r,n||e,r.params[t]);});},t.addMethod("__dummy__",function(e,t,n){return!0;}),t.addMethod("regex",function(e,t,n){var r;return this.optional(t)?!0:(r=new RegExp(n).exec(e),r&&r.index===0&&r[0].length===e.length);}),t.addMethod("nonalphamin",function(e,t,n){var r;return n&&(r=e.match(/\W/g),r=r&&r.length>=n),r;}),t.methods.extension?(n.addSingleVal("accept","mimtype"),n.addSingleVal("extension","extension")):n.addSingleVal("extension","extension","accept"),n.addSingleVal("regex","pattern"),n.addBool("creditcard").addBool("date").addBool("digits").addBool("email").addBool("number").addBool("url"),n.addMinMax("length","minlength","maxlength","rangelength").addMinMax("range","min","max","range"),n.addMinMax("minlength","minlength").addMinMax("maxlength","minlength","maxlength"),n.add("equalto",["other"],function(t){var n=u(t.element.name),r=t.params.other,s=a(r,n),f=e(t.form).find(":input").filter("[name='"+o(s)+"']")[0];i(t,"equalTo",f);}),n.add("required",function(e){(e.element.tagName.toUpperCase()!=="INPUT"||e.element.type.toUpperCase()!=="CHECKBOX")&&i(e,"required",!0);}),n.add("remote",["url","type","additionalfields"],function(t){var n={url:t.params.url,type:t.params.type||"GET",data:{}},r=u(t.element.name);e.each(s(t.params.additionalfields||t.element.name),function(i,s){var u=a(s,r);n.data[u]=function(){return e(t.form).find(":input").filter("[name='"+o(u)+"']").val();};}),i(t,"remote",n);}),n.add("password",["min","nonalphamin","regex"],function(e){e.params.min&&i(e,"minlength",e.params.min),e.params.nonalphamin&&i(e,"nonalphamin",e.params.nonalphamin),e.params.regex&&i(e,"regex",e.params.regex);}),e(function(){t.unobtrusive.parse(document);});}(jQuery),define("jquery.validate.unobtrusive",["jquery.validate"],function(){}),function(e){function i(e,t){var n=window,r=(e||"").split(".");while(n&&r.length){n=n[r.shift()];}return typeof n=="function"?n:(t.push(e),Function.constructor.apply(null,t));}function s(e){return e==="GET"||e==="POST";}function o(e,t){s(t)||e.setRequestHeader("X-HTTP-Method-Override",t);}function u(t,n,r){var i;if(r.indexOf("application/x-javascript")!==-1)return;i=(t.getAttribute("data-ajax-mode")||"").toUpperCase(),e(t.getAttribute("data-ajax-update")).each(function(t,r){var s;switch(i){case"BEFORE":s=r.firstChild,e("<div />").html(n).contents().each(function(){r.insertBefore(this,s);});break;case"AFTER":e("<div />").html(n).contents().each(function(){r.appendChild(this);});break;case"REPLACE-WITH":e(r).replaceWith(n);break;default:e(r).html(n);}});}function a(t,n){var r,a,f,l;r=t.getAttribute("data-ajax-confirm");if(r&&!window.confirm(r))return;a=e(t.getAttribute("data-ajax-loading")),l=parseInt(t.getAttribute("data-ajax-loading-duration"),10)||0,e.extend(n,{type:t.getAttribute("data-ajax-method")||undefined,url:t.getAttribute("data-ajax-url")||undefined,cache:!!t.getAttribute("data-ajax-cache"),beforeSend:function beforeSend(e){var n;return o(e,f),n=i(t.getAttribute("data-ajax-begin"),["xhr"]).apply(t,arguments),n!==!1&&a.show(l),n;},complete:function complete(){a.hide(l),i(t.getAttribute("data-ajax-complete"),["xhr","status"]).apply(t,arguments);},success:function success(e,n,r){u(t,e,r.getResponseHeader("Content-Type")||"text/html"),i(t.getAttribute("data-ajax-success"),["data","status","xhr"]).apply(t,arguments);},error:function error(){i(t.getAttribute("data-ajax-failure"),["xhr","status","error"]).apply(t,arguments);}}),n.data.push({name:"X-Requested-With",value:"XMLHttpRequest"}),f=n.type.toUpperCase(),s(f)||(n.type="POST",n.data.push({name:"X-HTTP-Method-Override",value:f})),e.ajax(n);}function f(t){var n=e(t).data(r);return!n||!n.validate||n.validate();}var t="unobtrusiveAjaxClick",n="unobtrusiveAjaxClickTarget",r="unobtrusiveValidation";e(document).on("click","a[data-ajax=true]",function(e){e.preventDefault(),a(this,{url:this.href,type:"GET",data:[]});}),e(document).on("click","form[data-ajax=true] input[type=image]",function(n){var r=n.target.name,i=e(n.target),s=e(i.parents("form")[0]),o=i.offset();s.data(t,[{name:r+".x",value:Math.round(n.pageX-o.left)},{name:r+".y",value:Math.round(n.pageY-o.top)}]),setTimeout(function(){s.removeData(t);},0);}),e(document).on("click","form[data-ajax=true] :submit",function(r){var i=r.currentTarget.name,s=e(r.target),o=e(s.parents("form")[0]);o.data(t,i?[{name:i,value:r.currentTarget.value}]:[]),o.data(n,s),setTimeout(function(){o.removeData(t),o.removeData(n);},0);}),e(document).on("submit","form[data-ajax=true]",function(r){var i=e(this).data(t)||[],s=e(this).data(n),o=s&&s.hasClass("cancel");r.preventDefault();if(!o&&!f(this))return;a(this,{url:this.action,type:this.method||"GET",data:i.concat(e(this).serializeArray())});});}(jQuery),define("jquery.unobtrusive-ajax",["jquery.validate.unobtrusive"],function(){}),define("jquery.designForms",["require","jquery"],function(e){"use strict";var t=e("jquery");t.fn.designForms=function(e){return this.each(function(){function u(n,r){var i=t(n),s=i.is(":checked"),o=i.is(":disabled"),u=i.is(":focus"),a="";o&&(a+="Disabled"),s&&(a+="Checked"),e&&e(n,s),u&&!o&&(a+="Focused"),r&&(a+=r),i.parent().removeClass().addClass(n.type+"InputContainer"+(a!=""?" "+n.type+a:""));}var n=this,r=t(n),i=n.type+"InputContainer";if(n.type!="radio"&&n.type!="checkbox")return;if(r.parent().hasClass(i))return;var s=t("<div>").addClass(i);n.parentNode.insertBefore(s[0],n),s.append(n);if(n.type=="radio"){var o=s.siblings("label[for="+n.id+"]");o.length&&s.append(o);}s.append("<div>"),u(n);if(n.type=="radio")var a=document.getElementsByTagName("INPUT"),f=function f(){if(n.name)for(var e=0;e<a.length;e++){a[e].name&&a[e].name==n.name&&a[e]!=n&&!a[e].checked&&u(a[e]);}};r.on("design:update",function(){u(n);}),n.getAttribute("disabled")||(r.parent().on("mousedown",function(){setTimeout(function(){u(n,"Pressed");},5);}).on("mouseup",function(){u(t(this).find("input")[0]),n.focus(),n.click();}),r.on("focus",function(){setTimeout(function(){u(n),n.type=="radio"&&f(n);},10);}).on("blur",function(){u(this);}).on("change",function(){u(this),n.type=="radio"&&f(n);}));});};}),define("campaign.create.intendedResult",["require","jquery","underscore","tools","events"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("tools"),i=e("events"),s=function s(e,_s3){var o=this,u=t.extend({containerEl:"#campaignIntendedResult",templateId:"#template_ACIntendedResult"},_s3||{});t.extend(this,{init:function init(){this.$el=t(u.containerEl),this.template=n.template(t(u.templateId).html()),this.render("empty"),this.setEvents();},render:function render(e,n){var i=t.extend({state:e},n||{});r.object(i.Result).each(function(e){e==="Coverage"&&(i.Result.CoverageString=r.number(i.Result[e]).decline(["","",""]));}),this.$el.html(this.template(i));},setEvents:function setEvents(){i.on("campaignCreate:changeAdType",function(e){e.adType==1?o.render("geo"):e.isFormValid?o.render("loading"):o.render("empty");}).on("campaignCreate:startChecking",function(){o.render("loading");}).on("campaignCreate:finishChecking",function(e){e.Success&&e.Result?o.render("success",e):o.render("notSuccessed",e);}).on("campaignCreate:notSuccessed",function(){o.render("empty");}).on("campaignCreate:errorValidation",function(){o.render("empty");}).on("campaignCreate:errorChecking",function(){o.render("empty");});}}),this.init();};return function(e){new s(e);};}),define("campaign.create.checkingResult",["require","jquery","tools","events","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("templates.storage"),s=function s(e,_s4){var o=this,u=window.langResource,a=i.get("#template_ACCheckinkResult"),f={container:"#campaignCheckinkResult",frequency:".js-frequency",groups:".js-groups",frequencyGroups:".js-group-frequency"};t.extend(this,{init:function init(){this.$el=t(f.container),this.setEvents();},render:function render(e,n){if(e==="empty")this.$el.html("");else{var r=t.extend({state:e},n||{});this.formatParams(r);var i=a(r);this.$el.html(i),this.initControls(r);}},formatParams:function formatParams(e){e.state==="geo"?this.discount==100?e.BudgetString=0:e.BudgetString=n.number(e.Budget).range("&nbsp;"):n.object(e.Result).each(function(t){t==="MonitorCount"&&(e.Result.MonitorCountString=n.number(e.Result[t]).decline([u.campaignCreate.monitorsCount1,u.campaignCreate.monitorsCount2,u.campaignCreate.monitorsCount3])),t==="ShowCount"&&(e.Result.ShowCountString=n.number(e.Result[t]).decline([u.campaignCreate.showsCount1,u.campaignCreate.showsCount2,u.campaignCreate.showsCount3]));if(t==="MonitorCount"||t==="ShowCount")e.Result[t]=n.number(e.Result[t]).range("&nbsp;");});},initControls:function initControls(e){e.state!=="geo"&&(this.$el.find(f.groups).click(function(){var e=String(t(this).data("groups")).split(",");r.trigger("campaignCreate:unselectPartnerGroups",{Ids:e});}),this.$el.find(f.frequency).click(function(){var e=t(this).data("frequency");r.trigger("campaignCreate:changeFrequencyCount",{Frequency:e});}),this.$el.find(f.frequencyGroups).click(function(){var e=t(this).data("frequency"),n=String(t(this).data("groups")).split(",");r.trigger("campaignCreate:changeFrequencyCount",{Frequency:e}),r.trigger("campaignCreate:unselectPartnerGroups",{Ids:n});}));},setEvents:function setEvents(){this.discount=0,r.on("campaignCreate:changeGeoModel",function(e){e.isFormValid?o.render("geo",e.params):o.render("empty");}).on("campaignCreate:startChecking",function(){o.render("loading");}).on("campaignCreate:finishChecking",function(e){e.Success&&e.Result?o.render("success",e):e.Recommendations&&e.Recommendations.length?o.render("recommendation",e):o.render("empty");}).on("campaignCreate:errorValidation",function(){o.render("empty");}).on("campaignCreate:errorChecking",function(){o.render("empty");}).on("campaignCreate:ChangeDiscount",function(e){o.discount=e;});}}),this.init();};return function(e){new s(e);};}),define("campaign.create.button",["require","jquery","events"],function(e){"use strict";var t=e("jquery"),n=e("events"),r=function r(e,_r3){var i=this,s=window.langResource,o=t.extend({containerEl:"#buttonCreateCampaign",buttonHtml:'<button class="button button_submit ac-button-save"></button>',buttonTextRun:s.campaignCreate.run,buttonTextChecking:'<i class="loading"></i> <span>'+s.campaignCreate.evaluating+"</span>",buttonTextSaving:'<i class="loading"></i> <span>'+s.campaignCreate.running+"</span>"},_r3||{}),u={isDisabled:"is-disabled"};t.extend(this,{initialize:function initialize(){this.render(),this.disable(),this.setEvents();},render:function render(){this.$el=t(o.buttonHtml).html(o.buttonTextRun).click(function(){return i.isDisabled||(i.isDisabled=!0,n.trigger("campaignCreate:create"),i.$el.html(o.buttonTextSaving)),!1;}),t(o.containerEl).append(this.$el);},enable:function enable(){this.isDisabled=!1,this.$el.removeClass(u.isDisabled);},disable:function disable(){this.isDisabled=!0,this.$el.addClass(u.isDisabled);},setEvents:function setEvents(){n.on("campaignCreate:selectStartDate",function(e){e&&i.$el.data("dates",e).html(i.getButtonText(e));}).on("campaignCreate:changeGeoModel",function(e){e.isFormValid?i.enable():i.disable();}).on("campaignCreate:startChecking",function(){i.disable(),i.$el.html(o.buttonTextChecking);}).on("campaignCreate:finishChecking",function(e){i[e.Success&&e.Result?"enable":"disable"]();var t=i.$el.data("dates");i.$el.html(t?i.getButtonText(t):o.buttonTextRun);}).on("campaignCreate:errorCreate",function(){i.enable();var e=i.$el.data("dates");i.$el.html(e?i.getButtonText(e):o.buttonTextRun);}).on("campaignCreate:errorValidation",function(){i.disable();}).on("campaignCreate:errorChecking",function(){i.disable();});},getButtonText:function getButtonText(e){return e.dateReal.toDateString()===new Date().toDateString()?o.buttonTextRun:o.buttonTextRun+" "+e.dateForUI.replace(" "+new Date().getFullYear(),"");}}),this.initialize();};return function(e){new r(e);};}),define("dates.adapter",["require","tools"],function(e){"use strict";function r(e){var t=n[0];return e.indexOf(".")!==-1&&(t=n[1]),t;}var t=e("tools"),n=["yy/mm/dd","yy.mm.dd"];return{getDate:function getDate(e){return t.date(e).parse(r(e));},getFormat:function getFormat(){return n[0];}};}),define("datePicker",["require","tools","dates.adapter","jqueryUI.DatePicker"],function(e){"use strict";var t=e("tools"),n=e("dates.adapter"),r=window.langResource;return e("jqueryUI.DatePicker"),function(e,i){var s=this,o=$.extend({$gapEl:null,changeMonth:!1,changeYear:!1,showOtherMonths:!0,selectOtherMonths:!0,buttonText:'<i class="datepicker-icon"></i>',defaultDateText:r.datePicker.defaultDateText,dateFormatForServer:n.getFormat(),minDate:null,maxDate:null,classDisabled:"is-disabled",classFocused:"is-focused",classEmpty:"is-empty",onSelect:null},i||{}),u=$("<input/>").datepicker({dateFormat:o.dateFormatForServer});return $.extend(this,{initialize:function initialize(){e.datepicker({changeMonth:o.changeMonth,changeYear:o.changeYear,showOtherMonths:o.showOtherMonths,selectOtherMonths:o.selectOtherMonths,showOn:"button",buttonText:o.buttonText,dateFormat:o.dateFormatForServer,minDate:o.minDate,maxDate:o.maxDate,beforeShow:function beforeShow(){e.parent().addClass(o.classFocused);},onClose:function onClose(){e.parent().removeClass(o.classFocused);},onSelect:function onSelect(t){s.setGapDate(e.datepicker("getDate")),typeof o.onSelect=="function"&&o.onSelect(t);}}).click(function(){e.siblings("button").click();}),this.clear();},setDate:function setDate(t){e.datepicker("setDate",t),this.setGapDate(t);},setGapDate:function setGapDate(n){if(o.$gapEl&&o.$gapEl.length){var r=o.dateFormatForUI?t.date(e.datepicker("getDate")).format(o.dateFormatForUI):u.datepicker("setDate",n).val();o.$gapEl.text(r).parent().removeClass(o.classEmpty);}},getServerDate:function getServerDate(){return e.val();},getUIDate:function getUIDate(){return o.$gapEl.text();},getRealDate:function getRealDate(){return e.datepicker("getDate");},setMinDate:function setMinDate(t){e.datepicker("option","minDate",t);},clear:function clear(){e.datepicker("setDate",null),o.$gapEl&&o.$gapEl.length&&o.defaultDateText&&o.$gapEl.text(o.defaultDateText).parent().addClass(o.classEmpty);},disable:function disable(){e.prop("disabled",!0).parent().addClass(o.classDisabled);},enable:function enable(){e.prop("disabled",!1).parent().removeClass(o.classDisabled);},runCallback:function runCallback(){}}),this.initialize(),{setDate:function setDate(e){s.setDate(e);},getServerDate:function getServerDate(){return s.getServerDate();},getUIDate:function getUIDate(){return s.getUIDate();},getRealDate:function getRealDate(){return s.getRealDate();},setMinDate:function setMinDate(e){return s.setMinDate(e);},clear:function clear(){return s.clear();},disable:function disable(){return s.disable();},enable:function enable(){return s.enable();}};};}),define("partnerGroups.model",["require","backbone"],function(e){"use strict";var t=e("backbone"),n="is-selected";return t.Model.extend({initialize:function initialize(){var e=this;this.on("swapRowSelection",function(){e.swapRowSelection();});},swapRowSelection:function swapRowSelection(){this.get("El")[this.get("IsSelected")?"addClass":"removeClass"](n);},toggleSelection:function toggleSelection(e,t){this.set({IsSelected:e},{silent:t||!1}),this.swapRowSelection();},select:function select(e){this.get("Checkbox").attr("checked","checked").trigger("design:update"),this.toggleSelection(!0,e);},unselect:function unselect(e){this.get("Checkbox").removeAttr("checked").trigger("design:update"),this.toggleSelection(!1,e);}});}),define("partnerGroups.collection",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone");return n.Collection.extend({toggleSelection:function toggleSelection(e,n){var r=this,i;t.list(e).each(function(e){i=r.where({Id:parseInt(e,10)}),i.length&&i[0][n?"select":"unselect"](!0);}),this.trigger("change");},select:function select(e){this.toggleSelection(e,!0);},unselect:function unselect(e){this.toggleSelection(e,!1);},getSelectedIds:function getSelectedIds(){var e=this.where({IsSelected:!0}),n=[];return t.list(e).each(function(e){n.push(e.get("Id"));}),n;}});}),define("partnerGroups.workload",["require","jquery"],function(e){"use strict";var t=e("jquery"),n=200,r=32,i=100,s={error:"#e04939",workload:"#d8c2a5",campaign:"#efe4d6",cap:"#CAAF8D",cut:"#d4c3b1"},o=2,u=1;return function(e,a){function h(e,t,n,r,i){c.fillStyle=i,c.fillRect(e,t,n,r);}function p(e,t){c.beginPath(),c.strokeStyle=t,c.moveTo(e-.5,0),c.lineTo(e-.5,r),c.stroke(),c.closePath();}var f=(r-1)/i,l=t("<canvas>").attr("width",n).attr("height",r);t(e).append(l);var c=l[0].getContext("2d"),d=Math.max(1,Math.floor(n/a.length)),v=Math.max(0,Math.floor((n-d*a.length)/2));a.forEach(function(e,t){var n=d*t+v,i=e.IsOverloaded&&t!==0&&t!==a.length-1;if(i)h(n,0,d,o,s.error),h(n,o,d,r-o,s.workload);else{var l=Math.max(1,Math.round(e.GroupWorkload*f)),c=r-l;h(n,c,d,l,s.workload),t!==0&&t!==a.length-1&&(c-=Math.max(1,Math.round(e.NewCampaignWorkload*f)),l=Math.max(1,Math.round(e.NewCampaignWorkload*f)),h(n,c,d,l,s.campaign),c-=u,h(n,c,d,u,s.cap));}}),p(d+v,s.cut),p(d*(a.length-1)+v,s.cut);};}),define("partnerGroups",["require","jquery","tools","events","templates.storage","partnerGroups.model","partnerGroups.collection","partnerGroups.workload"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("templates.storage"),s=e("partnerGroups.model"),o=e("partnerGroups.collection"),u=e("partnerGroups.workload"),a="#template_partner_groups",f={costPerShowEl:"span.costPerShow",dates:"span.js-group-dates",workload:".js-group-workload"};return function(e,l){if(!e||!e.length||!l.data||!l.data.length)return;var c=this,h=i.get(a),p=t.extend({hasCheckboxAll:!0},l);return t.extend(this,{initialize:function initialize(){this.collection=new o(),p.hasCheckboxAll&&this.renderCheckbox(),this.renderList(),this.setEvents(),this.runToggleSelectionCallback(),this.collection.on("change",function(){c.runToggleSelectionCallback();});},toggleSelection:function toggleSelection(e){c.collection.each(function(t){t.set("IsSelected",e),t.trigger("swapRowSelection");});},renderCheckbox:function renderCheckbox(){var n=this,r=this.collection.every(function(e){return e.get("IsSelected");});this.$checkboxAllGroups=t('<input type="checkbox" name="allGroups" checked='+r+" />");var i=t('<div class="b-checkbox groups-body__select-all" />');i.append(this.$checkboxAllGroups),e.append(i),this.$checkboxAllGroups.designForms().change(function(){var e=t(this).is(":checked");n.toggleSelection(e);});},renderList:function renderList(){n.list(p.data).each(function(n){n.IsSelected=!0;if(p.selected&&p.selected.length){n.IsSelected=!1;for(var r=0,i=p.selected.length;r<i;r++){if(n.Id===p.selected[r]){n.IsSelected=!0;break;}}}var o=c.createNode(n);e.append(o.$node);var u=t.extend({IsSelected:n.IsSelected,Id:n.Id,El:o.$node,Checkbox:o.$checkbox},n),a=new s(u);a.trigger("swapRowSelection"),a.on("change:IsSelected",function(e,t){t||c.removeGraphic(e),o.$checkbox.prop("checked",t).trigger("design:update");}),o.$checkbox.designForms().change(function(){var e=t(this).is(":checked");a.set("IsSelected",e),a.trigger("swapRowSelection");}),c.collection.add(a);});},createNode:function createNode(e){var r=n.object(e).clone();n.object(r).each(function(e){e==="TotalCoverage"&&(r[e]=n.number(r[e]).range("&nbsp;"));});var i=t(h(r)),s=i.find("input:checkbox");return{$node:i,$checkbox:s};},setEvents:function setEvents(){this.discount=0,r.on("campaignCreate:unselectPartnerGroups",function(e){e.Ids&&e.Ids.length&&c.collection.unselect(e.Ids);}).on("campaignCreate:VideoLengthByVideo",function(e){c.videoLingth=e,c.updateCostPerShow();}).on("campaignCreate:VideoLengthByUser",function(e){c.videoLingth=e,c.updateCostPerShow();}).on("campaignCreate:ChangeDiscount",function(e){c.discount=e,c.updateCostPerShow();}).on("campaignCreate:finishChecking",function(e){c.updateWorkloadGraphic(e),c.updateHeadDates(e);}).on("campaignCreate:errorChecking",function(){c.removeAllGraphics(),c.updateHeadDates();}).on("campaignCreate:errorValidation",function(){c.removeAllGraphics(),c.updateHeadDates();});},runToggleSelectionCallback:function runToggleSelectionCallback(){p.hasCheckboxAll&&this.$checkboxAllGroups.prop("checked",this.collection.every(function(e){return e.get("IsSelected");})).trigger("design:update"),n.is(p.onToggleSelection).fn()&&p.onToggleSelection(this.collection.getSelectedIds());},updateHeadDates:function updateHeadDates(t){var r=e.prev().find(f.dates);r.html("");if(!t)return;var i=t.GroupsWorkloads;if(t&&n.is(i).array()&&i.length){var s=i[0].Days;if(s.length>2){var o=n.date(s[1].Date).chain().parse("dd.mm.yy").format("d M").value(),u=n.date(s[s.length-2].Date).chain().parse("dd.mm.yy").format("d M").value();r.html(o+"&nbsp;&ndash;&nbsp;"+u);}}},updateCostPerShow:function updateCostPerShow(){var e;n.list(this.collection.models).each(function(t){c.videoLingth?(e=t.get("CostPerSecond")*c.videoLingth,c.discount&&(e-=e/100*c.discount),e=n.number(e).chain().truncateFloat(2).changeSep(".",",").range().value()):e="",t.get("El").find(f.costPerShowEl).text(e),p.$inner&&p.$inner.find(f.costPerShowEl).text(e);});},updateWorkloadGraphic:function updateWorkloadGraphic(e){var t=e.GroupsWorkloads;if(!n.is(t).array())return;n.list(t).each(function(e){n.list(c.collection.models).each(function(t){if(e.Id==t.get("Id")){var n=t.get("El").find(f.workload);return n.html(""),new u(n[0],e.Days),!1;}});});},removeAllGraphics:function removeAllGraphics(){n.list(this.collection.models).each(function(e){c.removeGraphic(e);});},removeGraphic:function removeGraphic(e){e.get("El").find(f.workload).html("");}}),this.initialize(),{selectAll:function selectAll(){c.toggleSelection(!0);},unselectAll:function unselectAll(){c.toggleSelection(!1);}};};}),define("partnerCityItem",["require","jquery","tools","events","backbone","templates.storage","partnerGroups","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("backbone"),s=e("templates.storage"),o=e("partnerGroups");e("jquery.designForms");var u="#template_partner_city_item",a={buttonToggle:".js-button-toggle",groupsList:".js-groups-list",title:".js-title"},f={opened:"is-opened"},l=250,c=i.View.extend({template:s.get(u),initialize:function initialize(e,t){this.$el=e,this.model=new i.Model(t),this.toggleSelectionCallback=t.toggleSelectionCallback,this.setSelectedGroups(),this.setTotalInfo(),this.render();},setSelectedGroups:function setSelectedGroups(){var e=!0,t=this.model.get("selected");n.list(this.model.get("Groups")).each(function(r){var i=!0;t&&t.length&&(i=!1,n.list(t).each(function(e){if(e===r.Id)return i=!0,!1;}));if(!i)return e=!1,!1;}),this.model.set({IsAllSelected:e});},setTotalInfo:function setTotalInfo(){var e=0,t=0;n.list(this.model.get("Groups")).each(function(n,r){e+=n.MonitorsCount,t+=n.TotalCoverage;}),this.model.set({MonitorsCount:n.number(e).range(),TotalCoverage:n.number(t).range()});},render:function render(){var e=this;this.$el.append(t(this.template(this.model.toJSON()))),this.$buttonToggle=this.$el.find(a.buttonToggle),this.$groupsList=this.$el.find(a.groupsList),this.$buttonToggle.click(function(){var t=e.$buttonToggle.hasClass(f.opened);e.$buttonToggle[t?"removeClass":"addClass"](f.opened),e.$groupsList[t?"slideUp":"slideDown"](l);}),this.$el.find(a.title).click(function(){e.$buttonToggle.click();}),this.$checkbox=this.$el.find("input:checkbox").designForms().change(function(){var n=t(this).is(":checked");e.model.set("IsAllSelected",n),e.partnerGroups[n?"selectAll":"unselectAll"]();}),this.model.on("change:IsAllSelected",function(t,n){e.$checkbox.prop("checked",n).trigger("design:update");}),this.initPartnerGroups();},initPartnerGroups:function initPartnerGroups(){var e=this,t=this.model.get("Groups").length;this.partnerGroups=new o(this.$groupsList,{data:this.model.get("Groups"),hasCheckboxAll:!1,selected:this.model.get("selectedGroups"),onToggleSelection:function onToggleSelection(n){e.model.set("IsAllSelected",t===n.length),typeof e.toggleSelectionCallback=="function"&&e.toggleSelectionCallback(n);}});},destroy:function destroy(){this.$el.remove();}});return function(e,t){e&&e.length>0&&t&&new c(e,t);};}),define("partnerMap.mapTypes",["require"],function(e){"use strict";return{circle:"circle",polygon:"polygon"};}),define("partnerMap.shapes.collection",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone");return n.Collection.extend({getModel:function getModel(e){var t=this.where({Id:e});return t.length?t[0]:null;},removeModel:function removeModel(e){var t=this.getModel(e);t&&t.destroy();},setToModel:function setToModel(e,t){var n=this.getModel(e);n&&n.set(t);},unselectAll:function unselectAll(){var e=this.where({IsSelected:!0});if(e.length){e[0].set({IsSelected:!1});var t=e[0].get("Circle");t.setOptions({fillOpacity:.35}),t.canEditable(!1),t.isSelected=!1,t.buttonRemove.hide();}},getCircleAreas:function getCircleAreas(){var e=this,n=[];return t.list(this.models).each(function(t){n.push({CenterLatitude:t.get("CenterLatitude"),CenterLongitude:t.get("CenterLongitude"),Radius:t.get("Radius"),CityId:e.cityId});}),n;},getPolygonAreas:function getPolygonAreas(){var e=this,n=[];return t.list(this.models).each(function(r){var i=[];t.list(r.get("Polygon").getPath().getArray()).each(function(e){i.push({lat:e.lat(),lng:e.lng()});}),n.push({latLngs:i,CityId:e.cityId});}),n;}});}),define("googleMaps.circle",["require","jquery","tools"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=1,i=1;return function(e,s){var o=t.extend({strokeColor:"#1a98ff",strokeOpacity:.8,strokeWeight:1,fillColor:"#1a98ff",fillOpacity:.6,radius:500,clickable:!1,draggable:!1,editable:!1,suppressUndo:!0},s||{});return t.extend(this,{initialize:function initialize(){var t=new e.Circle(o);return t.index=r++,t.id=i++,e.event.addListener(t,"click",function(){n.is(o.onClick).fn()&&o.onClick(t);}),e.event.addListener(t,"mouseover",function(){n.is(o.onMouseOver).fn()&&o.onMouseOver(t);}),e.event.addListener(t,"mouseout",function(){n.is(o.onMouseOut).fn()&&o.onMouseOut(t);}),t.remove=function(){e.event.trigger(t,"remove"),t.setMap(null);},t;}}),this.initialize();};}),define("googleMaps.polygon",["require","jquery","tools"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=1,i=1;return function(e,r){var i=t.extend({strokeColor:"#1a98ff",strokeOpacity:.8,strokeWeight:2.5,fillColor:"#1a98ff",fillOpacity:.6,radius:500,clickable:!1,draggable:!1,editable:!1,suppressUndo:!0},r||{});return t.extend(this,{initialize:function initialize(){var t=new e.Polygon(i);return e.event.addListener(t,"click",function(){n.is(i.onClick).fn()&&i.onClick(t);}),t.remove=function(){e.event.trigger(t,"remove"),t.setMap(null);},t;}}),this.initialize();};}),define("googleMaps.customMarker",["require","jquery"],function(e){"use strict";var t=e("jquery");return function(e){function n(e){this.latlng_=e.latlng,this.setMap(e.map);}return n.prototype=new e.googleMaps.OverlayView(),n.prototype.draw=function(){var n=this.div_;if(!n){n=this.div_=t("<div/>")[0],e["class"]&&(n.className=e["class"]),n.style.position="absolute",e.visible===!1&&(n.style.display="none"),typeof e.onClick=="function"&&t(n).click(function(){return e.onClick(),!1;}),n.appendChild(document.createElement("i"));var r=this.getPanes();r.overlayImage.appendChild(n);}var i=this.getProjection().fromLatLngToDivPixel(this.latlng_);i&&(n.style.left=i.x+"px",n.style.top=i.y+"px");},n.prototype.remove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null,this.setMap(null));},n.prototype.getPosition=function(){return this.latlng_;},n.prototype.updatePosition=function(e){this.latlng_=e,this.draw();},n.prototype.show=function(){this.div_.style.display="block";},n.prototype.hide=function(){this.div_.style.display="none";},new n(e);};}),define("googleMaps.design",[],function(){"use strict";var e={lightGray:[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#d3d3d3"}]},{featureType:"transit",stylers:[{},{visibility:"off"}]},{featureType:"transit.station.bus",stylers:[{saturation:-150},{visibility:"simplified"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#b3b3b3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"},{weight:1.8}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#d7d7d7"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ebebeb"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#a7a7a7"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#efefef"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#696969"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#737373"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dadada"}]}]};return{get:function get(t){return e[t]?e[t]:[];}};}),define("googleMaps",["require","jquery","tools","googleMaps.circle","googleMaps.polygon","googleMaps.customMarker","googleMaps.design"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("googleMaps.circle"),i=e("googleMaps.polygon"),s=e("googleMaps.customMarker");n.browser().msie()&&(HTMLElement.prototype.getBoundingClientRect=function(){var e=HTMLElement.prototype.getBoundingClientRect;return function(){try{return e.apply(this,arguments);}catch(t){return{left:"",right:"",top:"",bottom:""};}};}()),window.initGMaps=function(){};var o=function o(){var o=this;return this.googleMaps=google.maps,t.extend(this,{defaultMapOptions:{containerClass:"google-maps",zoom:10,mapTypeControl:!1,zoomControl:!0,zoomControlOptions:{position:this.googleMaps.ControlPosition.RIGHT_TOP},panControl:!1,scaleControl:!1,streetViewControl:!1,styles:e("googleMaps.design").get("lightGray")},render:function render(e){var r=e.$container&&e.$container.length?e.$container:t(e.containerId);if(!r.length)return;var i=t.extend({center:this.createPoint(e.center.lat,e.center.lng)},this.defaultMapOptions,e);r.addClass(i.containerClass);var s=new this.googleMaps.Map(r[0],i);return n.is(e.onClick).fn()&&this.googleMaps.event.addListener(s,"click",function(t){e.onClick(s,t);}),n.is(e.onDblClick).fn()&&this.googleMaps.event.addListener(s,"dblclick",function(t){e.onDblClick(s,t);}),n.is(e.onChangeCenter).fn()&&this.googleMaps.event.addListener(s,"center_changed",function(t){e.onChangeCenter(s,t);}),n.is(e.onChangeScale).fn()&&this.googleMaps.event.addListener(s,"zoom_changed",function(){e.onChangeScale(s);}),s.addNewEvent=function(e,t){o.googleMaps.event.addListener(this,e,function(){typeof t=="function"&&t(this);});},s;},createPoint:function createPoint(e,t){return new this.googleMaps.LatLng(e,t);},createElement:function createElement(e){if(!e.map)return;var n=t.extend({position:"LEFT_BOTTOM"},e),r=t("<div/>").addClass(n["class"]).html(n.text);return n.map.controls[this.googleMaps.ControlPosition[n.position]].push(r[0]),r;},createCircle:function createCircle(e){var i=t.extend({clickable:!0,editable:!0,selected:!0},e),o=new r(this.googleMaps,i);return i.selected?o.isSelected=!0:o.setOptions({editable:!1}),o.buttonRemove=new s({googleMaps:this.googleMaps,latlng:o.getCenter(),map:o.getMap(),"class":"google-maps__remove-circles",zIndex:o.index,visible:i.selected,onClick:function onClick(){n.is(i.onRemove).fn()&&i.onRemove(o.id),o.remove();}}),this.googleMaps.event.addListener(o,"click",function(){o.swapSelection();}),this.googleMaps.event.addListener(o,"radius_changed",function(){n.is(i.onChangeRadius).fn()&&i.onChangeRadius(o);}),this.googleMaps.event.addListener(o,"center_changed",function(){o.buttonRemove.updatePosition(o.getCenter()),n.is(i.onChangeCenter).fn()&&i.onChangeCenter(o);}),this.googleMaps.event.addListener(o,"mouseover",function(){o.toFront(),o.canEditable(!0);}),this.googleMaps.event.addListener(o,"mouseout",function(){o.toBack(),o.isSelected||o.canEditable(!1);}),o.swapSelection=function(){o.isSelected?(o.setOptions({fillOpacity:.35}),o.buttonRemove.hide()):(o.setOptions({fillOpacity:.6}),o.buttonRemove.show()),o.isSelected=!o.isSelected;},o.canEditable=function(e){o.setOptions({editable:e});},o.toFront=function(){o.setOptions({zIndex:5e3});},o.toBack=function(){o.setOptions({zIndex:o.index});},this.googleMaps.event.addListener(o,"remove",function(){o.buttonRemove.remove();}),o;},createPolygon:function createPolygon(e){var n=t.extend({clickable:!0,editable:!0,selected:!0},e),r=new i(this.googleMaps,n);return n.selected?r.isSelected=!0:r.setOptions({editable:!1}),this.googleMaps.event.addListener(r,"mouseover",function(){r.toFront(),r.canEditable(!0);}),this.googleMaps.event.addListener(r,"mouseout",function(){r.toBack();}),r.canEditable=function(e){r.setOptions({editable:e});},r.toFront=function(){r.setOptions({zIndex:5e3});},r.toBack=function(){r.setOptions({zIndex:r.index});},r;},resize:function resize(e){this.googleMaps.event.trigger(e,"resize");}}),{googleMaps:o.googleMaps,render:function render(e){return o.render(e);},createPoint:function createPoint(e,t){return o.createPoint(e,t);},createElement:function createElement(e){return o.createElement(e);},createCircle:function createCircle(e){return o.createCircle(e);},createPolygon:function createPolygon(e){return o.createPolygon(e);},resize:function resize(e){o.resize(e);}};},u=new function(){var n=[];return t.extend(this,{isLoaded:!1,initMap:function initMap(t){e(["https://maps.googleapis.com/maps/api/js?v=3.34&key=AIzaSyDkzXJZFiciHsrB_r1sxyVTYPqNnmiOA1Q&sensor=false&libraries=geometry&callback=initGMaps"]),u.isLoaded?typeof t=="function"&&t(new o()):n.push(t);},runCallbacks:function runCallbacks(){this.isLoaded=!0;for(var e=0,t=n.length;e<t;e++){n[e](new o());}n=[];}}),{initMap:this.initMap,runCallbacks:this.runCallbacks};}();return window.initGMaps=function(){u.runCallbacks();},u.initMap;}),define("partnerMap",["require","jquery","backbone","events","tools","partnerMap.mapTypes","partnerMap.shapes.collection","googleMaps"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=e("events"),i=e("tools"),s=e("partnerMap.mapTypes"),o=e("partnerMap.shapes.collection"),u=window.langResource,a=null,f={hidden:"is-hidden",opened:"is-opened"},l={label:u.campaignCreate.selectPoints},c={map:".map-container",gap:".map-gap",label:".map-label",overlay:".map-overlay"},h=500,p=10,d=1e4;return function(r,v,m){if(!r||!r.length||!v)return;var g=this,y=s[v.GpsPolygonAreas.length?"polygon":"circle"],b=!1;t.extend(this,{initialize:function initialize(){this.$gap=r.find(c.gap).click(function(){g.map&&(b=!0,r.addClass(f.opened));}),this.$overlay=r.find(c.overlay),this.renderMap(function(){g.initLabel();});},initLabel:function initLabel(){this.$label=r.find(c.label).text(l.label),this.collection.on("add",function(){g.$label.addClass(f.hidden);}).on("remove",function(){this.models.length||g.$label.removeClass(f.hidden);});},runCallback:function runCallback(e,t){i.is(m[e]).fn()&&m[e](t);},renderMap:function renderMap(l){function c(){a.each(function(e){e.get("Polygon").setOptions({fillOpacity:.6,strokeWeight:1});});}function m(){g.currentPolygonId=null,g.currentPolygonCoords=[],a.each(function(e){e.set("canAddNewCords",!1);});}e("googleMaps")(function(e){function w(e){var t=g.collection.where({Id:e.id})[0];t.set({IsSelected:!t.get("IsSelected")});}function E(e,t){var r=g.maps.createCircle({map:g.map,center:e,selected:b,radius:t,onClick:function onClick(e){e.isSelected?g.map.selectedCircle=null:(g.map.selectedCircle=e.id,g.collection.unselectAll()),w(e);},onChangeRadius:function onChangeRadius(e){var t=e.getRadius();t=Math.min(t,d),t=Math.max(t,p),t!=e.getRadius()&&e.setRadius(t),g.collection.setToModel(e.id,{Radius:Math.round(t)});},onChangeCenter:function onChangeCenter(e){g.collection.setToModel(e.id,{CenterLatitude:e.getCenter().lat(),CenterLongitude:e.getCenter().lng()});},onRemove:function onRemove(e){g.collection.removeModel(e);}});b&&(g.collection.unselectAll(),g.map.selectedCircle=r.id),g.collection.add(new n.Model({Id:r.id,Circle:r,IsSelected:b,Radius:r.getRadius(),CenterLatitude:r.getCenter().lat(),CenterLongitude:r.getCenter().lng()}));}function S(e,t){return g.maps.createPolygon({map:g.map,id:e.cid,paths:t,selected:b,onClick:function onClick(e){if(g.currentPolygonId===e.id)return;m(),c(),g.currentPolygonId=e.id,a.get({cid:e.id}).get("Polygon").setOptions({strokeWeight:2.5});}});}function x(e){g.currentPolygonCoords.push(e);if(g.currentPolygonId===null){var t=new n.Model({Polygon:null,canAddNewCords:!0});g.currentPolygonId=t.cid;var r=S(t,g.currentPolygonCoords);t.set("Polygon",r),a.add(t);}else{var i=a.get({cid:g.currentPolygonId});if(i.get("canAddNewCords")){var s=i.get("Polygon");s.setMap(null),s.setPaths(g.currentPolygonCoords),s.setMap(g.map);}}}function T(){e.resize(g.map);var t=new g.maps.googleMaps.LatLngBounds();if(y===s.circle){var n;g.collection.models.length?(i.list(g.collection.models).each(function(e){n=e.get("Circle").getBounds(),t.extend(n.getNorthEast()),t.extend(n.getSouthWest());}),g.map.fitBounds(t)):g.map.setCenter(g.maps.createPoint(v.CityLatitude,v.CityLongitude),v.Zoom);}else a.length?(i.list(a.models).each(function(e){i.list(e.get("Polygon").getPath().getArray()).each(function(e){t.extend(g.maps.createPoint(e.lat(),e.lng()));});}),g.map.fitBounds(t)):g.map.setCenter(g.maps.createPoint(v.CityLatitude,v.CityLongitude),v.Zoom);}g.maps=e,g.collection=new o(),g.collection.cityId=v.Id,a=new o(),a.cityId=v.Id,a.unselectAll=function(){this.each(function(e){e.get("Polygon").canEditable(!1);});},g.currentPolygonId=null,g.currentPolygonCoords=[],a.on("reset add remove change",function(){g.runCallback("onChangePolygonAreas",this.getPolygonAreas());}),g.collection.on("add remove change:Radius change:CenterLatitude change:CenterLongitude",function(){g.runCallback("onChangeCircleAreas",this.getCircleAreas());}),g.map=e.render({containerId:"#map-city-"+v.Id,center:{lat:v.CityLatitude,lng:v.CityLongitude},zoomControl:!1,zoom:v.Zoom,draggableCursor:"default",onClick:function onClick(e,t){y===s.circle?E(t.latLng,h):x(t.latLng);}}),b=!1,t(document).on("keydown",function(e){if(e.keyCode===46&&b&&g.map.selectedCircle){var t=g.collection.getModel(g.map.selectedCircle);t&&t.destroy();}}),g.$gap.click(function(){C.show(),A.show(),O.show(),y===s.circle?A.trigger("click"):O.trigger("click"),g.collection.models.length?k.show():N.show(),g.map.setOptions({zoomControl:!0}),T();});var N=e.createElement({"class":"lbl-circles-info",text:u.campaignCreate.mapHelpLabel,position:"TOP_CENTER",map:g.map}).hide();g.collection.on("add",function(){N.hide();}).on("remove",function(){this.models.length||N.show();});var C=e.createElement({"class":"btn-complete",text:'<button class="button button_submit">'+u.campaignCreate.complete+"</button>",position:"RIGHT_BOTTOM",map:g.map}).hide().click(function(){a.trigger("change"),g.map.setOptions({zoomControl:!1}),C.hide(),A.hide(),O.hide(),k.hide(),L.hide(),M.hide(),_.hide(),N.hide(),b=!1,r.removeClass(f.opened),e.resize(g.map),g.collection.unselectAll(),a.unselectAll(),T();}),k=e.createElement({"class":"btn-remove-circles",text:'<button class="button">'+u.campaignCreate.removeAllAreas+"</button>",position:"LEFT_BOTTOM",map:g.map}).hide().click(function(){for(var e=0,t=g.collection.models.length;e<t;e++){g.collection.models[e].get("Circle").remove(),g.collection.models[e].destroy(),e--,t--;}}),L=e.createElement({"class":"btn-remove-circles",text:'<button class="button">  </button>',position:"LEFT_BOTTOM",map:g.map}).hide().click(function(){a.each(function(e){e.get("Polygon").remove();}),a.reset(),m();}),A=e.createElement({"class":"btn-circle-map",text:'<button class="button"></button>',position:"LEFT_TOP",map:g.map}).hide().click(function(){M.hide(),_.hide(),L.hide(),a.each(function(e){e.get("Polygon").setMap(null);}),A.find("button").addClass("button_submit"),O.find("button").removeClass("button_submit"),g.collection.each(function(e){e.get("Circle").setMap(g.map);}),g.collection.length&&k.show(),y=s.circle,g.runCallback("onChangeMapType",y);}),O=e.createElement({"class":"btn-polygon-map",text:'<button class="button"></button>',position:"LEFT_TOP",map:g.map}).hide().click(function(){k.hide(),g.collection.each(function(e){e.get("Circle").setMap(null);}),g.collection.unselectAll(),O.find("button").addClass("button_submit"),A.find("button").removeClass("button_submit"),a.each(function(e){e.get("Polygon").setMap(g.map);}),a.length&&L.show(),M.show(),_.show(),y=s.polygon,g.runCallback("onChangeMapType",y);}),M=e.createElement({"class":"btn-polygon-add",text:'<button class="button"> </button>',position:"LEFT_BOTTOM",map:g.map}).hide().click(function(){m(),c();}),_=e.createElement({"class":"btn-polygon-delete",text:'<button class="button"> </button>',position:"LEFT_BOTTOM",map:g.map}).hide().click(function(){a.get({cid:g.currentPolygonId}).get("Polygon").remove(),a.remove(a.get({cid:g.currentPolygonId})),m();});g.collection.on("add",function(){b&&k.show();}).on("remove",function(){this.models.length||k.hide();}),a.on("add",function(){b&&L.show();}).on("remove",function(){a.length||L.hide();}),y===s.circle?i.list(v.GpsAreas).each(function(e){E(g.maps.createPoint(e.CenterLatitude,e.CenterLongitude),e.Radius);}):i.list(v.GpsPolygonAreas).each(function(e){var t=[];i.list(e.LatLngs).each(function(e){t.push(g.maps.createPoint(e.Lat,e.Lng));});var r=new n.Model({Polygon:null,canAddNewCords:!0}),s=S(r,t);r.set("Polygon",s),a.add(r);}),T(),l();});}}),this.initialize();};}),define("map.defaultLocation",[],function(){"use strict";var e=window.langResource,t;switch(e.currentLocale){default:t={Latitude:67.09772323711415,Longitude:105.71252525376622,Zoom:4};}return t;}),define("partnerCity",["require","jquery","tools","events","backbone","templates.storage","partnerCityItem","partnerGroups","partnerMap","map.defaultLocation"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("backbone"),s=e("templates.storage"),o=e("partnerCityItem"),u=e("partnerGroups"),a=e("partnerMap"),f=e("map.defaultLocation"),l="#template_partner_city",c={groupsContainer:"div.js-groups-container",groups:".js-groups-list",checkboxAllCities:"div.js-checkboxAllCities",map:"div.js-map-container"},h="is-hidden";return function(e,p){if(!e||!e.length||!p||!p.data)return;var d=this,v=s.get(l);t.extend(this,{initialize:function initialize(){this.render(),this.setEvents();},render:function render(){e.append(v(p.data[0])),this.$mapContainer=e.find(c.map),this.$groupsContainer=e.find(c.groupsContainer),this.swapGroupsAndMap(p.campaignType),this.checkboxAllCitiesChecked=!0,window.dataAllRegions?this.renderForEvrikaTv():this.renderNormal();},renderForEvrikaTv:function renderForEvrikaTv(){var e=s.get("#template_partner_region"),o=function o(e,t,r){n.list(t).each(function(t,n){t.Level=r;var i=new f(t);n===0&&i.$el.addClass("first"),e.append(i.$el),t.Inner&&t.Inner.length&&o(i.getInnerCont(),t.Inner,r+1);});},f=i.View.extend({initialize:function initialize(e){this.model=new i.Model(e),this.render();},render:function render(){var n=this,r=250;this.$el=t(e(this.model.toJSON())),this.$buttonOpen=this.$el.find(".js-button-open:first"),this.$inner=this.$el.filter(".js-group-inner:first"),this.$buttonOpen.click(function(){var e=n.$buttonOpen.hasClass("is-opened");n.$buttonOpen[e?"removeClass":"addClass"]("is-opened"),n.$inner[e?"slideUp":"slideDown"](r);}),this.$el.find(".js-pg-title").click(function(){n.$buttonOpen.click();});},getInnerCont:function getInnerCont(){return this.$inner;}});o(this.$groupsContainer.find(".js-groups-list"),window.dataAllRegions,1),this.$groupsContainer.parent().addClass("draft");var l=this.$groupsContainer.find(".js-moskow").html("");new u(l,{data:p.data.Groups,selected:p.selectedGroups,$inner:this.$groupsContainer,onToggleSelection:function onToggleSelection(e){r.trigger("campaignCreate:changePartnerGroups",{Ids:e});}}),l.find(">div").addClass("group__row4"),l.find("input:checkbox").prop("checked",!1).change().attr("data-level",4);var c=function c(e,r,i){var s=e.prev().find(r);s.text(n.number(Number(t.trim(s.text().replace(/\s/g,"")))-i).range());var o=e.parents(".js-group-inner:first");o.length&&c(o,r,i);},h=0,d=0,v=0,m=0;l.find(".cell--monitors").each(function(){h+=Number(t.trim(t(this).text().replace(/\s/g,"")));}),l.find(".cell--coverage").each(function(){d+=Number(t.trim(t(this).text().replace(/\s/g,"")));}),v=Number(t.trim(l.prev().find(".cell--monitors").text().replace(/\s/g,"")))-h,m=Number(t.trim(l.prev().find(".cell--coverage").text().replace(/\s/g,"")))-d,c(l,".cell--monitors",v),c(l,".cell--coverage",m),this.$groupsContainer.find("input:checkbox").designForms().on("change",function(){var e=t(this),n=e.is(":checked"),r=e.parents(".group__row:first").next();r.length&&r.hasClass("js-group-inner")&&r.find('input:checkbox[data-level="'+(e.data("level")+1)+'"]').each(function(){t(this).is(":checked")!=n&&t(this).prop("checked",n).change();}),g(e,e.data("level"));});var g=function g(e,t){if(t===1)return;var n=e.parents(".js-group-inner:first"),r=n.find('input:checkbox[data-level="'+t+'"]'),i=r.filter(":checked"),s=r.parent(".half"),o=n.prev().find('input:checkbox[data-level="'+(t-1)+'"]'),u=o.is(":checked");r.length===i.length?o.prop("checked",!0).trigger("design:update").parent().removeClass("half"):i.length!==0?o.prop("checked",!1).trigger("design:update").parent().addClass("half"):o.prop("checked",!1).trigger("design:update").parent()[s.length?"addClass":"removeClass"]("half"),g(o,t-1);};new a(this.$mapContainer,{Id:p.data[0].Id,CityLatitude:p.data[0].CityLatitude,CityLongitude:p.data[0].CityLongitude,Zoom:p.data[0].CityMapScale,GpsAreas:p.gpsAreas,GpsPolygonAreas:p.gpsPolygonAreas},{onChangeMapType:function onChangeMapType(e){r.trigger("campaignCreate:changeMapType",{mapType:e});},onChangeCircleAreas:function onChangeCircleAreas(e){r.trigger("campaignCreate:changeCircleAreas",{GpsAreas:e});},onChangePolygonAreas:function onChangePolygonAreas(e){r.trigger("campaignCreate:changePolygonAreas",{GpsPolygonAreas:e});}});},renderNormal:function renderNormal(){var e=this,i=p.data.length>1;if(i){var s=e.$groupsContainer.find(c.groups),l={},h=[];t(c.checkboxAllCities).find("input:checkbox").prop("checked","checked").designForms().change(function(r){e.checkboxAllCitiesChecked=!e.checkboxAllCitiesChecked;var i=!0;e.checkboxAllCitiesChecked&&(i=!1),n.list(s.find("input:checkbox")).each(function(e,n){t(e).prop("checked")===i&&t(e).click();});}),r.on("campaignCreate:changePartnerGroups",function(n){h.length!==n.Ids.length?(e.checkboxAllCitiesChecked=!1,t(c.checkboxAllCities).find("input:checkbox").prop("checked","").trigger("design:update")):h.length===n.Ids.length&&(e.checkboxAllCitiesChecked=!0,t(c.checkboxAllCities).find("input:checkbox").prop("checked","checked").trigger("design:update"));}),n.list(p.data).each(function(e,i){var u=t("<div />",{"class":"city-item"});s.append(u),h.push(e.Id),new o(u,t.extend({toggleSelectionCallback:function toggleSelectionCallback(e){l[i]=e;var t=[];n.object(l).each(function(e){n.list(l[e]).each(function(e){t.push(e);});}),r.trigger("campaignCreate:changePartnerGroups",{Ids:t});}},e));});}else new u(this.$groupsContainer.find(c.groups),{data:p.data[0].Groups,selected:p.selectedGroups,onToggleSelection:function onToggleSelection(e){r.trigger("campaignCreate:changePartnerGroups",{Ids:e});}});var d={Id:p.data[0].Id,CityLatitude:i?f.Latitude:p.data[0].CityLatitude,CityLongitude:i?f.Longitude:p.data[0].CityLongitude,Zoom:i?f.Zoom:p.data[0].CityMapScale,GpsAreas:p.gpsAreas,GpsPolygonAreas:p.gpsPolygonAreas};new a(this.$mapContainer,d,{onChangeMapType:function onChangeMapType(e){r.trigger("campaignCreate:changeMapType",{mapType:e});},onChangeCircleAreas:function onChangeCircleAreas(e){r.trigger("campaignCreate:changeCircleAreas",{GpsAreas:e});},onChangePolygonAreas:function onChangePolygonAreas(e){r.trigger("campaignCreate:changePolygonAreas",{GpsPolygonAreas:e});}});},setEvents:function setEvents(){r.on("campaignCreate:changeAdType",function(e){d.swapGroupsAndMap(e.adType);});},swapGroupsAndMap:function swapGroupsAndMap(e){this.$mapContainer[e==0?"addClass":"removeClass"](h),this.$groupsContainer[e!=0?"addClass":"removeClass"](h);}}),this.initialize();};}),define("campaign.create.model",["require","jquery","backbone","events","tools","urls"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=e("events"),i=e("tools"),s=e("urls");return n.Model.extend({delayBeforeCheck:500,defaults:{AdvertiserId:"",Title:"",AdsCampaignType:"0",StartDate:"",EndDate:"",IsEndDateLimited:!0,Discount:"0",Budget:"",IsBillingEnabled:!0,Videos:{},VideoIds:[],IsVideoSelected:!0,VideoLengthByVideo:"",VideoLengthByUser:"",VideoLengthInSeconds:"",IsCustomFrequency:!1,Frequency:5,GeoFrequencies:1,IsGeoFrequncyUsed:!1,MaxGpsShowCountInArea:1,PartnerGroupIds:[],GpsAreas:[],GpsPolygonAreas:[],MapType:"circle"},setSimple:function setSimple(e,t){if(this.get(e)){var n={};n[e]=t,this.set(n,{silent:!0});}else this.set(e,t);},initialize:function initialize(){this.url=s.get("campaignCreate"),this.setEvents();},setEvents:function setEvents(){var e=this;this.on("change:AdsCampaignType",function(t,n){r.trigger("campaignCreate:changeAdType",{adType:n,isFormValid:e.isValid()});}).on("change:VideoLengthByUser",function(e,t){e.get("IsVideoSelected")||r.trigger("campaignCreate:VideoLengthByUser",t);}).on("change:VideoLengthByVideo",function(e,t){e.get("IsVideoSelected")&&r.trigger("campaignCreate:VideoLengthByVideo",t);}).on("change:IsVideoSelected change:VideoLengthByUser change:VideoLengthByVideo",function(e){e.get("IsVideoSelected")?e.set("VideoLengthInSeconds",e.get("VideoLengthByVideo")):e.set("VideoLengthInSeconds",e.get("VideoLengthByUser")),r.trigger("campaignCreate:changeVideos",e.toJSON());}).on("change:IsVideoSelected change:StartDate",function(e){r.trigger("campaignCreate:validateDates",e.toJSON());}),r.on("campaignCreate:create",function(){e.create();}).on("campaignCreate:changePartnerGroups",function(t){e.set("PartnerGroupIds",t.Ids);}).on("campaignCreate:changeCircleAreas",function(t){e.set("GpsAreas",t.GpsAreas);}).on("campaignCreate:changePolygonAreas",function(t){e.set("GpsPolygonAreas",t.GpsPolygonAreas);}).on("campaignCreate:changeMapType",function(t){e.set("MapType",t.mapType);});},validate:function validate(){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){var t=e.isValid();e.get("AdsCampaignType")==="0"?t?e.checkCreate():r.trigger("campaignCreate:errorValidation"):r.trigger("campaignCreate:changeGeoModel",{isFormValid:t,params:e.toJSON()});},this.delayBeforeCheck);},isValid:function isValid(){var e=this.toJSON();if(!e.StartDate)return!1;if(e.AdsCampaignType==="0"){if(!e.IsEndDateLimited&&!e.Budget)return!1;if(e.IsEndDateLimited&&!e.EndDate)return!1;}else{if(e.IsEndDateLimited&&!e.EndDate)return!1;if(e.IsBillingEnabled==="True"&&!e.Budget)return!1;}if(!e.IsVideoSelected){if(!e.VideoLengthByUser)return!1;if(i.date(e.StartDate).getDaysOffset(new Date())<3)return!1;}else{if(!e.VideoIds.length)return!1;if(!e.VideoLengthByVideo)return!1;}return e.AdsCampaignType==="0"&&!e.Frequency?!1:e.AdsCampaignType==="1"&&!e.MaxGpsShowCountInArea?!1:e.AdsCampaignType==="0"&&!e.PartnerGroupIds.length?!1:e.AdsCampaignType==="1"&&!e.GpsAreas.length&&!e.GpsPolygonAreas.length?!1:!0;},getCheckedParams:function getCheckedParams(){var e=this.toJSON();return e.IsEndDateLimited||delete e.EndDate,e.AdsCampaignType==="0"&&e.IsEndDateLimited?delete e.Budget:e.Budget=i.number(e.Budget).formatToNumber(),e.AdsCampaignType==="1"&&(e.IsGeoFrequncyUsed?e.Frequency=e.GeoFrequencies:delete e.Frequency),e.MapType==="circle"?delete e.GpsPolygonAreas:delete e.GpsAreas,delete e.GeoFrequencies,delete e.IsGeoFrequncyUsed,delete e.VideosData,e;},checkCreate:function checkCreate(){var e=this;r.trigger("campaignCreate:startChecking"),t.ajax({url:s.get("isCampaignCreatable"),data:this.getCheckedParams(),traditional:!0,poolName:"AC.isCampaignCreatable",success:function success(t){e.get("AdsCampaignType")==="0"&&r.trigger("campaignCreate:finishChecking",t);},error:function error(){e.get("AdsCampaignType")==="0"&&r.trigger("campaignCreate:errorChecking");}});},create:function create(){var e=this;t.ajax({type:"POST",url:this.url,data:this.getCheckedParams(),success:function success(t){t.Success&&t.UrlRedirect?window.location.href=t.UrlRedirect:(alert("   .   ..."),e.get("AdsCampaignType")==="0"?e.checkCreate():r.trigger("campaignCreate:errorCreate"));},error:function error(){alert("-   .   ..."),e.get("AdsCampaignType")==="0"?e.checkCreate():r.trigger("campaignCreate:errorCreate");}});}});}),define("campaign.create.formHelpers",[],function(){"use strict";var e={hidden:"is-hidden"};return{showHideBlock:function showHideBlock(t,n){t[n?"removeClass":"addClass"](e.hidden);},selectRadioByValue:function selectRadioByValue(e,t){e.filter("[value="+t+"]").prop("checked",!0).change();}};}),define("customer.form.addoredit",["require","jquery","tools","popup"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("popup");return function(e){var i=this,s=t.extend({buttonCancel:"input.js-button-cancel",loaderEl:".js-loader",inputNotValidClass:"input-validation-error",errors:{el:"div.js-field-errors",serverText:"   "}},e||{});if(!s.$linkOpen||!s.$linkOpen.length||s.$linkOpen.data("is-initialized"))return;return t.extend(this,{initialize:function initialize(){s.$linkOpen.click(function(){return i.show(),!1;}),s.$linkOpen.data("is-initialized",!0);},createPopup:function createPopup(){if(this.popup)return;this.popup=new r({containerClass:"popup_advertiser-create",headerText:s.headerText,hideByOverlay:!1,hideByEscape:!1}),this.popup.addContent(s.$container),this.initFormSubmit(),this.initControls();},show:function show(){this.createPopup(),s.type==="edit"&&this.populateFields(),this.popup.show();},hide:function hide(){this.popup.hide(),s.type==="add"&&this.clearFields();},initFormSubmit:function initFormSubmit(){function e(e){i.$errorsField.text(e).show();}this.$popupLoader=s.$container.find(s.loaderEl),this.$errorsField=s.$container.find(s.errors.el);var t=s.$container.find(">form");t.submit(function(e){if(i.isSaving)return e.preventDefault(),!1;t.find("input."+s.inputNotValidClass).length||(i.isSaving=!0,i.$errorsField.hide(),i.$popupLoader.show());}),window.advertiserCreateSuccess=function(t){setTimeout(function(){t.success?(i.useCallback("onSuccess",{Id:t.advertiserId,Title:t.advertiserTitle}),i.hide()):e(t.validationErrorMessage),i.$popupLoader.hide(),i.isSaving=!1;},400);},window.advertiserCreateError=function(){setTimeout(function(){e(s.errors.serverText),i.$popupLoader.hide(),i.isSaving=!1;},400);};},initControls:function initControls(){s.$container.find(s.buttonCancel).click(function(){return i.hide(),!1;}),this.clearFields();},clearFields:function clearFields(){this.$errorsField.hide(),s.$container.find("input:text, textarea").removeClass(s.inputNotValidClass).val("");},populateFields:function populateFields(){var e=s.$linkOpen.data(),t;n.object(e).each(function(e,r){t=s.$container.find("#"+n.string(e).capitalize()),t.length&&t.val(r);});},useCallback:function useCallback(e,t){n.is(s[e]).fn()&&s[e](t);}}),this.initialize(),{show:function show(){i.show();},hide:function hide(){i.hide();}};};}),define("customer.form.builder",["require","tools","customer.form.addoredit"],function(e){"use strict";var t=e("tools"),n=e("customer.form.addoredit"),r=$("#advertiserFormCreate");return function(e){return r.length?new n({$container:r,$linkOpen:e.$linkOpen,headerText:r.data("header-text"),type:e.type,onSuccess:function onSuccess(n){t.is(e.onSuccess).fn()&&e.onSuccess(n);}}):null;};}),function(){var e,t,n,r,i,s={}.hasOwnProperty,o=function o(e,t){function r(){this.constructor=e;}for(var n in t){s.call(t,n)&&(e[n]=t[n]);}return r.prototype=t.prototype,e.prototype=new r(),e.__super__=t.prototype,e;};r=function(){function e(){this.options_index=0,this.parsed=[];}return e.prototype.add_node=function(e){return e.nodeName.toUpperCase()==="OPTGROUP"?this.add_group(e):this.add_option(e);},e.prototype.add_group=function(e){var t,n,r,i,s,o;t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:this.escapeExpression(e.label),children:0,disabled:e.disabled}),s=e.childNodes,o=[];for(r=0,i=s.length;r<i;r++){n=s[r],o.push(this.add_option(n,t,e.disabled));}return o;},e.prototype.add_option=function(e,t,n){if(e.nodeName.toUpperCase()==="OPTION")return e.text!==""?(t!=null&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1;},e.prototype.escapeExpression=function(e){var t,n;return e==null||e===!1?"":/[\&\<\>\"\'\`]/.test(e)?(t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[\<\>\"\'\`]/g,e.replace(n,function(e){return t[e]||"&amp;";})):e;},e;}(),r.select_to_array=function(e){var t,n,i,s,o;n=new r(),o=e.childNodes;for(i=0,s=o.length;i<s;i++){t=o[i],n.add_node(t);}return n.parsed;},t=function(){function e(t,n){this.form_field=t,this.options=n!=null?n:{};if(!e.browser_is_supported())return;this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers();}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t);},this.activate_action=function(t){return e.activate_field(t);},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0]!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:!0,this.group_search=this.options.group_search!=null?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||Infinity,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:!0,this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:!0;},e.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||e.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||e.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||e.default_no_result_text;},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0;},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1;},e.prototype.input_focus=function(e){var t=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return t.container_mousedown();},50);}else if(!this.active_field)return this.activate_field();},e.prototype.input_blur=function(e){var t=this;if(!this.mouse_on_container)return this.active_field=!1,setTimeout(function(){return t.blur_test();},100);},e.prototype.results_option_build=function(e){var t,n,r,i,s;t="",s=this.results_data;for(r=0,i=s.length;r<i;r++){n=s[r],n.group?t+=this.result_add_group(n):t+=this.result_add_option(n);if(e!=null?e.first:void 0)n.selected&&this.is_multiple?this.choice_build(n):n.selected&&!this.is_multiple&&this.single_set_selected_text(n.text);}return t;},e.prototype.result_add_option=function(e){var t,n;return e.search_match?this.include_option_in_results(e)?(t=[],!e.disabled&&(!e.selected||!this.is_multiple)&&t.push("active-result"),e.disabled&&(!e.selected||!this.is_multiple)&&t.push("disabled-result"),e.selected&&t.push("result-selected"),e.group_array_index!=null&&t.push("group-option"),e.classes!==""&&t.push(e.classes),n=document.createElement("li"),n.className=t.join(" "),n.style.cssText=e.style,n.setAttribute("data-option-array-index",e.array_index),n.innerHTML=e.search_text,this.outerHTML(n)):"":"";},e.prototype.result_add_group=function(e){var t;return!e.search_match&&!e.group_match?"":e.active_options>0?(t=document.createElement("li"),t.className="group-result",t.innerHTML=e.search_text,this.outerHTML(t)):"";},e.prototype.results_update_field=function(){this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build();if(this.results_showing)return this.winnow_results();},e.prototype.reset_single_select_options=function(){var e,t,n,r,i;r=this.results_data,i=[];for(t=0,n=r.length;t<n;t++){e=r[t],e.selected?i.push(e.selected=!1):i.push(void 0);}return i;},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show();},e.prototype.results_search=function(e){return this.results_showing?this.winnow_results():this.results_show();},e.prototype.winnow_results=function(){var e,t,n,r,i,s,o,u,a,f,l,c;this.no_results_clear(),r=0,s=this.get_search_text(),e=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),a=new RegExp(e,"i"),n=this.get_search_regex(e),c=this.results_data;for(f=0,l=c.length;f<l;f++){t=c[f],t.search_match=!1,i=null;if(this.include_option_in_results(t)){t.group&&(t.group_match=!1,t.active_options=0),t.group_array_index!=null&&this.results_data[t.group_array_index]&&(i=this.results_data[t.group_array_index],i.active_options===0&&i.search_match&&(r+=1),i.active_options+=1);if(!t.group||!!this.group_search)t.search_text=t.group?t.label:t.text,t.search_match=this.search_string_match(t.search_text,n),t.search_match&&!t.group&&(r+=1),t.search_match?(s.length&&(o=t.search_text.search(a),u=t.search_text.substr(0,o+s.length)+"</em>"+t.search_text.substr(o+s.length),t.search_text=u.substr(0,o)+"<em>"+u.substr(o)),i!=null&&(i.group_match=!0)):t.group_array_index!=null&&this.results_data[t.group_array_index].search_match&&(t.search_match=!0);}}return this.result_clear_highlight(),r<1&&s.length?(this.update_results_content(""),this.no_results(s)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight());},e.prototype.get_search_regex=function(e){var t;return t=this.search_contains?"":"^",new RegExp(t+e,"i");},e.prototype.search_string_match=function(e,t){var n,r,i,s;if(t.test(e))return!0;if(this.enable_split_word_search&&(e.indexOf(" ")>=0||e.indexOf("[")===0)){r=e.replace(/\[|\]/g,"").split(" ");if(r.length)for(i=0,s=r.length;i<s;i++){n=r[i];if(t.test(n))return!0;}}},e.prototype.choices_count=function(){var e,t,n,r;if(this.selected_option_count!=null)return this.selected_option_count;this.selected_option_count=0,r=this.form_field.options;for(t=0,n=r.length;t<n;t++){e=r[t],e.selected&&(this.selected_option_count+=1);}return this.selected_option_count;},e.prototype.choices_click=function(e){e.preventDefault();if(!this.results_showing&&!this.is_disabled)return this.results_show();},e.prototype.keyup_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode,this.search_field_scale();switch(t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:e.preventDefault();if(this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search();}},e.prototype.clipboard_event_checker=function(e){var t=this;return setTimeout(function(){return t.results_search();},50);},e.prototype.container_width=function(){return this.options.width!=null?this.options.width:""+this.form_field.offsetWidth+"px";},e.prototype.include_option_in_results=function(e){return this.is_multiple&&!this.display_selected_options&&e.selected?!1:!this.display_disabled_options&&e.disabled?!1:e.empty?!1:!0;},e.prototype.search_results_touchstart=function(e){return this.touch_started=!0,this.search_results_mouseover(e);},e.prototype.search_results_touchmove=function(e){return this.touch_started=!1,this.search_results_mouseout(e);},e.prototype.search_results_touchend=function(e){if(this.touch_started)return this.search_results_mouseup(e);},e.prototype.outerHTML=function(e){var t;return e.outerHTML?e.outerHTML:(t=document.createElement("div"),t.appendChild(e),t.innerHTML);},e.browser_is_supported=function(){return window.navigator.appName==="Microsoft Internet Explorer"?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0;},e.default_multiple_text="Select Some Options",e.default_single_text="Select an Option",e.default_no_result_text="No results match",e;}(),e=jQuery,e.fn.extend({chosen:function chosen(r){return t.browser_is_supported()?this.each(function(t){var i,s;i=e(this),s=i.data("chosen"),r==="destroy"&&s instanceof n?s.destroy():s instanceof n||i.data("chosen",new n(this,r));}):this;}}),n=function(t){function n(){return i=n.__super__.constructor.apply(this,arguments),i;}return o(n,t),n.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl");},n.prototype.set_up_html=function(){var t,n;return t=["chosen-container"],t.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chosen-rtl"),n={"class":t.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(n.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=e("<div />",n),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this});},n.prototype.register_observers=function(){var e=this;return this.container.bind("touchstart.chosen",function(t){e.container_mousedown(t);}),this.container.bind("touchend.chosen",function(t){e.container_mouseup(t);}),this.container.bind("mousedown.chosen",function(t){e.container_mousedown(t);}),this.container.bind("mouseup.chosen",function(t){e.container_mouseup(t);}),this.container.bind("mouseenter.chosen",function(t){e.mouse_enter(t);}),this.container.bind("mouseleave.chosen",function(t){e.mouse_leave(t);}),this.search_results.bind("mouseup.chosen",function(t){e.search_results_mouseup(t);}),this.search_results.bind("mouseover.chosen",function(t){e.search_results_mouseover(t);}),this.search_results.bind("mouseout.chosen",function(t){e.search_results_mouseout(t);}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(t){e.search_results_mousewheel(t);}),this.search_results.bind("touchstart.chosen",function(t){e.search_results_touchstart(t);}),this.search_results.bind("touchmove.chosen",function(t){e.search_results_touchmove(t);}),this.search_results.bind("touchend.chosen",function(t){e.search_results_touchend(t);}),this.form_field_jq.bind("chosen:updated.chosen",function(t){e.results_update_field(t);}),this.form_field_jq.bind("chosen:activate.chosen",function(t){e.activate_field(t);}),this.form_field_jq.bind("chosen:open.chosen",function(t){e.container_mousedown(t);}),this.form_field_jq.bind("chosen:close.chosen",function(t){e.input_blur(t);}),this.search_field.bind("blur.chosen",function(t){e.input_blur(t);}),this.search_field.bind("keyup.chosen",function(t){e.keyup_checker(t);}),this.search_field.bind("keydown.chosen",function(t){e.keydown_checker(t);}),this.search_field.bind("focus.chosen",function(t){e.input_focus(t);}),this.search_field.bind("cut.chosen",function(t){e.clipboard_event_checker(t);}),this.search_field.bind("paste.chosen",function(t){e.clipboard_event_checker(t);}),this.is_multiple?this.search_choices.bind("click.chosen",function(t){e.choices_click(t);}):this.container.bind("click.chosen",function(e){e.preventDefault();});},n.prototype.destroy=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show();},n.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled)return this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field();this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1;if(!this.is_multiple)return this.selected_item.bind("focus.chosen",this.activate_action);},n.prototype.container_mousedown=function(t){if(!this.is_disabled){t&&t.type==="mousedown"&&!this.results_showing&&t.preventDefault();if(t==null||!e(t.target).hasClass("search-choice-close"))return this.active_field?!this.is_multiple&&t&&(e(t.target)[0]===this.selected_item[0]||e(t.target).parents("a.chosen-single").length)&&(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field();}},n.prototype.container_mouseup=function(e){if(e.target.nodeName==="ABBR"&&!this.is_disabled)return this.results_reset(e);},n.prototype.search_results_mousewheel=function(e){var t;e.originalEvent&&(t=e.originalEvent.deltaY||-e.originalEvent.wheelDelta||e.originalEvent.detail);if(t!=null)return e.preventDefault(),e.type==="DOMMouseScroll"&&(t*=40),this.search_results.scrollTop(t+this.search_results.scrollTop());},n.prototype.blur_test=function(e){if(!this.active_field&&this.container.hasClass("chosen-container-active"))return this.close_field();},n.prototype.close_field=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale();},n.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus();},n.prototype.test_active_click=function(t){var n;return n=e(t.target).closest(".chosen-container"),n.length&&this.container[0]===n[0]?this.active_field=!0:this.close_field();},n.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=r.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1;},n.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),r=parseInt(this.search_results.css("maxHeight"),10),s=this.search_results.scrollTop(),i=r+s,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight();if(t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(n<s)return this.search_results.scrollTop(n);}},n.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null;},n.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}));},n.prototype.update_results_content=function(e){return this.search_results.html(e);},n.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1;},n.prototype.set_tab_index=function(e){var t;if(this.form_field.tabIndex)return t=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=t;},n.prototype.set_label_behavior=function(){var t=this;this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=e("label[for='"+this.form_field.id+"']"));if(this.form_field_label.length>0)return this.form_field_label.bind("click.chosen",function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field();});},n.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"));},n.prototype.search_results_mouseup=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n.length)return this.result_highlight=n,this.result_select(t),this.search_field.focus();},n.prototype.search_results_mouseover=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n)return this.result_do_highlight(n);},n.prototype.search_results_mouseout=function(t){if(e(t.target).hasClass("active-result"))return this.result_clear_highlight();},n.prototype.choice_build=function(t){var n,r,i=this;return n=e("<li />",{"class":"search-choice"}).html("<span>"+t.html+"</span>"),t.disabled?n.addClass("search-choice-disabled"):(r=e("<a />",{"class":"search-choice-close","data-option-array-index":t.array_index}),r.bind("click.chosen",function(e){return i.choice_destroy_link_click(e);}),n.append(r)),this.search_container.before(n);},n.prototype.choice_destroy_link_click=function(t){t.preventDefault(),t.stopPropagation();if(!this.is_disabled)return this.choice_destroy(e(t.target));},n.prototype.choice_destroy=function(e){if(this.result_deselect(e[0].getAttribute("data-option-array-index")))return this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale();},n.prototype.results_reset=function(){this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change");if(this.active_field)return this.results_hide();},n.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove();},n.prototype.result_select=function(e){var t,n;if(this.result_highlight)return t=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?t.removeClass("active-result"):this.reset_single_select_options(),n=this.results_data[t[0].getAttribute("data-option-array-index")],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(n):this.single_set_selected_text(n.text),(!e.metaKey&&!e.ctrlKey||!this.is_multiple)&&this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale());},n.prototype.single_set_selected_text=function(e){return e==null&&(e=this.default_text),e===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(e);},n.prototype.result_deselect=function(e){var t;return t=this.results_data[e],this.form_field.options[t.options_index].disabled?!1:(t.selected=!1,this.form_field.options[t.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[t.options_index].value}),this.search_field_scale(),!0);},n.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect)return;return this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect");},n.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html();},n.prototype.winnow_results_set_highlight=function(){var e,t;t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first();if(e!=null)return this.result_do_highlight(e);},n.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n),this.form_field_jq.trigger("chosen:no_results",{chosen:this});},n.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove();},n.prototype.keydown_arrow=function(){var e;if(!this.results_showing||!this.result_highlight)return this.results_show();e=this.result_highlight.nextAll("li.active-result").first();if(e)return this.result_do_highlight(e);},n.prototype.keyup_arrow=function(){var e;if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight)return e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight());},n.prototype.keydown_backstroke=function(){var e;if(this.pending_backstroke)return this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke();e=this.search_container.siblings("li.search-choice").last();if(e.length&&!e.hasClass("search-choice-disabled"))return this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus");},n.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null;},n.prototype.keydown_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode,this.search_field_scale(),t!==8&&this.pending_backstroke&&this.clear_backstroke();switch(t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:this.results_showing&&e.preventDefault();break;case 32:this.disable_search&&e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:e.preventDefault(),this.keydown_arrow();}},n.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,a,f;if(this.is_multiple){r=0,u=0,s="position:absolute; left: -1000px; top: -1000px; display:none;",o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(a=0,f=o.length;a<f;a++){i=o[a],s+=i+":"+this.search_field.css(i)+";";}return t=e("<div />",{style:s}),t.text(this.search_field.val()),e("body").append(t),u=t.width()+25,t.remove(),n=this.container.outerWidth(),u>n-10&&(u=n-10),this.search_field.css({width:u+"px"});}},n;}(t);}.call(void 0),define("jquery.designDropdowns",["jquery"],function(){}),define("campaign.create.form.customers",["require","jquery","customer.form.builder","jquery.designDropdowns"],function(e){"use strict";var t=e("jquery"),n=e("customer.form.builder");e("jquery.designDropdowns");var r=window.langResource,i={dropdown:"#advertisers",buttonCreate:"button.js-create-advertiser",selectedAdvertiserId:"#SelectedAdvertiserId"},s={placeholderText:r.dropdowns.select,emptySearchText:r.dropdowns.notFound},o=function o(e,t,r){var o=e.find(i.dropdown),u=e.find(i.selectedAdvertiserId).val()||o.val();t.get("AdvertiserId")||t.setSimple("AdvertiserId",u);if(!r){o.find("option[value="+t.get("AdvertiserId")+"]").attr("selected",!0),o.chosen({placeholder_text:s.placeholderText,no_results_text:s.emptySearchText}).on("change",function(){t.setSimple("AdvertiserId",o.val());});var a=n({type:"add",$linkOpen:e.find(i.buttonCreate),onSuccess:function onSuccess(e){a.hide(),o.append('<option selected value="'+e.Id+'">'+e.Title+"</option>").val(e.Id).change().trigger("chosen:updated");}});}};return function(e,t,n){e&&e.length&&t&&new o(e,t,n);};}),define("jquery.numeric",["require","jquery","tools"],function(e){"use strict";var t=e("jquery"),n=e("tools");t.fn.numeric=function(){return this.keypress(t.fn.numeric.keypress).keydown(t.fn.numeric.keydown).blur(t.fn.numeric.blur);},t.fn.numeric.keypress=function(e){var t=e.charCode?e.charCode:e.keyCode?e.keyCode:0;return t==13?!0:e.ctrlKey&&t==97||e.ctrlKey&&t==65?!0:e.ctrlKey&&t==120||e.ctrlKey&&t==88?!0:e.ctrlKey&&t==99||e.ctrlKey&&t==67?!0:e.ctrlKey&&t==122||e.ctrlKey&&t==90?!0:e.ctrlKey&&t==118||e.ctrlKey&&t==86||e.shiftKey&&t==45?!0:t<48||t>57?t!=8&&t!=9&&t!=35&&t!=36&&t!=37&&t!=39&&t!=46?!1:!0:!0;},t.fn.numeric.keydown=function(e){var r=e.charCode?e.charCode:e.keyCode?e.keyCode:0,i=this,s,o=!0,u=t.fn.getSelectionStart(i),a=t.fn.getSelectionEnd(i),f=i.value.substr(a).length;if(e.ctrlKey&&r==122||e.ctrlKey&&r==90||e.ctrlKey&&r==118||e.ctrlKey&&r==86||e.shiftKey&&r==45)return setTimeout(function(){i.value=n.number(i.value).chain().formatToNumber().range().value();},10),!0;if(r>=48&&r<=57||r==8||r==46)r==46&&u!=i.value.length&&i.value.substr(u,1)==" "&&u==a&&(i.value=i.value.substring(0,u+1)+i.value.substring(u+2),o=!1),r==8&&u!=0&&i.value.substr(u-1,1)==" "&&u==a&&(i.value=i.value.substring(0,u-2)+i.value.substring(u-1),o=!1),setTimeout(function(){i.value=n.number(i.value).chain().formatToNumber().range().value(),s=i.value.length-f,r==46&&u==a&&s++,t.fn.setSelection(i,s);},10);return o;},t.fn.numeric.blur=function(){var e=this;e.value=n.number(e.value).chain().formatToNumber().range().value(),t(e).change();},t.fn.getSelectionStart=function(e){if(e.setSelectionRange)return e.selectionStart;if(document.selection&&document.selection.createRange){var t=document.selection.createRange().duplicate();return t.moveEnd("character",e.value.length),t.text===""?e.value.length:e.value.length-t.text.length;}},t.fn.getSelectionEnd=function(e){if(e.setSelectionRange)return e.selectionStart;if(document.selection&&document.selection.createRange){var t=document.selection.createRange().duplicate();return t.moveStart("character",-e.value.length),t.text.length;}},t.fn.setSelection=function(e,t){typeof t=="number"&&(t=[t,t]);if(t&&t.constructor==Array&&t.length==2)if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveStart("character",t[0]),n.moveEnd("character",t[1]-t[0]),n.select();}else e.setSelectionRange&&(e.focus(),e.setSelectionRange(t[0],t[1]));};}),define("campaign.create.form.discount",["require","jquery","events","tools","jquery.numeric"],function(e){"use strict";var t=e("jquery"),n=e("events"),r=e("tools");e("jquery.numeric");var i=function i(e,_i2){var s={modelParamName:"Discount",inputEl:"input#discount"};t.extend(this,{initialize:function initialize(){var o=e.find(s.inputEl),u,a,f,l;o.numeric().val(_i2.get(s.modelParamName)).on("keypress",function(e){var n=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(n>47&&n<58){switch(n){case 48:f=0;break;case 49:f=1;break;case 50:f=2;break;case 51:f=3;break;case 52:f=4;break;case 53:f=5;break;case 54:f=6;break;case 55:f=7;break;case 56:f=8;break;case 57:f=9;}a=t.trim(o.val());if(a){l=t.fn.getSelectionStart(o[0]),u=a.substr(0,l)+f+a.substr(l),u=parseInt(u,10);if(!isNaN(u))return u>100&&(u=100),o.val(u),!1;}}}).on("keyup",function(){u=parseFloat(o.val()),_i2.set(s.modelParamName,parseFloat(o.val())),!isNaN(u)&&r.is(u).number()&&u>=0&&u<=100&&n.trigger("campaignCreate:ChangeDiscount",u);});}}),this.initialize();};return function(e,t){new i(e,t);};}),function(e){if(e.fn.inputmask===undefined){var t=function t(e){var t=document.createElement("input"),n="on"+e,r=n in t;return r||(t.setAttribute(n,"return;"),r=typeof t[n]=="function"),t=null,r;};var n=function n(e){var t=e=="text"||e=="tel";if(!t){var n=document.createElement("input");n.setAttribute("type",e),t=n.type==="text",n=null;}return t;};var r=function r(t,n,i){var s=i.aliases[t];return s?(s.alias&&r(s.alias,undefined,i),e.extend(!0,i,s),e.extend(!0,i,n),!0):!1;};var i=function i(t,n){function i(e){function i(e,t,n,r){this.matches=[],this.isGroup=e||!1,this.isOptional=t||!1,this.isQuantifier=n||!1,this.isAlternator=r||!1,this.quantifier={min:1,max:1};}function s(e,n,i){var s=t.definitions[n],o=e.matches.length==0;i=i!=undefined?i:e.matches.length;if(s&&!r){var u=s.prevalidator,a=u?u.length:0;for(var f=1;f<s.cardinality;f++){var l=a>=f?u[f-1]:[],c=l.validator,h=l.cardinality;e.matches.splice(i++,0,{fn:c?typeof c=="string"?new RegExp(c):new function(){this.test=c;}():new RegExp("."),cardinality:h?h:1,optionality:e.isOptional,newBlockMarker:o,casing:s.casing,def:s.definitionSymbol||n,placeholder:s.placeholder,mask:n});}e.matches.splice(i++,0,{fn:s.validator?typeof s.validator=="string"?new RegExp(s.validator):new function(){this.test=s.validator;}():new RegExp("."),cardinality:s.cardinality,optionality:e.isOptional,newBlockMarker:o,casing:s.casing,def:s.definitionSymbol||n,placeholder:s.placeholder,mask:n});}else e.matches.splice(i++,0,{fn:null,cardinality:0,optionality:e.isOptional,newBlockMarker:o,casing:null,def:n,placeholder:undefined,mask:n}),r=!1;}var n=/(?:[?*+]|\{[0-9\+\*]+(?:,[0-9\+\*]*)?\})\??|[^.?*+^${[]()|\\]+|./g,r=!1,o=new i(),u,a,f=[],l=[],c,h,p,d;while(u=n.exec(e)){a=u[0];switch(a.charAt(0)){case t.optionalmarker.end:case t.groupmarker.end:c=f.pop();if(f.length>0){h=f[f.length-1],h.matches.push(c);if(h.isAlternator){p=f.pop();for(var v=0;v<p.matches.length;v++){p.matches[v].isGroup=!1;}f.length>0?(h=f[f.length-1],h.matches.push(p)):o.matches.push(p);}}else o.matches.push(c);break;case t.optionalmarker.start:f.push(new i(!1,!0));break;case t.groupmarker.start:f.push(new i(!0));break;case t.quantifiermarker.start:var m=new i(!1,!1,!0);a=a.replace(/[{}]/g,"");var g=a.split(","),y=isNaN(g[0])?g[0]:parseInt(g[0]),b=g.length==1?y:isNaN(g[1])?g[1]:parseInt(g[1]);if(b=="*"||b=="+")y=b=="*"?0:1;m.quantifier={min:y,max:b};if(f.length>0){var w=f[f.length-1].matches;u=w.pop();if(!u.isGroup){var E=new i(!0);E.matches.push(u),u=E;}w.push(u),w.push(m);}else{u=o.matches.pop();if(!u.isGroup){var E=new i(!0);E.matches.push(u),u=E;}o.matches.push(u),o.matches.push(m);}break;case t.escapeChar:r=!0;break;case t.alternatormarker:f.length>0?(h=f[f.length-1],d=h.matches.pop()):d=o.matches.pop(),d.isAlternator?f.push(d):(p=new i(!1,!1,!1,!0),p.matches.push(d),f.push(p));break;default:if(f.length>0){h=f[f.length-1],h.matches.length>0&&(d=h.matches[h.matches.length-1],d.isGroup&&(d.isGroup=!1,s(d,t.groupmarker.start,0),s(d,t.groupmarker.end))),s(h,a);if(h.isAlternator){p=f.pop();for(var v=0;v<p.matches.length;v++){p.matches[v].isGroup=!1;}f.length>0?(h=f[f.length-1],h.matches.push(p)):o.matches.push(p);}}else o.matches.length>0&&(d=o.matches[o.matches.length-1],d.isGroup&&(d.isGroup=!1,s(d,t.groupmarker.start,0),s(d,t.groupmarker.end))),s(o,a);}}return o.matches.length>0&&(d=o.matches[o.matches.length-1],d.isGroup&&(d.isGroup=!1,s(d,t.groupmarker.start,0),s(d,t.groupmarker.end)),l.push(o)),l;}function s(n,r){if(t.numericInput&&t.multi!==!0){n=n.split("").reverse();for(var s=0;s<n.length;s++){n[s]==t.optionalmarker.start?n[s]=t.optionalmarker.end:n[s]==t.optionalmarker.end?n[s]=t.optionalmarker.start:n[s]==t.groupmarker.start?n[s]=t.groupmarker.end:n[s]==t.groupmarker.end&&(n[s]=t.groupmarker.start);}n=n.join("");}if(n==undefined||n=="")return undefined;n.length==1&&t.greedy==0&&t.repeat!=0&&(t.placeholder="");if(t.repeat>0||t.repeat=="*"||t.repeat=="+"){var o=t.repeat=="*"?0:t.repeat=="+"?1:t.repeat;n=t.groupmarker.start+n+t.groupmarker.end+t.quantifiermarker.start+o+","+t.repeat+t.quantifiermarker.end;}return e.inputmask.masksCache[n]==undefined&&(e.inputmask.masksCache[n]={mask:n,maskToken:i(n),validPositions:{},_buffer:undefined,buffer:undefined,tests:{},metadata:r}),e.extend(!0,{},e.inputmask.masksCache[n]);}var r=undefined;e.isFunction(t.mask)&&(t.mask=t.mask.call(this,t));if(e.isArray(t.mask)){if(n)r=[],e.each(t.mask,function(t,n){n["mask"]!=undefined&&!e.isFunction(n.mask)?r.push(s(n.mask.toString(),n)):r.push(s(n.toString(),n));});else{t.keepStatic=t.keepStatic==undefined?!0:t.keepStatic;var o="(";e.each(t.mask,function(t,n){o.length>1&&(o+=")|("),n["mask"]!=undefined&&!e.isFunction(n.mask)?o+=n.mask.toString():o+=n.toString();}),o+=")",r=s(o,t.mask);}}else t.mask&&(t.mask["mask"]!=undefined&&!e.isFunction(t.mask.mask)?r=s(t.mask.mask.toString(),t.mask):r=s(t.mask.toString(),t.mask));return r;};var p=function p(r,i,s){function b(e,t,n){t=t||0;var r=[],i,s=0,o,u;do{if(e===!0&&w().validPositions[s]){var a=w().validPositions[s];o=a.match,i=a.locator.slice(),r.push(n===!0?a.input:q(s,o));}else{if(t>s){var f=L(s,i,s-1);u=f[0];}else u=N(s,i,s-1);o=u.match,i=u.locator.slice(),r.push(q(s,o));}s++;}while((y==undefined||s-1<y)&&o["fn"]!=null||o["fn"]==null&&o["def"]!=""||t>=s);return r.pop(),r;}function w(){return i;}function E(e){var t=w();t.buffer=undefined,t.tests={},e!==!0&&(t._buffer=undefined,t.validPositions={},t.p=0);}function S(e){var t=w(),n=-1,r=t.validPositions;e==undefined&&(e=-1);var i=n,s=n;for(var o in r){var u=parseInt(o);if(e==-1||r[u]["match"].fn!=null)u<=e&&(i=u),u>=e&&(s=u);}return n=e-i>1||s<e?i:s,n;}function x(t,n,r){if(s.insertMode&&w()["validPositions"][t]!=undefined&&r==undefined){var i=e.extend(!0,{},w().validPositions),o=S(),u;for(u=t;u<=o;u++){delete w().validPositions[u];}w().validPositions[t]=n;var a=!0,f;for(u=t;u<=o;u++){var l=i[u];if(l!=undefined){var c=w().validPositions;!s.keepStatic&&(c[u+1]!=undefined&&L(u+1,c[u].locator.slice(),u).length>1||c[u]&&c[u].alternation!=undefined)?f=u+1:f=B(u),k(f,l.match.def)?a=a&&D(f,l.input,!0,!0)!==!1:a=l["match"].fn==null;}if(!a)break;}if(!a)return w().validPositions=e.extend(!0,{},i),!1;}else w().validPositions[t]=n;return!0;}function T(e,t){var n,r=e;w()["validPositions"][e]!=undefined&&w()["validPositions"][e].input==s.radixPoint&&(t++,r++);for(n=r;n<t;n++){w()["validPositions"][n]!=undefined&&(w()["validPositions"][n].input!=s.radixPoint||n==S())&&delete w().validPositions[n];}for(n=t;n<=S();){var i=w().validPositions[n],o=w().validPositions[r];i!=undefined&&o==undefined?(k(r,i.match.def)&&D(r,i.input,!0)!==!1&&(delete w().validPositions[n],n++),r++):n++;}var u=S();e<=u&&w()["validPositions"][u]!=undefined&&w()["validPositions"][u].input==s.radixPoint&&delete w().validPositions[u],E(!0);}function N(t,n,r){function i(t,n,r){var i=s.greedy?r:r.slice(0,1),o=!1,u=t.locator[n].toString().split(",");for(var a=0;a<u.length;a++){if(e.inArray(u[a],i)!=-1){o=!0;break;}}return o;}var o=L(t,n,r),u,a=S(),f=w().validPositions[a]||L(0)[0],l=f.alternation!=undefined?f.locator[f.alternation].split(","):[];for(var c=0;c<o.length;c++){u=o[c];if(s.greedy||u.match&&(u.match.optionality===!1||u.match.newBlockMarker===!1)&&u.match.optionalQuantifier!==!0&&(f.alternation==undefined||u["locator"][f.alternation]!=undefined&&i(u,f.alternation,l)))break;}return u;}function C(e){return w().validPositions[e]?w().validPositions[e].match:L(e)[0].match;}function k(e,t){var n=!1,r=L(e);for(var i=0;i<r.length;i++){if(r[i].match&&r[i]["match"].def==t){n=!0;break;}}return n;}function L(t,n,r){function l(n,r,i,u){function c(i,u,p){if(o>1e4)return alert("jquery.inputmask: There is probably an error in your mask definition or in the code. Create an issue on github with an example of the mask you are using. "+w().mask),!0;if(o==t&&i.matches==undefined)return a.push({match:i,locator:u.reverse()}),!0;if(i.matches!=undefined){if(i.isGroup&&p!==!0){i=c(n.matches[h+1],u);if(i)return!0;}else if(i.isOptional){var d=i;i=l(i,r,u,p);if(i){var v=a[a.length-1].match,m=e.inArray(v,d.matches)==0;m&&(f=!0),o=t;}}else if(i.isAlternator){var g=i,y=[],b,E=a.slice(),S=u.length,x=r.length>0?r.shift():-1;if(x==-1||typeof x=="string"){var T=o,N=r.slice(),C;typeof x=="string"&&(C=x.split(","));for(var k=0;k<g.matches.length;k++){a=[],i=c(g.matches[k],[k].concat(u),p)||i,b=a.slice(),o=T,a=[];for(var L=0;L<N.length;L++){r[L]=N[L];}for(var A=0;A<b.length;A++){var O=b[A];for(var M=0;M<y.length;M++){var _=y[M];if(O.match.mask==_.match.mask&&(typeof x!="string"||e.inArray(O.locator[S].toString(),C)!=-1)){b.splice(A,1),_.locator[S]=_.locator[S]+","+O.locator[S],_.alternation=S;break;}}}y=y.concat(b);}typeof x=="string"&&(y=e.map(y,function(t,n){if(isFinite(n)){var r=t.locator[S].toString().split(","),i;t.locator[S]=undefined,t.alternation=undefined;for(var s=0;s<r.length;s++){i=e.inArray(r[s],C)!=-1,i&&(t.locator[S]!=undefined?(t.locator[S]+=",",t.alternation=S,t.locator[S]+=r[s]):t.locator[S]=parseInt(r[s]));}if(t.locator[S]!=undefined)return t;}})),a=E.concat(y),f=!0;}else i=c(g.matches[x],[x].concat(u),p);if(i)return!0;}else if(i.isQuantifier&&p!==!0){var D=i;s.greedy=s.greedy&&isFinite(D.quantifier.max);for(var P=r.length>0&&p!==!0?r.shift():0;P<(isNaN(D.quantifier.max)?P+1:D.quantifier.max)&&o<=t;P++){var H=n.matches[e.inArray(D,n.matches)-1];i=c(H,[P].concat(u),!0);if(i){var v=a[a.length-1].match;v.optionalQuantifier=P>D.quantifier.min-1;var m=e.inArray(v,H.matches)==0;if(m){if(P>D.quantifier.min-1){f=!0,o=t;break;}return!0;}return!0;}}}else{i=l(i,r,u,p);if(i)return!0;}}else o++;}for(var h=r.length>0?r.shift():0;h<n.matches.length;h++){if(n.matches[h].isQuantifier!==!0){var p=c(n.matches[h],[h].concat(i),u);if(p&&o==t)return p;if(o>t)break;}}}var i=w().maskToken,o=n?r:0,u=n||[0],a=[],f=!1;if(n==undefined){var c=t-1,h;while((h=w()["validPositions"][c])==undefined&&c>-1){c--;}if(h!=undefined&&c>-1)o=c,u=h.locator.slice();else{c=t-1;while((h=w()["tests"][c])==undefined&&c>-1){c--;}h!=undefined&&c>-1&&(o=c,u=h[0].locator.slice());}}for(var p=u.shift();p<i.length;p++){var d=l(i[p],u,[p]);if(d&&o==t||o>t)break;}return(a.length==0||f)&&a.push({match:{fn:null,cardinality:0,optionality:!0,casing:null,def:""},locator:[]}),w().tests[t]=e.extend(!0,[],a),w().tests[t];}function A(){return w()["_buffer"]==undefined&&(w()._buffer=b(!1,1)),w()._buffer;}function O(){return w()["buffer"]==undefined&&(w().buffer=b(!0,S(),!0)),w().buffer;}function M(e,t){var n=O().slice();if(e===!0)E(),e=0,t=n.length;else for(var r=e;r<t;r++){delete w().validPositions[r],delete w().tests[r];}for(var r=e;r<t;r++){n[r]!=s.skipOptionalPartCharacter&&D(r,n[r],!0,!0);}}function _(e,t){switch(t.casing){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();}return e;}function D(t,n,r,i){function o(t,n,r,i){var o=!1;return e.each(L(t),function(u,a){var f=a.match,l=n?1:0,c="",h=O();for(var p=f.cardinality;p>l;p--){c+=F(t-(p-1));}n&&(c+=n),o=f.fn!=null?f.fn.test(c,w(),t,r,s):n!=f["def"]&&n!=s.skipOptionalPartCharacter||f["def"]==""?!1:{c:f.def,pos:t};if(o!==!1){var d=o.c!=undefined?o.c:n;d=d==s.skipOptionalPartCharacter&&f.fn===null?f.def:d;var v=t;o["remove"]!=undefined&&T(o.remove,o.remove+1);if(o.refreshFromBuffer){var m=o.refreshFromBuffer;r=!0,M(m===!0?m:m.start,m.end);if(o.pos==undefined&&o.c==undefined)return o.pos=S(),!1;v=o.pos!=undefined?o.pos:t;if(v!=t)return o=e.extend(o,D(v,d,!0)),!1;}else if(o!==!0&&o.pos!=undefined&&o["pos"]!=t){v=o.pos,M(t,v);if(v!=t)return o=e.extend(o,D(v,d,!0)),!1;}return o!=1&&o.pos==undefined&&o.c==undefined?!1:(u>0&&E(!0),x(v,e.extend({},a,{input:_(d,f)}),i)||(o=!1),!1);}}),o;}function u(t,n,r,i){var o=e.extend(!0,{},w().validPositions),u,a;for(u=S();u>=0;u--){if(w().validPositions[u]&&w()["validPositions"][u].alternation!=undefined){a=w().validPositions[u].alternation;break;}}if(a!=undefined)for(var f in w().validPositions){if(parseInt(f)>parseInt(u)&&w().validPositions[f].alternation===undefined){var l=w().validPositions[f],c=l.locator[a],h=w().validPositions[u].locator[a].split(",");for(var p=0;p<h.length;p++){if(c<h[p]){var d,v;for(var m=f-1;m>=0;m--){d=w().validPositions[m];if(d!=undefined){v=d.locator[a],d.locator[a]=h[p];break;}}if(c!=d.locator[a]){var g=O().slice();for(var y=f;y<S()+1;y++){delete w().validPositions[y],delete w().tests[y];}E(!0),s.keepStatic=!s.keepStatic;for(var y=f;y<g.length;y++){g[y]!=s.skipOptionalPartCharacter&&D(S()+1,g[y],!1,!0);}d.locator[a]=v;var b=D(t,n,r,i);s.keepStatic=!s.keepStatic;if(!!b)return b;E(),w().validPositions=e.extend(!0,{},o);}}}break;}}return!1;}r=r===!0;var a=O();for(var f=t-1;f>-1;f--){if(w().validPositions[f]&&w()["validPositions"][f]["match"].fn==null)break;w()["validPositions"][f]==undefined&&(!P(f)||a[f]!=q(f))&&L(f).length>1&&o(f,a[f],!0);}var l=t,c=!1;i&&l>=H()&&E(!0);if(l<H()){c=o(l,n,r,i);if(!r&&c===!1){var h=w().validPositions[l];if(!h||h["match"].fn!=null||h["match"].def!=n&&n!=s.skipOptionalPartCharacter){if((s.insertMode||w()["validPositions"][B(l)]==undefined)&&!P(l))for(var p=l+1,d=B(l);p<=d;p++){c=o(p,n,r,i);if(c!==!1){l=p;break;}}}else c={caret:B(l)};}}return c===!1&&s.keepStatic&&K(a)&&(c=u(t,n,r,i)),c===!0&&(c={pos:l}),c;}function P(e){var t=C(e);return t.fn!=null?t.fn:!1;}function H(){var e;y=d.prop("maxLength"),y==-1&&(y=undefined);if(s.greedy==0){var t,n=S(),r=w().validPositions[n],i=r!=undefined?r.locator.slice():undefined;for(t=n+1;r==undefined||r["match"]["fn"]!=null||r["match"]["fn"]==null&&r["match"]["def"]!="";t++){r=N(t,i,t-1),i=r.locator.slice();}e=t;}else e=O().length;return y==undefined||e<y?e:y;}function B(e){var t=H();if(e>=t)return t;var n=e;while(++n<t&&!P(n)&&(s.nojumps!==!0||s.nojumpsThreshold>n)){;}return n;}function j(e){var t=e;if(t<=0)return 0;while(--t>0&&!P(t)){;}return t;}function F(e){return w()["validPositions"][e]==undefined?q(e):w().validPositions[e].input;}function I(e,t,n){e._valueSet(t.join("")),n!=undefined&&X(e,n);}function q(t,n){n=n||C(t);var r=e.isFunction(n.placeholder)?n.placeholder.call(this,s):n.placeholder;return r!=undefined?r:n["fn"]==null?n.def:s.placeholder.charAt(t%s.placeholder.length);}function R(t,n,r,i){var o=i!=undefined?i.slice():t._valueGet().split("");E(),n&&t._valueSet("");var u=A().slice(0,B(-1)).join(""),a=o.join("").match(new RegExp(U(u),"g"));a&&a.length>1&&o.splice(0,u.length),e.each(o,function(n,i){var s=S();e.inArray(i,A().slice(s+1,w()["p"]))==-1||r?(nt.call(t,undefined,!0,i.charCodeAt(0),!1,r,r?n:w().p),r=r||n>0&&n>w().p):nt.call(t,undefined,!0,i.charCodeAt(0),!1,!0,s+1);});if(n){var f=s.onKeyPress.call(this,undefined,O(),0,s);et(t,f),I(t,O(),e(t).is(":focus")?B(S(0)):undefined);}}function U(t){return e.inputmask.escapeRegex.call(this,t);}function z(t){if(t.data("_inputmask")&&!t.hasClass("hasDatepicker")){var n=[],r=w().validPositions;for(var i in r){r[i].match&&r[i]["match"].fn!=null&&n.push(r[i].input);}var u=(o?n.reverse():n).join(""),a=(o?O().slice().reverse():O()).join("");return e.isFunction(s.onUnMask)&&(u=s.onUnMask.call(t,a,u,s)||u),u;}return t[0]._valueGet();}function W(e){if(o&&typeof e=="number"&&(!s.greedy||s.placeholder!="")){var t=O().length;e=t-e;}return e;}function X(t,n,r){var i=t.jquery&&t.length>0?t[0]:t,o;if(typeof n!="number"){var u=e(i).data("_inputmask");return!e(i).is(":visible")&&u&&u["caret"]!=undefined?(n=u.caret.begin,r=u.caret.end):i.setSelectionRange?(n=i.selectionStart,r=i.selectionEnd):document.selection&&document.selection.createRange&&(o=document.selection.createRange(),n=0-o.duplicate().moveStart("character",-1e5),r=n+o.text.length),n=W(n),r=W(r),{begin:n,end:r};}n=W(n),r=W(r),r=typeof r=="number"?r:n;var u=e(i).data("_inputmask")||{};u.caret={begin:n,end:r},e(i).data("_inputmask",u);if(!e(i).is(":visible"))return;i.scrollLeft=i.scrollWidth,s.insertMode==0&&n==r&&r++,i.setSelectionRange?(i.selectionStart=n,i.selectionEnd=r):i.createTextRange&&(o=i.createTextRange(),o.collapse(!0),o.moveEnd("character",r),o.moveStart("character",n),o.select());}function V(t){var n=O(),r=n.length,i,s=S(),o={},u=w().validPositions[s],a=u!=undefined?u.locator.slice():undefined,f;for(i=s+1;i<n.length;i++){f=N(i,a,i-1),a=f.locator.slice(),o[i]=e.extend(!0,{},f);}var l=u&&u.alternation!=undefined?u.locator[u.alternation].split(","):[];for(i=r-1;i>s;i--){f=o[i].match;if(!(f.optionality||f.optionalQuantifier||u&&u.alternation!=undefined&&o[i]["locator"][u.alternation]!=undefined&&e.inArray(o[i]["locator"][u.alternation].toString(),l)!=-1)||n[i]!=q(i,f))break;r--;}return t?{l:r,def:o[r]?o[r].match:undefined}:r;}function J(e){var t=O(),n=t.slice(),r=V(),i=n.length-1;for(;i>r;i--){if(P(i))break;}n.splice(r,i+1-r),I(e,n);}function K(t){if(e.isFunction(s.isComplete))return s.isComplete.call(d,t,s);if(s.repeat=="*")return undefined;var n=!1,r=V(!0),i=j(r.l),o=S();if(o==i)if(r["def"]==undefined||r.def.newBlockMarker||r.def.optionalQuantifier){n=!0;for(var u=0;u<=i;u++){var a=P(u);if(a&&(t[u]==undefined||t[u]==q(u))||!a&&t[u]!=q(u)){n=!1;break;}}}return n;}function Q(e,t){return o?e-t>1||e-t==1&&s.insertMode:t-e>1||t-e==1&&s.insertMode;}function G(t){var n=e._data(t).events;e.each(n,function(t,n){e.each(n,function(e,t){if(t.namespace=="inputmask"&&t.type!="setvalue"){var n=t.handler;t.handler=function(e){if(!this.readOnly&&!this.disabled)return n.apply(this,arguments);e.preventDefault;};}});});}function Y(t){function i(t){if(e.valHooks[t]==undefined||e.valHooks[t].inputmaskpatch!=1){var n=e.valHooks[t]&&e.valHooks[t].get?e.valHooks[t].get:function(e){return e.value;},r=e.valHooks[t]&&e.valHooks[t].set?e.valHooks[t].set:function(e,t){return e.value=t,e;};e.valHooks[t]={get:function get(t){var r=e(t);if(r.data("_inputmask")){if(r.data("_inputmask").opts.autoUnmask)return r.inputmask("unmaskedvalue");var i=n(t),s=r.data("_inputmask"),o=s.maskset,u=o._buffer;return u=u?u.join(""):"",i!=u?i:"";}return n(t);},set:function set(t,n){var i=e(t),s=i.data("_inputmask"),o;return s?(o=r(t,e.isFunction(s.opts.onBeforeMask)?s.opts.onBeforeMask.call(pt,n,s.opts)||n:n),i.triggerHandler("setvalue.inputmask")):o=r(t,n),o;},inputmaskpatch:!0};}}function s(){var t=e(this),r=e(this).data("_inputmask");return r?r.opts.autoUnmask?t.inputmask("unmaskedvalue"):n.call(this)!=A().join("")?n.call(this):"":n.call(this);}function u(t){var n=e(this).data("_inputmask");n?(r.call(this,e.isFunction(n.opts.onBeforeMask)?n.opts.onBeforeMask.call(pt,t,n.opts)||t:t),e(this).triggerHandler("setvalue.inputmask")):r.call(this,t);}function a(t){e(t).bind("mouseenter.inputmask",function(t){var n=e(this),r=this,i=r._valueGet();i!=""&&i!=O().join("")&&n.trigger("setvalue");});var n=e._data(t).events,r=n.mouseover;if(r){var i=r[r.length-1];for(var s=r.length-1;s>0;s--){r[s]=r[s-1];}r[0]=i;}}var n,r;if(!t._valueGet){if(Object.getOwnPropertyDescriptor)var f=Object.getOwnPropertyDescriptor(t,"value");f&&f.configurable&&!1?(t._value=f.value,n=function n(){return this._value||"";},r=function r(e){this._value=e,this.select(),this.setRangeText(e),this.selectionStart=this.selectionEnd;},Object.defineProperty(t,"value",{get:s,set:u})):document.__lookupGetter__&&t.__lookupGetter__("value")?(n=t.__lookupGetter__("value"),r=t.__lookupSetter__("value"),t.__defineGetter__("value",s),t.__defineSetter__("value",u)):(n=function n(){return t.value;},r=function r(e){t.value=e;},i(t.type),a(t)),t._valueGet=function(){return o?n.call(this).split("").reverse().join(""):n.call(this);},t._valueSet=function(e){r.call(this,o?e.split("").reverse().join(""):e);};}}function Z(t,n,r){function i(){if(s.keepStatic){E(!0);var e=[],n;for(n=S();n>=0;n--){if(w().validPositions[n]){if(w()["validPositions"][n].alternation!=undefined)break;e.push(w().validPositions[n].input),delete w().validPositions[n];}}if(n>0)while(e.length>0){w().p=B(S()),nt.call(t,undefined,!0,e.pop().charCodeAt(0),!1,!1,w().p);}}}if(s.numericInput||o){n==e.inputmask.keyCode.BACKSPACE?n=e.inputmask.keyCode.DELETE:n==e.inputmask.keyCode.DELETE&&(n=e.inputmask.keyCode.BACKSPACE);if(o){var u=r.end;r.end=r.begin,r.begin=u;}}n==e.inputmask.keyCode.BACKSPACE&&r.end-r.begin<=1?r.begin=j(r.begin):n==e.inputmask.keyCode.DELETE&&r.begin==r.end&&r.end++,T(r.begin,r.end),i();var a=S(r.begin);a<r.begin?(a==-1&&E(),w().p=B(a)):w().p=r.begin;}function et(e,t,n){if(t&&t.refreshFromBuffer){var r=t.refreshFromBuffer;M(r===!0?r:r.start,r.end),E(!0),n!=undefined&&(I(e,O()),X(e,t.caret||n.begin,t.caret||n.end));}}function tt(n){v=!1;var r=this,i=e(r),a=n.keyCode,f=X(r);a==e.inputmask.keyCode.BACKSPACE||a==e.inputmask.keyCode.DELETE||u&&a==127||n.ctrlKey&&a==88&&!t("cut")?(n.preventDefault(),a==88&&(p=O().join("")),Z(r,a,f),I(r,O(),w().p),r._valueGet()==A().join("")&&i.trigger("cleared"),s.showTooltip&&i.prop("title",w().mask)):a==e.inputmask.keyCode.END||a==e.inputmask.keyCode.PAGE_DOWN?setTimeout(function(){var e=B(S());!s.insertMode&&e==H()&&!n.shiftKey&&e--,X(r,n.shiftKey?f.begin:e,e);},0):a==e.inputmask.keyCode.HOME&&!n.shiftKey||a==e.inputmask.keyCode.PAGE_UP?X(r,0,n.shiftKey?f.begin:0):a==e.inputmask.keyCode.ESCAPE||a==90&&n.ctrlKey?(R(r,!0,!1,p.split("")),i.click()):a==e.inputmask.keyCode.INSERT&&!n.shiftKey&&!n.ctrlKey?(s.insertMode=!s.insertMode,X(r,!s.insertMode&&f.begin==H()?f.begin-1:f.begin)):s.insertMode==0&&!n.shiftKey&&(a==e.inputmask.keyCode.RIGHT?setTimeout(function(){var e=X(r);X(r,e.begin);},0):a==e.inputmask.keyCode.LEFT&&setTimeout(function(){var e=X(r);X(r,o?e.begin+1:e.begin-1);},0));var l=X(r),c=s.onKeyDown.call(this,n,O(),l.begin,s);et(r,c,l),g=e.inArray(a,s.ignorables)!=-1;}function nt(t,n,r,i,u,a){if(r==undefined&&v)return!1;v=!0;var f=this,l=e(f);t=t||window.event;var r=n?r:t.which||t.charCode||t.keyCode;if(n!==!0&&(!t.ctrlKey||!t.altKey)&&(t.ctrlKey||t.metaKey||g))return!0;if(r){n!==!0&&r==46&&t.shiftKey==0&&s.radixPoint==","&&(r=44);var c=n?{begin:a,end:a}:X(f),h,p=String.fromCharCode(r),d=Q(c.begin,c.end);d&&(w().undoPositions=e.extend(!0,{},w().validPositions),Z(f,e.inputmask.keyCode.DELETE,c),s.insertMode||(s.insertMode=!s.insertMode,x(c.begin,u),s.insertMode=!s.insertMode),d=!s.multi),w().writeOutBuffer=!0;var y=o&&!d?c.end:c.begin,b=D(y,p,u);if(b!==!1){b!==!0&&(y=b.pos!=undefined?b.pos:y,p=b.c!=undefined?b.c:p),E(!0);if(b.caret!=undefined)h=b.caret;else{var S=w().validPositions;!s.keepStatic&&(S[y+1]!=undefined&&L(y+1,S[y].locator.slice(),y).length>1||S[y].alternation!=undefined)?h=y+1:h=B(y);}w().p=h;}if(i!==!1){var T=this;setTimeout(function(){s.onKeyValidation.call(T,b,s);},0);if(w().writeOutBuffer&&b!==!1){var N=O();I(f,N,n?undefined:s.numericInput?j(h):h),n!==!0&&setTimeout(function(){K(N)===!0&&l.trigger("complete"),m=!0,l.trigger("input");},0);}else d&&(w().buffer=undefined,w().validPositions=w().undoPositions);}else d&&(w().buffer=undefined,w().validPositions=w().undoPositions);s.showTooltip&&l.prop("title",w().mask);if(t&&n!=1){t.preventDefault();var C=X(f),k=s.onKeyPress.call(this,t,O(),C.begin,s);et(f,k,C);}}}function rt(t){var n=e(this),r=this,i=t.keyCode,o=O(),u=X(r),a=s.onKeyUp.call(this,t,o,u.begin,s);et(r,a,u),i==e.inputmask.keyCode.TAB&&s.showMaskOnFocus&&(n.hasClass("focus-inputmask")&&r._valueGet().length==0?(E(),o=O(),I(r,o),X(r,0),p=O().join("")):(I(r,o),X(r,W(0),W(H()))));}function it(t){if(m===!0&&t.type=="input")return m=!1,!0;var n=this,r=e(n),i=n._valueGet(),u=X(n);if(t.type=="propertychange"&&n._valueGet().length<=H())return!0;t.type=="paste"&&(window.clipboardData&&window.clipboardData.getData?i=i.substr(0,u.begin)+window.clipboardData.getData("Text")+i.substr(u.end,i.length):t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.getData&&(i=i.substr(0,u.begin)+t.originalEvent.clipboardData.getData("text/plain")+i.substr(u.end,i.length)));var a=e.isFunction(s.onBeforePaste)?s.onBeforePaste.call(n,i,s)||i:i;return R(n,!0,!1,o?a.split("").reverse():a.split("")),r.click(),K(O())===!0&&r.trigger("complete"),!1;}function st(t){if(m===!0&&t.type=="input")return m=!1,!0;var n=this,r=X(n),i=n._valueGet();i=i.replace(new RegExp("("+U(A().join(""))+")*"),""),r.begin>i.length&&(X(n,i.length),r=X(n)),O().length-i.length==1&&i.charAt(r.begin)!=O()[r.begin]&&i.charAt(r.begin+1)!=O()[r.begin]&&!P(r.begin)&&(t.keyCode=e.inputmask.keyCode.BACKSPACE,tt.call(n,t)),t.preventDefault();}function ot(t){if(m===!0&&t.type=="input")return m=!1,!0;var n=this;R(n,!1,!1);var r=w().p;I(n,O(),s.numericInput?j(r):r),K(O())===!0&&e(n).trigger("complete"),t.preventDefault();}function ut(t){m=!0;var n=this;return setTimeout(function(){X(n,X(n).begin-1);var r=e.Event("keypress");r.which=t.originalEvent.data.charCodeAt(0),v=!1,g=!1,nt.call(n,r,undefined,undefined,!1);var i=w().p;I(n,O(),s.numericInput?j(i):i);},0),!1;}function at(t){d=e(t);if(d.is(":input")&&n(d.attr("type"))){d.data("_inputmask",{maskset:i,opts:s,isRTL:!1}),s.showTooltip&&d.prop("title",w().mask),(t.dir=="rtl"||s.rightAlign)&&d.css("text-align","right");if(t.dir=="rtl"||s.numericInput){t.dir="ltr",d.removeAttr("dir");var r=d.data("_inputmask");r.isRTL=!0,d.data("_inputmask",r),o=!0;}d.unbind(".inputmask"),d.removeClass("focus-inputmask"),d.closest("form").bind("submit",function(e){p!=O().join("")&&d.change(),d[0]._valueGet&&d[0]._valueGet()==A().join("")&&d[0]._valueSet(""),s.autoUnmask&&s.removeMaskOnSubmit&&d.inputmask("remove");}).bind("reset",function(){setTimeout(function(){d.trigger("setvalue");},0);}),d.bind("mouseenter.inputmask",function(){var t=e(this),n=this;!t.hasClass("focus-inputmask")&&s.showMaskOnHover&&n._valueGet()!=O().join("")&&I(n,O());}).bind("blur.inputmask",function(){var t=e(this),n=this;if(t.data("_inputmask")){var r=n._valueGet(),i=O();t.removeClass("focus-inputmask"),p!=O().join("")&&t.change(),s.clearMaskOnLostFocus&&r!=""&&(r==A().join("")?n._valueSet(""):J(n)),K(i)===!1&&(t.trigger("incomplete"),s.clearIncomplete&&(E(),s.clearMaskOnLostFocus?n._valueSet(""):(i=A().slice(),I(n,i))));}}).bind("focus.inputmask",function(){var t=e(this),n=this,r=n._valueGet();s.showMaskOnFocus&&!t.hasClass("focus-inputmask")&&(!s.showMaskOnHover||s.showMaskOnHover&&r=="")&&n._valueGet()!=O().join("")&&I(n,O(),B(S())),t.addClass("focus-inputmask"),p=O().join("");}).bind("mouseleave.inputmask",function(){var t=e(this),n=this;s.clearMaskOnLostFocus&&!t.hasClass("focus-inputmask")&&n._valueGet()!=t.attr("placeholder")&&(n._valueGet()==A().join("")||n._valueGet()==""?n._valueSet(""):J(n));}).bind("click.inputmask",function(){var t=this;e(t).is(":focus")&&setTimeout(function(){var n=X(t);if(n.begin==n.end)if(s.radixFocus&&s.radixPoint!=""&&e.inArray(s.radixPoint,O())!=-1&&O().join("")==A().join(""))X(t,e.inArray(s.radixPoint,O()));else{var r=o?W(n.begin):n.begin,i=B(S(r));r<i?X(t,P(r)?r:B(r)):X(t,i);}},0);}).bind("dblclick.inputmask",function(){var e=this;setTimeout(function(){X(e,0,B(S()));},0);}).bind(h+".inputmask dragdrop.inputmask drop.inputmask",it).bind("setvalue.inputmask",function(){var e=this;R(e,!0,!1),p=O().join(""),(s.clearMaskOnLostFocus||s.clearIncomplete)&&e._valueGet()==A().join("")&&e._valueSet("");}).bind("cut.inputmask",function(t){m=!0;var n=this,r=e(n),i=X(n);Z(n,e.inputmask.keyCode.DELETE,i);var o=s.onKeyPress.call(this,t,O(),w().p,s);et(n,o,{begin:w().p,end:w().p}),n._valueGet()==A().join("")&&r.trigger("cleared"),s.showTooltip&&r.prop("title",w().mask);}).bind("complete.inputmask",s.oncomplete).bind("incomplete.inputmask",s.onincomplete).bind("cleared.inputmask",s.oncleared),d.bind("keydown.inputmask",tt).bind("keypress.inputmask",nt).bind("keyup.inputmask",rt).bind("compositionupdate.inputmask",ut),h==="paste"&&d.bind("input.inputmask",ot);if(a||l||f||c)d.unbind("input.inputmask"),d.bind("input.inputmask",st);Y(t);var u=e.isFunction(s.onBeforeMask)?s.onBeforeMask.call(t,t._valueGet(),s)||t._valueGet():t._valueGet();R(t,!0,!1,u.split("")),p=O().join("");var v;try{v=document.activeElement;}catch(g){}K(O())===!1&&s.clearIncomplete&&E(),s.clearMaskOnLostFocus?O().join("")==A().join("")?t._valueSet(""):J(t):I(t,O()),v===t&&(d.addClass("focus-inputmask"),X(t,B(S()))),G(t);}}var o=!1,p,d,v=!1,m=!1,g=!1,y;if(r!=undefined)switch(r.action){case"isComplete":return d=e(r.el),i=d.data("_inputmask").maskset,s=d.data("_inputmask").opts,K(r.buffer);case"unmaskedvalue":return d=r.$input,i=d.data("_inputmask").maskset,s=d.data("_inputmask").opts,o=r.$input.data("_inputmask").isRTL,z(r.$input);case"mask":p=O().join(""),at(r.el);break;case"format":d=e({}),d.data("_inputmask",{maskset:i,opts:s,isRTL:s.numericInput}),s.numericInput&&(o=!0);var ft=(e.isFunction(s.onBeforeMask)?s.onBeforeMask.call(d,r.value,s)||r.value:r.value).split("");R(d,!1,!1,o?ft.reverse():ft),s.onKeyPress.call(this,undefined,O(),0,s);if(r.metadata)return{value:o?O().slice().reverse().join(""):O().join(""),metadata:d.inputmask("getmetadata")};return o?O().slice().reverse().join(""):O().join("");case"isValid":d=e({}),d.data("_inputmask",{maskset:i,opts:s,isRTL:s.numericInput}),s.numericInput&&(o=!0);var ft=r.value.split("");R(d,!1,!0,o?ft.reverse():ft);var lt=O(),ct=V(),ht=lt.length-1;for(;ht>ct;ht--){if(P(ht))break;}return lt.splice(ct,ht+1-ct),K(lt)&&r["value"]==lt.join("");case"getemptymask":return d=e(r.el),i=d.data("_inputmask").maskset,s=d.data("_inputmask").opts,A();case"remove":var pt=r.el;d=e(pt),i=d.data("_inputmask").maskset,s=d.data("_inputmask").opts,pt._valueSet(z(d)),d.unbind(".inputmask"),d.removeClass("focus-inputmask"),d.removeData("_inputmask");var dt;Object.getOwnPropertyDescriptor&&(dt=Object.getOwnPropertyDescriptor(pt,"value")),dt&&dt.get?pt._valueGet&&Object.defineProperty(pt,"value",{get:pt._valueGet,set:pt._valueSet}):document.__lookupGetter__&&pt.__lookupGetter__("value")&&pt._valueGet&&(pt.__defineGetter__("value",pt._valueGet),pt.__defineSetter__("value",pt._valueSet));try{delete pt._valueGet,delete pt._valueSet;}catch(vt){pt._valueGet=undefined,pt._valueSet=undefined;}break;case"getmetadata":d=e(r.el),i=d.data("_inputmask").maskset,s=d.data("_inputmask").opts;if(e.isArray(i.metadata)){var mt,gt=S();for(var yt=gt;yt>=0;yt--){if(w().validPositions[yt]&&w()["validPositions"][yt].alternation!=undefined){mt=w().validPositions[yt].alternation;break;}}return mt!=undefined?i.metadata[w().validPositions[gt].locator[mt]]:i.metadata[0];}return i.metadata;}};var s=typeof ScriptEngineMajorVersion=="function"?ScriptEngineMajorVersion():new Function("/*@cc_on return @_jscript_version; @*/")()>=10,o=navigator.userAgent,u=o.match(new RegExp("iphone","i"))!==null,a=o.match(new RegExp("android.*safari.*","i"))!==null,f=o.match(new RegExp("android.*chrome.*","i"))!==null,l=o.match(new RegExp("android.*firefox.*","i"))!==null,c=/Kindle/i.test(o)||/Silk/i.test(o)||/KFTT/i.test(o)||/KFOT/i.test(o)||/KFJWA/i.test(o)||/KFJWI/i.test(o)||/KFSOWI/i.test(o)||/KFTHWA/i.test(o)||/KFTHWI/i.test(o)||/KFAPWA/i.test(o)||/KFAPWI/i.test(o),h=t("paste")?"paste":t("input")?"input":"propertychange";e.inputmask={defaults:{placeholder:"_",optionalmarker:{start:"[",end:"]"},quantifiermarker:{start:"{",end:"}"},groupmarker:{start:"(",end:")"},alternatormarker:"|",escapeChar:"\\",mask:null,oncomplete:e.noop,onincomplete:e.noop,oncleared:e.noop,repeat:0,greedy:!0,autoUnmask:!1,removeMaskOnSubmit:!0,clearMaskOnLostFocus:!0,insertMode:!0,clearIncomplete:!1,aliases:{},alias:null,onKeyUp:e.noop,onKeyPress:e.noop,onKeyDown:e.noop,onBeforeMask:undefined,onBeforePaste:undefined,onUnMask:undefined,showMaskOnFocus:!0,showMaskOnHover:!0,onKeyValidation:e.noop,skipOptionalPartCharacter:" ",showTooltip:!1,numericInput:!1,rightAlign:!1,radixPoint:"",radixFocus:!1,nojumps:!1,nojumpsThreshold:0,keepStatic:undefined,definitions:{9:{validator:"[0-9]",cardinality:1,definitionSymbol:"*"},a:{validator:"[A-Za-z--]",cardinality:1,definitionSymbol:"*"},"*":{validator:"[0-9A-Za-z--]",cardinality:1}},ignorables:[8,9,13,19,27,33,34,35,36,37,38,39,40,45,46,93,112,113,114,115,116,117,118,119,120,121,122,123],isComplete:undefined},keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91},masksCache:{},escapeRegex:function escapeRegex(e){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];return e.replace(new RegExp("(\\"+t.join("|\\")+")","gim"),"\\$1");},format:function format(t,n,s){var o=e.extend(!0,{},e.inputmask.defaults,n);return r(o.alias,n,o),p({action:"format",value:t,metadata:s},i(o),o);},isValid:function isValid(t,n){var s=e.extend(!0,{},e.inputmask.defaults,n);return r(s.alias,n,s),p({action:"isValid",value:t},i(s),s);}},e.fn.inputmask=function(t,n,s,o,u){function a(t,n,i){var s=e(t);s.data("inputmask-alias")&&r(s.data("inputmask-alias"),{},n);for(var o in n){var u=s.data("inputmask-"+o.toLowerCase());u!=undefined&&(o=="mask"&&u.indexOf("[")==0?(n[o]=u.replace(/[\s[\]]/g,"").split("','"),n[o][0]=n[o][0].replace("'",""),n[o][n[o].length-1]=n[o][n[o].length-1].replace("'","")):n[o]=typeof u=="boolean"?u:u.toString(),i&&(i[o]=n[o]));}return n;}s=s||p,o=o||"_inputmask";var f=e.extend(!0,{},e.inputmask.defaults,n),l;if(typeof t=="string")switch(t){case"mask":r(f.alias,n,f),l=i(f,s!==p);if(l==undefined)return this;return this.each(function(){s({action:"mask",el:this},e.extend(!0,{},l),a(this,f));});case"unmaskedvalue":var c=e(this);return c.data(o)?s({action:"unmaskedvalue",$input:c}):c.val();case"remove":return this.each(function(){var t=e(this);t.data(o)&&s({action:"remove",el:this});});case"getemptymask":return this.data(o)?s({action:"getemptymask",el:this}):"";case"hasMaskedValue":return this.data(o)?!this.data(o).opts.autoUnmask:!1;case"isComplete":return this.data(o)?s({action:"isComplete",buffer:this[0]._valueGet().split(""),el:this}):!0;case"getmetadata":return this.data(o)?s({action:"getmetadata",el:this}):undefined;case"_detectScope":return r(f.alias,n,f),u!=undefined&&!r(u,n,f)&&e.inArray(u,["mask","unmaskedvalue","remove","getemptymask","hasMaskedValue","isComplete","getmetadata","_detectScope"])==-1&&(f.mask=u),e.isFunction(f.mask)&&(f.mask=f.mask.call(this,f)),e.isArray(f.mask);default:r(f.alias,n,f),r(t,n,f)||(f.mask=t),l=i(f,s!==p);if(l==undefined)return this;return this.each(function(){s({action:"mask",el:this},e.extend(!0,{},l),a(this,f));});}else{if(_typeof(t)=="object")return f=e.extend(!0,{},e.inputmask.defaults,t),r(f.alias,t,f),l=i(f,s!==p),l==undefined?this:this.each(function(){s({action:"mask",el:this},e.extend(!0,{},l),a(this,f));});if(t==undefined)return this.each(function(){var t=e(this).attr("data-inputmask");if(t&&t!="")try{t=t.replace(new RegExp("'","g"),'"');var i=e.parseJSON("{"+t+"}");e.extend(!0,i,n),f=e.extend(!0,{},e.inputmask.defaults,i),f=a(this,f),r(f.alias,i,f),f.alias=undefined,e(this).inputmask("mask",f,s);}catch(o){}if(e(this).attr("data-inputmask-mask")||e(this).attr("data-inputmask-alias")){f=e.extend(!0,{},e.inputmask.defaults,{});var u={};f=a(this,f,u),r(f.alias,u,f),f.alias=undefined,e(this).inputmask("mask",f,s);}});}};}return e.fn.inputmask;}(jQuery),define("jquery.inputMask",["jquery"],function(){}),define("timePicker",["require","jquery","tools","jquery.inputMask"],function(e){"use strict";var t=e("jquery"),n=e("tools");return e("jquery.inputMask"),function(e,r){var i=this,s=t.extend({definitions:[{5:{validator:"[0-5]",cardinality:1,prevalidator:null}}],mask:"59:59",sep:":",minTime:["00","01"],maxTime:["59","59"],stepSeconds:10,classes:{container:"b-timepicker",buttonUp:"tp__button-up",buttonDown:"tp__button-down",isFocused:"is-focused",isDisabled:"is-disabled"}},r||{});return t.extend(this,{isCompleted:!1,initialize:function initialize(){this.setDefinitions(),this.setMinTime(),this.setMaxTime(),this.render(),this.setDefaultTime();},setDefinitions:function setDefinitions(){var e,n;if(s.definitions&&s.definitions.length)for(e=0,n=s.definitions.length;e<n;e++){t.extend(t.inputmask.defaults.definitions,s.definitions[e]);}},setMinTime:function setMinTime(){var e=s.minTime.join(s.sep);s.minTime=this.stringToTime(e);},setMaxTime:function setMaxTime(){var e=s.maxTime.join(s.sep);s.maxTime=this.stringToTime(e);},render:function render(){this.$container=t("<div />").addClass(s.classes.container),e.before(this.$container),this.$buttonUp=t("<span><i></i></span>").addClass(s.classes.buttonUp).click(function(){i.upTime();}),this.$buttonDown=t("<span><i></i></span>").addClass(s.classes.buttonDown).click(function(){i.downTime();}),this.$container.append(e).append(t('<div class="b-timepicker_buttons"/>').append(this.$buttonUp).append(this.$buttonDown)),e.focus(function(){i.$container.addClass(s.classes.isFocused);}).blur(function(){i.$container.removeClass(s.classes.isFocused);}).keydown(function(e){e.keyCode==38&&i.upTime(),e.keyCode==40&&i.downTime();}).inputmask(s.mask,{oncomplete:function oncomplete(){var e=i.getTime();e>=s.minTime&&e<=s.maxTime?i.onCompleteCallback():i.onIncompleteCallback();},onincomplete:function onincomplete(){i.onIncompleteCallback();}}),e.is(":disabled")?this.disable():this.enable();},setDefaultTime:function setDefaultTime(){s.defaultTime&&n.is(s.defaultTime).number()?this.setTime(s.defaultTime):e.val("");},onCompleteCallback:function onCompleteCallback(){this.isCompleted=!0,n.is(s.onComplete).fn()&&s.onComplete(this.getTime());},onIncompleteCallback:function onIncompleteCallback(){this.isCompleted=!1,n.is(s.onIncomplete).fn()&&s.onIncomplete();},stringToTime:function stringToTime(e){var t=e.split(s.sep),n=parseInt(t[0]),r=parseInt(t[1]),i=0;return n&&(i=n*60),r&&(i+=r),i;},timeToString:function timeToString(e){return n.number(e).toTimeString(s.sep);},upTime:function upTime(){if(!this.isEnabled)return;if(!this.isCompleted)e.val(this.timeToString(s.stepSeconds));else{var t=this.getTime();e.val(this.timeToString(Math.min(t+s.stepSeconds,s.maxTime)));}this.onCompleteCallback();},downTime:function downTime(){if(!this.isEnabled)return;if(!this.isCompleted)e.val(this.timeToString(s.stepSeconds));else{var t=this.getTime();e.val(this.timeToString(Math.max(t-s.stepSeconds,s.minTime)));}this.onCompleteCallback();},getTime:function getTime(){return this.stringToTime(e.val());},setTime:function setTime(t){t<s.minTime||t>s.maxTime?(e.val(""),this.onIncompleteCallback()):(e.val(i.timeToString(t)),this.onCompleteCallback());},enable:function enable(){this.isEnabled=!0,this.$container.removeClass(s.classes.isDisabled),e.prop("disabled",!1);},disable:function disable(){this.isEnabled=!1,this.$container.removeClass(s.classes.isFocused).addClass(s.classes.isDisabled),e.blur().prop("disabled",!0);}}),this.initialize(),{getTime:function getTime(){return i.getTime();},setTime:function setTime(e){return i.setTime(e);},enable:function enable(){return i.enable();},disable:function disable(){return i.disable();}};};}),define("videoPlayer",["require","jquery"],function(e){"use strict";var t=e("jquery"),n=function n(e){var n=this,r=t.extend({controls:!0,autoplay:!1,loop:!1,muted:!1},e||{});return t.extend(this,{initialize:function initialize(){this.$container=r.containerEl,this.render();},render:function render(){this.$container.length&&r.videoUrl&&r.videoWidth&&r.videoHeight&&(this.$video=t('<video controlsList="nodownload" preload="auto" src="'+r.videoUrl+'" width="'+r.videoWidth+'" height="'+r.videoHeight+'"'+(r.controls?" controls":"")+(r.autoplay?" autoplay":"")+(r.muted?" muted":"")+(r.loop?" loop":"")+(r.poster?' poster="'+r.poster+'"':"")+" />"),this.$container.html(this.$video),this.$video.on("contextmenu",function(e){return e.preventDefault(),!1;}),typeof r.onended=="function"&&this.$video.on("ended",function(){r.onended();}));},changeVideo:function changeVideo(e){this.$video.attr("src",e);},play:function play(){this.$video.get(0).play();}}),this.initialize(),{getContainer:function getContainer(){return n.$container;},changeVideo:function changeVideo(e){n.changeVideo(e);},play:function play(){n.play();}};};return function(e){return new n(e);};}),define("gallery",["require","jquery","tools","videoPlayer"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("videoPlayer"),i=function i(e){var i=this,s=t.extend({galleryClass:"gallery",buttonPlayClass:"button-play-video",labelLengthClass:"gallery__video-length",headerClass:"gallery__header",classNotClickable:"not-clickable",width:240,height:135,rotateTime:1e3},e||{});return t.extend(this,{initialize:function initialize(){this.$container=s.container;if(!this.$container.length||!s.thumbnailUrls)return;this.render();},render:function render(){this.$gallery=t('<div class="'+s.galleryClass+'" />'),this.renderBackground(),this.$container.append(this.$gallery),this.renderThumbnails(),this.isStoped=!1,s.videoUrl&&(this.$gallery.addClass("with-video"),this.renderButtonPlay(),this.renderHeader(),this.setClickEvent()),this.$container.on("mouseenter",function(){i.setTimerSlide();}).on("mouseleave",function(){i.removeTimerSlide();});},setClickEvent:function setClickEvent(){this.$gallery.on("click.gallery",function(){i.$container.parent().hasClass(s.classNotClickable)||(i.isStoped=!0,new r({containerEl:i.$container,videoUrl:s.videoUrl,videoWidth:s.width,videoHeight:s.height,autoplay:!0,poster:s.thumbnailUrls[0]}));});},renderBackground:function renderBackground(){var e=n.object(s.thumbnailUrls).first();this.$container.html(t('<img class="gallery-background" src="'+e.value+'" width="'+s.width+'" height="'+s.height+'" />'));},renderThumbnails:function renderThumbnails(){var e;n.object(s.thumbnailUrls).each(function(n,r,o){e=t('<img class="gallery__item" src="'+r+'" height="'+s.height+'" />'),o!=0&&e.hide(),i.$gallery.append(e);}),this.$thumbnails=this.$gallery.find("img");},setTimerSlide:function setTimerSlide(){s.thumbnailUrls[1]&&(this.timer=setTimeout(function(){i.showNextSlide();},s.rotateTime));},removeTimerSlide:function removeTimerSlide(){this.timer&&(clearTimeout(this.timer),this.currentSlide=0,this.showSlide(0));},showNextSlide:function showNextSlide(){this.isStoped||(this.currentSlide===undefined&&(this.currentSlide=0),this.currentSlide==this.$thumbnails.length-1?this.currentSlide=0:this.currentSlide++,this.showSlide(this.currentSlide),this.setTimerSlide());},showSlide:function showSlide(e){this.$thumbnails.hide().eq(e).show();},renderButtonPlay:function renderButtonPlay(){var e=t("<span/>").addClass(s.buttonPlayClass);this.$gallery.append(e);},renderHeader:function renderHeader(){var e=t('<div class="'+s.headerClass+'"/>');s.videoLength&&e.append('<span class="gallery__video-length" title=" ">'+n.number(s.videoLength).toTimeString()+"</span>"),s.videoSize&&e.append('<span class="gallery__video-size" title=" ">'+Math.round(s.videoSize/1024/1024*10)/10+"MB</span>"),s.viewsCount>=0&&e.append(this.createViewCount()),this.$gallery.append(e);},createViewCount:function createViewCount(){var e=t('<span class="gallery__video-views" title=" " />');return e.append('<svg xmlns="http://www.w3.org/2000/svg" width="9" height="10" viewBox="0 0 9 10"><path fill="none" fill-rule="evenodd" stroke="#FFF" d="M 1 1 L 9 5 L 1 9 Z" stroke-linejoin="round" /></svg>'),e.append(s.viewsCount),e;},destroy:function destroy(){this.isStoped=!0;}}),this.initialize(),{destroy:function destroy(){i.destroy();}};};return function(e){return new i(e);};}),!function(e,t){"use strict";function n(e,t){for(var n,r=[],i=0;i<e.length;++i){if(n=u[e[i]]||s(e[i]),!n)throw"module definition dependecy not found: "+e[i];r.push(n);}t.apply(null,r);}function r(e,r,i){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(i===t)throw"invalid module definition, definition function must be specified";n(r,function(){u[e]=i.apply(null,arguments);});}function i(e){return!!u[e];}function s(t){for(var n=e,r=t.split(/[.\/]/),i=0;i<r.length;++i){if(!n[r[i]])return;n=n[r[i]];}return n;}function o(n){for(var r=0;r<n.length;r++){for(var i=e,s=n[r],o=s.split(/[.\/]/),a=0;a<o.length-1;++a){i[o[a]]===t&&(i[o[a]]={}),i=i[o[a]];}i[o[o.length-1]]=u[s];}}var u={},a="moxie/core/utils/Basic",f="moxie/core/I18n",l="moxie/core/utils/Mime",c="moxie/core/utils/Env",h="moxie/core/utils/Dom",p="moxie/core/Exceptions",d="moxie/core/EventTarget",v="moxie/core/utils/Encode",m="moxie/runtime/Runtime",g="moxie/runtime/RuntimeClient",y="moxie/file/Blob",b="moxie/file/File",w="moxie/file/FileInput",E="moxie/file/FileDrop",S="moxie/runtime/RuntimeTarget",x="moxie/file/FileReader",T="moxie/core/utils/Url",N="moxie/file/FileReaderSync",C="moxie/xhr/FormData",k="moxie/xhr/XMLHttpRequest",L="moxie/runtime/Transporter",A="moxie/image/Image",O="moxie/runtime/html5/Runtime",M="moxie/runtime/html5/file/Blob",_="moxie/core/utils/Events",D="moxie/runtime/html5/file/FileInput",P="moxie/runtime/html5/file/FileDrop",H="moxie/runtime/html5/file/FileReader",B="moxie/runtime/html5/xhr/XMLHttpRequest",j="moxie/runtime/html5/utils/BinaryReader",F="moxie/runtime/html5/image/JPEGHeaders",I="moxie/runtime/html5/image/ExifParser",q="moxie/runtime/html5/image/JPEG",R="moxie/runtime/html5/image/PNG",U="moxie/runtime/html5/image/ImageInfo",z="moxie/runtime/html5/image/MegaPixel",W="moxie/runtime/html5/image/Image",X="moxie/runtime/flash/Runtime",V="moxie/runtime/flash/file/Blob",$="moxie/runtime/flash/file/FileInput",J="moxie/runtime/flash/file/FileReader",K="moxie/runtime/flash/file/FileReaderSync",Q="moxie/runtime/flash/xhr/XMLHttpRequest",G="moxie/runtime/flash/runtime/Transporter",Y="moxie/runtime/flash/image/Image",Z="moxie/runtime/silverlight/Runtime",et="moxie/runtime/silverlight/file/Blob",tt="moxie/runtime/silverlight/file/FileInput",nt="moxie/runtime/silverlight/file/FileDrop",rt="moxie/runtime/silverlight/file/FileReader",it="moxie/runtime/silverlight/file/FileReaderSync",st="moxie/runtime/silverlight/xhr/XMLHttpRequest",ot="moxie/runtime/silverlight/runtime/Transporter",ut="moxie/runtime/silverlight/image/Image",at="moxie/runtime/html4/Runtime",ft="moxie/runtime/html4/file/FileInput",lt="moxie/runtime/html4/file/FileReader",ct="moxie/runtime/html4/xhr/XMLHttpRequest",ht="moxie/runtime/html4/image/Image";r(a,[],function(){var e=function e(_e){var t;return _e===t?"undefined":null===_e?"null":_e.nodeType?"node":{}.toString.call(_e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();},t=function t(r){var i;return n(arguments,function(s,u){u>0&&n(s,function(n,s){n!==i&&(e(r[s])===e(n)&&~o(e(n),["array","object"])?t(r[s],n):r[s]=n);});}),r;},n=function n(e,t){var n,r,i,s;if(e){try{n=e.length;}catch(o){n=s;}if(n===s){for(r in e){if(e.hasOwnProperty(r)&&t(e[r],r)===!1)return;}}else for(i=0;n>i;i++){if(t(e[i],i)===!1)return;}}},r=function r(t){var n;if(!t||"object"!==e(t))return!0;for(n in t){return!1;}return!0;},i=function i(t,n){function r(i){"function"===e(t[i])&&t[i](function(e){++i<s&&!e?r(i):n(e);});}var i=0,s=t.length;"function"!==e(n)&&(n=function n(){}),t&&t.length||n(),r(i);},s=function s(e,t){var r=0,i=e.length,s=new Array(i);n(e,function(e,n){e(function(e){if(e)return t(e);var o=[].slice.call(arguments);o.shift(),s[n]=o,r++,r===i&&(s.unshift(null),t.apply(this,s));});});},o=function o(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,r=t.length;r>n;n++){if(t[n]===e)return n;}}return-1;},u=function u(t,n){var r=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var i in t){-1===o(t[i],n)&&r.push(t[i]);}return r.length?r:!1;},a=function a(e,t){var r=[];return n(e,function(e){-1!==o(e,t)&&r.push(e);}),r.length?r:null;},f=function f(e){var t,n=[];for(t=0;t<e.length;t++){n[t]=e[t];}return n;},l=function(){var e=0;return function(t){var n=new Date().getTime().toString(32),r;for(r=0;5>r;r++){n+=Math.floor(65535*Math.random()).toString(32);}return(t||"o_")+n+(e++).toString(32);};}(),c=function c(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e;},h=function h(e){if("string"!=typeof e)return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),n=e[2],e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e;};return{guid:l,typeOf:e,extend:t,each:n,isEmptyObj:r,inSeries:i,inParallel:s,inArray:o,arrayDiff:u,arrayIntersect:a,toArray:f,trim:c,parseSizeStr:h};}),r(f,[a],function(e){var t={};return{addI18n:function addI18n(n){return e.extend(t,n);},translate:function translate(e){return t[e]||e;},_:function _(e){return this.translate(e);},sprintf:function sprintf(t){var n=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=n.shift();return"undefined"!==e.typeOf(t)?t:"";});}};}),r(l,[a,f],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",r={mimes:{},extensions:{},addMimeType:function addMimeType(e){var t=e.split(/,/),n,r,i;for(n=0;n<t.length;n+=2){for(i=t[n+1].split(/ /),r=0;r<i.length;r++){this.mimes[i[r]]=t[n];}this.extensions[t[n]]=i;}},extList2mimes:function extList2mimes(t,n){var r=this,i,s,o,u,a=[];for(s=0;s<t.length;s++){for(i=t[s].extensions.split(/\s*,\s*/),o=0;o<i.length;o++){if("*"===i[o])return[];if(u=r.mimes[i[o]])-1===e.inArray(u,a)&&a.push(u);else{if(!n||!/^\w+$/.test(i[o]))return[];a.push("."+i[o]);}}}return a;},mimes2exts:function mimes2exts(t){var n=this,r=[];return e.each(t,function(t){if("*"===t)return r=[],!1;var i=t.match(/^(\w+)\/(\*|\w+)$/);i&&("*"===i[2]?e.each(n.extensions,function(e,t){new RegExp("^"+i[1]+"/").test(t)&&[].push.apply(r,n.extensions[t]);}):n.extensions[t]&&[].push.apply(r,n.extensions[t]));}),r;},mimes2extList:function mimes2extList(n){var r=[],i=[];return"string"===e.typeOf(n)&&(n=e.trim(n).split(/\s*,\s*/)),i=this.mimes2exts(n),r.push({title:t.translate("Files"),extensions:i.length?i.join(","):"*"}),r.mimes=n,r;},getFileExtension:function getFileExtension(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():"";},getFileMime:function getFileMime(e){return this.mimes[this.getFileExtension(e)]||"";}};return r.addMimeType(n),r;}),r(c,[a],function(e){function t(e,t,n){var r=0,i=0,s=0,o={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},u=function u(e){return e=(""+e).replace(/[_\-+]/g,"."),e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),e.length?e.split("."):[-8];},a=function a(e){return e?isNaN(e)?o[e]||-7:parseInt(e,10):0;};for(e=u(e),t=u(t),i=Math.max(e.length,t.length),r=0;i>r;r++){if(e[r]!=t[r]){if(e[r]=a(e[r]),t[r]=a(t[r]),e[r]<t[r]){s=-1;break;}if(e[r]>t[r]){s=1;break;}}}if(!n)return s;switch(n){case">":case"gt":return s>0;case">=":case"ge":return s>=0;case"<=":case"le":return 0>=s;case"==":case"=":case"eq":return 0===s;case"<>":case"!=":case"ne":return 0!==s;case"":case"<":case"lt":return 0>s;default:return null;}}var n=function(e){var t="",n="?",r="function",i="undefined",s="object",o="major",u="model",a="name",f="type",l="vendor",c="version",h="architecture",p="console",d="mobile",v="tablet",m={has:function has(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase());},lowerize:function lowerize(e){return e.toLowerCase();}},g={rgx:function rgx(){for(var t,n=0,o,u,a,f,l,c,h=arguments;n<h.length;n+=2){var p=h[n],d=h[n+1];if(_typeof(t)===i){t={};for(a in d){f=d[a],_typeof(f)===s?t[f[0]]=e:t[f]=e;}}for(o=u=0;o<p.length;o++){if(l=p[o].exec(this.getUA())){for(a=0;a<d.length;a++){c=l[++u],f=d[a],_typeof(f)===s&&f.length>0?2==f.length?t[f[0]]=_typeof(f[1])==r?f[1].call(this,c):f[1]:3==f.length?t[f[0]]=_typeof(f[1])!==r||f[1].exec&&f[1].test?c?c.replace(f[1],f[2]):e:c?f[1].call(this,c,f[2]):e:4==f.length&&(t[f[0]]=c?f[3].call(this,c.replace(f[1],f[2])):e):t[f]=c?c:e;}break;}}if(l)break;}return t;},str:function str(t,r){for(var i in r){if(_typeof(r[i])===s&&r[i].length>0){for(var o=0;o<r[i].length;o++){if(m.has(r[i][o],t))return i===n?e:i;}}else if(m.has(r[i],t))return i===n?e:i;}return t;}},y={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},b={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[a,c,o],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[a,"Opera"],c,o],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[a,c,o],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[a,"IE"],c,o],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[a,"Yandex"],c,o],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[a,/_/g," "],c,o],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[a,c,o],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[a,"Dolphin"],c,o],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[a,"Chrome"],c,o],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[a,"Android Browser"],c,o],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[c,o,[a,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[c,o,a],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[a,[o,g.str,y.browser.oldsafari.major],[c,g.str,y.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[a,c,o],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[a,"Netscape"],c,o],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[a,c,o]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,c],[/rv\:([\w\.]+).*(gecko)/i],[c,a]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[c,g.str,y.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[c,g.str,y.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],c],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[a,c],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[a,"Symbian"],c],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],c],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[a,c],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],c],[/(sunos)\s?([\w\.]+\d)*/i],[[a,"Solaris"],c],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[a,c],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[a,"iOS"],[c,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[a,[c,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[a,c]]},w=function w(e){var n=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:t);this.getBrowser=function(){return g.rgx.apply(this,b.browser);},this.getEngine=function(){return g.rgx.apply(this,b.engine);},this.getOS=function(){return g.rgx.apply(this,b.os);},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()};},this.getUA=function(){return n;},this.setUA=function(e){return n=e,this;},this.setUA(n);};return new w().getResult();}(),r=function(){var t={define_property:function(){return!1;}(),create_canvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d");}(),return_response_type:function return_response_type(t){try{if(-1!==e.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest();if(n.open("get","/"),"responseType"in n)return n.responseType=t,n.responseType!==t?!1:!0;}}catch(r){}return!1;},use_data_uri:function(){var e=new Image();return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height;},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";},1),!1;}(),use_data_uri_over32kb:function use_data_uri_over32kb(){return t.use_data_uri&&("IE"!==i.browser||i.version>=9);},use_data_uri_of:function use_data_uri_of(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb();},use_fileinput:function use_fileinput(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled;}};return function(n){var r=[].slice.call(arguments);return r.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,r):!!t[n];};}(),i={can:r,browser:n.browser.name,version:parseFloat(n.browser.major),os:n.os.name,osVersion:n.os.version,verComp:t,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return i.OS=i.os,i;}),r(h,[c],function(e){var t=function t(e){return"string"!=typeof e?e:document.getElementById(e);},n=function n(e,t){if(!e.className)return!1;var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return n.test(e.className);},r=function r(e,t){n(e,t)||(e.className=e.className?e.className.replace(/\s+$/,"")+" "+t:t);},i=function i(e,t){if(e.className){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":"";});}},s=function s(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0;},o=function o(t,n){function r(e){var t,n,r=0,i=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===u.compatMode?u.documentElement:u.body,r=n.left+t.scrollLeft,i=n.top+t.scrollTop),{x:r,y:i};}var i=0,s=0,o,u=document,a,f;if(t=t,n=n||u.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!u.documentMode||u.documentMode<8))return a=r(t),f=r(n),{x:a.x-f.x,y:a.y-f.y};for(o=t;o&&o!=n&&o.nodeType;){i+=o.offsetLeft||0,s+=o.offsetTop||0,o=o.offsetParent;}for(o=t.parentNode;o&&o!=n&&o.nodeType;){i-=o.scrollLeft||0,s-=o.scrollTop||0,o=o.parentNode;}return{x:i,y:s};},u=function u(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight};};return{get:t,hasClass:n,addClass:r,removeClass:i,getStyle:s,getPos:o,getSize:u};}),r(p,[a],function(e){function t(e,t){var n;for(n in e){if(e[n]===t)return n;}return null;}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": RuntimeError "+this.code;}var r={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,r),n.prototype=Error.prototype,n;}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException";}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t;}(),ImageError:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": ImageError "+this.code;}var r={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return e.extend(n,r),n.prototype=Error.prototype,n;}(),FileException:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": FileException "+this.code;}var r={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,r),n.prototype=Error.prototype,n;}(),DOMException:function(){function n(e){this.code=e,this.name=t(r,e),this.message=this.name+": DOMException "+this.code;}var r={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,r),n.prototype=Error.prototype,n;}(),EventException:function(){function t(e){this.code=e,this.name="EventException";}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t;}()};}),r(d,[p,a],function(e,t){function n(){var n={};t.extend(this,{uid:null,init:function init(){this.uid||(this.uid=t.guid("uid_"));},addEventListener:function addEventListener(e,r,i,s){var o=this,u;return e=t.trim(e),/\s/.test(e)?(t.each(e.split(/\s+/),function(e){o.addEventListener(e,r,i,s);}),void 0):(e=e.toLowerCase(),i=parseInt(i,10)||0,u=n[this.uid]&&n[this.uid][e]||[],u.push({fn:r,priority:i,scope:s||this}),n[this.uid]||(n[this.uid]={}),n[this.uid][e]=u,void 0);},hasEventListener:function hasEventListener(e){return e?!!n[this.uid]&&!!n[this.uid][e]:!!n[this.uid];},removeEventListener:function removeEventListener(e,r){e=e.toLowerCase();var i=n[this.uid]&&n[this.uid][e],s;if(i){if(r){for(s=i.length-1;s>=0;s--){if(i[s].fn===r){i.splice(s,1);break;}}}else i=[];i.length||(delete n[this.uid][e],t.isEmptyObj(n[this.uid])&&delete n[this.uid]);}},removeAllEventListeners:function removeAllEventListeners(){n[this.uid]&&delete n[this.uid];},dispatchEvent:function dispatchEvent(r){var i,s,o,u,a={},f=!0,l;if("string"!==t.typeOf(r)){if(u=r,"string"!==t.typeOf(u.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);r=u.type,u.total!==l&&u.loaded!==l&&(a.total=u.total,a.loaded=u.loaded),a.async=u.async||!1;}if(-1!==r.indexOf("::")?function(e){i=e[0],r=e[1];}(r.split("::")):i=this.uid,r=r.toLowerCase(),s=n[i]&&n[i][r]){s.sort(function(e,t){return t.priority-e.priority;}),o=[].slice.call(arguments),o.shift(),a.type=r,o.unshift(a);var c=[];t.each(s,function(e){o[0].target=e.scope,a.async?c.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,o)===!1);},1);}):c.push(function(t){t(e.fn.apply(e.scope,o)===!1);});}),c.length&&t.inSeries(c,function(e){f=!e;});}return f;},bind:function bind(){this.addEventListener.apply(this,arguments);},unbind:function unbind(){this.removeEventListener.apply(this,arguments);},unbindAll:function unbindAll(){this.removeAllEventListeners.apply(this,arguments);},trigger:function trigger(){return this.dispatchEvent.apply(this,arguments);},convertEventPropsToHandlers:function convertEventPropsToHandlers(e){var n;"array"!==t.typeOf(e)&&(e=[e]);for(var r=0;r<e.length;r++){n="on"+e[r],"function"===t.typeOf(this[n])?this.addEventListener(e[r],this[n]):"undefined"===t.typeOf(this[n])&&(this[n]=null);}}});}return n.instance=new n(),n;}),r(v,[],function(){var e=function e(_e2){return unescape(encodeURIComponent(_e2));},t=function t(e){return decodeURIComponent(escape(e));},n=function n(e,_n2){if("function"==typeof window.atob)return _n2?t(window.atob(e)):window.atob(e);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!e)return e;e+="";do{u=r.indexOf(e.charAt(h++)),a=r.indexOf(e.charAt(h++)),f=r.indexOf(e.charAt(h++)),l=r.indexOf(e.charAt(h++)),c=u<<18|a<<12|f<<6|l,i=255&c>>16,s=255&c>>8,o=255&c,v[p++]=64==f?String.fromCharCode(i):64==l?String.fromCharCode(i,s):String.fromCharCode(i,s,o);}while(h<e.length);return d=v.join(""),_n2?t(d):d;},r=function r(t,n){if(n&&e(t),"function"==typeof window.btoa)return window.btoa(t);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!t)return t;do{i=t.charCodeAt(h++),s=t.charCodeAt(h++),o=t.charCodeAt(h++),c=i<<16|s<<8|o,u=63&c>>18,a=63&c>>12,f=63&c>>6,l=63&c,v[p++]=r.charAt(u)+r.charAt(a)+r.charAt(f)+r.charAt(l);}while(h<t.length);d=v.join("");var m=t.length%3;return(m?d.slice(0,m-3):d)+"===".slice(m||3);};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:r};}),r(m,[a,h,d],function(e,t,n){function r(n,i,o,u,a){var f=this,l,c=e.guid(i+"_"),h=a||"browser";n=n||{},s[c]=this,o=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},o),n.preferred_caps&&(h=r.getMode(u,n.preferred_caps,h)),l=function(){var t={};return{exec:function exec(e,n,r,i){return l[n]&&(t[e]||(t[e]={context:this,instance:new l[n]()}),t[e].instance[r])?t[e].instance[r].apply(this,i):void 0;},removeInstance:function removeInstance(e){delete t[e];},removeAllInstances:function removeAllInstances(){var n=this;e.each(t,function(t,r){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(r);});}};}(),e.extend(this,{initialized:!1,uid:c,type:i,mode:r.getMode(u,n.required_caps,h),shimid:c+"_container",clients:0,options:n,can:function can(t,n){var i=arguments[2]||o;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=r.parseCaps(t)),"object"===e.typeOf(t)){for(var s in t){if(!this.can(s,t[s],i))return!1;}return!0;}return"function"===e.typeOf(i[t])?i[t].call(this,n):n===i[t];},getShimContainer:function getShimContainer(){var n,r=t.get(this.shimid);return r||(n=this.options.container?t.get(this.options.container):document.body,r=document.createElement("div"),r.id=this.shimid,r.className="moxie-shim moxie-shim-"+this.type,e.extend(r.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(r),n=null),r;},getShim:function getShim(){return l;},shimExec:function shimExec(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec.call(this,this.uid,e,t,n);},exec:function exec(e,t){var n=[].slice.call(arguments,2);return f[e]&&f[e][t]?f[e][t].apply(this,n):f.shimExec.apply(this,arguments);},destroy:function destroy(){if(f){var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),l&&l.removeAllInstances(),this.unbindAll(),delete s[this.uid],this.uid=null,c=f=l=e=null;}}}),this.mode&&n.required_caps&&!this.can(n.required_caps)&&(this.mode=!1);}var i={},s={};return r.order="html5,flash,silverlight,html4",r.getRuntime=function(e){return s[e]?s[e]:!1;},r.addConstructor=function(e,t){t.prototype=n.instance,i[e]=t;},r.getConstructor=function(e){return i[e]||null;},r.getInfo=function(e){var t=r.getRuntime(e);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function can(){return t.can.apply(t,arguments);}}:null;},r.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(e){n[e]=!0;}),n);},r.can=function(e,t){var n,i=r.getConstructor(e),s;return i?(n=new i({required_caps:t}),s=n.mode,n.destroy(),!!s):!1;},r.thatCan=function(e,t){var n=(t||r.order).split(/\s*,\s*/);for(var i in n){if(r.can(n[i],e))return n[i];}return null;},r.getMode=function(t,n,r){var i=null;if("undefined"===e.typeOf(r)&&(r="browser"),n&&!e.isEmptyObj(t)){if(e.each(n,function(n,r){if(t.hasOwnProperty(r)){var s=t[r](n);if("string"==typeof s&&(s=[s]),i){if(!(i=e.arrayIntersect(i,s)))return i=!1;}else i=s;}}),i)return-1!==e.inArray(r,i)?r:i[0];if(i===!1)return!1;}return r;},r.capTrue=function(){return!0;},r.capFalse=function(){return!1;},r.capTest=function(e){return function(){return!!e;};},r;}),r(g,[p,a,m],function(e,t,n){return function r(){var r;t.extend(this,{connectRuntime:function connectRuntime(i){function s(t){var u,a;return t.length?(u=t.shift(),(a=n.getConstructor(u))?(r=new a(i),r.bind("Init",function(){r.initialized=!0,setTimeout(function(){r.clients++,o.trigger("RuntimeInit",r);},1);}),r.bind("Error",function(){r.destroy(),s(t);}),r.mode?(r.init(),void 0):(r.trigger("Error"),void 0)):(s(t),void 0)):(o.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),r=null,void 0);}var o=this,u;if("string"===t.typeOf(i)?u=i:"string"===t.typeOf(i.ruid)&&(u=i.ruid),u){if(r=n.getRuntime(u))return r.clients++,r;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR);}s((i.runtime_order||n.order).split(/\s*,\s*/));},getRuntime:function getRuntime(){return r&&r.uid?r:(r=null,null);},disconnectRuntime:function disconnectRuntime(){r&&--r.clients<=0&&(r.destroy(),r=null);}});};}),r(y,[a,v,g],function(e,t,n){function r(s,o){function u(t,n,s){var o,u=i[this.uid];return"string"===e.typeOf(u)&&u.length?(o=new r(null,{type:s,size:n-t}),o.detach(u.substr(t,o.size)),o):null;}n.call(this),s&&this.connectRuntime(s),o?"string"===e.typeOf(o)&&(o={data:o}):o={},e.extend(this,{uid:o.uid||e.guid("uid_"),ruid:s,size:o.size||0,type:o.type||"",slice:function slice(e,t,n){return this.isDetached()?u.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n);},getSource:function getSource(){return i[this.uid]?i[this.uid]:null;},detach:function detach(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",i[this.uid]),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,i[this.uid]=e;},isDetached:function isDetached(){return!this.ruid&&"string"===e.typeOf(i[this.uid]);},destroy:function destroy(){this.detach(),delete i[this.uid];}}),o.data?this.detach(o.data):i[this.uid]=o;}var i={};return r;}),r(b,[a,l,y],function(e,t,n){function r(r,i){var s,o;if(i||(i={}),o=i.type&&""!==i.type?i.type:t.getFileMime(i.name),i.name)s=i.name.replace(/\\/g,"/"),s=s.substr(s.lastIndexOf("/")+1);else{var u=o.split("/")[0];s=e.guid((""!==u?u:"file")+"_"),t.extensions[o]&&(s+="."+t.extensions[o][0]);}n.apply(this,arguments),e.extend(this,{type:o||"",name:s||e.guid("file_"),lastModifiedDate:i.lastModifiedDate||new Date().toLocaleString()});}return r.prototype=n.prototype,r;}),r(w,[a,l,h,p,d,f,b,m,g],function(e,t,n,r,i,s,o,u,a){function f(i){var f=this,c,h,p;if(-1!==e.inArray(e.typeOf(i),["string","node"])&&(i={browse_button:i}),h=n.get(i.browse_button),!h)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR);p={accept:[{title:s.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:h.parentNode||document.body},i=e.extend({},p,i),"string"==typeof i.required_caps&&(i.required_caps=u.parseCaps(i.required_caps)),"string"==typeof i.accept&&(i.accept=t.mimes2extList(i.accept)),c=n.get(i.container),c||(c=document.body),"static"===n.getStyle(c,"position")&&(c.style.position="relative"),c=h=null,a.call(f),e.extend(f,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function init(){f.convertEventPropsToHandlers(l),f.bind("RuntimeInit",function(t,r){f.ruid=r.uid,f.shimid=r.shimid,f.bind("Ready",function(){f.trigger("Refresh");},999),f.bind("Change",function(){var t=r.exec.call(f,"FileInput","getFiles");f.files=[],e.each(t,function(e){return 0===e.size?!0:(f.files.push(new o(f.ruid,e)),void 0);});},999),f.bind("Refresh",function(){var t,s,o,u;o=n.get(i.browse_button),u=n.get(r.shimid),o&&(t=n.getPos(o,n.get(i.container)),s=n.getSize(o),u&&e.extend(u.style,{top:t.y+"px",left:t.x+"px",width:s.w+"px",height:s.h+"px"})),u=o=null;}),r.exec.call(f,"FileInput","init",i);}),f.connectRuntime(e.extend({},i,{required_caps:{select_file:!0}}));},disable:function disable(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)?!0:t);},refresh:function refresh(){f.trigger("Refresh");},destroy:function destroy(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy();}),this.files=null;}});}var l=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return f.prototype=i.instance,f;}),r(E,[f,h,p,a,b,g,d,l],function(e,t,n,r,i,s,o,u){function a(n){var o=this,a;"string"==typeof n&&(n={drop_zone:n}),a={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==_typeof(n)?r.extend({},a,n):a,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=u.mimes2extList(n.accept)),s.call(o),r.extend(o,{uid:r.guid("uid_"),ruid:null,files:null,init:function init(){o.convertEventPropsToHandlers(f),o.bind("RuntimeInit",function(e,t){o.ruid=t.uid,o.bind("Drop",function(){var e=t.exec.call(o,"FileDrop","getFiles");o.files=[],r.each(e,function(e){o.files.push(new i(o.ruid,e));});},999),t.exec.call(o,"FileDrop","init",n),o.dispatchEvent("ready");}),o.connectRuntime(n);},destroy:function destroy(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null;}});}var f=["ready","dragenter","dragleave","drop","error"];return a.prototype=o.instance,a;}),r(S,[a,g,d],function(e,t,n){function r(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll();};}return r.prototype=n.instance,r;}),r(x,[a,v,p,d,y,b,S],function(e,t,n,r,i,s,o){function u(){function r(e,r){function l(e){s.readyState=u.DONE,s.error=e,s.trigger("error"),c();}function c(){f.destroy(),f=null,s.trigger("loadend");}function h(t){f.bind("Error",function(e,t){l(t);}),f.bind("Progress",function(e){s.result=t.exec.call(f,"FileReader","getResult"),s.trigger(e);}),f.bind("Load",function(e){s.readyState=u.DONE,s.result=t.exec.call(f,"FileReader","getResult"),s.trigger(e),c();}),t.exec.call(f,"FileReader","read",e,r);}if(f=new o(),this.convertEventPropsToHandlers(a),this.readyState===u.LOADING)return l(new n.DOMException(n.DOMException.INVALID_STATE_ERR));if(this.readyState=u.LOADING,this.trigger("loadstart"),r instanceof i){if(r.isDetached()){var p=r.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=p;break;case"readAsDataURL":this.result="data:"+r.type+";base64,"+t.btoa(p);}this.readyState=u.DONE,this.trigger("load"),c();}else h(f.connectRuntime(r.ruid));}else l(new n.DOMException(n.DOMException.NOT_FOUND_ERR));}var s=this,f;e.extend(this,{uid:e.guid("uid_"),readyState:u.EMPTY,result:null,error:null,readAsBinaryString:function readAsBinaryString(e){r.call(this,"readAsBinaryString",e);},readAsDataURL:function readAsDataURL(e){r.call(this,"readAsDataURL",e);},readAsText:function readAsText(e){r.call(this,"readAsText",e);},abort:function abort(){this.result=null,-1===e.inArray(this.readyState,[u.EMPTY,u.DONE])&&(this.readyState===u.LOADING&&(this.readyState=u.DONE),f&&f.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"));},destroy:function destroy(){this.abort(),f&&(f.getRuntime().exec.call(this,"FileReader","destroy"),f.disconnectRuntime()),s=f=null;}});}var a=["loadstart","progress","load","abort","error","loadend"];return u.EMPTY=0,u.LOADING=1,u.DONE=2,u.prototype=r.instance,u;}),r(T,[],function(){var e=function e(t,n){for(var r=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],i=r.length,s={http:80,https:443},o={},u=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,a=u.exec(t||"");i--;){a[i]&&(o[r[i]]=a[i]);}if(!o.scheme){n&&"string"!=typeof n||(n=e(n||document.location.href)),o.scheme=n.scheme,o.host=n.host,o.port=n.port;var f="";/^[^\/]/.test(o.path)&&(f=n.path,/(\/|\/[^\.]+)$/.test(f)?f+="/":f=f.replace(/\/[^\/]+$/,"/")),o.path=f+(o.path||"");}return o.port||(o.port=s[o.scheme]||80),o.port=parseInt(o.port,10),o.path||(o.path="/"),delete o.source,o;},t=function t(_t4){var n={http:80,https:443},r=e(_t4);return r.scheme+"://"+r.host+(r.port!==n[r.scheme]?":"+r.port:"")+r.path+(r.query?r.query:"");},n=function n(t){function n(e){return[e.scheme,e.host,e.port].join("/");}return"string"==typeof t&&(t=e(t)),n(e())===n(t);};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n};}),r(N,[a,g,v],function(e,t,n){return function(){function r(e,t){if(!t.isDetached()){var r=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),r;}var i=t.getSource();switch(e){case"readAsBinaryString":return i;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(i);case"readAsText":for(var s="",o=0,u=i.length;u>o;o++){s+=String.fromCharCode(i[o]);}return s;}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function readAsBinaryString(e){return r.call(this,"readAsBinaryString",e);},readAsDataURL:function readAsDataURL(e){return r.call(this,"readAsDataURL",e);},readAsText:function readAsText(e){return r.call(this,"readAsText",e);}});};}),r(C,[p,a,y],function(e,t,n){function r(){var e,r=[];t.extend(this,{append:function append(i,s){var o=this,u=t.typeOf(s);s instanceof n?e={name:i,value:s}:"array"===u?(i+="[]",t.each(s,function(e){o.append(i,e);})):"object"===u?t.each(s,function(e,t){o.append(i+"["+t+"]",e);}):"null"===u||"undefined"===u||"number"===u&&isNaN(s)?o.append(i,"false"):r.push({name:i,value:s.toString()});},hasBlob:function hasBlob(){return!!this.getBlob();},getBlob:function getBlob(){return e&&e.value||null;},getBlobName:function getBlobName(){return e&&e.name||null;},each:function each(n){t.each(r,function(e){n(e.value,e.name);}),e&&n(e.value,e.name);},destroy:function destroy(){e=null,r=[];}});}return r;}),r(k,[a,p,d,v,T,m,S,y,N,C,c,l],function(e,t,n,r,i,s,o,u,a,f,l,c){function h(){this.uid=e.guid("uid_");}function p(){function n(e,t){return y.hasOwnProperty(e)?1===arguments.length?l.can("define_property")?y[e]:g[e]:(l.can("define_property")?y[e]=t:g[e]=t,void 0):void 0;}function a(t){function r(){F.destroy(),F=null,u.dispatchEvent("loadend"),u=null;}function i(i){F.bind("LoadStart",function(e){n("readyState",p.LOADING),u.dispatchEvent("readystatechange"),u.dispatchEvent(e),A&&u.upload.dispatchEvent(e);}),F.bind("Progress",function(e){n("readyState")!==p.LOADING&&(n("readyState",p.LOADING),u.dispatchEvent("readystatechange")),u.dispatchEvent(e);}),F.bind("UploadProgress",function(e){A&&u.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded});}),F.bind("Load",function(t){n("readyState",p.DONE),n("status",Number(i.exec.call(F,"XMLHttpRequest","getStatus")||0)),n("statusText",d[n("status")]||""),n("response",i.exec.call(F,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),I=i.exec.call(F,"XMLHttpRequest","getAllResponseHeaders"),u.dispatchEvent("readystatechange"),n("status")>0?(A&&u.upload.dispatchEvent(t),u.dispatchEvent(t)):(M=!0,u.dispatchEvent("error")),r();}),F.bind("Abort",function(e){u.dispatchEvent(e),r();}),F.bind("Error",function(e){M=!0,n("readyState",p.DONE),u.dispatchEvent("readystatechange"),O=!0,u.dispatchEvent(e),r();}),i.exec.call(F,"XMLHttpRequest","send",{url:w,method:E,async:b,user:x,password:T,headers:S,mimeType:C,encoding:N,responseType:u.responseType,withCredentials:u.withCredentials,options:j},t);}var u=this;D=new Date().getTime(),F=new o(),"string"==typeof j.required_caps&&(j.required_caps=s.parseCaps(j.required_caps)),j.required_caps=e.extend({},j.required_caps,{return_response_type:u.responseType}),t instanceof f&&(j.required_caps.send_multipart=!0),_||(j.required_caps.do_cors=!0),j.ruid?i(F.connectRuntime(j)):(F.bind("RuntimeInit",function(e,t){i(t);}),F.bind("RuntimeError",function(e,t){u.dispatchEvent("RuntimeError",t);}),F.connectRuntime(j));}function m(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),D=P=null;}var g=this,y={timeout:0,readyState:p.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},b=!0,w,E,S={},x,T,N=null,C=null,k=!1,L=!1,A=!1,O=!1,M=!1,_=!1,D,P,H=null,B=null,j={},F,I="",q;e.extend(this,y,{uid:e.guid("uid_"),upload:new h(),open:function open(s,o,u,a,f){var l;if(!s||!o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(s)||r.utf8_encode(s)!==s)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(s.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(E=s.toUpperCase()),~e.inArray(E,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(o=r.utf8_encode(o),l=i.parseUrl(o),_=i.hasSameOrigin(l),w=i.resolveUrl(o),(a||f)&&!_)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(x=a||l.user,T=f||l.pass,b=u||!0,b===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);k=!b,L=!1,S={},m.call(this),n("readyState",p.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange");},setRequestHeader:function setRequestHeader(i,s){var o=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==p.OPENED||L)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(i)||r.utf8_encode(i)!==i)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return i=e.trim(i).toLowerCase(),~e.inArray(i,o)||/^(proxy\-|sec\-)/.test(i)?!1:(S[i]?S[i]+=", "+s:S[i]=s,!0);},getAllResponseHeaders:function getAllResponseHeaders(){return I||"";},getResponseHeader:function getResponseHeader(t){return t=t.toLowerCase(),M||~e.inArray(t,["set-cookie","set-cookie2"])?null:I&&""!==I&&(q||(q={},e.each(I.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),q[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])});})),q.hasOwnProperty(t))?q[t].header+": "+q[t].value:null;},overrideMimeType:function overrideMimeType(r){var i,s;if(~e.inArray(n("readyState"),[p.LOADING,p.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(r=e.trim(r.toLowerCase()),/;/.test(r)&&(i=r.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(r=i[1],i[2]&&(s=i[2])),!c.mimes[r])throw new t.DOMException(t.DOMException.SYNTAX_ERR);H=r,B=s;},send:function send(n,i){if(j="string"===e.typeOf(i)?{ruid:i}:i?i:{},this.convertEventPropsToHandlers(v),this.upload.convertEventPropsToHandlers(v),this.readyState!==p.OPENED||L)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof u)j.ruid=n.ruid,C=n.type||"application/octet-stream";else if(n instanceof f){if(n.hasBlob()){var s=n.getBlob();j.ruid=s.ruid,C=s.type||"application/octet-stream";}}else"string"==typeof n&&(N="UTF-8",C="text/plain;charset=UTF-8",n=r.utf8_encode(n));this.withCredentials||(this.withCredentials=j.required_caps&&j.required_caps.send_browser_cookies&&!_),A=!k&&this.upload.hasEventListener(),M=!1,O=!n,k||(L=!0),a.call(this,n);},abort:function abort(){if(M=!0,k=!1,~e.inArray(n("readyState"),[p.UNSENT,p.OPENED,p.DONE]))n("readyState",p.UNSENT);else{if(n("readyState",p.DONE),L=!1,!F)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);F.getRuntime().exec.call(F,"XMLHttpRequest","abort",O),O=!0;}},destroy:function destroy(){F&&("function"===e.typeOf(F.destroy)&&F.destroy(),F=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null);}});}var d={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};h.prototype=n.instance;var v=["loadstart","progress","abort","error","load","timeout","loadend"],m=1,g=2;return p.UNSENT=0,p.OPENED=1,p.HEADERS_RECEIVED=2,p.LOADING=3,p.DONE=4,p.prototype=n.instance,p;}),r(L,[a,v,g,d],function(e,t,n,r){function i(){function r(){l=c=0,f=this.result=null;}function s(t,n){var r=this;a=n,r.bind("TransportingProgress",function(t){c=t.loaded,l>c&&-1===e.inArray(r.state,[i.IDLE,i.DONE])&&o.call(r);},999),r.bind("TransportingComplete",function(){c=l,r.state=i.DONE,f=null,r.result=a.exec.call(r,"Transporter","getAsBlob",t||"");},999),r.state=i.BUSY,r.trigger("TransportingStarted"),o.call(r);}function o(){var e=this,n,r=l-c;h>r&&(h=r),n=t.btoa(f.substr(c,h)),a.exec.call(e,"Transporter","receive",n,l);}var u,a,f,l,c,h;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:i.IDLE,result:null,transport:function transport(t,n,i){var o=this;if(i=e.extend({chunk_size:204798},i),(u=i.chunk_size%3)&&(i.chunk_size+=3-u),h=i.chunk_size,r.call(this),f=t,l=t.length,"string"===e.typeOf(i)||i.ruid)s.call(o,n,this.connectRuntime(i));else{var a=function a(e,t){o.unbind("RuntimeInit",a),s.call(o,n,t);};this.bind("RuntimeInit",a),this.connectRuntime(i);}},abort:function abort(){var e=this;e.state=i.IDLE,a&&(a.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),r.call(e);},destroy:function destroy(){this.unbindAll(),a=null,this.disconnectRuntime(),r.call(this);}});}return i.IDLE=0,i.BUSY=1,i.DONE=2,i.prototype=r.instance,i;}),r(A,[a,h,p,N,k,m,g,L,c,d,y,b,v],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(){function r(e){e||(e=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=e.size,this.width=e.width,this.height=e.height,this.type=e.type,this.meta=e.meta,""===this.name&&(this.name=e.name);}function f(t){var r=e.typeOf(t);try{if(t instanceof p){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);v.apply(this,arguments);}else if(t instanceof l){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);m.apply(this,arguments);}else if(-1!==e.inArray(r,["blob","file"]))f.call(this,new c(null,t),arguments[1]);else if("string"===r)/^data:[^;]*;base64,/.test(t)?f.call(this,new l(null,{data:t}),arguments[1]):g.apply(this,arguments);else{if("node"!==r||"img"!==t.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);f.call(this,t.src,arguments[1]);}}catch(i){this.trigger("error",i);}}function v(t,n){var r=this.connectRuntime(t.ruid);this.ruid=r.uid,r.exec.call(this,"Image","loadFromImage",t,"undefined"===e.typeOf(n)?!0:n);}function m(t,n){function r(e){i.ruid=e.uid,e.exec.call(i,"Image","loadFromBlob",t);}var i=this;i.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){r(t);}),n&&"string"==typeof n.required_caps&&(n.required_caps=s.parseCaps(n.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):r(this.connectRuntime(t.ruid));}function g(e,t){var n=this,r;r=new i(),r.open("get",e),r.responseType="blob",r.onprogress=function(e){n.trigger(e);},r.onload=function(){m.call(n,r.response,!0);},r.onerror=function(e){n.trigger(e);},r.onloadend=function(){r.destroy();},r.bind("RuntimeError",function(e,t){n.trigger("RuntimeError",t);}),r.send(null,t);}o.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function clone(){this.load.apply(this,arguments);},load:function load(){this.bind("Load Resize",function(){r.call(this);},999),this.convertEventPropsToHandlers(d),f.apply(this,arguments);},downsize:function downsize(t,r,i,s){try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);(!t&&!r||"undefined"===e.typeOf(i))&&(i=!1),t=t||this.width,r=r||this.height,s="undefined"===e.typeOf(s)?!0:!!s,this.getRuntime().exec.call(this,"Image","downsize",t,r,i,s);}catch(o){this.trigger("error",o);}},crop:function crop(e,t,n){this.downsize(e,t,!0,n);},getAsCanvas:function getAsCanvas(){if(!a.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas");},getAsBlob:function getAsBlob(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return e||(e="image/jpeg"),"image/jpeg"!==e||t||(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",e,t);},getAsDataURL:function getAsDataURL(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t);},getAsBinaryString:function getAsBinaryString(e,t){var n=this.getAsDataURL(e,t);return h.atob(n.substring(n.indexOf("base64,")+7));},embed:function embed(r){function i(){if(a.can("create_canvas")){var t=o.getAsCanvas();if(t)return r.appendChild(t),t=null,o.destroy(),s.trigger("embedded"),void 0;}var i=o.getAsDataURL(f,l);if(!i)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(a.can("use_data_uri_of",i.length))r.innerHTML='<img src="'+i+'" width="'+o.width+'" height="'+o.height+'" />',o.destroy(),s.trigger("embedded");else{var c=new u();c.bind("TransportingComplete",function(){g=s.connectRuntime(this.result.ruid),s.bind("Embedded",function(){e.extend(g.getShimContainer().style,{top:"0px",left:"0px",width:o.width+"px",height:o.height+"px"}),g=null;},999),g.exec.call(s,"ImageView","display",this.result.uid,v,m),o.destroy();}),c.transport(h.atob(i.substring(i.indexOf("base64,")+7)),f,e.extend({},d,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r}));}}var s=this,o,f,l,c,d=arguments[1]||{},v=this.width,m=this.height,g;try{if(!(r=t.get(r)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>p.MAX_RESIZE_WIDTH||this.height>p.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);if(f=d.type||this.type||"image/jpeg",l=d.quality||90,c="undefined"!==e.typeOf(d.crop)?d.crop:!1,d.width)v=d.width,m=d.height||v;else{var y=t.getSize(r);y.w&&y.h&&(v=y.w,m=y.h);}return o=new p(),o.bind("Resize",function(){i.call(s);}),o.bind("Load",function(){o.downsize(v,m,c,!1);}),o.clone(this,!1),o;}catch(b){this.trigger("error",b);}},destroy:function destroy(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll();}});}var d=["progress","load","error","resize","embedded"];return p.MAX_RESIZE_WIDTH=6500,p.MAX_RESIZE_HEIGHT=6500,p.prototype=f.instance,p;}),r(O,[a,p,m,c],function(e,t,n,r){function i(t){var i=this,u=n.capTest,a=n.capTrue,f=e.extend({access_binary:u(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function access_image_binary(){return i.can("access_binary")&&!!o.Image;},display_media:u(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:u(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest()),drag_and_drop:u(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==r.browser||r.version>9);}()),filter_by_extension:u(function(){return"Chrome"===r.browser&&r.version>=28||"IE"===r.browser&&r.version>=10;}()),return_response_headers:a,return_response_type:function return_response_type(e){return"json"===e&&window.JSON?!0:r.can("return_response_type",e);},return_status_code:a,report_upload_progress:u(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function resize_image(){return i.can("access_binary")&&r.can("create_canvas");},select_file:function select_file(){return r.can("use_fileinput")&&window.File;},select_folder:function select_folder(){return i.can("select_file")&&"Chrome"===r.browser&&r.version>=21;},select_multiple:function select_multiple(){return!(!i.can("select_file")||"Safari"===r.browser&&"Windows"===r.os||"iOS"===r.os&&r.verComp(r.osVersion,"7.0.4","<"));},send_binary_string:u(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:u(window.XMLHttpRequest),send_multipart:function send_multipart(){return!!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||i.can("send_binary_string");},slice_blob:u(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function stream_upload(){return i.can("slice_blob")&&i.can("send_multipart");},summon_file_dialog:u(function(){return"Firefox"===r.browser&&r.version>=4||"Opera"===r.browser&&r.version>=12||"IE"===r.browser&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"]);}()),upload_filesize:a},arguments[2]);n.call(this,t,arguments[1]||s,f),e.extend(this,{init:function init(){this.trigger("Init");},destroy:function(e){return function(){e.call(i),e=i=null;};}(this.destroy)}),e.extend(this.getShim(),o);}var s="html5",o={};return n.addConstructor(s,i),o;}),r(M,[O,y],function(e,t){function n(){function e(e,t,n){var r;if(!window.File.prototype.slice)return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(e,t,n):null;try{return e.slice(),e.slice(t,n);}catch(i){return e.slice(t,n-t);}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments));};}return e.Blob=n;}),r(_,[a],function(e){function t(){this.returnValue=!1;}function n(){this.cancelBubble=!0;}var r={},i="moxie_"+e.guid(),s=function s(_s5,o,u,a){var f,l;o=o.toLowerCase(),_s5.addEventListener?(f=u,_s5.addEventListener(o,f,!1)):_s5.attachEvent&&(f=function f(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,u(e);},_s5.attachEvent("on"+o,f)),_s5[i]||(_s5[i]=e.guid()),r.hasOwnProperty(_s5[i])||(r[_s5[i]]={}),l=r[_s5[i]],l.hasOwnProperty(o)||(l[o]=[]),l[o].push({func:f,orig:u,key:a});},o=function o(t,n,s){var o,u;if(n=n.toLowerCase(),t[i]&&r[t[i]]&&r[t[i]][n]){o=r[t[i]][n];for(var a=o.length-1;a>=0&&(o[a].orig!==s&&o[a].key!==s||(t.removeEventListener?t.removeEventListener(n,o[a].func,!1):t.detachEvent&&t.detachEvent("on"+n,o[a].func),o[a].orig=null,o[a].func=null,o.splice(a,1),s===u));a--){;}if(o.length||delete r[t[i]][n],e.isEmptyObj(r[t[i]])){delete r[t[i]];try{delete t[i];}catch(f){t[i]=u;}}}},u=function u(t,n){t&&t[i]&&e.each(r[t[i]],function(e,r){o(t,r,n);});};return{addEvent:s,removeEvent:o,removeAllEvents:u};}),r(D,[O,a,h,_,l,c],function(e,t,n,r,i,s){function o(){var e=[],o;t.extend(this,{init:function init(u){var a=this,f=a.getRuntime(),l,c,h,p,d,v;o=u,e=[],h=o.accept.mimes||i.extList2mimes(o.accept,f.can("filter_by_extension")),c=f.getShimContainer(),c.innerHTML='<input id="'+f.uid+'" type="file" style="font-size:999px;opacity:0;"'+(o.multiple&&f.can("select_multiple")?"multiple":"")+(o.directory&&f.can("select_folder")?"webkitdirectory directory":"")+(h?' accept="'+h.join(",")+'"':"")+" />",l=n.get(f.uid),t.extend(l.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=n.get(o.browse_button),f.can("summon_file_dialog")&&("static"===n.getStyle(p,"position")&&(p.style.position="relative"),d=parseInt(n.getStyle(p,"z-index"),10)||1,p.style.zIndex=d,c.style.zIndex=d-1,r.addEvent(p,"click",function(e){var t=n.get(f.uid);t&&!t.disabled&&t.click(),e.preventDefault();},a.uid)),v=f.can("summon_file_dialog")?p:c,r.addEvent(v,"mouseover",function(){a.trigger("mouseenter");},a.uid),r.addEvent(v,"mouseout",function(){a.trigger("mouseleave");},a.uid),r.addEvent(v,"mousedown",function(){a.trigger("mousedown");},a.uid),r.addEvent(n.get(o.container),"mouseup",function(){a.trigger("mouseup");},a.uid),l.onchange=function m(){if(e=[],o.directory?t.each(this.files,function(t){"."!==t.name&&e.push(t);}):e=[].slice.call(this.files),"IE"!==s.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=m;}a.trigger("change");},a.trigger({type:"ready",async:!0}),c=null;},getFiles:function getFiles(){return e;},disable:function disable(e){var t=this.getRuntime(),r;(r=n.get(t.uid))&&(r.disabled=!!e);},destroy:function destroy(){var t=this.getRuntime(),i=t.getShim(),s=t.getShimContainer();r.removeAllEvents(s,this.uid),r.removeAllEvents(o&&n.get(o.container),this.uid),r.removeAllEvents(o&&n.get(o.browse_button),this.uid),s&&(s.innerHTML=""),i.removeInstance(this.uid),e=o=s=i=null;}});}return e.FileInput=o;}),r(P,[O,a,h,_,l],function(e,t,n,r,i){function s(){function e(e){for(var n=[],r=0;r<e.length;r++){[].push.apply(n,e[r].extensions.split(/\s*,\s*/));}return-1===t.inArray("*",n)?n:[];}function s(e){var n=i.getFileExtension(e.name);return!n||!c.length||-1!==t.inArray(n,c);}function o(e,n){var r=[];t.each(e,function(e){var t=e.webkitGetAsEntry();if(t)if(t.isFile){var n=e.getAsFile();s(n)&&l.push(n);}else r.push(t);}),r.length?u(r,n):n();}function u(e,n){var r=[];t.each(e,function(e){r.push(function(t){a(e,t);});}),t.inSeries(r,function(){n();});}function a(e,t){e.isFile?e.file(function(e){s(e)&&l.push(e),t();},function(){t();}):e.isDirectory?f(e,t):t();}function f(e,t){function n(e){i.readEntries(function(t){t.length?([].push.apply(r,t),n(e)):e();},e);}var r=[],i=e.createReader();n(function(){u(r,t);});}var l=[],c=[],h;t.extend(this,{init:function init(n){var i=this,u;h=n,c=e(h.accept),u=h.container,r.addEvent(u,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy";},i.uid),r.addEvent(u,"drop",function(e){e.preventDefault(),e.stopPropagation(),l=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?o(e.dataTransfer.items,function(){i.trigger("drop");}):(t.each(e.dataTransfer.files,function(e){s(e)&&l.push(e);}),i.trigger("drop"));},i.uid),r.addEvent(u,"dragenter",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("dragenter");},i.uid),r.addEvent(u,"dragleave",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("dragleave");},i.uid);},getFiles:function getFiles(){return l;},destroy:function destroy(){r.removeAllEvents(h&&n.get(h.container),this.uid),l=c=h=null;}});}return e.FileDrop=s;}),r(H,[O,v,a],function(e,t,n){function r(){function e(e){return t.atob(e.substring(e.indexOf("base64,")+7));}var r,i=!1;n.extend(this,{read:function read(e,t){var s=this;r=new window.FileReader(),r.addEventListener("progress",function(e){s.trigger(e);}),r.addEventListener("load",function(e){s.trigger(e);}),r.addEventListener("error",function(e){s.trigger(e,r.error);}),r.addEventListener("loadend",function(){r=null;}),"function"===n.typeOf(r[e])?(i=!1,r[e](t.getSource())):"readAsBinaryString"===e&&(i=!0,r.readAsDataURL(t.getSource()));},getResult:function getResult(){return r&&r.result?i?e(r.result):r.result:null;},abort:function abort(){r&&r.abort();},destroy:function destroy(){r=null;}});}return e.FileReader=r;}),r(B,[O,a,l,T,b,y,C,p,c],function(e,t,n,r,i,s,o,u,a){function f(){function e(e,t){var n=this,r,i;r=t.getBlob().getSource(),i=new window.FileReader(),i.onload=function(){t.append(t.getBlobName(),new s(null,{type:r.type,data:i.result})),h.send.call(n,e,t);},i.readAsBinaryString(r);}function f(){return!window.XMLHttpRequest||"IE"===a.browser&&a.version<8?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++){try{return new ActiveXObject(e[t]);}catch(n){}}}():new window.XMLHttpRequest();}function l(e){var t=e.responseXML,n=e.responseText;return"IE"===a.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===a.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t;}function c(e){var t="----moxieboundary"+new Date().getTime(),n="--",r="\r\n",i="",o=this.getRuntime();if(!o.can("send_binary_string"))throw new u.RuntimeError(u.RuntimeError.NOT_SUPPORTED_ERR);return p.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,o){i+=e instanceof s?n+t+r+'Content-Disposition: form-data; name="'+o+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+r+"Content-Type: "+(e.type||"application/octet-stream")+r+r+e.getSource()+r:n+t+r+'Content-Disposition: form-data; name="'+o+'"'+r+r+unescape(encodeURIComponent(e))+r;}),i+=n+t+n+r;}var h=this,p,d;t.extend(this,{send:function send(n,i){var u=this,l="Mozilla"===a.browser&&a.version>=4&&a.version<7,h="Android Browser"===a.browser,v=!1;if(d=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),p=f(),p.open(n.method,n.url,n.async,n.user,n.password),i instanceof s)i.isDetached()&&(v=!0),i=i.getSource();else if(i instanceof o){if(i.hasBlob())if(i.getBlob().isDetached())i=c.call(u,i),v=!0;else if((l||h)&&"blob"===t.typeOf(i.getBlob().getSource())&&window.FileReader)return e.call(u,n,i),void 0;if(i instanceof o){var m=new window.FormData();i.each(function(e,t){e instanceof s?m.append(t,e.getSource()):m.append(t,e);}),i=m;}}p.upload?(n.withCredentials&&(p.withCredentials=!0),p.addEventListener("load",function(e){u.trigger(e);}),p.addEventListener("error",function(e){u.trigger(e);}),p.addEventListener("progress",function(e){u.trigger(e);}),p.upload.addEventListener("progress",function(e){u.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total});})):p.onreadystatechange=function(){switch(p.readyState){case 1:break;case 2:break;case 3:var t,i;try{r.hasSameOrigin(n.url)&&(t=p.getResponseHeader("Content-Length")||0),p.responseText&&(i=p.responseText.length);}catch(s){t=i=0;}u.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:i});break;case 4:p.onreadystatechange=function(){},0===p.status?u.trigger("error"):u.trigger("load");}},t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){p.setRequestHeader(t,e);}),""!==n.responseType&&"responseType"in p&&(p.responseType="json"!==n.responseType||a.can("return_response_type","json")?n.responseType:"text"),v?p.sendAsBinary?p.sendAsBinary(i):function(){for(var e=new Uint8Array(i.length),t=0;t<i.length;t++){e[t]=255&i.charCodeAt(t);}p.send(e.buffer);}():p.send(i),u.trigger("loadstart");},getStatus:function getStatus(){try{if(p)return p.status;}catch(e){}return 0;},getResponse:function getResponse(e){var t=this.getRuntime();try{switch(e){case"blob":var r=new i(t.uid,p.response),s=p.getResponseHeader("Content-Disposition");if(s){var o=s.match(/filename=([\'\"'])([^\1]+)\1/);o&&(d=o[2]);}return r.name=d,r.type||(r.type=n.getFileMime(d)),r;case"json":return a.can("return_response_type","json")?p.response:200===p.status&&window.JSON?JSON.parse(p.responseText):null;case"document":return l(p);default:return""!==p.responseText?p.responseText:null;}}catch(u){return null;}},getAllResponseHeaders:function getAllResponseHeaders(){try{return p.getAllResponseHeaders();}catch(e){}return"";},abort:function abort(){p&&p.abort();},destroy:function destroy(){h=d=null;}});}return e.XMLHttpRequest=f;}),r(j,[],function(){return function(){function e(e,t){var n=i?0:-8*(t-1),r=0,o;for(o=0;t>o;o++){r|=s.charCodeAt(e+o)<<Math.abs(n+8*o);}return r;}function n(e,t,n){n=3===arguments.length?n:s.length-t-1,s=s.substr(0,t)+e+s.substr(n+t);}function r(e,t,r){var s="",o=i?0:-8*(r-1),u;for(u=0;r>u;u++){s+=String.fromCharCode(255&t>>Math.abs(o+8*u));}n(s,e,r);}var i=!1,s;return{II:function II(e){return e===t?i:(i=e,void 0);},init:function init(e){i=!1,s=e;},SEGMENT:function SEGMENT(e,t,r){switch(arguments.length){case 1:return s.substr(e,s.length-e-1);case 2:return s.substr(e,t);case 3:n(r,e,t);break;default:return s;}},BYTE:function BYTE(t){return e(t,1);},SHORT:function SHORT(t){return e(t,2);},LONG:function LONG(n,i){return i===t?e(n,4):(r(n,i,4),void 0);},SLONG:function SLONG(t){var n=e(t,4);return n>2147483647?n-4294967296:n;},STRING:function STRING(t,n){var r="";for(n+=t;n>t;t++){r+=String.fromCharCode(e(t,1));}return r;}};};}),r(F,[j],function(e){return function t(n){var r=[],i,s,o,u=0;if(i=new e(),i.init(n),65496===i.SHORT(0)){for(s=2;s<=n.length;){if(o=i.SHORT(s),o>=65488&&65495>=o)s+=2;else{if(65498===o||65497===o)break;u=i.SHORT(s+2)+2,o>=65505&&65519>=o&&r.push({hex:o,name:"APP"+(15&o),start:s,length:u,segment:i.SEGMENT(s,u)}),s+=u;}}return i.init(null),{headers:r,restore:function restore(e){var t,n;for(i.init(e),s=65504==i.SHORT(2)?4+i.SHORT(4):2,n=0,t=r.length;t>n;n++){i.SEGMENT(s,0,r[n].segment),s+=r[n].length;}return e=i.SEGMENT(),i.init(null),e;},strip:function strip(e){var n,r,s;for(r=new t(e),n=r.headers,r.purge(),i.init(e),s=n.length;s--;){i.SEGMENT(n[s].start,n[s].length,"");}return e=i.SEGMENT(),i.init(null),e;},get:function get(e){for(var t=[],n=0,i=r.length;i>n;n++){r[n].name===e.toUpperCase()&&t.push(r[n].segment);}return t;},set:function set(e,t){var n=[],i,s,o;for("string"==typeof t?n.push(t):n=t,i=s=0,o=r.length;o>i&&(r[i].name===e.toUpperCase()&&(r[i].segment=n[s],r[i].length=n[s].length,s++),!(s>=n.length));i++){;}},purge:function purge(){r=[],i.init(null),i=null;}};}};}),r(I,[a,j],function(e,n){return function r(){function r(e,n){var r=o.SHORT(e),i,s,u,a,c,h,p,d,v=[],m={};for(i=0;r>i;i++){if(p=h=e+12*i+2,u=n[o.SHORT(p)],u!==t){switch(a=o.SHORT(p+=2),c=o.LONG(p+=2),p+=4,v=[],a){case 1:case 7:for(c>4&&(p=o.LONG(p)+f.tiffHeader),s=0;c>s;s++){v[s]=o.BYTE(p+s);}break;case 2:c>4&&(p=o.LONG(p)+f.tiffHeader),m[u]=o.STRING(p,c-1);continue;case 3:for(c>2&&(p=o.LONG(p)+f.tiffHeader),s=0;c>s;s++){v[s]=o.SHORT(p+2*s);}break;case 4:for(c>1&&(p=o.LONG(p)+f.tiffHeader),s=0;c>s;s++){v[s]=o.LONG(p+4*s);}break;case 5:for(p=o.LONG(p)+f.tiffHeader,s=0;c>s;s++){v[s]=o.LONG(p+4*s)/o.LONG(p+4*s+4);}break;case 9:for(p=o.LONG(p)+f.tiffHeader,s=0;c>s;s++){v[s]=o.SLONG(p+4*s);}break;case 10:for(p=o.LONG(p)+f.tiffHeader,s=0;c>s;s++){v[s]=o.SLONG(p+4*s)/o.SLONG(p+4*s+4);}break;default:continue;}d=1==c?v[0]:v,m[u]=l.hasOwnProperty(u)&&"object"!=_typeof(d)?l[u][d]:d;}}return m;}function i(){var e=f.tiffHeader;return o.II(18761==o.SHORT(e)),42!==o.SHORT(e+=2)?!1:(f.IFD0=f.tiffHeader+o.LONG(e+=2),a=r(f.IFD0,u.tiff),"ExifIFDPointer"in a&&(f.exifIFD=f.tiffHeader+a.ExifIFDPointer,delete a.ExifIFDPointer),"GPSInfoIFDPointer"in a&&(f.gpsIFD=f.tiffHeader+a.GPSInfoIFDPointer,delete a.GPSInfoIFDPointer),!0);}function s(e,t,n){var r,i,s,a=0;if("string"==typeof t){var l=u[e.toLowerCase()];for(var c in l){if(l[c]===t){t=c;break;}}}r=f[e.toLowerCase()+"IFD"],i=o.SHORT(r);for(var h=0;i>h;h++){if(s=r+12*h+2,o.SHORT(s)==t){a=s+8;break;}}return a?(o.LONG(a,n),!0):!1;}var o,u,a,f={},l;return o=new n(),u={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function init(e){return f={tiffHeader:10},e!==t&&e.length?(o.init(e),65505===o.SHORT(0)&&"EXIF\0"===o.STRING(4,5).toUpperCase()?i():!1):!1;},TIFF:function TIFF(){return a;},EXIF:function EXIF(){var t;if(t=r(f.exifIFD,u.exif),t.ExifVersion&&"array"===e.typeOf(t.ExifVersion)){for(var n=0,i="";n<t.ExifVersion.length;n++){i+=String.fromCharCode(t.ExifVersion[n]);}t.ExifVersion=i;}return t;},GPS:function GPS(){var t;return t=r(f.gpsIFD,u.gps),t.GPSVersionID&&"array"===e.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join(".")),t;},setExif:function setExif(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:s("exif",e,t);},getBinary:function getBinary(){return o.SEGMENT();},purge:function purge(){o.init(null),o=a=null,f={};}};};}),r(q,[a,p,F,j,I],function(e,t,n,r,i){function s(s){function o(){for(var e=0,t,n;e<=a.length;){if(t=f.SHORT(e+=2),t>=65472&&65475>=t)return e+=5,{height:f.SHORT(e),width:f.SHORT(e+=2)};n=f.SHORT(e+=2),e+=n-2;}return null;}function u(){c&&l&&f&&(c.purge(),l.purge(),f.init(null),a=h=l=c=f=null);}var a,f,l,c,h,p;if(a=s,f=new r(),f.init(a),65496!==f.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);l=new n(s),c=new i(),p=!!c.init(l.get("app1")[0]),h=o.call(this),e.extend(this,{type:"image/jpeg",size:a.length,width:h&&h.width||0,height:h&&h.height||0,setExif:function setExif(t,n){return p?("object"===e.typeOf(t)?e.each(t,function(e,t){c.setExif(t,e);}):c.setExif(t,n),l.set("app1",c.getBinary()),void 0):!1;},writeHeaders:function writeHeaders(){return arguments.length?l.restore(arguments[0]):a=l.restore(a);},stripHeaders:function stripHeaders(e){return l.strip(e);},purge:function purge(){u.call(this);}}),p&&(this.meta={tiff:c.TIFF(),exif:c.EXIF(),gps:c.GPS()});}return s;}),r(R,[p,a,j],function(e,t,n){function r(r){function i(){var e,t;return e=o.call(this,8),"IHDR"==e.type?(t=e.start,{width:a.LONG(t),height:a.LONG(t+=4)}):null;}function s(){a&&(a.init(null),u=c=f=l=a=null);}function o(e){var t,n,r,i;return t=a.LONG(e),n=a.STRING(e+=4,4),r=e+=4,i=a.LONG(e+t),{length:t,type:n,start:r,CRC:i};}var u,a,f,l,c;u=r,a=new n(),a.init(u),function(){var t=0,n=0,r=[35152,20039,3338,6666];for(n=0;n<r.length;n++,t+=2){if(r[n]!=a.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT);}}(),c=i.call(this),t.extend(this,{type:"image/png",size:u.length,width:c.width,height:c.height,purge:function purge(){s.call(this);}}),s.call(this);}return r;}),r(U,[a,p,q,R],function(e,t,n,r){return function(i){var s=[n,r],o;o=function(){for(var e=0;e<s.length;e++){try{return new s[e](i);}catch(n){}}throw new t.ImageError(t.ImageError.WRONG_FORMAT);}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function setExif(){},writeHeaders:function writeHeaders(e){return e;},stripHeaders:function stripHeaders(e){return e;},purge:function purge(){}}),e.extend(this,o),this.purge=function(){o.purge(),o=null;};};}),r(z,[],function(){function e(e,r,i){var s=e.naturalWidth,o=e.naturalHeight,u=i.width,a=i.height,f=i.x||0,l=i.y||0,c=r.getContext("2d");t(e)&&(s/=2,o/=2);var h=1024,p=document.createElement("canvas");p.width=p.height=h;for(var d=p.getContext("2d"),v=n(e,s,o),m=0;o>m;){for(var g=m+h>o?o-m:h,y=0;s>y;){var b=y+h>s?s-y:h;d.clearRect(0,0,h,h),d.drawImage(e,-y,-m);var w=y*u/s+f<<0,E=Math.ceil(b*u/s),S=m*a/o/v+l<<0,x=Math.ceil(g*a/o/v);c.drawImage(p,0,0,b,g,w,S,E,x),y+=h;}m+=h;}p=d=null;}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");return i.drawImage(e,-t+1,0),0===i.getImageData(0,0,1,1).data[3];}return!1;}function n(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var s=i.getImageData(0,0,1,n).data,o=0,u=n,a=n;a>o;){var f=s[4*(a-1)+3];0===f?u=a:o=a,a=u+o>>1;}r=null;var l=a/n;return 0===l?1:l;}return{isSubsampled:t,renderTo:e};}),r(W,[O,a,p,v,b,U,z,l,c],function(e,t,n,r,i,s,o,u,a){function f(){function e(){if(!w&&!y)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return w||y;}function f(e){return r.atob(e.substring(e.indexOf("base64,")+7));}function l(e,t){return"data:"+(t||"")+";base64,"+r.btoa(e);}function c(e){var t=this;y=new Image(),y.onerror=function(){m.call(this),t.trigger("error",new n.ImageError(n.ImageError.WRONG_FORMAT));},y.onload=function(){t.trigger("load");},y.src=/^data:[^;]*;base64,/.test(e)?e:l(e,S.type);}function h(e,t){var r=this,i;return window.FileReader?(i=new FileReader(),i.onload=function(){t(this.result);},i.onerror=function(){r.trigger("error",new n.FileException(n.FileException.NOT_READABLE_ERR));},i.readAsDataURL(e),void 0):t(e.getAsDataURL());}function p(n,r,i,s){var o=this,u,a,f=0,l=0,c,h,p,m;if(T=s,m=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(m,[5,6,7,8])){var g=n;n=r,r=g;}return c=e(),a=i?Math.max:Math.min,u=a(n/c.width,r/c.height),u>1&&(!i||s)?(this.trigger("Resize"),void 0):(w||(w=document.createElement("canvas")),h=Math.round(c.width*u),p=Math.round(c.height*u),i?(w.width=n,w.height=r,h>n&&(f=Math.round((h-n)/2)),p>r&&(l=Math.round((p-r)/2))):(w.width=h,w.height=p),T||v(w.width,w.height,m),d.call(this,c,w,-f,-l,h,p),this.width=w.width,this.height=w.height,x=!0,o.trigger("Resize"),void 0);}function d(e,t,n,r,i,s){if("iOS"===a.OS)o.renderTo(e,t,{width:i,height:s,x:n,y:r});else{var u=t.getContext("2d");u.drawImage(e,n,r,i,s);}}function v(e,t,n){switch(n){case 5:case 6:case 7:case 8:w.width=t,w.height=e;break;default:w.width=e,w.height=t;}var r=w.getContext("2d");switch(n){case 2:r.translate(e,0),r.scale(-1,1);break;case 3:r.translate(e,t),r.rotate(Math.PI);break;case 4:r.translate(0,t),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI),r.translate(e,-t),r.scale(-1,1);break;case 8:r.rotate(-0.5*Math.PI),r.translate(-e,0);}}function m(){b&&(b.purge(),b=null),E=y=w=S=null,x=!1;}var g=this,y,b,w,E,S,x=!1,T=!0;t.extend(this,{loadFromBlob:function loadFromBlob(e){var t=this,r=t.getRuntime(),i=arguments.length>1?arguments[1]:!0;if(!r.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return S=e,e.isDetached()?(E=e.getSource(),c.call(this,E),void 0):(h.call(this,e.getSource(),function(e){i&&(E=f(e)),c.call(t,e);}),void 0);},loadFromImage:function loadFromImage(e,t){this.meta=e.meta,S=new i(null,{name:e.name,size:e.size,type:e.type}),c.call(this,t?E=e.getAsBinaryString():e.getAsDataURL());},getInfo:function getInfo(){var t=this.getRuntime(),n;return!b&&E&&t.can("access_image_binary")&&(b=new s(E)),n={width:e().width||0,height:e().height||0,type:S.type||u.getFileMime(S.name),size:E&&E.length||S.size||0,name:S.name||"",meta:b&&b.meta||this.meta||{}};},downsize:function downsize(){p.apply(this,arguments);},getAsCanvas:function getAsCanvas(){return w&&(w.id=this.uid+"_canvas"),w;},getAsBlob:function getAsBlob(e,t){return e!==this.type&&p.call(this,this.width,this.height,!1),new i(null,{name:S.name||"",type:e,data:g.getAsBinaryString.call(this,e,t)});},getAsDataURL:function getAsDataURL(e){var t=arguments[1]||90;if(!x)return y.src;if("image/jpeg"!==e)return w.toDataURL("image/png");try{return w.toDataURL("image/jpeg",t/100);}catch(n){return w.toDataURL("image/jpeg");}},getAsBinaryString:function getAsBinaryString(e,t){if(!x)return E||(E=f(g.getAsDataURL(e,t))),E;if("image/jpeg"!==e)E=f(g.getAsDataURL(e,t));else{var n;t||(t=90);try{n=w.toDataURL("image/jpeg",t/100);}catch(r){n=w.toDataURL("image/jpeg");}E=f(n),b&&(E=b.stripHeaders(E),T&&(b.meta&&b.meta.exif&&b.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),E=b.writeHeaders(E)),b.purge(),b=null);}return x=!1,E;},destroy:function destroy(){g=null,m.call(this),this.getRuntime().getShim().removeInstance(this.uid);}});}return e.Image=f;}),r(X,[a,c,h,p,m],function(e,t,n,r,i){function s(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description;}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version");}catch(n){e="0.0";}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1]);}function o(o){var f=this,l;o=e.extend({swf_url:t.swf_url},o),i.call(this,o,u,{access_binary:function access_binary(e){return e&&"browser"===f.mode;},access_image_binary:function access_image_binary(e){return e&&"browser"===f.mode;},display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:function report_upload_progress(){return"client"===f.mode;},resize_image:i.capTrue,return_response_headers:!1,return_response_type:function return_response_type(t){return"json"===t&&window.JSON?!0:!e.arrayDiff(t,["","text","document"])||"browser"===f.mode;},return_status_code:function return_status_code(t){return"browser"===f.mode||!e.arrayDiff(t,[200,404]);},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:function send_binary_string(e){return e&&"browser"===f.mode;},send_browser_cookies:function send_browser_cookies(e){return e&&"browser"===f.mode;},send_custom_headers:function send_custom_headers(e){return e&&"browser"===f.mode;},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:function stream_upload(e){return e&&"browser"===f.mode;},summon_file_dialog:!1,upload_filesize:function upload_filesize(t){return e.parseSizeStr(t)<=2097152||"client"===f.mode;},use_http_method:function use_http_method(t){return!e.arrayDiff(t,["GET","POST"]);}},{access_binary:function access_binary(e){return e?"browser":"client";},access_image_binary:function access_image_binary(e){return e?"browser":"client";},report_upload_progress:function report_upload_progress(e){return e?"browser":"client";},return_response_type:function return_response_type(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"];},return_status_code:function return_status_code(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"];},send_binary_string:function send_binary_string(e){return e?"browser":"client";},send_browser_cookies:function send_browser_cookies(e){return e?"browser":"client";},send_custom_headers:function send_custom_headers(e){return e?"browser":"client";},stream_upload:function stream_upload(e){return e?"client":"browser";},upload_filesize:function upload_filesize(t){return e.parseSizeStr(t)>=2097152?"client":"browser";}},"client"),s()<10&&(this.mode=!1),e.extend(this,{getShim:function getShim(){return n.get(this.uid);},shimExec:function shimExec(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,n);},init:function init(){var n,i,s;s=this.getShimContainer(),e.extend(s.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+o.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+o.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>","IE"===t.browser?(i=document.createElement("div"),s.appendChild(i),i.outerHTML=n,i=s=null):s.innerHTML=n,l=setTimeout(function(){f&&!f.initialized&&f.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR));},5e3);},destroy:function(e){return function(){e.call(f),clearTimeout(l),o=l=e=f=null;};}(this.destroy)},a);}var u="flash",a={};return i.addConstructor(u,o),a;}),r(V,[X,y],function(e,t){var n={slice:function slice(e,n,r,i){var s=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>r?r=Math.max(e.size+r,0):r>0&&(r=Math.min(r,e.size)),e=s.shimExec.call(this,"Blob","slice",n,r,i||""),e&&(e=new t(s.uid,e)),e;}};return e.Blob=n;}),r($,[X],function(e){var t={init:function init(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready");}};return e.FileInput=t;}),r(J,[X,v],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e;}return null;}var r="",i={read:function read(e,t){var i=this,s=i.getRuntime();return"readAsDataURL"===e&&(r="data:"+(t.type||"")+";base64,"),i.bind("Progress",function(t,i){i&&(r+=n(i,e));}),s.shimExec.call(this,"FileReader","readAsBase64",t.uid);},getResult:function getResult(){return r;},destroy:function destroy(){r=null;}};return e.FileReader=i;}),r(K,[X,v],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e;}return null;}var r={read:function read(e,t){var r,i=this.getRuntime();return(r=i.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(r="data:"+(t.type||"")+";base64,"+r),n(r,e,t.type)):null;}};return e.FileReaderSync=r;}),r(Q,[X,a,y,b,N,C,L],function(e,t,n,r,i,s,o){var u={send:function send(e,r){function i(){e.transport=l.mode,l.shimExec.call(f,"XMLHttpRequest","send",e,r);}function u(e,t){l.shimExec.call(f,"XMLHttpRequest","appendBlob",e,t.uid),r=null,i();}function a(e,t){var n=new o();n.bind("TransportingComplete",function(){t(this.result);}),n.transport(e.getSource(),e.type,{ruid:l.uid});}var f=this,l=f.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){l.shimExec.call(f,"XMLHttpRequest","setRequestHeader",t,e.toString());}),r instanceof s){var c;if(r.each(function(e,t){e instanceof n?c=t:l.shimExec.call(f,"XMLHttpRequest","append",t,e);}),r.hasBlob()){var h=r.getBlob();h.isDetached()?a(h,function(e){h.destroy(),u(c,e);}):u(c,h);}else r=null,i();}else r instanceof n?r.isDetached()?a(r,function(e){r.destroy(),r=e.uid,i();}):(r=r.uid,i()):i();},getResponse:function getResponse(e){var n,s,o=this.getRuntime();if(s=o.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(s=new r(o.uid,s),"blob"===e)return s;try{if(n=new i(),~t.inArray(e,["","text"]))return n.readAsText(s);if("json"===e&&window.JSON)return JSON.parse(n.readAsText(s));}finally{s.destroy();}}return null;},abort:function abort(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort");}};return e.XMLHttpRequest=u;}),r(G,[X,y],function(e,t){var n={getAsBlob:function getAsBlob(e){var n=this.getRuntime(),r=n.shimExec.call(this,"Transporter","getAsBlob",e);return r?new t(n.uid,r):null;}};return e.Transporter=n;}),r(Y,[X,a,L,y,N],function(e,t,n,r,i){var s={loadFromBlob:function loadFromBlob(e){function t(e){i.shimExec.call(r,"Image","loadFromBlob",e.uid),r=i=null;}var r=this,i=r.getRuntime();if(e.isDetached()){var s=new n();s.bind("TransportingComplete",function(){t(s.result.getSource());}),s.transport(e.getSource(),e.type,{ruid:i.uid});}else t(e.getSource());},loadFromImage:function loadFromImage(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid);},getAsBlob:function getAsBlob(e,t){var n=this.getRuntime(),i=n.shimExec.call(this,"Image","getAsBlob",e,t);return i?new r(n.uid,i):null;},getAsDataURL:function getAsDataURL(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),n;return t?(n=new i(),n.readAsDataURL(t)):null;}};return e.Image=s;}),r(Z,[a,c,h,p,m],function(e,t,n,r,i){function s(e){var t=!1,n=null,r,i,s,o,u,a=0;try{try{n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported(e)&&(t=!0),n=null;}catch(f){var l=navigator.plugins["Silverlight Plug-In"];if(l){for(r=l.description,"1.0.30226.2"===r&&(r="2.0.30226.2"),i=r.split(".");i.length>3;){i.pop();}for(;i.length<4;){i.push(0);}for(s=e.split(".");s.length>4;){s.pop();}do{o=parseInt(s[a],10),u=parseInt(i[a],10),a++;}while(a<s.length&&o===u);u>=o&&!isNaN(o)&&(t=!0);}}}catch(c){t=!1;}return t;}function o(o){var f=this,l;o=e.extend({xap_url:t.xap_url},o),i.call(this,o,u,{access_binary:i.capTrue,access_image_binary:i.capTrue,display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:i.capTrue,resize_image:i.capTrue,return_response_headers:function return_response_headers(e){return e&&"client"===f.mode;},return_response_type:function return_response_type(e){return"json"!==e?!0:!!window.JSON;},return_status_code:function return_status_code(t){return"client"===f.mode||!e.arrayDiff(t,[200,404]);},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:i.capTrue,send_browser_cookies:function send_browser_cookies(e){return e&&"browser"===f.mode;},send_custom_headers:function send_custom_headers(e){return e&&"client"===f.mode;},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:i.capTrue,use_http_method:function use_http_method(t){return"client"===f.mode||!e.arrayDiff(t,["GET","POST"]);}},{return_response_headers:function return_response_headers(e){return e?"client":"browser";},return_status_code:function return_status_code(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"];},send_browser_cookies:function send_browser_cookies(e){return e?"browser":"client";},send_custom_headers:function send_custom_headers(e){return e?"client":"browser";},use_http_method:function use_http_method(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"];}}),s("2.0.31005.0")&&"Opera"!==t.browser||(this.mode=!1),e.extend(this,{getShim:function getShim(){return n.get(this.uid).content.Moxie;},shimExec:function shimExec(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,n);},init:function init(){var e;e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+o.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/>'+"</object>",l=setTimeout(function(){f&&!f.initialized&&f.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR));},"Windows"!==t.OS?1e4:5e3);},destroy:function(e){return function(){e.call(f),clearTimeout(l),o=l=e=f=null;};}(this.destroy)},a);}var u="silverlight",a={};return i.addConstructor(u,o),a;}),r(et,[Z,a,V],function(e,t,n){return e.Blob=t.extend({},n);}),r(tt,[Z],function(e){var t={init:function init(e){function t(e){for(var t="",n=0;n<e.length;n++){t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");}return t;}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple),this.trigger("ready");}};return e.FileInput=t;}),r(nt,[Z,h,_],function(e,t,n){var r={init:function init(){var e=this,r=e.getRuntime(),i;return i=r.getShimContainer(),n.addEvent(i,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy";},e.uid),n.addEvent(i,"dragenter",function(e){e.preventDefault();var n=t.get(r.uid).dragEnter(e);n&&e.stopPropagation();},e.uid),n.addEvent(i,"drop",function(e){e.preventDefault();var n=t.get(r.uid).dragDrop(e);n&&e.stopPropagation();},e.uid),r.shimExec.call(this,"FileDrop","init");}};return e.FileDrop=r;}),r(rt,[Z,a,J],function(e,t,n){return e.FileReader=t.extend({},n);}),r(it,[Z,a,K],function(e,t,n){return e.FileReaderSync=t.extend({},n);}),r(st,[Z,a,Q],function(e,t,n){return e.XMLHttpRequest=t.extend({},n);}),r(ot,[Z,a,G],function(e,t,n){return e.Transporter=t.extend({},n);}),r(ut,[Z,a,Y],function(e,t,n){return e.Image=t.extend({},n,{getInfo:function getInfo(){var e=this.getRuntime(),n=["tiff","exif","gps"],r={meta:{}},i=e.shimExec.call(this,"Image","getInfo");return i.meta&&t.each(n,function(e){var t=i.meta[e],n,s,o,u;if(t&&t.keys)for(r.meta[e]={},s=0,o=t.keys.length;o>s;s++){n=t.keys[s],u=t[n],u&&(/^(\d|[1-9]\d+)$/.test(u)?u=parseInt(u,10):/^\d*\.\d+$/.test(u)&&(u=parseFloat(u)),r.meta[e][n]=u);}}),r.width=parseInt(i.width,10),r.height=parseInt(i.height,10),r.size=parseInt(i.size,10),r.type=i.type,r.name=i.name,r;}});}),r(at,[a,p,m,c],function(e,t,n,r){function i(t){var i=this,u=n.capTest,a=n.capTrue;n.call(this,t,s,{access_binary:u(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:u(o.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:u(function(){return"Chrome"===r.browser&&r.version>=28||"IE"===r.browser&&r.version>=10;}()),resize_image:function resize_image(){return o.Image&&i.can("access_binary")&&r.can("create_canvas");},report_upload_progress:!1,return_response_headers:!1,return_response_type:function return_response_type(t){return"json"===t&&window.JSON?!0:!!~e.inArray(t,["text","document",""]);},return_status_code:function return_status_code(t){return!e.arrayDiff(t,[200,404]);},select_file:function select_file(){return r.can("use_fileinput");},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function stream_upload(){return i.can("select_file");},summon_file_dialog:u(function(){return"Firefox"===r.browser&&r.version>=4||"Opera"===r.browser&&r.version>=12||!!~e.inArray(r.browser,["Chrome","Safari"]);}()),upload_filesize:a,use_http_method:function use_http_method(t){return!e.arrayDiff(t,["GET","POST"]);}}),e.extend(this,{init:function init(){this.trigger("Init");},destroy:function(e){return function(){e.call(i),e=i=null;};}(this.destroy)}),e.extend(this.getShim(),o);}var s="html4",o={};return n.addConstructor(s,i),o;}),r(ft,[at,a,h,_,l,c],function(e,t,n,r,i,s){function o(){function e(){var i=this,l=i.getRuntime(),c,h,p,d,v,m;m=t.guid("uid_"),c=l.getShimContainer(),o&&(p=n.get(o+"_form"),p&&t.extend(p.style,{top:"100%"})),d=document.createElement("form"),d.setAttribute("id",m+"_form"),d.setAttribute("method","post"),d.setAttribute("enctype","multipart/form-data"),d.setAttribute("encoding","multipart/form-data"),t.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),v=document.createElement("input"),v.setAttribute("id",m),v.setAttribute("type","file"),v.setAttribute("name",f.name||"Filedata"),v.setAttribute("accept",a.join(",")),t.extend(v.style,{fontSize:"999px",opacity:0}),d.appendChild(v),c.appendChild(d),t.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===s.browser&&s.version<10&&t.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),v.onchange=function(){var t;this.value&&(t=this.files?this.files[0]:{name:this.value},u=[t],this.onchange=function(){},e.call(i),i.bind("change",function r(){var e=n.get(m),t=n.get(m+"_form"),s;i.unbind("change",r),i.files.length&&e&&t&&(s=i.files[0],e.setAttribute("id",s.uid),t.setAttribute("id",s.uid+"_form"),t.setAttribute("target",s.uid+"_iframe")),e=t=null;},998),v=d=null,i.trigger("change"));},l.can("summon_file_dialog")&&(h=n.get(f.browse_button),r.removeEvent(h,"click",i.uid),r.addEvent(h,"click",function(e){v&&!v.disabled&&v.click(),e.preventDefault();},i.uid)),o=m,c=p=h=null;}var o,u=[],a=[],f;t.extend(this,{init:function init(t){var s=this,o=s.getRuntime(),u;f=t,a=t.accept.mimes||i.extList2mimes(t.accept,o.can("filter_by_extension")),u=o.getShimContainer(),function(){var e,i,a;e=n.get(t.browse_button),o.can("summon_file_dialog")&&("static"===n.getStyle(e,"position")&&(e.style.position="relative"),i=parseInt(n.getStyle(e,"z-index"),10)||1,e.style.zIndex=i,u.style.zIndex=i-1),a=o.can("summon_file_dialog")?e:u,r.addEvent(a,"mouseover",function(){s.trigger("mouseenter");},s.uid),r.addEvent(a,"mouseout",function(){s.trigger("mouseleave");},s.uid),r.addEvent(a,"mousedown",function(){s.trigger("mousedown");},s.uid),r.addEvent(n.get(t.container),"mouseup",function(){s.trigger("mouseup");},s.uid),e=null;}(),e.call(this),u=null,s.trigger({type:"ready",async:!0});},getFiles:function getFiles(){return u;},disable:function disable(e){var t;(t=n.get(o))&&(t.disabled=!!e);},destroy:function destroy(){var e=this.getRuntime(),t=e.getShim(),i=e.getShimContainer();r.removeAllEvents(i,this.uid),r.removeAllEvents(f&&n.get(f.container),this.uid),r.removeAllEvents(f&&n.get(f.browse_button),this.uid),i&&(i.innerHTML=""),t.removeInstance(this.uid),o=u=a=f=i=t=null;}});}return e.FileInput=o;}),r(lt,[at,H],function(e,t){return e.FileReader=t;}),r(ct,[at,a,h,T,p,_,y,C],function(e,t,n,r,i,s,o,u){function a(){function e(e){var t=this,r,i,o,u,a=!1;if(l){if(r=l.id.replace(/_iframe$/,""),i=n.get(r+"_form")){for(o=i.getElementsByTagName("input"),u=o.length;u--;){switch(o[u].getAttribute("type")){case"hidden":o[u].parentNode.removeChild(o[u]);break;case"file":a=!0;}}o=[],a||i.parentNode.removeChild(i),i=null;}setTimeout(function(){s.removeEvent(l,"load",t.uid),l.parentNode&&l.parentNode.removeChild(l);var n=t.getRuntime().getShimContainer();n.children.length||n.parentNode.removeChild(n),n=l=null,e();},1);}}var a,f,l;t.extend(this,{send:function send(c,h){function p(){var n=v.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+m+'_iframe" name="'+m+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',l=i.firstChild,n.appendChild(l),s.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?a=n.title.replace(/^(\d+).*$/,"$1"):(a=200,f=t.trim(n.body.innerHTML),d.trigger({type:"progress",loaded:f.length,total:f.length}),b&&d.trigger({type:"uploadprogress",loaded:b.size||1025,total:b.size||1025}));}catch(i){if(!r.hasSameOrigin(c.url))return e.call(d,function(){d.trigger("error");}),void 0;a=404;}e.call(d,function(){d.trigger("load");});},d.uid);}var d=this,v=d.getRuntime(),m,g,y,b;if(a=f=null,h instanceof u&&h.hasBlob()){if(b=h.getBlob(),m=b.uid,y=n.get(m),g=n.get(m+"_form"),!g)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);}else m=t.guid("uid_"),g=document.createElement("form"),g.setAttribute("id",m+"_form"),g.setAttribute("method",c.method),g.setAttribute("enctype","multipart/form-data"),g.setAttribute("encoding","multipart/form-data"),g.setAttribute("target",m+"_iframe"),v.getShimContainer().appendChild(g);h instanceof u&&h.each(function(e,n){if(e instanceof o)y&&y.setAttribute("name",n);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:n,value:e}),y?g.insertBefore(r,y):g.appendChild(r);}}),g.setAttribute("action",c.url),p(),g.submit(),d.trigger("loadstart");},getStatus:function getStatus(){return a;},getResponse:function getResponse(e){if("json"===e&&"string"===t.typeOf(f)&&window.JSON)try{return JSON.parse(f.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""));}catch(n){return null;}return f;},abort:function abort(){var t=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank"),e.call(this,function(){t.dispatchEvent("abort");});}});}return e.XMLHttpRequest=a;}),r(ht,[at,W],function(e,t){return e.Image=t;}),o([a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,_]);}(void 0),function(){"use strict";var e={},t=moxie.core.utils.Basic.inArray;return function n(r){var i,s;for(i in r){s=_typeof(r[i]),s==="object"&&!~t(i,["Exceptions","Env","Mime"])?n(r[i]):s==="function"&&(e[i]=r[i]);}}(window.moxie),e.Env=window.moxie.core.utils.Env,e.Mime=window.moxie.core.utils.Mime,e.Exceptions=window.moxie.core.Exceptions,window.mOxie=e,window.o||(window.o=e),e;}(),function(e,t,n){function r(e){function t(e,t,n){var i={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};i[e]?r[i[e]]=t:n||(r[e]=t);}var n=e.required_features,r={};return typeof n=="string"?o.each(n.split(/\s*,\s*/),function(e){t(e,!0);}):_typeof(n)=="object"?o.each(n,function(e,n){t(n,e);}):n===!0&&(e.multipart||(r.send_binary_string=!0),e.chunk_size>0&&(r.slice_blob=!0),e.resize.enabled&&(r.send_binary_string=!0),o.each(e,function(e,n){t(n,!!e,!0);})),r;}var i=e.setTimeout,s={},o={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function get(e){var n=[],r;t.typeOf(e)!=="array"&&(e=[e]);var i=e.length;while(i--){r=t.get(e[i]),r&&n.push(r);}return n.length?n:null;},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function xmlEncode(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e;}):e;},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function cleanName(e){var t,n;n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(t=0;t<n.length;t+=2){e=e.replace(n[t],n[t+1]);}return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,""),e;},buildUrl:function buildUrl(e,t){var n="";return o.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e);}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e;},formatSize:function formatSize(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t);}if(e===n||/\D/.test(e))return o.translate("N/A");var r=Math.pow(1024,4);return e>r?t(e/r,1)+" "+o.translate("tb"):e>(r/=1024)?t(e/r,1)+" "+o.translate("gb"):e>(r/=1024)?t(e/r,1)+" "+o.translate("mb"):e>1024?Math.round(e/1024)+" "+o.translate("kb"):e+" "+o.translate("b");},parseSize:t.parseSizeStr,predictRuntime:function predictRuntime(e,n){var r,i;return r=new o.Uploader(e),i=t.Runtime.thatCan(r.getOption().required_features,n||e.runtimes),r.destroy(),i;},addFileFilter:function addFileFilter(e,t){s[e]=t;}};o.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:o.FILE_EXTENSION_ERROR,message:o.translate("File extension error."),file:t}),n(!1)):n(!0);}),o.addFileFilter("max_file_size",function(e,t,n){var r;e=o.parseSize(e),t.size!==r&&e&&t.size>e?(this.trigger("Error",{code:o.FILE_SIZE_ERROR,message:o.translate("File size error."),file:t}),n(!1)):n(!0);}),o.addFileFilter("prevent_duplicates",function(e,t,n){if(e){var r=this.files.length;while(r--){if(t.name===this.files[r].name&&t.size===this.files[r].size){this.trigger("Error",{code:o.FILE_DUPLICATE_ERROR,message:o.translate("Duplicate file error."),file:t}),n(!1);return;}}}n(!0);}),o.Uploader=function(e){function u(){var e,t=0,n;if(this.state==o.STARTED){for(n=0;n<k.length;n++){!e&&k[n].status==o.QUEUED?(e=k[n],this.trigger("BeforeUpload",e)&&(e.status=o.UPLOADING,this.trigger("UploadFile",e))):t++;}t==k.length&&(this.state!==o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",k));}}function a(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,f();}function f(){var e,t;_.reset();for(e=0;e<k.length;e++){t=k[e],t.size!==n?(_.size+=t.origSize,_.loaded+=t.loaded*t.origSize/t.size):_.size=n,t.status==o.DONE?_.uploaded++:t.status==o.FAILED?_.failed++:_.queued++;}_.size===n?_.percent=k.length>0?Math.ceil(_.uploaded/k.length*100):0:(_.bytesPerSec=Math.ceil(_.loaded/((+new Date()-M||1)/1e3)),_.percent=_.size>0?Math.ceil(_.loaded/_.size*100):0);}function l(){var e=A[0]||O[0];return e?e.getRuntime().uid:!1;}function c(e,n){if(e.ruid){var r=t.Runtime.getInfo(e.ruid);if(r)return r.can(n);}return!1;}function h(){this.bind("FilesAdded",m),this.bind("CancelUpload",E),this.bind("BeforeUpload",g),this.bind("UploadFile",y),this.bind("UploadProgress",b),this.bind("StateChanged",w),this.bind("QueueChanged",f),this.bind("Error",x),this.bind("FileUploaded",S),this.bind("Destroy",T);}function p(e,n){var r=this,i=0,s=[],u={accept:e.filters.mime_types,runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:L,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};o.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(u[t]=e[t]);}),e.browse_button&&o.each(e.browse_button,function(n){s.push(function(s){var a=new t.FileInput(o.extend({},u,{name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));a.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),i++,A.push(this),s();},a.onchange=function(){r.addFile(this.files);},a.bind("mouseenter mouseleave mousedown mouseup",function(r){D||(e.browse_button_hover&&("mouseenter"===r.type?t.addClass(n,e.browse_button_hover):"mouseleave"===r.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===r.type?t.addClass(n,e.browse_button_active):"mouseup"===r.type&&t.removeClass(n,e.browse_button_active)));}),a.bind("error runtimeerror",function(){a=null,s();}),a.init();});}),e.drop_element&&o.each(e.drop_element,function(e){s.push(function(n){var s=new t.FileDrop(o.extend({},u,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);r.features.dragdrop=e.can("drag_and_drop"),i++,O.push(this),n();},s.ondrop=function(){r.addFile(this.files);},s.bind("error runtimeerror",function(){s=null,n();}),s.init();});}),t.inSeries(s,function(){typeof n=="function"&&n(i);});}function d(e,n,r){var i=new t.Image();try{i.onload=function(){i.downsize(n.width,n.height,n.crop,n.preserve_headers);},i.onresize=function(){r(this.getAsBlob(e.type,n.quality)),this.destroy();},i.onerror=function(){r(e);},i.load(e);}catch(s){r(e);}}function v(e,n,i){function s(e,t,n){var r=C[e];switch(e){case"max_file_size":e==="max_file_size"&&(C.max_file_size=C.filters.max_file_size=t);break;case"chunk_size":if(t=o.parseSize(t))C[e]=t;break;case"filters":o.typeOf(t)==="array"&&(t={mime_types:t}),n?o.extend(C.filters,t):C.filters=t,t.mime_types&&(C.filters.mime_types.regexp=function(e){var t=[];return o.each(e,function(e){o.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"));});}),new RegExp("("+t.join("|")+")$","i");}(C.filters.mime_types));break;case"resize":n?o.extend(C.resize,t,{enabled:!0}):C.resize=t;break;case"prevent_duplicates":C.prevent_duplicates=C.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=o.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":C[e]=t,n||(a=!0);break;default:C[e]=t;}n||u.trigger("OptionChanged",e,t,r);}var u=this,a=!1;_typeof(e)=="object"?o.each(e,function(e,t){s(t,e,i);}):s(e,n,i),i?(C.required_features=r(o.extend({},C)),L=r(o.extend({},C,{required_features:!0}))):a&&(u.trigger("Destroy"),p.call(u,C,function(e){e?(u.runtime=t.Runtime.getInfo(l()).type,u.trigger("Init",{runtime:u.runtime}),u.trigger("PostInit")):u.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")});}));}function m(e,t){[].push.apply(k,t),e.trigger("QueueChanged"),e.refresh();}function g(e,t){if(C.unique_names){var n=t.name.match(/\.([^.]+)$/),r="part";n&&(r=n[1]),t.target_name=t.id+"."+r;}}function y(e,n){function r(){f-->0?i(s,1e3):(n.loaded=h,e.trigger("Error",{code:o.HTTP_ERROR,message:o.translate("HTTP Error."),file:n,response:P.responseText,status:P.status,responseHeaders:P.getAllResponseHeaders()}));}function s(){var c,d,v,m;if(n.status==o.DONE||n.status==o.FAILED||e.state==o.STOPPED)return;v={name:n.target_name||n.name},a&&l.chunks&&p.size>a?(m=Math.min(a,p.size-h),c=p.slice(h,h+m)):(m=p.size,c=p),a&&l.chunks&&(e.settings.send_chunk_number?(v.chunk=Math.ceil(h/a),v.chunks=Math.ceil(p.size/a)):(v.offset=h,v.total=p.size)),P=new t.XMLHttpRequest(),P.upload&&(P.upload.onprogress=function(t){n.loaded=Math.min(n.size,h+t.loaded),e.trigger("UploadProgress",n);}),P.onload=function(){if(P.status>=400){r();return;}f=e.settings.max_retries,m<p.size?(c.destroy(),h+=m,n.loaded=Math.min(h,p.size),e.trigger("ChunkUploaded",n,{offset:n.loaded,total:p.size,response:P.responseText,status:P.status,responseHeaders:P.getAllResponseHeaders()}),t.Env.browser==="Android Browser"&&e.trigger("UploadProgress",n)):n.loaded=n.size,c=d=null,!h||h>=p.size?(n.size!=n.origSize&&(p.destroy(),p=null),e.trigger("UploadProgress",n),n.status=o.DONE,e.trigger("FileUploaded",n,{response:P.responseText,status:P.status,responseHeaders:P.getAllResponseHeaders()})):i(s,1);},P.onerror=function(){r();},P.onloadend=function(){this.destroy(),P=null;},e.settings.multipart&&l.multipart?(v.name=n.target_name||n.name,P.open("post",u,!0),o.each(e.settings.headers,function(e,t){P.setRequestHeader(t,e);}),d=new t.FormData(),o.each(o.extend(v,e.settings.multipart_params),function(e,t){d.append(t,e);}),d.append(e.settings.file_data_name,c),P.send(d,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:L,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(u=o.buildUrl(e.settings.url,o.extend(v,e.settings.multipart_params)),P.open("post",u,!0),P.setRequestHeader("Content-Type","application/octet-stream"),o.each(e.settings.headers,function(e,t){P.setRequestHeader(t,e);}),P.send(c,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:L,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url}));}var u=e.settings.url,a=e.settings.chunk_size,f=e.settings.max_retries,l=e.features,h=0,p;n.loaded&&(h=n.loaded=a*Math.floor(n.loaded/a)),p=n.getSource(),e.settings.resize.enabled&&c(p,"send_binary_string")&&!!~t.inArray(p.type,["image/jpeg","image/png"])?d.call(this,p,e.settings.resize,function(e){p=e,n.size=e.size,s();}):s();}function b(e,t){a(t);}function w(e){if(e.state==o.STARTED)M=+new Date();else if(e.state==o.STOPPED)for(var t=e.files.length-1;t>=0;t--){e.files[t].status==o.UPLOADING&&(e.files[t].status=o.QUEUED,f());}}function E(){P&&P.abort();}function S(e){f(),i(function(){u.call(e);},1);}function x(e,t){t.file&&(t.file.status=o.FAILED,a(t.file),e.state==o.STARTED&&(e.trigger("CancelUpload"),i(function(){u.call(e);},1)));}function T(e){e.stop(),o.each(k,function(e){e.destroy();}),k=[],A.length&&(o.each(A,function(e){e.destroy();}),A=[]),O.length&&(o.each(O,function(e){e.destroy();}),O=[]),L={},D=!1,M=P=null,_.reset();}var N=o.guid(),C,k=[],L={},A=[],O=[],M,_,D=!1,P;C={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0},v.call(this,e,null,!0),_=new o.QueueProgress(),o.extend(this,{id:N,uid:N,state:o.STOPPED,features:{},runtime:null,files:k,settings:C,total:_,init:function init(){var e=this;typeof C.preinit=="function"?C.preinit(e):o.each(C.preinit,function(t,n){e.bind(n,t);});if(!C.browse_button||!C.url){this.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")});return;}h.call(this),p.call(this,C,function(n){typeof C.init=="function"?C.init(e):o.each(C.init,function(t,n){e.bind(n,t);}),n?(e.runtime=t.Runtime.getInfo(l()).type,e.trigger("Init",{runtime:e.runtime}),e.trigger("PostInit")):e.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")});});},setOption:function setOption(e,t){v.call(this,e,t,!this.runtime);},getOption:function getOption(e){return e?C[e]:C;},refresh:function refresh(){A.length&&o.each(A,function(e){e.trigger("Refresh");}),this.trigger("Refresh");},start:function start(){this.state!=o.STARTED&&(this.state=o.STARTED,this.trigger("StateChanged"),u.call(this));},stop:function stop(){this.state!=o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"));},disableBrowse:function disableBrowse(){D=arguments[0]!==n?arguments[0]:!0,A.length&&o.each(A,function(e){e.disable(D);}),this.trigger("DisableBrowse",D);},getFile:function getFile(e){var t;for(t=k.length-1;t>=0;t--){if(k[t].id===e)return k[t];}},addFile:function addFile(e,n){function r(e,n){var r=[];t.each(a.settings.filters,function(t,n){s[n]&&r.push(function(r){s[n].call(a,t,e,function(e){r(!e);});});}),t.inSeries(r,n);}function u(e){var s=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!h)return!1;e.ruid=h,e.connectRuntime(h);}u(new o.File(e));}else e instanceof t.Blob?(u(e.getSource()),e.destroy()):e instanceof o.File?(n&&(e.name=n),f.push(function(t){r(e,function(n){n||(c.push(e),a.trigger("FileFiltered",e)),i(t,1);});})):t.inArray(s,["file","blob"])!==-1?u(new t.File(null,e)):s==="node"&&t.typeOf(e.files)==="filelist"?t.each(e.files,u):s==="array"&&(n=null,t.each(e,u));}var a=this,f=[],c=[],h;h=l(),u(e),f.length&&t.inSeries(f,function(){c.length&&a.trigger("FilesAdded",c);});},removeFile:function removeFile(e){var t=typeof e=="string"?e:e.id;for(var n=k.length-1;n>=0;n--){if(k[n].id===t)return this.splice(n,1)[0];}},splice:function splice(e,t){var r=k.splice(e===n?0:e,t===n?k.length:t),i=!1;return this.state==o.STARTED&&(i=!0,this.stop()),this.trigger("FilesRemoved",r),o.each(r,function(e){e.destroy();}),this.trigger("QueueChanged"),this.refresh(),i&&this.start(),r;},bind:function bind(e,t,n){var r=this;o.Uploader.prototype.bind.call(this,e,function(){var e=[].slice.call(arguments);return e.splice(0,1,r),t.apply(this,e);},0,n);},destroy:function destroy(){this.trigger("Destroy"),C=_=null,this.unbindAll();}});},o.Uploader.prototype=t.EventTarget.instance,o.File=function(){function e(e){o.extend(this,{id:o.guid(),name:e.name||e.fileName,type:e.type||"",size:e.size||e.fileSize,origSize:e.size||e.fileSize,loaded:0,percent:0,status:o.QUEUED,lastModifiedDate:e.lastModifiedDate||new Date().toLocaleString(),getNative:function getNative(){var e=this.getSource().getSource();return t.inArray(t.typeOf(e),["blob","file"])!==-1?e:null;},getSource:function getSource(){return n[this.id]?n[this.id]:null;},destroy:function destroy(){var e=this.getSource();e&&(e.destroy(),delete n[this.id]);}}),n[this.id]=e;}var n={};return e;}(),o.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0;};},e.plupload=o;}(window,mOxie),define("plupload",["jquery"],function(e){return function(){var t,n;return t||e.Plupload;};}(void 0)),define("videoLoader",["require","jquery","urls","tools","events","gallery","plupload","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("events"),s=e("gallery");e("plupload");var o=function o(_o3){var u=this,a=t.extend({maxFileSize:"100mb",extensions:"mp4",preventDuplicates:!0,multiSelection:!0,dragdrop:!0,templateResultsId:"#template_VideoLoaderResults",gapEl:"div.video-gap",buttonRemove:"a.js-remove-video",linkOpenArchive:"a.js-link-open-archive",classDragover:"dragover",classAddedVideo:"with-video",classVideoLoaded:"is-loaded",classErrorLoading:"with-error"},_o3||{}),f=e("templates.storage").get(a.templateResultsId);t.extend(this,{initialize:function initialize(){this.$container=t(a.containerEl);if(!a.buttonBrowse||!this.$container.length)return;this.initUploader(),this.initButtonRemove();},initUploader:function initUploader(){var e={browse_button:a.buttonBrowse,url:n.get("uploadVideo"),multipart_params:a.additionalParams||{},multi_selection:a.multiSelection,headers:{"X-Requested-With":"XMLHttpRequest"},filters:{mime_types:[{title:"Video files",extensions:a.extensions}],max_file_size:a.maxFileSize,prevent_duplicates:a.preventDuplicates}};a.dragdrop&&(e.drop_element=this.$container[0]),this.uploader=new plupload.Uploader(e),this.uploader.init(),this.uploader.bind("Init",function(e){r.is(a.onInit).fn()&&a.onInit(e),u.uploader.features.dragdrop&&u.$container.on("dragenter",function(){u.isDragging||(u.isDragging=!0,u.$container.addClass(a.classDragover));}).on("dragleave",function(e){e.relatedTarget!=u.$container[0]&&!t(e.relatedTarget).parents(a.containerEl).length&&(u.isDragging=!1,u.$container.removeClass(a.classDragover));}).on("drop",function(e){u.isDragging=!1,u.$container.removeClass(a.classDragover);});}),this.uploader.bind("FilesAdded",function(e){if(!a.multiSelection)while(e.files.length>1){e.removeFile(e.files[0]);}if(r.is(a.onFilesAdded).fn()&&a.onFilesAdded(e)===!1)return!1;u.gallery&&(u.gallery.destroy(),u.gallery=null),u.$container.addClass(a.classAddedVideo),a.buttonLoad||u.uploader.start();}),this.uploader.bind("BeforeUpload",function(e){u.$container.removeClass(a.classErrorLoading);if(r.is(a.onBeforeLoad).fn()&&a.onBeforeLoad(e)===!1)return!1;u.state="loading",u.render("loading",{Percent:0,Filename:e.files[0].name});}),this.uploader.bind("UploadProgress",function(e,t){u.state==="loading"&&(t.percent==100?(u.state="loaded",u.render("processing",{Filename:e.files[0].name})):u.render("loading",{Percent:t.percent,Filename:e.files[0].name}));}),this.uploader.bind("FileUploaded",function(e,t,n){n.responseHeaders.indexOf("X-Unauthorized: True")!==-1&&window.location.reload();var r=JSON.parse(n.response);r.Errors?(u.$container.addClass(a.classErrorLoading),u.render("error",r.Errors),u.initErrorsControls(),u.runCallback("onError")):(u.$container.addClass(a.classVideoLoaded),u.gallery=new s({container:u.$container.find(">div:first"),thumbnailUrls:r.thumbnailUrls,videoUrl:r.videoUrl,videoLength:r.videoLengthInSeconds,videoSize:r.videoSize}),u.runCallback("onAfterLoad",r));}),this.uploader.bind("Error",function(e,t){if(t.code==-602)return;var n=t.message;t.code==-600&&(n="   100"),u.render("error",{errorText:n}),u.$container.addClass(a.classErrorLoading),u.runCallback("onError"),r.is(a.onBeforeLoad).fn()&&a.onBeforeLoad();}),a.buttonLoad&&t("#"+a.buttonLoad).click(function(){u.uploader.start();});},render:function render(e,n){var r=t.extend({state:e},n||{});this.$container.find(">div:first").html(f(r));},initErrorsControls:function initErrorsControls(){this.$container.find(a.linkOpenArchive).click(function(e){e.stopPropagation(),t("html, body").animate({scrollTop:0},250),i.trigger("archive:showTooltip",{tab:1});});},renderByData:function renderByData(e){u.$container.addClass(a.classAddedVideo).addClass(a.classVideoLoaded),u.gallery=new s({container:u.$container.find(">div:first"),thumbnailUrls:e.thumbnailUrls,videoUrl:e.videoUrl,videoLength:e.videoLengthInSeconds,videoSize:e.videoSize}),u.runCallback("onAfterLoad",e);},runCallback:function runCallback(e,t){r.is(a[e]).fn()&&a[e](t);},initButtonRemove:function initButtonRemove(){this.$buttonRemove=this.$container.find(a.buttonRemove),this.$buttonRemove.length&&this.$buttonRemove.click(function(){return u.uploader.stop(),u.uploader.destroy(),u.runCallback("onRemove"),!1;});}}),this.initialize();};return function(e){return new o(e);};}),define("campaign.create.form.video",["require","jquery","tools","timePicker","videoLoader","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("timePicker"),i=e("videoLoader"),s=function s(_s6,o){var u=this,a={videoList:".js-video-list",videoContainer:"#videoStream",videoNumber:".js-video-number",buttonLoadVideo:"browseVideo",adVideoLengthSwitch:"#adVideoLengthSwitch",adVideoLength:"#adVideoLength",adVideoLengthCont:"div.js-adVideoLengthCont"},f={unselected:"unselected",notSortable:"js-not-sortable",notClickable:"not-clickable"},l=e("templates.storage").get("#template_video_item"),c=1;t.extend(this,{initialize:function initialize(){this.initVideoLoader(),this.initUploadedVideos(),this.initVideoSwitcher(),this.initTimePicker();},initVideoLoader:function initVideoLoader(){this.$videoList=_s6.find(a.videoList).sortable({placeholder:"ui-state-highlight",cancel:"."+f.notSortable,start:function start(e,t){t.item.addClass(f.notClickable);},stop:function stop(e,t){setTimeout(function(){t.item.removeClass(f.notClickable);},300);},update:function update(){u.setVideosData(n.object(o.get("Videos")).clone()),u.updateVideoNumbers();}}),this.$videoContainer=t(a.videoContainer),i({containerEl:a.videoContainer,buttonBrowse:a.buttonLoadVideo,onFilesAdded:function onFilesAdded(e){return u.renderVideoBlocks(n.list(e.files).clone()),setTimeout(function(){while(e.files.length>0){e.removeFile(e.files[0]);}},500),!1;}});},initUploadedVideos:function initUploadedVideos(){var e=o.get("VideosData");e&&e.length&&n.list(e).each(function(e){var n=t(l({Index:c++,Number:u.$videoList.find(">div").length+1}));u.$videoList.append(n),u.initLoadingVideo(n,null,e);});},updateVideoNumbers:function updateVideoNumbers(){n.list(this.$videoList.find(">div")).each(function(e,n){t(e).find(a.videoNumber).text(n+1+".");});},renderVideoBlocks:function renderVideoBlocks(e){n.list(e).each(function(e){var n=t(l({Index:c++,Number:u.$videoList.find(">div").length+1}));u.$videoList.append(n),u.initLoadingVideo(n,e);});},initLoadingVideo:function initLoadingVideo(e,t,r){function l(t,r){var i=n.object(o.get("Videos")).clone();t.id=r.videoId,i[t.id]=r.videoLengthInSeconds,e.removeClass(f.notSortable).data("video-id",t.id),u.setVideosData(i);}var s=e.data("index"),c=i({containerEl:a.videoContainer+s,buttonBrowse:a.buttonLoadVideo+s,multiSelection:!1,dragdrop:!1,additionalParams:{inac:!0},onInit:function onInit(e){t?e.addFile(t):r&&(c.renderByData(r),l(c,r));},onBeforeLoad:function onBeforeLoad(){u.$adVideoLengthSwitch.removeAttr("checked").change();},onAfterLoad:function onAfterLoad(e){l(c,e);},onError:function onError(){},onRemove:function onRemove(){e.remove();if(c.id){var t=n.object(o.get("Videos")).clone();delete t[c.id],u.setVideosData(t);}u.updateVideoNumbers();}});},setVideosData:function setVideosData(e){var r,i,s={Videos:e,VideoIds:[]};n.list(this.$videoList.find(">div:not(."+f.notSortable+")")).each(function(o){i=t(o).data("video-id"),r!=""&&(n.is(r).defined()?r!=e[i]&&(r=""):r=e[i]),s.VideoIds.push(i);}),s.VideoLengthByVideo=r,o.set(s);},initVideoSwitcher:function initVideoSwitcher(){this.$adVideoLengthSwitch=t(a.adVideoLengthSwitch);if(this.$adVideoLengthSwitch.length){var _r4=function _r4(){u.$videoContainer[o.get("IsVideoSelected")?"removeClass":"addClass"](f.unselected);};var e=o.get("VideoIds"),n=o.get("VideoLengthInSeconds");o.on("change:Videos",function(e,n){t.isEmptyObject(n)?u.$adVideoLengthSwitch.prop("disabled",!1).change():u.$adVideoLengthSwitch.removeAttr("checked").prop("disabled",!0).change();}).on("change:IsVideoSelected",function(e,t){_r4();}),_r4(),this.$adVideoLengthSwitch.prop("disabled",!!e.length),this.$adVideoLengthSwitch.prop("checked",!e.length&&!!n),this.$adVideoLengthSwitch.change().change(function(){o.set("IsVideoSelected",!t(this).is(":checked"));});}},initTimePicker:function initTimePicker(){var e=t(a.adVideoLength);if(e.length){var n=o.get("VideoIds"),i=o.get("VideoLengthInSeconds"),s=n.length>0||i==="",u=new r(e,{defaultTime:i?i:null,onComplete:function onComplete(e){o.set("VideoLengthByUser",e);},onIncomplete:function onIncomplete(){o.set("VideoLengthByUser","");}});u[s?"disable":"enable"](),o.on("change:IsVideoSelected",function(e,t){u[t?"disable":"enable"]();}).on("change:VideoLengthByVideo",function(e,t){u.setTime(t);});}}}),this.initialize();};return function(e,t){new s(e,t);};}),define("campaign.create.form.maxGpsShowCount",["require","jquery","campaign.create.formHelpers"],function(e){"use strict";var t=e("jquery"),n=e("campaign.create.formHelpers"),r=function r(e,_r5){var i={modelParamName:"MaxGpsShowCountInArea",inputEl:"input:radio[name=showCount]",containerEl:"div.js-show-count",classIsHidden:"is-hidden"};t.extend(this,{initialize:function initialize(){var t=e.find(i.inputEl),s=e.find(i.containerEl);t.on("change",function(){_r5.set(i.modelParamName,t.filter(":checked").val());}).filter("[value="+_r5.get(i.modelParamName)+"]").prop("checked",!0).change(),n.showHideBlock(s,_r5.get("AdsCampaignType")!=="0"),_r5.on("change:AdsCampaignType",function(e,t){n.showHideBlock(s,t!=="0");});}}),this.initialize();};return function(e,t){new r(e,t);};}),define("campaign.create.form.name",["require","jquery","tools"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=function r(e,_r6){var i={name:"#adName"};t.extend(this,{initialize:function initialize(){var t=e.find(i.name).val(_r6.get("Title")).on("keyup",function(){_r6.setSimple("Title",n.string(t.val()).trim());});}}),this.initialize();};return function(e,t){new r(e,t);};}),define("campaign.create.form.type",["require","jquery","campaign.create.formHelpers"],function(e){"use strict";var t=e("jquery"),n=e("campaign.create.formHelpers"),r=function r(e,_r7){var i={type:"input:radio[name=adType]"};t.extend(this,{initialize:function initialize(){var t=e.find(i.type).on("change",function(){_r7.set("AdsCampaignType",t.filter(":checked").val());});n.selectRadioByValue(t,_r7.get("AdsCampaignType"));}}),this.initialize();};return function(e,t){new r(e,t);};}),define("campaign.create.form.budget",["require","jquery","jquery.numeric"],function(e){"use strict";var t=e("jquery");e("jquery.numeric");var n=function n(e,_n3){var r=this,i={budget:"#adBudget"};t.extend(this,{initialize:function initialize(){this.$budget=e.find(i.budget).numeric().val(_n3.get("Budget")).prop("disabled",!0).on("keyup",function(){_n3.set("Budget",r.$budget.val());}),r.setDisableState(),_n3.on("change:AdsCampaignType change:IsEndDateLimited",function(e,t){r.setDisableState();});},setDisableState:function setDisableState(){this.$budget.prop("disabled",_n3.get("AdsCampaignType")==="0"?_n3.get("IsEndDateLimited"):!1);}}),this.initialize();};return function(e,t){new n(e,t);};}),define("campaign.create.form.frequency",["require","jquery","events","campaign.create.formHelpers"],function(e){"use strict";var t=e("jquery"),n=e("events"),r=e("campaign.create.formHelpers"),i=function i(e,_i3){var s={frequency:"input:radio[name=frequency]",frequencyCont:"div.js-frequency-cont",frequencyCustomButton:"#frequency_custom_button",frequencyCustomCont:"div.js-frequency-custom",frequencyCustom:"#frequency_custom"};t.extend(this,{initialize:function initialize(){var t=e.find(s.frequency),o=e.find(s.frequencyCont),u=e.find(s.frequencyCustomButton),a=e.find(s.frequencyCustomCont),f=e.find(s.frequencyCustom);a.hide(),t.on("change",function(){a.hide(),_i3.set("IsCustomFrequency",!1),_i3.set("Frequency",t.filter(":checked").val());}),f.on("change",function(){_i3.set("Frequency",this.value);}),u.on("click",function(){f.val(_i3.get("Frequency")*60),a.show(),_i3.set({IsCustomFrequency:!0,Frequency:f.val()});}),r.selectRadioByValue(t,_i3.get("Frequency")),r.showHideBlock(o,_i3.get("AdsCampaignType")==="0"),_i3.on("change:AdsCampaignType",function(e,t){r.showHideBlock(o,t==="0");}),n.on("campaignCreate:changeFrequencyCount",function(e){r.selectRadioByValue(t,e.Frequency);});}}),this.initialize();};return function(e,t){new i(e,t);};}),define("campaign.create.form.geoFrequency",["require","jquery","events","campaign.create.formHelpers"],function(e){"use strict";var t=e("jquery"),n=e("events"),r=e("campaign.create.formHelpers"),i=function i(e,n){var i={frequency:"input:radio[name=geofrequency]",frequencyCont:"div.js-geofrequency-cont",isFrequncyUsed:"#isGeoFrequncyUsed"};t.extend(this,{initialize:function initialize(){var t=e.find(i.isFrequncyUsed),s=e.find(i.frequency),o=e.find(i.frequencyCont);t.prop("checked",n.get("IsGeoFrequncyUsed")).trigger("design:update").on("change",function(){n.set("IsGeoFrequncyUsed",t.is(":checked"));}),s.prop("disabled",!n.get("IsGeoFrequncyUsed")).on("change",function(){n.set("GeoFrequencies",s.filter(":checked").val());}),r.selectRadioByValue(s,n.get("GeoFrequencies")),r.showHideBlock(o,n.get("AdsCampaignType")!=="0"),n.on("change:AdsCampaignType",function(e,t){r.showHideBlock(o,t!=="0");}).on("change:IsGeoFrequncyUsed",function(e,t){s.prop("disabled",!t).change();});}}),this.initialize();};return function(e,t){new i(e,t);};}),define("campaign.create.form",["require","jquery","backbone","tools","events","datePicker","partnerCity","partnerMap.mapTypes","campaign.create.model","campaign.create.formHelpers","campaign.create.form.customers","campaign.create.form.discount","campaign.create.form.video","campaign.create.form.maxGpsShowCount","campaign.create.form.name","campaign.create.form.type","campaign.create.form.budget","campaign.create.form.frequency","campaign.create.form.geoFrequency","jquery.designDropdowns"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=e("tools"),i=e("events"),s=e("datePicker"),o=e("partnerCity"),u=e("partnerMap.mapTypes"),a=e("campaign.create.model"),f=e("campaign.create.formHelpers"),l=e("campaign.create.form.customers"),c=e("campaign.create.form.discount"),h=e("campaign.create.form.video"),p=e("campaign.create.form.maxGpsShowCount"),d=e("campaign.create.form.name"),v=e("campaign.create.form.type"),m=e("campaign.create.form.budget"),g=e("campaign.create.form.frequency"),y=e("campaign.create.form.geoFrequency");e("jquery.designDropdowns");var b=n.View.extend({defaultOptions:{formId:"#formCreateCampaign",elements:{adIsBillingEnabled:"#IsBillingEnabled",adStartDate:"#adStartDate",adStartDateGap:"#adStartDateGap",adEndDate:"#adEndDate",adEndDateGap:"#adEndDateGap",adEndDateLimit:"#isEndDateLimited"}},model:new a(),initialize:function initialize(e){this.options=t.extend(this.defaultOptions,e||{}),this.$el=t(this.options.formId);var n=this.$el.data("old-campaign");n&&(String(n.AdsCampaignType)==="1"&&(n.Frequency&&(n.GeoFrequencies=n.Frequency,n.IsGeoFrequncyUsed=!0,delete n.Frequency),n.GpsPolygonAreas.length&&(n.MapType=u.polygon)),r.list(["CreatedCampaignId","CurrentUserId","ForecastedEndDate","IsPartner","PartnerId","PartnerNow","Recommendations"]).each(function(e){delete n[e];}),this.model.set(n)),this.initControls(),this.model.setSimple("IsBillingEnabled",this.$(this.options.elements.adIsBillingEnabled).val()),this.model.on("change",function(e){e.validate();}),this.model.validate();},initControls:function initControls(){l(this.$el,this.model,this.options.isAdvertiser),d(this.$el,this.model),v(this.$el,this.model),this.initStartDate(),this.initEndDate(),this.initEndDateLimit(),this.options.isAdvertiser||c(this.$el,this.model),m(this.$el,this.model),h(this.$el,this.model),g(this.$el,this.model),y(this.$el,this.model),p(this.$el,this.model),this.initPartnerCity();},initStartDate:function initStartDate(){var e=this,t=this.$(this.options.elements.adStartDate),n=this.$(this.options.elements.adStartDateGap),r=new s(t,{$gapEl:n,minDate:new Date(),onSelect:function onSelect(t){e.model.set("StartDate",t);}});this.model.on("change:StartDate",function(){i.trigger("campaignCreate:selectStartDate",{dateForUI:r.getUIDate(),dateForServer:r.getServerDate(),dateReal:r.getRealDate()});});var o=this.model.get("StartDate");o&&(r.setDate(o),e.model.set("StartDate",r.getServerDate()));},initEndDate:function initEndDate(){var e=this,t=this.$(this.options.elements.adEndDate),n=this.$(this.options.elements.adEndDateGap),r=new s(t,{$gapEl:n,minDate:new Date(),onSelect:function onSelect(t){e.model.set("EndDate",t);}});this.model.get("IsEndDateLimited")?r.enable():r.disable(),this.model.on("change:IsEndDateLimited",function(e,t){r[t?"enable":"disable"]();});var i=this.model.get("EndDate");i&&(r.setDate(i),e.model.set("EndDate",r.getServerDate())),this.model.on("change:StartDate",function(t,n){var i=t.get("EndDate");i&&new Date(n)>new Date(i)&&(e.model.setSimple("EndDate",""),r.clear()),r.setMinDate(n);});},initEndDateLimit:function initEndDateLimit(){var e=this,t=this.$(this.options.elements.adEndDateLimit);t.prop("checked",!this.model.get("IsEndDateLimited")).trigger("design:update"),t.on("change",function(){e.model.set("IsEndDateLimited",!t.is(":checked"));}),this.model.on("change:IsEndDateLimited",function(e,n){t.prop("checked",!n).trigger("design:update");});},initPartnerCity:function initPartnerCity(){var e=this.model.toJSON(),n=this.model.get("PartnerGroupIds");new o(t("#partnerCities"),{data:window.partnerCities,campaignType:e.AdsCampaignType,selectedGroups:e.PartnerGroupIds,gpsAreas:e.GpsAreas,gpsPolygonAreas:e.GpsPolygonAreas});}});return function(e){new b(e);};}),define("campaign.create.formMessages",["require","jquery","tools","events","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("templates.storage"),s=function s(e,_s7){var o=this,u=t.extend({containerEl:"#campaignFormMesssages",templateId:"#template_ac_form_messages"},_s7||{}),a=i.get(u.templateId);t.extend(this,{initialize:function initialize(){this.$container=t(u.containerEl);if(!this.$container.length)return;this.setEvents();},setEvents:function setEvents(){r.on("campaignCreate:validateDates",function(e){setTimeout(function(){o.render(e);},500);}).on("campaignCreate:changeVideos",function(e){setTimeout(function(){o.render(e);},500);});},render:function render(e){e.StartDate&&(e.StartDateOffsetDays=n.date(e.StartDate).getDaysOffset(new Date())),this.$container.html(a(e));}}),this.initialize();};return function(e){new s(e);};}),define("campaign.create.action",["require","base","campaign.create.intendedResult","campaign.create.checkingResult","campaign.create.button","campaign.create.form","campaign.create.formMessages"],function(e){"use strict";var t=e("base");return new t.Action({initialize:function initialize(t){e("campaign.create.intendedResult")(t),e("campaign.create.checkingResult")(t),e("campaign.create.button")(t),e("campaign.create.form")(t),e("campaign.create.formMessages")(t);}});}),define("campaign.manager",["require","jquery","tools","urls"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("urls"),i=function i(e,_i4){var s=this;t.extend(this,{actionUrls:{remove:r.get("campaignRemove"),confirm:r.get("campaignConfirm"),stop:r.get("campaignStop")},initialize:function initialize(){var r=this.actionUrls[_i4.action];if(!r)return;e.click(function(){var e=t(this).data("id");return n.is(_i4.onClick).fn()?_i4.onClick(e)!==!1&&s.runAction(r,e):s.runAction(r,e),!1;});},runAction:function runAction(e,r){t.ajax({type:"POST",url:e,data:{Id:r},success:function success(){n.is(_i4.callback).fn()&&_i4.callback(r);}});}}),this.initialize();};return function(e,t){e&&e.length&&t&&t.action&&new i(e,t);};}),define("campaign.report.campaignStopper",["require","jquery","campaign.manager"],function(e){"use strict";var t=e("jquery"),n=e("campaign.manager"),r=function r(){var e={buttonsContainer:"div.buttons-cont",buttonStopContaiter:"div.js-button-stop-container",buttonStop:"a.js-button-stop",buttonStopConfirm:"a.js-button-stop-confirm",buttonConfirm:"a.js-button-confirm"},r={classIsHidden:"is-hidden"},i=t(e.buttonsContainer),s=t(e.buttonStopContaiter),o=i.find(e.buttonStop).click(function(){return i.addClass(r.classIsHidden),s.removeClass(r.classIsHidden),!1;});n(s.find(e.buttonStopConfirm),{action:"stop",onClick:function onClick(){o.hide(),u.hide(),s.addClass(r.classIsHidden),i.removeClass(r.classIsHidden);},callback:function callback(){window.location.reload();}});var u=i.find(e.buttonConfirm);n(u,{action:"confirm",onClick:function onClick(){o.hide(),u.hide(),s.addClass(r.classIsHidden),i.removeClass(r.classIsHidden);}});};return function(){new r();};}),define("campaign.report.buttonToArchive",["require","jquery","urls"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=function r(){var e=this,r={button:"a.js-button-to-archive",question:"   ?"};t.extend(this,{initialize:function initialize(){this.$buttons=t(r.button);if(!this.$buttons.length)return;this.isCampaignMoved=!1,this.$buttons.click(function(){if(!e.isCampaignMoved){var n=window.confirm(r.question);n==1&&(e.isCampaignMoved=!0,e.moveToArchive(t(this).data("id")));}});},moveToArchive:function moveToArchive(e){t.ajax({type:"POST",url:n.get("makeCampaignArchived"),data:{Id:e},success:function success(){window.location.reload();}});}}),this.initialize();};return function(){new r();};}),!function(){function e(e,t){return t>e?-1:e>t?1:e>=t?0:0/0;}function t(e){return null===e?0/0:+e;}function n(e){return!isNaN(e);}function r(e){return{left:function left(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e(t[s],n)<0?r=s+1:i=s;}return r;},right:function right(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e(t[s],n)>0?i=s:r=s+1;}return r;}};}function i(e){return e.length;}function s(e){for(var t=1;e*t%1;){t*=10;}return t;}function o(e,t){for(var n in t){Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1});}}function u(){this._=Object.create(null);}function a(e){return(e+="")===lu||e[0]===cu?cu+e:e;}function f(e){return(e+="")[0]===cu?e.slice(1):e;}function l(e){return a(e)in this._;}function c(e){return(e=a(e))in this._&&delete this._[e];}function h(){var e=[];for(var t in this._){e.push(f(t));}return e;}function p(){var e=0;for(var t in this._){++e;}return e;}function d(){for(var e in this._){return!1;}return!0;}function v(){this._=Object.create(null);}function m(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r;};}function g(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var n=0,r=hu.length;r>n;++n){var i=hu[n]+t;if(i in e)return i;}}function y(){}function b(){}function w(e){function t(){for(var t,r=n,i=-1,s=r.length;++i<s;){(t=r[i].on)&&t.apply(this,arguments);}return e;}var n=[],r=new u();return t.on=function(t,i){var s,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,s=n.indexOf(o)).concat(n.slice(s+1)),r.remove(t)),i&&n.push(r.set(t,{on:i})),e);},t;}function E(){Ko.event.preventDefault();}function S(){for(var e,t=Ko.event;e=t.sourceEvent;){t=e;}return t;}function x(e){for(var t=new b(),n=0,r=arguments.length;++n<r;){t[arguments[n]]=w(t);}return t.of=function(n,r){return function(i){try{var s=i.sourceEvent=Ko.event;i.target=e,Ko.event=i,t[i.type].apply(n,r);}finally{Ko.event=s;}};},t;}function T(e){return du(e,bu),e;}function N(e){return"function"==typeof e?e:function(){return vu(e,this);};}function C(e){return"function"==typeof e?e:function(){return mu(e,this);};}function k(e,t){function n(){this.removeAttribute(e);}function r(){this.removeAttributeNS(e.space,e.local);}function i(){this.setAttribute(e,t);}function s(){this.setAttributeNS(e.space,e.local,t);}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n);}function u(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n);}return e=Ko.ns.qualify(e),null==t?e.local?r:n:"function"==typeof t?e.local?u:o:e.local?s:i;}function L(e){return e.trim().replace(/\s+/g," ");}function A(e){return new RegExp("(?:^|\\s+)"+Ko.requote(e)+"(?:\\s+|$)","g");}function O(e){return(e+"").trim().split(/^|\s+/);}function M(e,t){function n(){for(var n=-1;++n<i;){e[n](this,t);}}function r(){for(var n=-1,r=t.apply(this,arguments);++n<i;){e[n](this,r);}}e=O(e).map(_);var i=e.length;return"function"==typeof t?r:n;}function _(e){var t=A(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||n.setAttribute("class",L(i+" "+e))):n.setAttribute("class",L(i.replace(t," ")));};}function D(e,t,n){function r(){this.style.removeProperty(e);}function i(){this.style.setProperty(e,t,n);}function s(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n);}return null==t?r:"function"==typeof t?s:i;}function P(e,t){function n(){delete this[e];}function r(){this[e]=t;}function i(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n;}return null==t?n:"function"==typeof t?i:r;}function H(e){return"function"==typeof e?e:(e=Ko.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local);}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,e);};}function B(e){return{__data__:e};}function j(e){return function(){return yu(this,e);};}function F(t){return arguments.length||(t=e),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n;};}function I(e,t){for(var n=0,r=e.length;r>n;n++){for(var i,s=e[n],o=0,u=s.length;u>o;o++){(i=s[o])&&t(i,o,n);}}return e;}function q(e){return du(e,Eu),e;}function R(e){var t,n;return function(r,i,s){var o,u=e[s].update,a=u.length;for(s!=n&&(n=s,t=0),i>=t&&(t=i+1);!(o=u[t])&&++t<a;){;}return o;};}function U(){var e=this.__transition__;e&&++e.active;}function z(e,t,n){function r(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o]);}function i(){var i=a(t,Go(arguments));r.call(this),this.addEventListener(e,this[o]=i,i.$=n),i._=t;}function s(){var t,n=new RegExp("^__on([^.]+)"+Ko.requote(e)+"$");for(var r in this){if(t=r.match(n)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r];}}}var o="__on"+e,u=e.indexOf("."),a=W;u>0&&(e=e.slice(0,u));var f=xu.get(e);return f&&(e=f,a=X),u?t?i:r:t?y:s;}function W(e,t){return function(n){var r=Ko.event;Ko.event=n,t[0]=this.__data__;try{e.apply(this,t);}finally{Ko.event=r;}};}function X(e,t){var n=W(e,t);return function(e){var t=this,r=e.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||n.call(t,e);};}function V(){var e=".dragsuppress-"+ ++Nu,t="click"+e,n=Ko.select(eu).on("touchmove"+e,E).on("dragstart"+e,E).on("selectstart"+e,E);if(Tu){var r=Zo.style,i=r[Tu];r[Tu]="none";}return function(s){function o(){n.on(t,null);}n.on(e,null),Tu&&(r[Tu]=i),s&&(n.on(t,function(){E(),o();},!0),setTimeout(o,0));};}function $(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(0>Cu&&(eu.scrollX||eu.scrollY)){n=Ko.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var i=n[0][0].getScreenCTM();Cu=!i.f&&!i.e,n.remove();}return Cu?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y];}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop];}function J(){return Ko.event.changedTouches[0].identifier;}function K(){return Ko.event.target;}function Q(){return eu;}function G(e){return e>0?1:0>e?-1:0;}function Y(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0]);}function Z(e){return e>1?0:-1>e?ku:Math.acos(e);}function et(e){return e>1?Au:-1>e?-Au:Math.asin(e);}function tt(e){return((e=Math.exp(e))-1/e)/2;}function nt(e){return((e=Math.exp(e))+1/e)/2;}function rt(e){return((e=Math.exp(2*e))-1)/(e+1);}function it(e){return(e=Math.sin(e/2))*e;}function st(){}function ot(e,t,n){return this instanceof ot?(this.h=+e,this.s=+t,void(this.l=+n)):arguments.length<2?e instanceof ot?new ot(e.h,e.s,e.l):wt(""+e,Et,ot):new ot(e,t,n);}function ut(e,t,n){function r(e){return e>360?e-=360:0>e&&(e+=360),60>e?s+(o-s)*e/60:180>e?o:240>e?s+(o-s)*(240-e)/60:s;}function i(e){return Math.round(255*r(e));}var s,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:0>t?0:t>1?1:t,n=0>n?0:n>1?1:n,o=.5>=n?n*(1+t):n+t-n*t,s=2*n-o,new mt(i(e+120),i(e),i(e-120));}function at(e,t,n){return this instanceof at?(this.h=+e,this.c=+t,void(this.l=+n)):arguments.length<2?e instanceof at?new at(e.h,e.c,e.l):e instanceof lt?ht(e.l,e.a,e.b):ht((e=St((e=Ko.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new at(e,t,n);}function ft(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new lt(n,Math.cos(e*=_u)*t,Math.sin(e)*t);}function lt(e,t,n){return this instanceof lt?(this.l=+e,this.a=+t,void(this.b=+n)):arguments.length<2?e instanceof lt?new lt(e.l,e.a,e.b):e instanceof at?ft(e.h,e.c,e.l):St((e=mt(e)).r,e.g,e.b):new lt(e,t,n);}function ct(e,t,n){var r=(e+16)/116,i=r+t/500,s=r-n/200;return i=pt(i)*zu,r=pt(r)*Wu,s=pt(s)*Xu,new mt(vt(3.2404542*i-1.5371385*r-.4985314*s),vt(-0.969266*i+1.8760108*r+.041556*s),vt(.0556434*i-.2040259*r+1.0572252*s));}function ht(e,t,n){return e>0?new at(Math.atan2(n,t)*Du,Math.sqrt(t*t+n*n),e):new at(0/0,0/0,e);}function pt(e){return e>.206893034?e*e*e:(e-4/29)/7.787037;}function dt(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29;}function vt(e){return Math.round(255*(.00304>=e?12.92*e:1.055*Math.pow(e,1/2.4)-.055));}function mt(e,t,n){return this instanceof mt?(this.r=~~e,this.g=~~t,void(this.b=~~n)):arguments.length<2?e instanceof mt?new mt(e.r,e.g,e.b):wt(""+e,mt,ut):new mt(e,t,n);}function gt(e){return new mt(e>>16,255&e>>8,255&e);}function yt(e){return gt(e)+"";}function bt(e){return 16>e?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16);}function wt(e,t,n){var r,i,s,o=0,u=0,a=0;if(r=/([a-z]+)\((.*)\)/i.exec(e))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Tt(i[0]),Tt(i[1]),Tt(i[2]));}return(s=Ju.get(e))?t(s.r,s.g,s.b):(null==e||"#"!==e.charAt(0)||isNaN(s=parseInt(e.slice(1),16))||(4===e.length?(o=(3840&s)>>4,o=o>>4|o,u=240&s,u=u>>4|u,a=15&s,a=a<<4|a):7===e.length&&(o=(16711680&s)>>16,u=(65280&s)>>8,a=255&s)),t(o,u,a));}function Et(e,t,n){var r,i,s=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),u=o-s,a=(o+s)/2;return u?(i=.5>a?u/(o+s):u/(2-o-s),r=e==o?(t-n)/u+(n>t?6:0):t==o?(n-e)/u+2:(e-t)/u+4,r*=60):(r=0/0,i=a>0&&1>a?0:r),new ot(r,i,a);}function St(e,t,n){e=xt(e),t=xt(t),n=xt(n);var r=dt((.4124564*e+.3575761*t+.1804375*n)/zu),i=dt((.2126729*e+.7151522*t+.072175*n)/Wu),s=dt((.0193339*e+.119192*t+.9503041*n)/Xu);return lt(116*i-16,500*(r-i),200*(i-s));}function xt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);}function Tt(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t;}function Nt(e){return"function"==typeof e?e:function(){return e;};}function Ct(e){return e;}function kt(e){return function(t,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),Lt(t,n,e,r);};}function Lt(e,t,n,r){function i(){var e,t=a.status;if(!t&&Ot(a)||t>=200&&300>t||304===t){try{e=n.call(s,a);}catch(r){return o.error.call(s,r),void 0;}o.load.call(s,e);}else o.error.call(s,a);}var s={},o=Ko.dispatch("beforesend","progress","load","error"),u={},a=new XMLHttpRequest(),f=null;return!eu.XDomainRequest||"withCredentials"in a||!/^(http(s)?:)?\/\//.test(e)||(a=new XDomainRequest()),"onload"in a?a.onload=a.onerror=i:a.onreadystatechange=function(){a.readyState>3&&i();},a.onprogress=function(e){var t=Ko.event;Ko.event=e;try{o.progress.call(s,a);}finally{Ko.event=t;}},s.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u[e]:(null==t?delete u[e]:u[e]=t+"",s);},s.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",s):t;},s.responseType=function(e){return arguments.length?(f=e,s):f;},s.response=function(e){return n=e,s;},["get","post"].forEach(function(e){s[e]=function(){return s.send.apply(s,[e].concat(Go(arguments)));};}),s.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),a.open(n,e,!0),null==t||"accept"in u||(u.accept=t+",*/*"),a.setRequestHeader)for(var l in u){a.setRequestHeader(l,u[l]);}return null!=t&&a.overrideMimeType&&a.overrideMimeType(t),null!=f&&(a.responseType=f),null!=i&&s.on("error",i).on("load",function(e){i(null,e);}),o.beforesend.call(s,a),a.send(null==r?null:r),s;},s.abort=function(){return a.abort(),s;},Ko.rebind(s,o,"on"),null==r?s:s.get(At(r));}function At(e){return 1===e.length?function(t,n){e(null==t?n:null);}:e;}function Ot(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText;}function Mt(){var e=_t(),t=Dt()-e;t>24?(isFinite(t)&&(clearTimeout(Yu),Yu=setTimeout(Mt,t)),Gu=0):(Gu=1,ea(Mt));}function _t(){var e=Date.now();for(Zu=Ku;Zu;){e>=Zu.t&&(Zu.f=Zu.c(e-Zu.t)),Zu=Zu.n;}return e;}function Dt(){for(var e,t=Ku,n=1/0;t;){t.f?t=e?e.n=t.n:Ku=t.n:(t.t<n&&(n=t.t),t=(e=t).n);}return Qu=e,n;}function Pt(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1);}function Ht(e,t){var n=Math.pow(10,3*fu(8-t));return{scale:t>8?function(e){return e/n;}:function(e){return e*n;},symbol:e};}function Bt(e){var t=e.decimal,n=e.thousands,r=e.grouping,i=e.currency,s=r&&n?function(e,t){for(var i=e.length,s=[],o=0,u=r[0],a=0;i>0&&u>0&&(a+u+1>t&&(u=Math.max(1,t-a)),s.push(e.substring(i-=u,i+u)),!((a+=u+1)>t));){u=r[o=(o+1)%r.length];}return s.reverse().join(n);}:Ct;return function(e){var n=na.exec(e),r=n[1]||" ",o=n[2]||">",u=n[3]||"-",a=n[4]||"",f=n[5],l=+n[6],c=n[7],h=n[8],p=n[9],d=1,v="",m="",g=!1,y=!0;switch(h&&(h=+h.substring(1)),(f||"0"===r&&"="===o)&&(f=r="0",o="="),p){case"n":c=!0,p="g";break;case"%":d=100,m="%",p="f";break;case"p":d=100,m="%",p="r";break;case"b":case"o":case"x":case"X":"#"===a&&(v="0"+p.toLowerCase());case"c":y=!1;case"d":g=!0,h=0;break;case"s":d=-1,p="r";}"$"===a&&(v=i[0],m=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):("e"==p||"f"==p)&&(h=Math.max(0,Math.min(20,h)))),p=ra.get(p)||jt;var b=f&&c;return function(e){var n=m;if(g&&e%1)return"";var i=0>e||0===e&&0>1/e?(e=-e,"-"):"-"===u?"":u;if(0>d){var a=Ko.formatPrefix(e,h);e=a.scale(e),n=a.symbol+m;}else e*=d;e=p(e,h);var w,E,S=e.lastIndexOf(".");if(0>S){var x=y?e.lastIndexOf("e"):-1;0>x?(w=e,E=""):(w=e.substring(0,x),E=e.substring(x));}else w=e.substring(0,S),E=t+e.substring(S+1);!f&&c&&(w=s(w,1/0));var T=v.length+w.length+E.length+(b?0:i.length),N=l>T?new Array(T=l-T+1).join(r):"";return b&&(w=s(N+w,N.length?l-E.length:1/0)),i+=v,e=w+E,("<"===o?i+e+N:">"===o?N+i+e:"^"===o?N.substring(0,T>>=1)+i+e+N.substring(T):i+(b?e:N+e))+n;};};}function jt(e){return e+"";}function Ft(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}function It(e,t,n){function r(t){var n=e(t),r=s(n,1);return r-t>t-n?n:r;}function i(n){return t(n=e(new sa(n-1)),1),n;}function s(e,n){return t(e=new sa(+e),n),e;}function o(e,r,s){var o=i(e),u=[];if(s>1)for(;r>o;){n(o)%s||u.push(new Date(+o)),t(o,1);}else for(;r>o;){u.push(new Date(+o)),t(o,1);}return u;}function u(e,t,n){try{sa=Ft;var r=new Ft();return r._=e,o(r,t,n);}finally{sa=Date;}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=qt(e);return a.floor=a,a.round=qt(r),a.ceil=qt(i),a.offset=qt(s),a.range=u,e;}function qt(e){return function(t,n){try{sa=Ft;var r=new Ft();return r._=t,e(r,n)._;}finally{sa=Date;}};}function Rt(e){function t(e){function t(t){for(var n,i,s,o=[],u=-1,a=0;++u<r;){37===e.charCodeAt(u)&&(o.push(e.slice(a,u)),null!=(i=ua[n=e.charAt(++u)])&&(n=e.charAt(++u)),(s=L[n])&&(n=s(t,null==i?"e"===n?" ":"0":i)),o.push(n),a=u+1);}return o.push(e.slice(a,u)),o.join("");}var r=e.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=n(r,e,t,0);if(i!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var s=null!=r.Z&&sa!==Ft,o=new(s?Ft:sa)();return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(0|r.Z/100),r.M+r.Z%100,r.S,r.L),s?o._:o;},t.toString=function(){return e;},t;}function n(e,t,n,r){for(var i,s,o,u=0,a=t.length,f=n.length;a>u;){if(r>=f)return-1;if(i=t.charCodeAt(u++),37===i){if(o=t.charAt(u++),s=A[o in ua?t.charAt(u++):o],!s||(r=s(e,n,r))<0)return-1;}else if(i!=n.charCodeAt(r++))return-1;}return r;}function r(e,t,n){S.lastIndex=0;var r=S.exec(t.slice(n));return r?(e.w=x.get(r[0].toLowerCase()),n+r[0].length):-1;}function i(e,t,n){w.lastIndex=0;var r=w.exec(t.slice(n));return r?(e.w=E.get(r[0].toLowerCase()),n+r[0].length):-1;}function s(e,t,n){C.lastIndex=0;var r=C.exec(t.slice(n));return r?(e.m=k.get(r[0].toLowerCase()),n+r[0].length):-1;}function o(e,t,n){T.lastIndex=0;var r=T.exec(t.slice(n));return r?(e.m=N.get(r[0].toLowerCase()),n+r[0].length):-1;}function u(e,t,r){return n(e,L.c.toString(),t,r);}function a(e,t,r){return n(e,L.x.toString(),t,r);}function f(e,t,r){return n(e,L.X.toString(),t,r);}function l(e,t,n){var r=b.get(t.slice(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n);}var c=e.dateTime,h=e.date,p=e.time,d=e.periods,v=e.days,m=e.shortDays,g=e.months,y=e.shortMonths;t.utc=function(e){function n(e){try{sa=Ft;var t=new sa();return t._=e,r(t);}finally{sa=Date;}}var r=t(e);return n.parse=function(e){try{sa=Ft;var t=r.parse(e);return t&&t._;}finally{sa=Date;}},n.toString=r.toString,n;},t.multi=t.utc.multi=an;var b=Ko.map(),w=zt(v),E=Wt(v),S=zt(m),x=Wt(m),T=zt(g),N=Wt(g),C=zt(y),k=Wt(y);d.forEach(function(e,t){b.set(e.toLowerCase(),t);});var L={a:function a(e){return m[e.getDay()];},A:function A(e){return v[e.getDay()];},b:function b(e){return y[e.getMonth()];},B:function B(e){return g[e.getMonth()];},c:t(c),d:function d(e,t){return Ut(e.getDate(),t,2);},e:function e(_e3,t){return Ut(_e3.getDate(),t,2);},H:function H(e,t){return Ut(e.getHours(),t,2);},I:function I(e,t){return Ut(e.getHours()%12||12,t,2);},j:function j(e,t){return Ut(1+ia.dayOfYear(e),t,3);},L:function L(e,t){return Ut(e.getMilliseconds(),t,3);},m:function m(e,t){return Ut(e.getMonth()+1,t,2);},M:function M(e,t){return Ut(e.getMinutes(),t,2);},p:function p(e){return d[+(e.getHours()>=12)];},S:function S(e,t){return Ut(e.getSeconds(),t,2);},U:function U(e,t){return Ut(ia.sundayOfYear(e),t,2);},w:function w(e){return e.getDay();},W:function W(e,t){return Ut(ia.mondayOfYear(e),t,2);},x:t(h),X:t(p),y:function y(e,t){return Ut(e.getFullYear()%100,t,2);},Y:function Y(e,t){return Ut(e.getFullYear()%1e4,t,4);},Z:on,"%":function _(){return"%";}},A={a:r,A:i,b:s,B:o,c:u,d:Zt,e:Zt,H:tn,I:tn,j:en,L:sn,m:Yt,M:nn,p:l,S:rn,U:Vt,w:Xt,W:$t,x:a,X:f,y:Kt,Y:Jt,Z:Qt,"%":un};return t;}function Ut(e,t,n){var r=0>e?"-":"",i=(r?-e:e)+"",s=i.length;return r+(n>s?new Array(n-s+1).join(t)+i:i);}function zt(e){return new RegExp("^(?:"+e.map(Ko.requote).join("|")+")","i");}function Wt(e){for(var t=new u(),n=-1,r=e.length;++n<r;){t.set(e[n].toLowerCase(),n);}return t;}function Xt(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1;}function Vt(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n));return r?(e.U=+r[0],n+r[0].length):-1;}function $t(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n));return r?(e.W=+r[0],n+r[0].length):-1;}function Jt(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1;}function Kt(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+2));return r?(e.y=Gt(+r[0]),n+r[0].length):-1;}function Qt(e,t,n){return /^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1;}function Gt(e){return e+(e>68?1900:2e3);}function Yt(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1;}function Zt(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1;}function en(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1;}function tn(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1;}function nn(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1;}function rn(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1;}function sn(e,t,n){aa.lastIndex=0;var r=aa.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1;}function on(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=0|fu(t)/60,i=fu(t)%60;return n+Ut(r,"0",2)+Ut(i,"0",2);}function un(e,t,n){fa.lastIndex=0;var r=fa.exec(t.slice(n,n+1));return r?n+r[0].length:-1;}function an(e){for(var t=e.length,n=-1;++n<t;){e[n][0]=this(e[n][0]);}return function(t){for(var n=0,r=e[n];!r[1](t);){r=e[++n];}return r[0](t);};}function fn(){}function ln(e,t,n){var r=n.s=e+t,i=r-e,s=r-i;n.t=e-s+(t-i);}function cn(e,t){e&&pa.hasOwnProperty(e.type)&&pa[e.type](e,t);}function hn(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;){r=e[i],t.point(r[0],r[1],r[2]);}t.lineEnd();}function pn(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;){hn(e[n],t,1);}t.polygonEnd();}function dn(){function e(e,t){e*=_u,t=t*_u/2+ku/4;var n=e-r,o=n>=0?1:-1,u=o*n,a=Math.cos(t),f=Math.sin(t),l=s*f,c=i*a+l*Math.cos(u),h=l*o*Math.sin(u);va.add(Math.atan2(h,c)),r=e,i=a,s=f;}var t,n,r,i,s;ma.point=function(o,u){ma.point=e,r=(t=o)*_u,i=Math.cos(u=(n=u)*_u/2+ku/4),s=Math.sin(u);},ma.lineEnd=function(){e(t,n);};}function vn(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)];}function mn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2];}function gn(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]];}function yn(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2];}function bn(e,t){return[e[0]*t,e[1]*t,e[2]*t];}function wn(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t;}function En(e){return[Math.atan2(e[1],e[0]),et(e[2])];}function Sn(e,t){return fu(e[0]-t[0])<Ou&&fu(e[1]-t[1])<Ou;}function xn(e,t){e*=_u;var n=Math.cos(t*=_u);Tn(n*Math.cos(e),n*Math.sin(e),Math.sin(t));}function Tn(e,t,n){++ga,ba+=(e-ba)/ga,wa+=(t-wa)/ga,Ea+=(n-Ea)/ga;}function Nn(){function e(e,i){e*=_u;var s=Math.cos(i*=_u),o=s*Math.cos(e),u=s*Math.sin(e),a=Math.sin(i),f=Math.atan2(Math.sqrt((f=n*a-r*u)*f+(f=r*o-t*a)*f+(f=t*u-n*o)*f),t*o+n*u+r*a);ya+=f,Sa+=f*(t+(t=o)),xa+=f*(n+(n=u)),Ta+=f*(r+(r=a)),Tn(t,n,r);}var t,n,r;La.point=function(i,s){i*=_u;var o=Math.cos(s*=_u);t=o*Math.cos(i),n=o*Math.sin(i),r=Math.sin(s),La.point=e,Tn(t,n,r);};}function Cn(){La.point=xn;}function kn(){function e(e,t){e*=_u;var n=Math.cos(t*=_u),o=n*Math.cos(e),u=n*Math.sin(e),a=Math.sin(t),f=i*a-s*u,l=s*o-r*a,c=r*u-i*o,h=Math.sqrt(f*f+l*l+c*c),p=r*o+i*u+s*a,d=h&&-Z(p)/h,v=Math.atan2(h,p);Na+=d*f,Ca+=d*l,ka+=d*c,ya+=v,Sa+=v*(r+(r=o)),xa+=v*(i+(i=u)),Ta+=v*(s+(s=a)),Tn(r,i,s);}var t,n,r,i,s;La.point=function(o,u){t=o,n=u,La.point=e,o*=_u;var a=Math.cos(u*=_u);r=a*Math.cos(o),i=a*Math.sin(o),s=Math.sin(u),Tn(r,i,s);},La.lineEnd=function(){e(t,n),La.lineEnd=Cn,La.point=xn;};}function Ln(){return!0;}function An(e,t,n,r,i){var s=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],r=e[t];if(Sn(n,r)){i.lineStart();for(var u=0;t>u;++u){i.point((n=e[u])[0],n[1]);}return i.lineEnd(),void 0;}var a=new Mn(n,e,null,!0),f=new Mn(n,null,a,!1);a.o=f,s.push(a),o.push(f),a=new Mn(r,e,null,!1),f=new Mn(r,null,a,!0),a.o=f,s.push(a),o.push(f);}}),o.sort(t),On(s),On(o),s.length){for(var u=0,a=n,f=o.length;f>u;++u){o[u].e=a=!a;}for(var l,c,h=s[0];;){for(var p=h,d=!0;p.v;){if((p=p.n)===h)return;}l=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(var u=0,f=l.length;f>u;++u){i.point((c=l[u])[0],c[1]);}else r(p.x,p.n.x,1,i);p=p.n;}else{if(d){l=p.p.z;for(var u=l.length-1;u>=0;--u){i.point((c=l[u])[0],c[1]);}}else r(p.x,p.p.x,-1,i);p=p.p;}p=p.o,l=p.z,d=!d;}while(!p.v);i.lineEnd();}}}function On(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;){i.n=n=e[r],n.p=i,i=n;}i.n=n=e[0],n.p=i;}}function Mn(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null;}function _n(e,t,n,r){return function(i,s){function o(t,n){var r=i(t,n);e(t=r[0],n=r[1])&&s.point(t,n);}function u(e,t){var n=i(e,t);m.point(n[0],n[1]);}function a(){y.point=u,m.lineStart();}function f(){y.point=o,m.lineEnd();}function l(e,t){v.push([e,t]);var n=i(e,t);w.point(n[0],n[1]);}function c(){w.lineStart(),v=[];}function h(){l(v[0][0],v[0][1]),w.lineEnd();var e,t=w.clean(),n=b.buffer(),r=n.length;if(v.pop(),d.push(v),v=null,r)if(1&t){e=n[0];var i,r=e.length-1,o=-1;if(r>0){for(E||(s.polygonStart(),E=!0),s.lineStart();++o<r;){s.point((i=e[o])[0],i[1]);}s.lineEnd();}}else r>1&&2&t&&n.push(n.pop().concat(n.shift())),p.push(n.filter(Dn));}var p,d,v,m=t(s),g=i.invert(r[0],r[1]),y={point:o,lineStart:a,lineEnd:f,polygonStart:function polygonStart(){y.point=l,y.lineStart=c,y.lineEnd=h,p=[],d=[];},polygonEnd:function polygonEnd(){y.point=o,y.lineStart=a,y.lineEnd=f,p=Ko.merge(p);var e=In(g,d);p.length?(E||(s.polygonStart(),E=!0),An(p,Hn,e,n,s)):e&&(E||(s.polygonStart(),E=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),E&&(s.polygonEnd(),E=!1),p=d=null;},sphere:function sphere(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd();}},b=Pn(),w=t(b),E=!1;return y;};}function Dn(e){return e.length>1;}function Pn(){var e,t=[];return{lineStart:function lineStart(){t.push(e=[]);},point:function point(t,n){e.push([t,n]);},lineEnd:y,buffer:function buffer(){var n=t;return t=[],e=null,n;},rejoin:function rejoin(){t.length>1&&t.push(t.pop().concat(t.shift()));}};}function Hn(e,t){return((e=e.x)[0]<0?e[1]-Au-Ou:Au-e[1])-((t=t.x)[0]<0?t[1]-Au-Ou:Au-t[1]);}function Bn(e){var t,n=0/0,r=0/0,i=0/0;return{lineStart:function lineStart(){e.lineStart(),t=1;},point:function point(s,o){var u=s>0?ku:-ku,a=fu(s-n);fu(a-ku)<Ou?(e.point(n,r=(r+o)/2>0?Au:-Au),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),e.point(s,r),t=0):i!==u&&a>=ku&&(fu(n-i)<Ou&&(n-=i*Ou),fu(s-u)<Ou&&(s-=u*Ou),r=jn(n,r,s,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),t=0),e.point(n=s,r=o),i=u;},lineEnd:function lineEnd(){e.lineEnd(),n=r=0/0;},clean:function clean(){return 2-t;}};}function jn(e,t,n,r){var i,s,o=Math.sin(e-n);return fu(o)>Ou?Math.atan((Math.sin(t)*(s=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(t))*Math.sin(e))/(i*s*o)):(t+r)/2;}function Fn(e,t,n,r){var i;if(null==e)i=n*Au,r.point(-ku,i),r.point(0,i),r.point(ku,i),r.point(ku,0),r.point(ku,-i),r.point(0,-i),r.point(-ku,-i),r.point(-ku,0),r.point(-ku,i);else if(fu(e[0]-t[0])>Ou){var s=e[0]<t[0]?ku:-ku;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i);}else r.point(t[0],t[1]);}function In(e,t){var n=e[0],r=e[1],i=[Math.sin(n),-Math.cos(n),0],s=0,o=0;va.reset();for(var u=0,a=t.length;a>u;++u){var f=t[u],l=f.length;if(l)for(var c=f[0],h=c[0],p=c[1]/2+ku/4,d=Math.sin(p),v=Math.cos(p),m=1;;){m===l&&(m=0),e=f[m];var g=e[0],y=e[1]/2+ku/4,b=Math.sin(y),w=Math.cos(y),E=g-h,S=E>=0?1:-1,x=S*E,T=x>ku,N=d*b;if(va.add(Math.atan2(N*S*Math.sin(x),v*w+N*Math.cos(x))),s+=T?E+S*Lu:E,T^h>=n^g>=n){var C=gn(vn(c),vn(e));wn(C);var k=gn(i,C);wn(k);var L=(T^E>=0?-1:1)*et(k[2]);(r>L||r===L&&(C[0]||C[1]))&&(o+=T^E>=0?1:-1);}if(!m++)break;h=g,d=b,v=w,c=e;}}return(-Ou>s||Ou>s&&0>va)^1&o;}function qn(e){function t(e,t){return Math.cos(e)*Math.cos(t)>s;}function n(e){var n,s,a,f,l;return{lineStart:function lineStart(){f=a=!1,l=1;},point:function point(c,h){var p,d=[c,h],v=t(c,h),m=o?v?0:i(c,h):v?i(c+(0>c?ku:-ku),h):0;if(!n&&(f=a=v)&&e.lineStart(),v!==a&&(p=r(n,d),(Sn(n,p)||Sn(d,p))&&(d[0]+=Ou,d[1]+=Ou,v=t(d[0],d[1]))),v!==a)l=0,v?(e.lineStart(),p=r(d,n),e.point(p[0],p[1])):(p=r(n,d),e.point(p[0],p[1]),e.lineEnd()),n=p;else if(u&&n&&o^v){var g;m&s||!(g=r(d,n,!0))||(l=0,o?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1])));}!v||n&&Sn(n,d)||e.point(d[0],d[1]),n=d,a=v,s=m;},lineEnd:function lineEnd(){a&&e.lineEnd(),n=null;},clean:function clean(){return l|(f&&a)<<1;}};}function r(e,t,n){var r=vn(e),i=vn(t),o=[1,0,0],u=gn(r,i),a=mn(u,u),f=u[0],l=a-f*f;if(!l)return!n&&e;var c=s*a/l,h=-s*f/l,p=gn(o,u),d=bn(o,c),v=bn(u,h);yn(d,v);var m=p,g=mn(d,m),y=mn(m,m),b=g*g-y*(mn(d,d)-1);if(!(0>b)){var w=Math.sqrt(b),E=bn(m,(-g-w)/y);if(yn(E,d),E=En(E),!n)return E;var S,x=e[0],T=t[0],N=e[1],C=t[1];x>T&&(S=x,x=T,T=S);var k=T-x,L=fu(k-ku)<Ou,A=L||Ou>k;if(!L&&N>C&&(S=N,N=C,C=S),A?L?N+C>0^E[1]<(fu(E[0]-x)<Ou?N:C):N<=E[1]&&E[1]<=C:k>ku^(x<=E[0]&&E[0]<=T)){var O=bn(m,(-g+w)/y);return yn(O,d),[E,En(O)];}}}function i(t,n){var r=o?e:ku-e,i=0;return-r>t?i|=1:t>r&&(i|=2),-r>n?i|=4:n>r&&(i|=8),i;}var s=Math.cos(e),o=s>0,u=fu(s)>Ou,a=dr(e,6*_u);return _n(t,n,a,o?[0,-e]:[-ku,e-ku]);}function Rn(e,t,n,r){return function(i){var s,o=i.a,u=i.b,a=o.x,f=o.y,l=u.x,c=u.y,h=0,p=1,d=l-a,v=c-f;if(s=e-a,d||!(s>0)){if(s/=d,0>d){if(h>s)return;p>s&&(p=s);}else if(d>0){if(s>p)return;s>h&&(h=s);}if(s=n-a,d||!(0>s)){if(s/=d,0>d){if(s>p)return;s>h&&(h=s);}else if(d>0){if(h>s)return;p>s&&(p=s);}if(s=t-f,v||!(s>0)){if(s/=v,0>v){if(h>s)return;p>s&&(p=s);}else if(v>0){if(s>p)return;s>h&&(h=s);}if(s=r-f,v||!(0>s)){if(s/=v,0>v){if(s>p)return;s>h&&(h=s);}else if(v>0){if(h>s)return;p>s&&(p=s);}return h>0&&(i.a={x:a+h*d,y:f+h*v}),1>p&&(i.b={x:a+p*d,y:f+p*v}),i;}}}}};}function Un(e,t,n,r){function i(r,i){return fu(r[0]-e)<Ou?i>0?0:3:fu(r[0]-n)<Ou?i>0?2:1:fu(r[1]-t)<Ou?i>0?1:0:i>0?3:2;}function s(e,t){return o(e.x,t.x);}function o(e,t){var n=i(e,1),r=i(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0];}return function(u){function a(e){for(var t=0,n=m.length,r=e[1],i=0;n>i;++i){for(var s,o=1,u=m[i],a=u.length,f=u[0];a>o;++o){s=u[o],f[1]<=r?s[1]>r&&Y(f,s,e)>0&&++t:s[1]<=r&&Y(f,s,e)<0&&--t,f=s;}}return 0!==t;}function f(s,u,a,f){var l=0,c=0;if(null==s||(l=i(s,a))!==(c=i(u,a))||o(s,u)<0^a>0){do{f.point(0===l||3===l?e:n,l>1?r:t);}while((l=(l+a+4)%4)!==c);}else f.point(u[0],u[1]);}function l(i,s){return i>=e&&n>=i&&s>=t&&r>=s;}function c(e,t){l(e,t)&&u.point(e,t);}function h(){A.point=d,m&&m.push(g=[]),T=!0,x=!1,E=S=0/0;}function p(){v&&(d(y,b),w&&x&&k.rejoin(),v.push(k.buffer())),A.point=c,x&&u.lineEnd();}function d(e,t){e=Math.max(-Oa,Math.min(Oa,e)),t=Math.max(-Oa,Math.min(Oa,t));var n=l(e,t);if(m&&g.push([e,t]),T)y=e,b=t,w=n,T=!1,n&&(u.lineStart(),u.point(e,t));else if(n&&x)u.point(e,t);else{var r={a:{x:E,y:S},b:{x:e,y:t}};L(r)?(x||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),n||u.lineEnd(),N=!1):n&&(u.lineStart(),u.point(e,t),N=!1);}E=e,S=t,x=n;}var v,m,g,y,b,w,E,S,x,T,N,C=u,k=Pn(),L=Rn(e,t,n,r),A={point:c,lineStart:h,lineEnd:p,polygonStart:function polygonStart(){u=k,v=[],m=[],N=!0;},polygonEnd:function polygonEnd(){u=C,v=Ko.merge(v);var t=a([e,r]),n=N&&t,i=v.length;(n||i)&&(u.polygonStart(),n&&(u.lineStart(),f(null,null,1,u),u.lineEnd()),i&&An(v,s,t,f,u),u.polygonEnd()),v=m=g=null;}};return A;};}function zn(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1]);}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1]);}),n;}function Wn(e){var t=0,n=ku/3,r=or(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*ku/180,n=e[1]*ku/180):[180*(t/ku),180*(n/ku)];},i;}function Xn(e,t){function n(e,t){var n=Math.sqrt(s-2*i*Math.sin(t))/i;return[n*Math.sin(e*=i),o-n*Math.cos(e)];}var r=Math.sin(e),i=(r+Math.sin(t))/2,s=1+r*(2*i-r),o=Math.sqrt(s)/i;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/i,et((s-(e*e+n*n)*i*i)/(2*i))];},n;}function Vn(){function e(e,t){_a+=i*e-r*t,r=e,i=t;}var t,n,r,i;ja.point=function(s,o){ja.point=e,t=r=s,n=i=o;},ja.lineEnd=function(){e(t,n);};}function $n(e,t){Da>e&&(Da=e),e>Ha&&(Ha=e),Pa>t&&(Pa=t),t>Ba&&(Ba=t);}function Jn(){function e(e,t){o.push("M",e,",",t,s);}function t(e,t){o.push("M",e,",",t),u.point=n;}function n(e,t){o.push("L",e,",",t);}function r(){u.point=e;}function i(){o.push("Z");}var s=Kn(4.5),o=[],u={point:e,lineStart:function lineStart(){u.point=t;},lineEnd:r,polygonStart:function polygonStart(){u.lineEnd=i;},polygonEnd:function polygonEnd(){u.lineEnd=r,u.point=e;},pointRadius:function pointRadius(e){return s=Kn(e),u;},result:function result(){if(o.length){var e=o.join("");return o=[],e;}}};return u;}function Kn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z";}function Qn(e,t){ba+=e,wa+=t,++Ea;}function Gn(){function e(e,r){var i=e-t,s=r-n,o=Math.sqrt(i*i+s*s);Sa+=o*(t+e)/2,xa+=o*(n+r)/2,Ta+=o,Qn(t=e,n=r);}var t,n;Ia.point=function(r,i){Ia.point=e,Qn(t=r,n=i);};}function Yn(){Ia.point=Qn;}function Zn(){function e(e,t){var n=e-r,s=t-i,o=Math.sqrt(n*n+s*s);Sa+=o*(r+e)/2,xa+=o*(i+t)/2,Ta+=o,o=i*e-r*t,Na+=o*(r+e),Ca+=o*(i+t),ka+=3*o,Qn(r=e,i=t);}var t,n,r,i;Ia.point=function(s,o){Ia.point=e,Qn(t=r=s,n=i=o);},Ia.lineEnd=function(){e(t,n);};}function er(e){function t(t,n){e.moveTo(t,n),e.arc(t,n,o,0,Lu);}function n(t,n){e.moveTo(t,n),u.point=r;}function r(t,n){e.lineTo(t,n);}function i(){u.point=t;}function s(){e.closePath();}var o=4.5,u={point:t,lineStart:function lineStart(){u.point=n;},lineEnd:i,polygonStart:function polygonStart(){u.lineEnd=s;},polygonEnd:function polygonEnd(){u.lineEnd=i,u.point=t;},pointRadius:function pointRadius(e){return o=e,u;},result:y};return u;}function tr(e){function t(e){return(u?r:n)(e);}function n(t){return ir(t,function(n,r){n=e(n,r),t.point(n[0],n[1]);});}function r(t){function n(n,r){n=e(n,r),t.point(n[0],n[1]);}function r(){b=0/0,T.point=s,t.lineStart();}function s(n,r){var s=vn([n,r]),o=e(n,r);i(b,w,y,E,S,x,b=o[0],w=o[1],y=n,E=s[0],S=s[1],x=s[2],u,t),t.point(b,w);}function o(){T.point=n,t.lineEnd();}function a(){r(),T.point=f,T.lineEnd=l;}function f(e,t){s(c=e,h=t),p=b,d=w,v=E,m=S,g=x,T.point=s;}function l(){i(b,w,y,E,S,x,p,d,c,v,m,g,u,t),T.lineEnd=o,o();}var c,h,p,d,v,m,g,y,b,w,E,S,x,T={point:n,lineStart:r,lineEnd:o,polygonStart:function polygonStart(){t.polygonStart(),T.lineStart=a;},polygonEnd:function polygonEnd(){t.polygonEnd(),T.lineStart=r;}};return T;}function i(t,n,r,u,a,f,l,c,h,p,d,v,m,g){var y=l-t,b=c-n,w=y*y+b*b;if(w>4*s&&m--){var E=u+p,S=a+d,x=f+v,T=Math.sqrt(E*E+S*S+x*x),N=Math.asin(x/=T),C=fu(fu(x)-1)<Ou||fu(r-h)<Ou?(r+h)/2:Math.atan2(S,E),k=e(C,N),L=k[0],A=k[1],O=L-t,M=A-n,_=b*O-y*M;(_*_/w>s||fu((y*O+b*M)/w-.5)>.3||o>u*p+a*d+f*v)&&(i(t,n,r,u,a,f,L,A,C,E/=T,S/=T,x,m,g),g.point(L,A),i(L,A,C,E,S,x,l,c,h,p,d,v,m,g));}}var s=.5,o=Math.cos(30*_u),u=16;return t.precision=function(e){return arguments.length?(u=(s=e*e)>0&&16,t):Math.sqrt(s);},t;}function nr(e){var t=tr(function(t,n){return e([t*Du,n*Du]);});return function(e){return ur(t(e));};}function rr(e){this.stream=e;}function ir(e,t){return{point:t,sphere:function sphere(){e.sphere();},lineStart:function lineStart(){e.lineStart();},lineEnd:function lineEnd(){e.lineEnd();},polygonStart:function polygonStart(){e.polygonStart();},polygonEnd:function polygonEnd(){e.polygonEnd();}};}function sr(e){return or(function(){return e;})();}function or(e){function t(e){return e=u(e[0]*_u,e[1]*_u),[e[0]*h+a,f-e[1]*h];}function n(e){return e=u.invert((e[0]-a)/h,(f-e[1])/h),e&&[e[0]*Du,e[1]*Du];}function r(){u=zn(o=lr(g,y,b),s);var e=s(v,m);return a=p-e[0]*h,f=d+e[1]*h,i();}function i(){return l&&(l.valid=!1,l=null),t;}var s,o,u,a,f,l,c=tr(function(e,t){return e=s(e,t),[e[0]*h+a,f-e[1]*h];}),h=150,p=480,d=250,v=0,m=0,g=0,y=0,b=0,w=Aa,E=Ct,S=null,x=null;return t.stream=function(e){return l&&(l.valid=!1),l=ur(w(o,c(E(e)))),l.valid=!0,l;},t.clipAngle=function(e){return arguments.length?(w=null==e?(S=e,Aa):qn((S=+e)*_u),i()):S;},t.clipExtent=function(e){return arguments.length?(x=e,E=e?Un(e[0][0],e[0][1],e[1][0],e[1][1]):Ct,i()):x;},t.scale=function(e){return arguments.length?(h=+e,r()):h;},t.translate=function(e){return arguments.length?(p=+e[0],d=+e[1],r()):[p,d];},t.center=function(e){return arguments.length?(v=e[0]%360*_u,m=e[1]%360*_u,r()):[v*Du,m*Du];},t.rotate=function(e){return arguments.length?(g=e[0]%360*_u,y=e[1]%360*_u,b=e.length>2?e[2]%360*_u:0,r()):[g*Du,y*Du,b*Du];},Ko.rebind(t,c,"precision"),function(){return s=e.apply(this,arguments),t.invert=s.invert&&n,r();};}function ur(e){return ir(e,function(t,n){e.point(t*_u,n*_u);});}function ar(e,t){return[e,t];}function fr(e,t){return[e>ku?e-Lu:-ku>e?e+Lu:e,t];}function lr(e,t,n){return e?t||n?zn(hr(e),pr(t,n)):hr(e):t||n?pr(t,n):fr;}function cr(e){return function(t,n){return t+=e,[t>ku?t-Lu:-ku>t?t+Lu:t,n];};}function hr(e){var t=cr(e);return t.invert=cr(-e),t;}function pr(e,t){function n(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*r+u*i;return[Math.atan2(a*s-l*o,u*r-f*i),et(l*s+a*o)];}var r=Math.cos(e),i=Math.sin(e),s=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*s-a*o;return[Math.atan2(a*s+f*o,u*r+l*i),et(l*r-u*i)];},n;}function dr(e,t){var n=Math.cos(e),r=Math.sin(e);return function(i,s,o,u){var a=o*t;null!=i?(i=vr(n,i),s=vr(n,s),(o>0?s>i:i>s)&&(i+=o*Lu)):(i=e+o*Lu,s=e-.5*a);for(var f,l=i;o>0?l>s:s>l;l-=a){u.point((f=En([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],f[1]);}};}function vr(e,t){var n=vn(t);n[0]-=e,wn(n);var r=Z(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Ou)%(2*Math.PI);}function mr(e,t,n){var r=Ko.range(e,t-Ou,n).concat(t);return function(e){return r.map(function(t){return[e,t];});};}function gr(e,t,n){var r=Ko.range(e,t-Ou,n).concat(t);return function(e){return r.map(function(t){return[t,e];});};}function yr(e){return e.source;}function br(e){return e.target;}function wr(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(r),u=Math.sin(r),a=i*Math.cos(e),f=i*Math.sin(e),l=o*Math.cos(n),c=o*Math.sin(n),h=2*Math.asin(Math.sqrt(it(r-t)+i*o*it(n-e))),p=1/Math.sin(h),d=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,r=n*a+t*l,i=n*f+t*c,o=n*s+t*u;return[Math.atan2(i,r)*Du,Math.atan2(o,Math.sqrt(r*r+i*i))*Du];}:function(){return[e*Du,t*Du];};return d.distance=h,d;}function Er(){function e(e,i){var s=Math.sin(i*=_u),o=Math.cos(i),u=fu((e*=_u)-t),a=Math.cos(u);qa+=Math.atan2(Math.sqrt((u=o*Math.sin(u))*u+(u=r*s-n*o*a)*u),n*s+r*o*a),t=e,n=s,r=o;}var t,n,r;Ra.point=function(i,s){t=i*_u,n=Math.sin(s*=_u),r=Math.cos(s),Ra.point=e;},Ra.lineEnd=function(){Ra.point=Ra.lineEnd=y;};}function Sr(e,t){function n(t,n){var r=Math.cos(t),i=Math.cos(n),s=e(r*i);return[s*i*Math.sin(t),s*Math.sin(n)];}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),i=t(r),s=Math.sin(i),o=Math.cos(i);return[Math.atan2(e*s,r*o),Math.asin(r&&n*s/r)];},n;}function xr(e,t){function n(e,t){o>0?-Au+Ou>t&&(t=-Au+Ou):t>Au-Ou&&(t=Au-Ou);var n=o/Math.pow(i(t),s);return[n*Math.sin(s*e),o-n*Math.cos(s*e)];}var r=Math.cos(e),i=function i(e){return Math.tan(ku/4+e/2);},s=e===t?Math.sin(e):Math.log(r/Math.cos(t))/Math.log(i(t)/i(e)),o=r*Math.pow(i(e),s)/s;return s?(n.invert=function(e,t){var n=o-t,r=G(s)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/s,2*Math.atan(Math.pow(o/r,1/s))-Au];},n):Nr;}function Tr(e,t){function n(e,t){var n=s-t;return[n*Math.sin(i*e),s-n*Math.cos(i*e)];}var r=Math.cos(e),i=e===t?Math.sin(e):(r-Math.cos(t))/(t-e),s=r/i+e;return fu(i)<Ou?ar:(n.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/i,s-G(i)*Math.sqrt(e*e+n*n)];},n);}function Nr(e,t){return[e,Math.log(Math.tan(ku/4+t/2))];}function Cr(e){var t,n=sr(e),r=n.scale,i=n.translate,s=n.clipExtent;return n.scale=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e;},n.translate=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e;},n.clipExtent=function(e){var o=s.apply(n,arguments);if(o===n){if(t=null==e){var u=ku*r(),a=i();s([[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]]);}}else t&&(o=null);return o;},n.clipExtent(null);}function kr(e,t){return[Math.log(Math.tan(ku/4+t/2)),-e];}function Lr(e){return e[0];}function Ar(e){return e[1];}function Or(e){for(var t=e.length,n=[0,1],r=2,i=2;t>i;i++){for(;r>1&&Y(e[n[r-2]],e[n[r-1]],e[i])<=0;){--r;}n[r++]=i;}return n.slice(0,r);}function Mr(e,t){return e[0]-t[0]||e[1]-t[1];}function _r(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0]);}function Dr(e,t,n,r){var i=e[0],s=n[0],o=t[0]-i,u=r[0]-s,a=e[1],f=n[1],l=t[1]-a,c=r[1]-f,h=(u*(a-f)-c*(i-s))/(c*o-u*l);return[i+h*o,a+h*l];}function Pr(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1]);}function Hr(){ni(this),this.edge=this.site=this.circle=null;}function Br(e){var t=Za.pop()||new Hr();return t.site=e,t;}function jr(e){$r(e),Qa.remove(e),Za.push(e),ni(e);}function Fr(e){var t=e.circle,n=t.x,r=t.cy,i={x:n,y:r},s=e.P,o=e.N,u=[e];jr(e);for(var a=s;a.circle&&fu(n-a.circle.x)<Ou&&fu(r-a.circle.cy)<Ou;){s=a.P,u.unshift(a),jr(a),a=s;}u.unshift(a),$r(a);for(var f=o;f.circle&&fu(n-f.circle.x)<Ou&&fu(r-f.circle.cy)<Ou;){o=f.N,u.push(f),jr(f),f=o;}u.push(f),$r(f);var l,c=u.length;for(l=1;c>l;++l){f=u[l],a=u[l-1],Zr(f.edge,a.site,f.site,i);}a=u[0],f=u[c-1],f.edge=Gr(a.site,f.site,null,i),Vr(a),Vr(f);}function Ir(e){for(var t,n,r,i,s=e.x,o=e.y,u=Qa._;u;){if(r=qr(u,o)-s,r>Ou)u=u.L;else{if(i=s-Rr(u,o),!(i>Ou)){r>-Ou?(t=u.P,n=u):i>-Ou?(t=u,n=u.N):t=n=u;break;}if(!u.R){t=u;break;}u=u.R;}}var a=Br(e);if(Qa.insert(t,a),t||n){if(t===n)return $r(t),n=Br(t.site),Qa.insert(a,n),a.edge=n.edge=Gr(t.site,a.site),Vr(t),Vr(n),void 0;if(!n)return a.edge=Gr(t.site,a.site),void 0;$r(t),$r(n);var f=t.site,l=f.x,c=f.y,h=e.x-l,p=e.y-c,d=n.site,v=d.x-l,m=d.y-c,g=2*(h*m-p*v),y=h*h+p*p,b=v*v+m*m,w={x:(m*y-p*b)/g+l,y:(h*b-v*y)/g+c};Zr(n.edge,f,d,w),a.edge=Gr(f,e,null,w),n.edge=Gr(e,d,null,w),Vr(t),Vr(n);}}function qr(e,t){var n=e.site,r=n.x,i=n.y,s=i-t;if(!s)return r;var o=e.P;if(!o)return-1/0;n=o.site;var u=n.x,a=n.y,f=a-t;if(!f)return u;var l=u-r,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-a+f/2+i-s/2)))/c+r:(r+u)/2;}function Rr(e,t){var n=e.N;if(n)return qr(n,t);var r=e.site;return r.y===t?r.x:1/0;}function Ur(e){this.site=e,this.edges=[];}function zr(e){for(var t,n,r,i,s,o,u,a,f,l,c=e[0][0],h=e[1][0],p=e[0][1],d=e[1][1],v=Ka,m=v.length;m--;){if(s=v[m],s&&s.prepare())for(u=s.edges,a=u.length,o=0;a>o;){l=u[o].end(),r=l.x,i=l.y,f=u[++o%a].start(),t=f.x,n=f.y,(fu(r-t)>Ou||fu(i-n)>Ou)&&(u.splice(o,0,new ei(Yr(s.site,l,fu(r-c)<Ou&&d-i>Ou?{x:c,y:fu(t-c)<Ou?n:d}:fu(i-d)<Ou&&h-r>Ou?{x:fu(n-d)<Ou?t:h,y:d}:fu(r-h)<Ou&&i-p>Ou?{x:h,y:fu(t-h)<Ou?n:p}:fu(i-p)<Ou&&r-c>Ou?{x:fu(n-p)<Ou?t:c,y:p}:null),s.site,null)),++a);}}}function Wr(e,t){return t.angle-e.angle;}function Xr(){ni(this),this.x=this.y=this.arc=this.site=this.cy=null;}function Vr(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,s=n.site;if(r!==s){var o=i.x,u=i.y,a=r.x-o,f=r.y-u,l=s.x-o,c=s.y-u,h=2*(a*c-f*l);if(!(h>=-Mu)){var p=a*a+f*f,d=l*l+c*c,v=(c*p-f*d)/h,m=(a*d-l*p)/h,c=m+u,g=ef.pop()||new Xr();g.arc=e,g.site=i,g.x=v+o,g.y=c+Math.sqrt(v*v+m*m),g.cy=c,e.circle=g;for(var y=null,b=Ya._;b;){if(g.y<b.y||g.y===b.y&&g.x<=b.x){if(!b.L){y=b.P;break;}b=b.L;}else{if(!b.R){y=b;break;}b=b.R;}}Ya.insert(y,g),y||(Ga=g);}}}}function $r(e){var t=e.circle;t&&(t.P||(Ga=t.N),Ya.remove(t),ef.push(t),ni(t),e.circle=null);}function Jr(e){for(var t,n=Ja,r=Rn(e[0][0],e[0][1],e[1][0],e[1][1]),i=n.length;i--;){t=n[i],(!Kr(t,e)||!r(t)||fu(t.a.x-t.b.x)<Ou&&fu(t.a.y-t.b.y)<Ou)&&(t.a=t.b=null,n.splice(i,1));}}function Kr(e,t){var n=e.b;if(n)return!0;var r,i,s=e.a,o=t[0][0],u=t[1][0],a=t[0][1],f=t[1][1],l=e.l,c=e.r,h=l.x,p=l.y,d=c.x,v=c.y,m=(h+d)/2,g=(p+v)/2;if(v===p){if(o>m||m>=u)return;if(h>d){if(s){if(s.y>=f)return;}else s={x:m,y:a};n={x:m,y:f};}else{if(s){if(s.y<a)return;}else s={x:m,y:f};n={x:m,y:a};}}else if(r=(h-d)/(v-p),i=g-r*m,-1>r||r>1){if(h>d){if(s){if(s.y>=f)return;}else s={x:(a-i)/r,y:a};n={x:(f-i)/r,y:f};}else{if(s){if(s.y<a)return;}else s={x:(f-i)/r,y:f};n={x:(a-i)/r,y:a};}}else if(v>p){if(s){if(s.x>=u)return;}else s={x:o,y:r*o+i};n={x:u,y:r*u+i};}else{if(s){if(s.x<o)return;}else s={x:u,y:r*u+i};n={x:o,y:r*o+i};}return e.a=s,e.b=n,!0;}function Qr(e,t){this.l=e,this.r=t,this.a=this.b=null;}function Gr(e,t,n,r){var i=new Qr(e,t);return Ja.push(i),n&&Zr(i,e,t,n),r&&Zr(i,t,e,r),Ka[e.i].edges.push(new ei(i,e,t)),Ka[t.i].edges.push(new ei(i,t,e)),i;}function Yr(e,t,n){var r=new Qr(e,null);return r.a=t,r.b=n,Ja.push(r),r;}function Zr(e,t,n,r){e.a||e.b?e.l===n?e.b=r:e.a=r:(e.a=r,e.l=t,e.r=n);}function ei(e,t,n){var r=e.a,i=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y);}function ti(){this._=null;}function ni(e){e.U=e.C=e.L=e.R=e.P=e.N=null;}function ri(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n;}function ii(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n;}function si(e){for(;e.L;){e=e.L;}return e;}function oi(e,t){var n,r,i,s=e.sort(ui).pop();for(Ja=[],Ka=new Array(e.length),Qa=new ti(),Ya=new ti();;){if(i=Ga,s&&(!i||s.y<i.y||s.y===i.y&&s.x<i.x))(s.x!==n||s.y!==r)&&(Ka[s.i]=new Ur(s),Ir(s),n=s.x,r=s.y),s=e.pop();else{if(!i)break;Fr(i.arc);}}t&&(Jr(t),zr(t));var o={cells:Ka,edges:Ja};return Qa=Ya=Ja=Ka=null,o;}function ui(e,t){return t.y-e.y||t.x-e.x;}function ai(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y);}function fi(e){return e.x;}function li(e){return e.y;}function ci(){return{leaf:!0,nodes:[],point:null,x:null,y:null};}function hi(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=.5*(n+i),u=.5*(r+s),a=t.nodes;a[0]&&hi(e,a[0],n,r,o,u),a[1]&&hi(e,a[1],o,r,i,u),a[2]&&hi(e,a[2],n,u,o,s),a[3]&&hi(e,a[3],o,u,i,s);}}function pi(e,t){e=Ko.rgb(e),t=Ko.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+bt(Math.round(n+s*e))+bt(Math.round(r+o*e))+bt(Math.round(i+u*e));};}function di(e,t){var n,r={},i={};for(n in e){n in t?r[n]=gi(e[n],t[n]):i[n]=e[n];}for(n in t){n in e||(i[n]=t[n]);}return function(e){for(n in r){i[n]=r[n](e);}return i;};}function vi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n;};}function mi(e,t){var n,r,i,s=nf.lastIndex=rf.lastIndex=0,o=-1,u=[],a=[];for(e+="",t+="";(n=nf.exec(e))&&(r=rf.exec(t));){(i=r.index)>s&&(i=t.slice(s,i),u[o]?u[o]+=i:u[++o]=i),(n=n[0])===(r=r[0])?u[o]?u[o]+=r:u[++o]=r:(u[++o]=null,a.push({i:o,x:vi(n,r)})),s=rf.lastIndex;}return s<t.length&&(i=t.slice(s),u[o]?u[o]+=i:u[++o]=i),u.length<2?a[0]?(t=a[0].x,function(e){return t(e)+"";}):function(){return t;}:(t=a.length,function(e){for(var n,r=0;t>r;++r){u[(n=a[r]).i]=n.x(e);}return u.join("");});}function gi(e,t){for(var n,r=Ko.interpolators.length;--r>=0&&!(n=Ko.interpolators[r](e,t));){;}return n;}function yi(e,t){var n,r=[],i=[],s=e.length,o=t.length,u=Math.min(e.length,t.length);for(n=0;u>n;++n){r.push(gi(e[n],t[n]));}for(;s>n;++n){i[n]=e[n];}for(;o>n;++n){i[n]=t[n];}return function(e){for(n=0;u>n;++n){i[n]=r[n](e);}return i;};}function bi(e){return function(t){return 0>=t?0:t>=1?1:e(t);};}function wi(e){return function(t){return 1-e(1-t);};}function Ei(e){return function(t){return .5*(.5>t?e(2*t):2-e(2-2*t));};}function Si(e){return e*e;}function xi(e){return e*e*e;}function Ti(e){if(0>=e)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(.5>e?n:3*(e-t)+n-.75);}function Ni(e){return function(t){return Math.pow(t,e);};}function Ci(e){return 1-Math.cos(e*Au);}function ki(e){return Math.pow(2,10*(e-1));}function Li(e){return 1-Math.sqrt(1-e*e);}function Ai(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/Lu*Math.asin(1/e):(e=1,n=t/4),function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*Lu/t);};}function Oi(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e);};}function Mi(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375;}function _i(e,t){e=Ko.hcl(e),t=Ko.hcl(t);var n=e.h,r=e.c,i=e.l,s=t.h-n,o=t.c-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return ft(n+s*e,r+o*e,i+u*e)+"";};}function Di(e,t){e=Ko.hsl(e),t=Ko.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return ut(n+s*e,r+o*e,i+u*e)+"";};}function Pi(e,t){e=Ko.lab(e),t=Ko.lab(t);var n=e.l,r=e.a,i=e.b,s=t.l-n,o=t.a-r,u=t.b-i;return function(e){return ct(n+s*e,r+o*e,i+u*e)+"";};}function Hi(e,t){return t-=e,function(n){return Math.round(e+t*n);};}function Bi(e){var t=[e.a,e.b],n=[e.c,e.d],r=Fi(t),i=ji(t,n),s=Fi(Ii(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*Du,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*Du:0;}function ji(e,t){return e[0]*t[0]+e[1]*t[1];}function Fi(e){var t=Math.sqrt(ji(e,e));return t&&(e[0]/=t,e[1]/=t),t;}function Ii(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e;}function qi(e,t){var n,r=[],i=[],s=Ko.transform(e),o=Ko.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;return u[0]!=a[0]||u[1]!=a[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:vi(u[0],a[0])},{i:3,x:vi(u[1],a[1])})):a[0]||a[1]?r.push("translate("+a+")"):r.push(""),f!=l?(f-l>180?l+=360:l-f>180&&(f+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:vi(f,l)})):l&&r.push(r.pop()+"rotate("+l+")"),c!=h?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:vi(c,h)}):h&&r.push(r.pop()+"skewX("+h+")"),p[0]!=d[0]||p[1]!=d[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:vi(p[0],d[0])},{i:n-2,x:vi(p[1],d[1])})):(1!=d[0]||1!=d[1])&&r.push(r.pop()+"scale("+d+")"),n=i.length,function(e){for(var t,s=-1;++s<n;){r[(t=i[s]).i]=t.x(e);}return r.join("");};}function Ri(e,t){return t=(t-=e=+e)||1/t,function(n){return(n-e)/t;};}function Ui(e,t){return t=(t-=e=+e)||1/t,function(n){return Math.max(0,Math.min(1,(n-e)/t));};}function zi(e){for(var t=e.source,n=e.target,r=Xi(t,n),i=[t];t!==r;){t=t.parent,i.push(t);}for(var s=i.length;n!==r;){i.splice(s,0,n),n=n.parent;}return i;}function Wi(e){for(var t=[],n=e.parent;null!=n;){t.push(e),e=n,n=n.parent;}return t.push(e),t;}function Xi(e,t){if(e===t)return e;for(var n=Wi(e),r=Wi(t),i=n.pop(),s=r.pop(),o=null;i===s;){o=i,i=n.pop(),s=r.pop();}return o;}function Vi(e){e.fixed|=2;}function $i(e){e.fixed&=-7;}function Ji(e){e.fixed|=4,e.px=e.x,e.py=e.y;}function Ki(e){e.fixed&=-5;}function Qi(e,t,n){var r=0,i=0;if(e.charge=0,!e.leaf)for(var s,o=e.nodes,u=o.length,a=-1;++a<u;){s=o[a],null!=s&&(Qi(s,t,n),e.charge+=s.charge,r+=s.charge*s.cx,i+=s.charge*s.cy);}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y;}e.cx=r/e.charge,e.cy=i/e.charge;}function Gi(e,t){return Ko.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=rs,e;}function Yi(e,t){for(var n=[e];null!=(e=n.pop());){if(t(e),(i=e.children)&&(r=i.length))for(var r,i;--r>=0;){n.push(i[r]);}}}function Zi(e,t){for(var n=[e],r=[];null!=(e=n.pop());){if(r.push(e),(s=e.children)&&(i=s.length))for(var i,s,o=-1;++o<i;){n.push(s[o]);}}for(;null!=(e=r.pop());){t(e);}}function es(e){return e.children;}function ts(e){return e.value;}function ns(e,t){return t.value-e.value;}function rs(e){return Ko.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t};});}));}function is(e){return e.x;}function ss(e){return e.y;}function os(e,t,n){e.y0=t,e.y=n;}function us(e){return Ko.range(e.length);}function as(e){for(var t=-1,n=e[0].length,r=[];++t<n;){r[t]=0;}return r;}function fs(e){for(var t,n=1,r=0,i=e[0][1],s=e.length;s>n;++n){(t=e[n][1])>i&&(r=n,i=t);}return r;}function ls(e){return e.reduce(cs,0);}function cs(e,t){return e+t[1];}function hs(e,t){return ps(e,Math.ceil(Math.log(t.length)/Math.LN2+1));}function ps(e,t){for(var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];++n<=t;){s[n]=i*n+r;}return s;}function ds(e){return[Ko.min(e),Ko.max(e)];}function vs(e,t){return e.value-t.value;}function ms(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t;}function gs(e,t){e._pack_next=t,t._pack_prev=e;}function ys(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return .999*i*i>n*n+r*r;}function bs(e){function t(e){l=Math.min(e.x-e.r,l),c=Math.max(e.x+e.r,c),h=Math.min(e.y-e.r,h),p=Math.max(e.y+e.r,p);}if((n=e.children)&&(f=n.length)){var n,r,i,s,o,u,a,f,l=1/0,c=-1/0,h=1/0,p=-1/0;if(n.forEach(ws),r=n[0],r.x=-r.r,r.y=0,t(r),f>1&&(i=n[1],i.x=i.r,i.y=0,t(i),f>2))for(s=n[2],xs(r,i,s),t(s),ms(r,s),r._pack_prev=s,ms(s,i),i=r._pack_next,o=3;f>o;o++){xs(r,i,s=n[o]);var d=0,v=1,m=1;for(u=i._pack_next;u!==i;u=u._pack_next,v++){if(ys(u,s)){d=1;break;}}if(1==d)for(a=r._pack_prev;a!==u._pack_prev&&!ys(a,s);a=a._pack_prev,m++){;}d?(m>v||v==m&&i.r<r.r?gs(r,i=u):gs(r=a,i),o--):(ms(r,s),i=s,t(s));}var g=(l+c)/2,y=(h+p)/2,b=0;for(o=0;f>o;o++){s=n[o],s.x-=g,s.y-=y,b=Math.max(b,s.r+Math.sqrt(s.x*s.x+s.y*s.y));}e.r=b,n.forEach(Es);}}function ws(e){e._pack_next=e._pack_prev=e;}function Es(e){delete e._pack_next,delete e._pack_prev;}function Ss(e,t,n,r){var i=e.children;if(e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r,i)for(var s=-1,o=i.length;++s<o;){Ss(i[s],t,n,r);}}function xs(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=i*i+s*s;o*=o,r*=r;var a=.5+(r-o)/(2*u),f=Math.sqrt(Math.max(0,2*o*(r+u)-(r-=u)*r-o*o))/(2*u);n.x=e.x+a*i+f*s,n.y=e.y+a*s-f*i;}else n.x=e.x+r,n.y=e.y;}function Ts(e,t){return e.parent==t.parent?1:2;}function Ns(e){var t=e.children;return t.length?t[0]:e.t;}function Cs(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t;}function ks(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n;}function Ls(e){for(var t,n=0,r=0,i=e.children,s=i.length;--s>=0;){t=i[s],t.z+=n,t.m+=n,n+=t.s+(r+=t.c);}}function As(e,t,n){return e.a.parent===t.parent?e.a:n;}function Os(e){return 1+Ko.max(e,function(e){return e.y;});}function Ms(e){return e.reduce(function(e,t){return e+t.x;},0)/e.length;}function _s(e){var t=e.children;return t&&t.length?_s(t[0]):e;}function Ds(e){var t,n=e.children;return n&&(t=n.length)?Ds(n[t-1]):e;}function Ps(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy};}function Hs(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return 0>i&&(n+=i/2,i=0),0>s&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s};}function Bs(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t];}function js(e){return e.rangeExtent?e.rangeExtent():Bs(e.range());}function Fs(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e));};}function Is(e,t){var n,r=0,i=e.length-1,s=e[r],o=e[i];return s>o&&(n=r,r=i,i=n,n=s,s=o,o=n),e[r]=t.floor(s),e[i]=t.ceil(o),e;}function qs(e){return e?{floor:function floor(t){return Math.floor(t/e)*e;},ceil:function ceil(t){return Math.ceil(t/e)*e;}}:vf;}function Rs(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;for(e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=u;){i.push(n(e[o-1],e[o])),s.push(r(t[o-1],t[o]));}return function(t){var n=Ko.bisect(e,t,1,u)-1;return s[n](i[n](t));};}function Us(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?Rs:Fs,a=r?Ui:Ri;return o=i(e,t,a,n),u=i(t,e,a,gi),s;}function s(e){return o(e);}var o,u;return s.invert=function(e){return u(e);},s.domain=function(t){return arguments.length?(e=t.map(Number),i()):e;},s.range=function(e){return arguments.length?(t=e,i()):t;},s.rangeRound=function(e){return s.range(e).interpolate(Hi);},s.clamp=function(e){return arguments.length?(r=e,i()):r;},s.interpolate=function(e){return arguments.length?(n=e,i()):n;},s.ticks=function(t){return Vs(e,t);},s.tickFormat=function(t,n){return $s(e,t,n);},s.nice=function(t){return Ws(e,t),i();},s.copy=function(){return Us(e,t,n,r);},i();}function zs(e,t){return Ko.rebind(e,t,"range","rangeRound","interpolate","clamp");}function Ws(e,t){return Is(e,qs(Xs(e,t)[2]));}function Xs(e,t){null==t&&(t=10);var n=Bs(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return .15>=s?i*=10:.35>=s?i*=5:.75>=s&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n;}function Vs(e,t){return Ko.range.apply(Ko,Xs(e,t));}function $s(e,t,n){var r=Xs(e,t);if(n){var i=na.exec(n);if(i.shift(),"s"===i[8]){var s=Ko.formatPrefix(Math.max(fu(r[0]),fu(r[1])));return i[7]||(i[7]="."+Js(s.scale(r[2]))),i[8]="f",n=Ko.format(i.join("")),function(e){return n(s.scale(e))+s.symbol;};}i[7]||(i[7]="."+Ks(i[8],r)),n=i.join("");}else n=",."+Js(r[2])+"f";return Ko.format(n);}function Js(e){return-Math.floor(Math.log(e)/Math.LN10+.01);}function Ks(e,t){var n=Js(t[2]);return e in mf?Math.abs(n-Js(Math.max(fu(t[0]),fu(t[1]))))+ +("e"!==e):n-2*("%"===e);}function Qs(e,t,n,r){function i(e){return(n?Math.log(0>e?0:e):-Math.log(e>0?0:-e))/Math.log(t);}function s(e){return n?Math.pow(t,e):-Math.pow(t,-e);}function o(t){return e(i(t));}return o.invert=function(t){return s(e.invert(t));},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((r=t.map(Number)).map(i)),o):r;},o.base=function(n){return arguments.length?(t=+n,e.domain(r.map(i)),o):t;},o.nice=function(){var t=Is(r.map(i),n?Math:yf);return e.domain(t),r=t.map(s),o;},o.ticks=function(){var e=Bs(r),o=[],u=e[0],a=e[1],f=Math.floor(i(u)),l=Math.ceil(i(a)),c=t%1?2:t;if(isFinite(l-f)){if(n){for(;l>f;f++){for(var h=1;c>h;h++){o.push(s(f)*h);}}o.push(s(f));}else for(o.push(s(f));f++<l;){for(var h=c-1;h>0;h--){o.push(s(f)*h);}}for(f=0;o[f]<u;f++){;}for(l=o.length;o[l-1]>a;l--){;}o=o.slice(f,l);}return o;},o.tickFormat=function(e,t){if(!arguments.length)return gf;arguments.length<2?t=gf:"function"!=typeof t&&(t=Ko.format(t));var r,u=Math.max(.1,e/o.ticks().length),a=n?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(e){return e/s(a(i(e)+r))<=u?t(e):"";};},o.copy=function(){return Qs(e.copy(),t,n,r);},zs(o,e);}function Gs(e,t,n){function r(t){return e(i(t));}var i=Ys(t),s=Ys(1/t);return r.invert=function(t){return s(e.invert(t));},r.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(i)),r):n;},r.ticks=function(e){return Vs(n,e);},r.tickFormat=function(e,t){return $s(n,e,t);},r.nice=function(e){return r.domain(Ws(n,e));},r.exponent=function(o){return arguments.length?(i=Ys(t=o),s=Ys(1/t),e.domain(n.map(i)),r):t;},r.copy=function(){return Gs(e.copy(),t,n);},zs(r,e);}function Ys(e){return function(t){return 0>t?-Math.pow(-t,e):Math.pow(t,e);};}function Zs(e,t){function n(n){return s[((i.get(n)||("range"===t.t?i.set(n,e.push(n)):0/0))-1)%s.length];}function r(t,n){return Ko.range(e.length).map(function(e){return t+n*e;});}var i,s,o;return n.domain=function(r){if(!arguments.length)return e;e=[],i=new u();for(var s,o=-1,a=r.length;++o<a;){i.has(s=r[o])||i.set(s,e.push(s));}return n[t.t].apply(n,t.a);},n.range=function(e){return arguments.length?(s=e,o=0,t={t:"range",a:arguments},n):s;},n.rangePoints=function(i,u){arguments.length<2&&(u=0);var a=i[0],f=i[1],l=(f-a)/(Math.max(1,e.length-1)+u);return s=r(e.length<2?(a+f)/2:a+l*u/2,l),o=0,t={t:"rangePoints",a:arguments},n;},n.rangeBands=function(i,u,a){arguments.length<2&&(u=0),arguments.length<3&&(a=u);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=(c-l)/(e.length-u+2*a);return s=r(l+h*a,h),f&&s.reverse(),o=h*(1-u),t={t:"rangeBands",a:arguments},n;},n.rangeRoundBands=function(i,u,a){arguments.length<2&&(u=0),arguments.length<3&&(a=u);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=Math.floor((c-l)/(e.length-u+2*a)),p=c-l-(e.length-u)*h;return s=r(l+Math.round(p/2),h),f&&s.reverse(),o=Math.round(h*(1-u)),t={t:"rangeRoundBands",a:arguments},n;},n.rangeBand=function(){return o;},n.rangeExtent=function(){return Bs(t.a[0]);},n.copy=function(){return Zs(e,t);},n.domain(e);}function eo(r,i){function s(){var e=0,t=i.length;for(u=[];++e<t;){u[e-1]=Ko.quantile(r,e/t);}return o;}function o(e){return isNaN(e=+e)?void 0:i[Ko.bisect(u,e)];}var u;return o.domain=function(i){return arguments.length?(r=i.map(t).filter(n).sort(e),s()):r;},o.range=function(e){return arguments.length?(i=e,s()):i;},o.quantiles=function(){return u;},o.invertExtent=function(e){return e=i.indexOf(e),0>e?[0/0,0/0]:[e>0?u[e-1]:r[0],e<u.length?u[e]:r[r.length-1]];},o.copy=function(){return eo(r,i);},s();}function to(e,t,n){function r(t){return n[Math.max(0,Math.min(o,Math.floor(s*(t-e))))];}function i(){return s=n.length/(t-e),o=n.length-1,r;}var s,o;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t];},r.range=function(e){return arguments.length?(n=e,i()):n;},r.invertExtent=function(t){return t=n.indexOf(t),t=0>t?0/0:t/s+e,[t,t+1/s];},r.copy=function(){return to(e,t,n);},i();}function no(e,t){function n(n){return n>=n?t[Ko.bisect(e,n)]:void 0;}return n.domain=function(t){return arguments.length?(e=t,n):e;},n.range=function(e){return arguments.length?(t=e,n):t;},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]];},n.copy=function(){return no(e,t);},n;}function ro(e){function t(e){return+e;}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e;},t.ticks=function(t){return Vs(e,t);},t.tickFormat=function(t,n){return $s(e,t,n);},t.copy=function(){return ro(e);},t;}function io(e){return e.innerRadius;}function so(e){return e.outerRadius;}function oo(e){return e.startAngle;}function uo(e){return e.endAngle;}function ao(e){function t(t){function o(){f.push("M",s(e(l),u));}for(var a,f=[],l=[],c=-1,h=t.length,p=Nt(n),d=Nt(r);++c<h;){i.call(this,a=t[c],c)?l.push([+p.call(this,a,c),+d.call(this,a,c)]):l.length&&(o(),l=[]);}return l.length&&o(),f.length?f.join(""):null;}var n=Lr,r=Ar,i=Ln,s=fo,o=s.key,u=.7;return t.x=function(e){return arguments.length?(n=e,t):n;},t.y=function(e){return arguments.length?(r=e,t):r;},t.defined=function(e){return arguments.length?(i=e,t):i;},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?s=e:(s=Nf.get(e)||fo).key,t):o;},t.tension=function(e){return arguments.length?(u=e,t):u;},t;}function fo(e){return e.join("L");}function lo(e){return fo(e)+"Z";}function co(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;){i.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);}return n>1&&i.push("H",r[0]),i.join("");}function ho(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;){i.push("V",(r=e[t])[1],"H",r[0]);}return i.join("");}function po(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;){i.push("H",(r=e[t])[0],"V",r[1]);}return i.join("");}function vo(e,t){return e.length<4?fo(e):e[1]+yo(e.slice(1,e.length-1),bo(e,t));}function mo(e,t){return e.length<3?fo(e):e[0]+yo((e.push(e[0]),e),bo([e[e.length-2]].concat(e,[e[1]]),t));}function go(e,t){return e.length<3?fo(e):e[0]+yo(e,bo(e,t));}function yo(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return fo(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;if(n&&(r+="Q"+(s[0]-2*o[0]/3)+","+(s[1]-2*o[1]/3)+","+s[0]+","+s[1],i=e[1],a=2),t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++){s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];}}if(n){var l=e[a];r+="Q"+(s[0]+2*u[0]/3)+","+(s[1]+2*u[1]/3)+","+l[0]+","+l[1];}return r;}function bo(e,t){for(var n,r=[],i=(1-t)/2,s=e[0],o=e[1],u=1,a=e.length;++u<a;){n=s,s=o,o=e[u],r.push([i*(o[0]-n[0]),i*(o[1]-n[1])]);}return r;}function wo(e){if(e.length<3)return fo(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s,"L",To(Lf,o),",",To(Lf,u)];for(e.push(e[n-1]);++t<=n;){r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),No(a,o,u);}return e.pop(),a.push("L",r),a.join("");}function Eo(e){if(e.length<4)return fo(e);for(var t,n=[],r=-1,i=e.length,s=[0],o=[0];++r<3;){t=e[r],s.push(t[0]),o.push(t[1]);}for(n.push(To(Lf,s)+","+To(Lf,o)),--r;++r<i;){t=e[r],s.shift(),s.push(t[0]),o.shift(),o.push(t[1]),No(n,s,o);}return n.join("");}function So(e){for(var t,n,r=-1,i=e.length,s=i+4,o=[],u=[];++r<4;){n=e[r%i],o.push(n[0]),u.push(n[1]);}for(t=[To(Lf,o),",",To(Lf,u)],--r;++r<s;){n=e[r%i],o.shift(),o.push(n[0]),u.shift(),u.push(n[1]),No(t,o,u);}return t.join("");}function xo(e,t){var n=e.length-1;if(n)for(var r,i,s=e[0][0],o=e[0][1],u=e[n][0]-s,a=e[n][1]-o,f=-1;++f<=n;){r=e[f],i=f/n,r[0]=t*r[0]+(1-t)*(s+i*u),r[1]=t*r[1]+(1-t)*(o+i*a);}return wo(e);}function To(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];}function No(e,t,n){e.push("C",To(Cf,t),",",To(Cf,n),",",To(kf,t),",",To(kf,n),",",To(Lf,t),",",To(Lf,n));}function Co(e,t){return(t[1]-e[1])/(t[0]-e[0]);}function ko(e){for(var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=Co(i,s);++t<n;){r[t]=(o+(o=Co(i=s,s=e[t+1])))/2;}return r[t]=o,r;}function Lo(e){for(var t,n,r,i,s=[],o=ko(e),u=-1,a=e.length-1;++u<a;){t=Co(e[u],e[u+1]),fu(t)<Ou?o[u]=o[u+1]=0:(n=o[u]/t,r=o[u+1]/t,i=n*n+r*r,i>9&&(i=3*t/Math.sqrt(i),o[u]=i*n,o[u+1]=i*r));}for(u=-1;++u<=a;){i=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),s.push([i||0,o[u]*i||0]);}return s;}function Ao(e){return e.length<3?fo(e):e[0]+yo(e,Lo(e));}function Oo(e){for(var t,n,r,i=-1,s=e.length;++i<s;){t=e[i],n=t[0],r=t[1]+xf,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);}return e;}function Mo(e){function t(t){function a(){v.push("M",u(e(g),c),l,f(e(m.reverse()),c),"Z");}for(var h,p,d,v=[],m=[],g=[],y=-1,b=t.length,w=Nt(n),E=Nt(i),S=n===r?function(){return p;}:Nt(r),x=i===s?function(){return d;}:Nt(s);++y<b;){o.call(this,h=t[y],y)?(m.push([p=+w.call(this,h,y),d=+E.call(this,h,y)]),g.push([+S.call(this,h,y),+x.call(this,h,y)])):m.length&&(a(),m=[],g=[]);}return m.length&&a(),v.length?v.join(""):null;}var n=Lr,r=Lr,i=0,s=Ar,o=Ln,u=fo,a=u.key,f=u,l="L",c=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r;},t.x0=function(e){return arguments.length?(n=e,t):n;},t.x1=function(e){return arguments.length?(r=e,t):r;},t.y=function(e){return arguments.length?(i=s=e,t):s;},t.y0=function(e){return arguments.length?(i=e,t):i;},t.y1=function(e){return arguments.length?(s=e,t):s;},t.defined=function(e){return arguments.length?(o=e,t):o;},t.interpolate=function(e){return arguments.length?(a="function"==typeof e?u=e:(u=Nf.get(e)||fo).key,f=u.reverse||u,l=u.closed?"M":"L",t):a;},t.tension=function(e){return arguments.length?(c=e,t):c;},t;}function _o(e){return e.radius;}function Do(e){return[e.x,e.y];}function Po(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+xf;return[n*Math.cos(r),n*Math.sin(r)];};}function Ho(){return 64;}function Bo(){return"circle";}function jo(e){var t=Math.sqrt(e/ku);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z";}function Fo(e,t){return du(e,Pf),e.id=t,e;}function Io(e,t,n,r){var i=e.id;return I(e,"function"==typeof n?function(e,s,o){e.__transition__[i].tween.set(t,r(n.call(e,e.__data__,s,o)));}:(n=r(n),function(e){e.__transition__[i].tween.set(t,n);}));}function qo(e){return null==e&&(e=""),function(){this.textContent=e;};}function Ro(e,t,n,r){var i=e.__transition__||(e.__transition__={active:0,count:0}),s=i[n];if(!s){var o=r.time;s=i[n]={tween:new u(),time:o,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,Ko.timer(function(r){function u(r){return i.active>n?f():(i.active=n,s.event&&s.event.start.call(e,l,t),s.tween.forEach(function(n,r){(r=r.call(e,l,t))&&v.push(r);}),Ko.timer(function(){return d.c=a(r||1)?Ln:a,1;},0,o),void 0);}function a(r){if(i.active!==n)return f();for(var o=r/p,u=c(o),a=v.length;a>0;){v[--a].call(e,u);}return o>=1?(s.event&&s.event.end.call(e,l,t),f()):void 0;}function f(){return--i.count?delete i[n]:delete e.__transition__,1;}var l=e.__data__,c=s.ease,h=s.delay,p=s.duration,d=Zu,v=[];return d.t=h+o,r>=h?u(r-h):(d.c=u,void 0);},0,o);}}function Uo(e,t,n){e.attr("transform",function(e){var r=t(e);return"translate("+(isFinite(r)?r:n(e))+",0)";});}function zo(e,t,n){e.attr("transform",function(e){var r=t(e);return"translate(0,"+(isFinite(r)?r:n(e))+")";});}function Wo(e){return e.toISOString();}function Xo(e,t,n){function r(t){return e(t);}function i(e,n){var r=e[1]-e[0],i=r/n,s=Ko.bisect(zf,i);return s==zf.length?[t.year,Xs(e.map(function(e){return e/31536e6;}),n)[2]]:s?t[i/zf[s-1]<zf[s]/i?s-1:s]:[Vf,Xs(e,n)[2]];}return r.invert=function(t){return Vo(e.invert(t));},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(Vo);},r.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,Vo(+n+1),t).length;}var s=r.domain(),o=Bs(s),u=null==e?i(o,10):"number"==typeof e&&i(o,e);return u&&(e=u[0],t=u[1]),r.domain(Is(s,t>1?{floor:function floor(t){for(;n(t=e.floor(t));){t=Vo(t-1);}return t;},ceil:function ceil(t){for(;n(t=e.ceil(t));){t=Vo(+t+1);}return t;}}:e));},r.ticks=function(e,t){var n=Bs(r.domain()),s=null==e?i(n,10):"number"==typeof e?i(n,e):!e.range&&[{range:e},t];return s&&(e=s[0],t=s[1]),e.range(n[0],Vo(+n[1]+1),1>t?1:t);},r.tickFormat=function(){return n;},r.copy=function(){return Xo(e.copy(),t,n);},zs(r,e);}function Vo(e){return new Date(e);}function $o(e){return JSON.parse(e.responseText);}function Jo(e){var t=Yo.createRange();return t.selectNode(Yo.body),t.createContextualFragment(e.responseText);}var Ko={version:"3.4.13"};Date.now||(Date.now=function(){return+new Date();});var Qo=[].slice,Go=function Go(e){return Qo.call(e);},Yo=document,Zo=Yo.documentElement,eu=window;try{Go(Zo.childNodes)[0].nodeType;}catch(tu){Go=function Go(e){for(var t=e.length,n=new Array(t);t--;){n[t]=e[t];}return n;};}try{Yo.createElement("div").style.setProperty("opacity",0,"");}catch(nu){var ru=eu.Element.prototype,iu=ru.setAttribute,su=ru.setAttributeNS,ou=eu.CSSStyleDeclaration.prototype,uu=ou.setProperty;ru.setAttribute=function(e,t){iu.call(this,e,t+"");},ru.setAttributeNS=function(e,t,n){su.call(this,e,t,n+"");},ou.setProperty=function(e,t,n){uu.call(this,e,t+"",n);};}Ko.ascending=e,Ko.descending=function(e,t){return e>t?-1:t>e?1:t>=e?0:0/0;},Ko.min=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);){n=void 0;}for(;++i<s;){null!=(r=e[i])&&n>r&&(n=r);}}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);){n=void 0;}for(;++i<s;){null!=(r=t.call(e,e[i],i))&&n>r&&(n=r);}}return n;},Ko.max=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);){n=void 0;}for(;++i<s;){null!=(r=e[i])&&r>n&&(n=r);}}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);){n=void 0;}for(;++i<s;){null!=(r=t.call(e,e[i],i))&&r>n&&(n=r);}}return n;},Ko.extent=function(e,t){var n,r,i,s=-1,o=e.length;if(1===arguments.length){for(;++s<o&&!(null!=(n=i=e[s])&&n>=n);){n=i=void 0;}for(;++s<o;){null!=(r=e[s])&&(n>r&&(n=r),r>i&&(i=r));}}else{for(;++s<o&&!(null!=(n=i=t.call(e,e[s],s))&&n>=n);){n=void 0;}for(;++s<o;){null!=(r=t.call(e,e[s],s))&&(n>r&&(n=r),r>i&&(i=r));}}return[n,i];},Ko.sum=function(e,t){var r,i=0,s=e.length,o=-1;if(1===arguments.length)for(;++o<s;){n(r=+e[o])&&(i+=r);}else for(;++o<s;){n(r=+t.call(e,e[o],o))&&(i+=r);}return i;},Ko.mean=function(e,r){var i,s=0,o=e.length,u=-1,a=o;if(1===arguments.length)for(;++u<o;){n(i=t(e[u]))?s+=i:--a;}else for(;++u<o;){n(i=t(r.call(e,e[u],u)))?s+=i:--a;}return a?s/a:void 0;},Ko.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=+e[r-1],s=n-r;return s?i+s*(e[r]-i):i;},Ko.median=function(r,i){var s,o=[],u=r.length,a=-1;if(1===arguments.length)for(;++a<u;){n(s=t(r[a]))&&o.push(s);}else for(;++a<u;){n(s=t(i.call(r,r[a],a)))&&o.push(s);}return o.length?Ko.quantile(o.sort(e),.5):void 0;};var au=r(e);Ko.bisectLeft=au.left,Ko.bisect=Ko.bisectRight=au.right,Ko.bisector=function(t){return r(1===t.length?function(n,r){return e(t(n),r);}:t);},Ko.shuffle=function(e){for(var t,n,r=e.length;r;){n=0|Math.random()*r--,t=e[r],e[r]=e[n],e[n]=t;}return e;},Ko.permute=function(e,t){for(var n=t.length,r=new Array(n);n--;){r[n]=e[t[n]];}return r;},Ko.pairs=function(e){for(var t,n=0,r=e.length-1,i=e[0],s=new Array(0>r?0:r);r>n;){s[n]=[t=i,i=e[++n]];}return s;},Ko.zip=function(){if(!(r=arguments.length))return[];for(var e=-1,t=Ko.min(arguments,i),n=new Array(t);++e<t;){for(var r,s=-1,o=n[e]=new Array(r);++s<r;){o[s]=arguments[s][e];}}return n;},Ko.transpose=function(e){return Ko.zip.apply(Ko,e);},Ko.keys=function(e){var t=[];for(var n in e){t.push(n);}return t;},Ko.values=function(e){var t=[];for(var n in e){t.push(e[n]);}return t;},Ko.entries=function(e){var t=[];for(var n in e){t.push({key:n,value:e[n]});}return t;},Ko.merge=function(e){for(var t,n,r,i=e.length,s=-1,o=0;++s<i;){o+=e[s].length;}for(n=new Array(o);--i>=0;){for(r=e[i],t=r.length;--t>=0;){n[--o]=r[t];}}return n;};var fu=Math.abs;Ko.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),1/0===(t-e)/n)throw new Error("infinite range");var r,i=[],o=s(fu(n)),u=-1;if(e*=o,t*=o,n*=o,0>n)for(;(r=e+n*++u)>t;){i.push(r/o);}else for(;(r=e+n*++u)<t;){i.push(r/o);}return i;},Ko.map=function(e){var t=new u();if(e instanceof u)e.forEach(function(e,n){t.set(e,n);});else for(var n in e){t.set(n,e[n]);}return t;};var lu="__proto__",cu="\0";o(u,{has:l,get:function get(e){return this._[a(e)];},set:function set(e,t){return this._[a(e)]=t;},remove:c,keys:h,values:function values(){var e=[];for(var t in this._){e.push(this._[t]);}return e;},entries:function entries(){var e=[];for(var t in this._){e.push({key:f(t),value:this._[t]});}return e;},size:p,empty:d,forEach:function forEach(e){for(var t in this._){e.call(this,f(t),this._[t]);}}}),Ko.nest=function(){function e(t,o,a){if(a>=s.length)return r?r.call(i,o):n?o.sort(n):o;for(var f,l,c,h,p=-1,d=o.length,v=s[a++],m=new u();++p<d;){(h=m.get(f=v(l=o[p])))?h.push(l):m.set(f,[l]);}return t?(l=t(),c=function c(n,r){l.set(n,e(t,r,a));}):(l={},c=function c(n,r){l[n]=e(t,r,a);}),m.forEach(c),l;}function t(e,n){if(n>=s.length)return e;var r=[],i=o[n++];return e.forEach(function(e,i){r.push({key:e,values:t(i,n)});}),i?r.sort(function(e,t){return i(e.key,t.key);}):r;}var n,r,i={},s=[],o=[];return i.map=function(t,n){return e(n,t,0);},i.entries=function(n){return t(e(Ko.map,n,0),0);},i.key=function(e){return s.push(e),i;},i.sortKeys=function(e){return o[s.length-1]=e,i;},i.sortValues=function(e){return n=e,i;},i.rollup=function(e){return r=e,i;},i;},Ko.set=function(e){var t=new v();if(e)for(var n=0,r=e.length;r>n;++n){t.add(e[n]);}return t;},o(v,{has:l,add:function add(e){return this._[a(e+="")]=!0,e;},remove:c,values:h,size:p,empty:d,forEach:function forEach(e){for(var t in this._){e.call(this,f(t));}}}),Ko.behavior={},Ko.rebind=function(e,t){for(var n,r=1,i=arguments.length;++r<i;){e[n=arguments[r]]=m(e,t,t[n]);}return e;};var hu=["webkit","ms","moz","Moz","o","O"];Ko.dispatch=function(){for(var e=new b(),t=-1,n=arguments.length;++t<n;){e[arguments[t]]=w(e);}return e;},b.prototype.on=function(e,t){var n=e.indexOf("."),r="";if(n>=0&&(r=e.slice(n+1),e=e.slice(0,n)),e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(2===arguments.length){if(null==t)for(e in this){this.hasOwnProperty(e)&&this[e].on(r,null);}return this;}},Ko.event=null,Ko.requote=function(e){return e.replace(pu,"\\$&");};var pu=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,du={}.__proto__?function(e,t){e.__proto__=t;}:function(e,t){for(var n in t){e[n]=t[n];}},vu=function vu(e,t){return t.querySelector(e);},mu=function mu(e,t){return t.querySelectorAll(e);},gu=Zo.matches||Zo[g(Zo,"matchesSelector")],yu=function yu(e,t){return gu.call(e,t);};"function"==typeof Sizzle&&(vu=function vu(e,t){return Sizzle(e,t)[0]||null;},mu=Sizzle,yu=Sizzle.matchesSelector),Ko.selection=function(){return Su;};var bu=Ko.selection.prototype=[];bu.select=function(e){var t,n,r,i,s=[];e=N(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var a=-1,f=r.length;++a<f;){(i=r[a])?(t.push(n=e.call(i,i.__data__,a,o)),n&&"__data__"in i&&(n.__data__=i.__data__)):t.push(null);}}return T(s);},bu.selectAll=function(e){var t,n,r=[];e=C(e);for(var i=-1,s=this.length;++i<s;){for(var o=this[i],u=-1,a=o.length;++u<a;){(n=o[u])&&(r.push(t=Go(e.call(n,n.__data__,u,i))),t.parentNode=n);}}return T(r);};var wu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Ko.ns={prefix:wu,qualify:function qualify(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.slice(0,t),e=e.slice(t+1)),wu.hasOwnProperty(n)?{space:wu[n],local:e}:e;}},bu.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=Ko.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e);}for(t in e){this.each(k(t,e[t]));}return this;}return this.each(k(e,t));},bu.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),r=(e=O(e)).length,i=-1;if(t=n.classList){for(;++i<r;){if(!t.contains(e[i]))return!1;}}else for(t=n.getAttribute("class");++i<r;){if(!A(e[i]).test(t))return!1;}return!0;}for(t in e){this.each(M(t,e[t]));}return this;}return this.each(M(e,t));},bu.style=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t="");for(n in e){this.each(D(n,e[n],t));}return this;}if(2>r)return eu.getComputedStyle(this.node(),null).getPropertyValue(e);n="";}return this.each(D(e,t,n));},bu.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e){this.each(P(t,e[t]));}return this;}return this.each(P(e,t));},bu.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t;}:null==e?function(){this.textContent="";}:function(){this.textContent=e;}):this.node().textContent;},bu.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t;}:null==e?function(){this.innerHTML="";}:function(){this.innerHTML=e;}):this.node().innerHTML;},bu.append=function(e){return e=H(e),this.select(function(){return this.appendChild(e.apply(this,arguments));});},bu.insert=function(e,t){return e=H(e),t=N(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null);});},bu.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this);});},bu.data=function(e,t){function n(e,n){var r,i,s,o=e.length,c=n.length,h=Math.min(o,c),p=new Array(c),d=new Array(c),v=new Array(o);if(t){var m,g=new u(),y=new Array(o);for(r=-1;++r<o;){g.has(m=t.call(i=e[r],i.__data__,r))?v[r]=i:g.set(m,i),y[r]=m;}for(r=-1;++r<c;){(i=g.get(m=t.call(n,s=n[r],r)))?i!==!0&&(p[r]=i,i.__data__=s):d[r]=B(s),g.set(m,!0);}for(r=-1;++r<o;){g.get(y[r])!==!0&&(v[r]=e[r]);}}else{for(r=-1;++r<h;){i=e[r],s=n[r],i?(i.__data__=s,p[r]=i):d[r]=B(s);}for(;c>r;++r){d[r]=B(n[r]);}for(;o>r;++r){v[r]=e[r];}}d.update=p,d.parentNode=p.parentNode=v.parentNode=e.parentNode,a.push(d),f.push(p),l.push(v);}var r,i,s=-1,o=this.length;if(!arguments.length){for(e=new Array(o=(r=this[0]).length);++s<o;){(i=r[s])&&(e[s]=i.__data__);}return e;}var a=q([]),f=T([]),l=T([]);if("function"==typeof e)for(;++s<o;){n(r=this[s],e.call(r,r.parentNode.__data__,s));}else for(;++s<o;){n(r=this[s],e);}return f.enter=function(){return a;},f.exit=function(){return l;},f;},bu.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__");},bu.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=j(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]),t.parentNode=(n=this[s]).parentNode;for(var u=0,a=n.length;a>u;u++){(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r);}}return T(i);},bu.order=function(){for(var e=-1,t=this.length;++e<t;){for(var n,r=this[e],i=r.length-1,s=r[i];--i>=0;){(n=r[i])&&(s&&s!==n.nextSibling&&s.parentNode.insertBefore(n,s),s=n);}}return this;},bu.sort=function(e){e=F.apply(this,arguments);for(var t=-1,n=this.length;++t<n;){this[t].sort(e);}return this.order();},bu.each=function(e){return I(this,function(t,n,r){e.call(t,t.__data__,n,r);});},bu.call=function(e){var t=Go(arguments);return e.apply(t[0]=this,t),this;},bu.empty=function(){return!this.node();},bu.node=function(){for(var e=0,t=this.length;t>e;e++){for(var n=this[e],r=0,i=n.length;i>r;r++){var s=n[r];if(s)return s;}}return null;},bu.size=function(){var e=0;return I(this,function(){++e;}),e;};var Eu=[];Ko.selection.enter=q,Ko.selection.enter.prototype=Eu,Eu.append=bu.append,Eu.empty=bu.empty,Eu.node=bu.node,Eu.call=bu.call,Eu.size=bu.size,Eu.select=function(e){for(var t,n,r,i,s,o=[],u=-1,a=this.length;++u<a;){r=(i=this[u]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var f=-1,l=i.length;++f<l;){(s=i[f])?(t.push(r[f]=n=e.call(i.parentNode,s.__data__,f,u)),n.__data__=s.__data__):t.push(null);}}return T(o);},Eu.insert=function(e,t){return arguments.length<2&&(t=R(this)),bu.insert.call(this,e,t);},bu.transition=function(){for(var e,t,n=Of||++Hf,r=[],i=Mf||{time:Date.now(),ease:Ti,delay:0,duration:250},s=-1,o=this.length;++s<o;){r.push(e=[]);for(var u=this[s],a=-1,f=u.length;++a<f;){(t=u[a])&&Ro(t,a,n,i),e.push(t);}}return Fo(r,n);},bu.interrupt=function(){return this.each(U);},Ko.select=function(e){var t=["string"==typeof e?vu(e,Yo):e];return t.parentNode=Zo,T([t]);},Ko.selectAll=function(e){var t=Go("string"==typeof e?mu(e,Yo):e);return t.parentNode=Zo,T([t]);};var Su=Ko.select(Zo);bu.on=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t=!1);for(n in e){this.each(z(n,e[n],t));}return this;}if(2>r)return(r=this.node()["__on"+e])&&r._;n=!1;}return this.each(z(e,t,n));};var xu=Ko.map({mouseenter:"mouseover",mouseleave:"mouseout"});xu.forEach(function(e){"on"+e in Yo&&xu.remove(e);});var Tu="onselectstart"in Yo?null:g(Zo.style,"userSelect"),Nu=0;Ko.mouse=function(e){return $(e,S());};var Cu=/WebKit/.test(eu.navigator.userAgent)?-1:0;Ko.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=S().changedTouches),t)for(var r,i=0,s=t.length;s>i;++i){if((r=t[i]).identifier===n)return $(e,r);}},Ko.behavior.drag=function(){function e(){this.on("mousedown.drag",i).on("touchstart.drag",s);}function t(e,t,i,s,o){return function(){function u(){var e,n,r=t(h,v);r&&(e=r[0]-b[0],n=r[1]-b[1],d|=e|n,b=r,p({type:"drag",x:r[0]+f[0],y:r[1]+f[1],dx:e,dy:n}));}function a(){t(h,v)&&(g.on(s+m,null).on(o+m,null),y(d&&Ko.event.target===c),p({type:"dragend"}));}var f,l=this,c=Ko.event.target,h=l.parentNode,p=n.of(l,arguments),d=0,v=e(),m=".drag"+(null==v?"":"-"+v),g=Ko.select(i()).on(s+m,u).on(o+m,a),y=V(),b=t(h,v);r?(f=r.apply(l,arguments),f=[f.x-b[0],f.y-b[1]]):f=[0,0],p({type:"dragstart"});};}var n=x(e,"drag","dragstart","dragend"),r=null,i=t(y,Ko.mouse,Q,"mousemove","mouseup"),s=t(J,Ko.touch,K,"touchmove","touchend");return e.origin=function(t){return arguments.length?(r=t,e):r;},Ko.rebind(e,n,"on");},Ko.touches=function(e,t){return arguments.length<2&&(t=S().touches),t?Go(t).map(function(t){var n=$(e,t);return n.identifier=t.identifier,n;}):[];};var ku=Math.PI,Lu=2*ku,Au=ku/2,Ou=1e-6,Mu=Ou*Ou,_u=ku/180,Du=180/ku,Pu=Math.SQRT2,Hu=2,Bu=4;Ko.interpolateZoom=function(e,t){function n(e){var t=e*y;if(g){var n=nt(v),o=s/(Hu*h)*(n*rt(Pu*t+v)-tt(v));return[r+o*f,i+o*l,s*n/nt(Pu*t+v)];}return[r+e*f,i+e*l,s*Math.exp(Pu*t)];}var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2],f=o-r,l=u-i,c=f*f+l*l,h=Math.sqrt(c),p=(a*a-s*s+Bu*c)/(2*s*Hu*h),d=(a*a-s*s-Bu*c)/(2*a*Hu*h),v=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(d*d+1)-d),g=m-v,y=(g||Math.log(a/s))/Pu;return n.duration=1e3*y,n;},Ko.behavior.zoom=function(){function e(e){e.on(k,f).on(Iu+".zoom",c).on("dblclick.zoom",h).on(O,l);}function t(e){return[(e[0]-T.x)/T.k,(e[1]-T.y)/T.k];}function n(e){return[e[0]*T.k+T.x,e[1]*T.k+T.y];}function r(e){T.k=Math.max(C[0],Math.min(C[1],e));}function i(e,t){t=n(t),T.x+=e[0]-t[0],T.y+=e[1]-t[1];}function s(){b&&b.domain(y.range().map(function(e){return(e-T.x)/T.k;}).map(y.invert)),S&&S.domain(w.range().map(function(e){return(e-T.y)/T.k;}).map(w.invert));}function o(e){e({type:"zoomstart"});}function u(e){s(),e({type:"zoom",scale:T.k,translate:[T.x,T.y]});}function a(e){e({type:"zoomend"});}function f(){function e(){l=1,i(Ko.mouse(r),h),u(f);}function n(){c.on(L,null).on(A,null),p(l&&Ko.event.target===s),a(f);}var r=this,s=Ko.event.target,f=M.of(r,arguments),l=0,c=Ko.select(eu).on(L,e).on(A,n),h=t(Ko.mouse(r)),p=V();U.call(r),o(f);}function l(){function e(){var e=Ko.touches(p);return h=T.k,e.forEach(function(e){e.identifier in v&&(v[e.identifier]=t(e));}),e;}function n(){var t=Ko.event.target;Ko.select(t).on(b,s).on(w,c),S.push(t);for(var n=Ko.event.changedTouches,o=0,a=n.length;a>o;++o){v[n[o].identifier]=null;}var f=e(),l=Date.now();if(1===f.length){if(500>l-g){var h=f[0],p=v[h.identifier];r(2*T.k),i(h,p),E(),u(d);}g=l;}else if(f.length>1){var h=f[0],y=f[1],x=h[0]-y[0],N=h[1]-y[1];m=x*x+N*N;}}function s(){for(var e,t,n,s,o=Ko.touches(p),a=0,f=o.length;f>a;++a,s=null){if(n=o[a],s=v[n.identifier]){if(t)break;e=n,t=s;}}if(s){var l=(l=n[0]-e[0])*l+(l=n[1]-e[1])*l,c=m&&Math.sqrt(l/m);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+s[0])/2,(t[1]+s[1])/2],r(c*h);}g=null,i(e,t),u(d);}function c(){if(Ko.event.touches.length){for(var t=Ko.event.changedTouches,n=0,r=t.length;r>n;++n){delete v[t[n].identifier];}for(var i in v){return void e();}}Ko.selectAll(S).on(y,null),x.on(k,f).on(O,l),N(),a(d);}var h,p=this,d=M.of(p,arguments),v={},m=0,y=".zoom-"+Ko.event.changedTouches[0].identifier,b="touchmove"+y,w="touchend"+y,S=[],x=Ko.select(p),N=V();U.call(p),n(),o(d),x.on(k,null).on(O,n);}function c(){var e=M.of(this,arguments);m?clearTimeout(m):(p=t(d=v||Ko.mouse(this)),U.call(this),o(e)),m=setTimeout(function(){m=null,a(e);},50),E(),r(Math.pow(2,.002*ju())*T.k),i(d,p),u(e);}function h(){var e=M.of(this,arguments),n=Ko.mouse(this),s=t(n),f=Math.log(T.k)/Math.LN2;o(e),r(Math.pow(2,Ko.event.shiftKey?Math.ceil(f)-1:Math.floor(f)+1)),i(n,s),u(e),a(e);}var p,d,v,m,g,y,b,w,S,T={x:0,y:0,k:1},N=[960,500],C=Fu,k="mousedown.zoom",L="mousemove.zoom",A="mouseup.zoom",O="touchstart.zoom",M=x(e,"zoomstart","zoom","zoomend");return e.event=function(e){e.each(function(){var e=M.of(this,arguments),t=T;Of?Ko.select(this).transition().each("start.zoom",function(){T=this.__chart__||{x:0,y:0,k:1},o(e);}).tween("zoom:zoom",function(){var n=N[0],r=N[1],i=n/2,s=r/2,o=Ko.interpolateZoom([(i-T.x)/T.k,(s-T.y)/T.k,n/T.k],[(i-t.x)/t.k,(s-t.y)/t.k,n/t.k]);return function(t){var r=o(t),a=n/r[2];this.__chart__=T={x:i-r[0]*a,y:s-r[1]*a,k:a},u(e);};}).each("end.zoom",function(){a(e);}):(this.__chart__=T,o(e),u(e),a(e));});},e.translate=function(t){return arguments.length?(T={x:+t[0],y:+t[1],k:T.k},s(),e):[T.x,T.y];},e.scale=function(t){return arguments.length?(T={x:T.x,y:T.y,k:+t},s(),e):T.k;},e.scaleExtent=function(t){return arguments.length?(C=null==t?Fu:[+t[0],+t[1]],e):C;},e.center=function(t){return arguments.length?(v=t&&[+t[0],+t[1]],e):v;},e.size=function(t){return arguments.length?(N=t&&[+t[0],+t[1]],e):N;},e.x=function(t){return arguments.length?(b=t,y=t.copy(),T={x:0,y:0,k:1},e):b;},e.y=function(t){return arguments.length?(S=t,w=t.copy(),T={x:0,y:0,k:1},e):S;},Ko.rebind(e,M,"on");};var ju,Fu=[0,1/0],Iu="onwheel"in Yo?(ju=function ju(){return-Ko.event.deltaY*(Ko.event.deltaMode?120:1);},"wheel"):"onmousewheel"in Yo?(ju=function ju(){return Ko.event.wheelDelta;},"mousewheel"):(ju=function ju(){return-Ko.event.detail;},"MozMousePixelScroll");Ko.color=st,st.prototype.toString=function(){return this.rgb()+"";},Ko.hsl=ot;var qu=ot.prototype=new st();qu.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new ot(this.h,this.s,this.l/e);},qu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new ot(this.h,this.s,e*this.l);},qu.rgb=function(){return ut(this.h,this.s,this.l);},Ko.hcl=at;var Ru=at.prototype=new st();Ru.brighter=function(e){return new at(this.h,this.c,Math.min(100,this.l+Uu*(arguments.length?e:1)));},Ru.darker=function(e){return new at(this.h,this.c,Math.max(0,this.l-Uu*(arguments.length?e:1)));},Ru.rgb=function(){return ft(this.h,this.c,this.l).rgb();},Ko.lab=lt;var Uu=18,zu=.95047,Wu=1,Xu=1.08883,Vu=lt.prototype=new st();Vu.brighter=function(e){return new lt(Math.min(100,this.l+Uu*(arguments.length?e:1)),this.a,this.b);},Vu.darker=function(e){return new lt(Math.max(0,this.l-Uu*(arguments.length?e:1)),this.a,this.b);},Vu.rgb=function(){return ct(this.l,this.a,this.b);},Ko.rgb=mt;var $u=mt.prototype=new st();$u.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return t||n||r?(t&&i>t&&(t=i),n&&i>n&&(n=i),r&&i>r&&(r=i),new mt(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,r/e))):new mt(i,i,i);},$u.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new mt(e*this.r,e*this.g,e*this.b);},$u.hsl=function(){return Et(this.r,this.g,this.b);},$u.toString=function(){return"#"+bt(this.r)+bt(this.g)+bt(this.b);};var Ju=Ko.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Ju.forEach(function(e,t){Ju.set(e,gt(t));}),Ko.functor=Nt,Ko.xhr=kt(Ct),Ko.dsv=function(e,t){function n(e,n,s){arguments.length<3&&(s=n,n=null);var o=Lt(e,t,null==n?r:i(n),s);return o.row=function(e){return arguments.length?o.response(null==(n=e)?r:i(e)):n;},o;}function r(e){return n.parse(e.responseText);}function i(e){return function(t){return n.parse(t.responseText,e);};}function s(t){return t.map(o).join(e);}function o(e){return u.test(e)?'"'+e.replace(/\"/g,'""')+'"':e;}var u=new RegExp('["'+e+"\n]"),a=e.charCodeAt(0);return n.parse=function(e,t){var r;return n.parseRows(e,function(e,n){if(r)return r(e,n-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]";}).join(",")+"}");r=t?function(e,n){return t(i(e),n);}:i;});},n.parseRows=function(e,t){function n(){if(l>=f)return o;if(i)return i=!1,s;var t=l;if(34===e.charCodeAt(t)){for(var n=t;n++<f;){if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n;}}l=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&++l):10===r&&(i=!0),e.slice(t+1,n).replace(/""/g,'"');}for(;f>l;){var r=e.charCodeAt(l++),u=1;if(10===r)i=!0;else if(13===r)i=!0,10===e.charCodeAt(l)&&(++l,++u);else if(r!==a)continue;return e.slice(t,l-u);}return e.slice(t);}for(var r,i,s={},o={},u=[],f=e.length,l=0,c=0;(r=n())!==o;){for(var h=[];r!==s&&r!==o;){h.push(r),r=n();}t&&null==(h=t(h,c++))||u.push(h);}return u;},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var r=new v(),i=[];return t.forEach(function(e){for(var t in e){r.has(t)||i.push(r.add(t));}}),[i.map(o).join(e)].concat(t.map(function(t){return i.map(function(e){return o(t[e]);}).join(e);})).join("\n");},n.formatRows=function(e){return e.map(s).join("\n");},n;},Ko.csv=Ko.dsv(",","text/csv"),Ko.tsv=Ko.dsv("	","text/tab-separated-values");var Ku,Qu,Gu,Yu,Zu,ea=eu[g(eu,"requestAnimationFrame")]||function(e){setTimeout(e,17);};Ko.timer=function(e,t,n){var r=arguments.length;2>r&&(t=0),3>r&&(n=Date.now());var i=n+t,s={c:e,t:i,f:!1,n:null};Qu?Qu.n=s:Ku=s,Qu=s,Gu||(Yu=clearTimeout(Yu),Gu=1,ea(Mt));},Ko.timer.flush=function(){_t(),Dt();},Ko.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e);};var ta=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(Ht);Ko.formatPrefix=function(e,t){var n=0;return e&&(0>e&&(e*=-1),t&&(e=Ko.round(e,Pt(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),ta[8+n/3];};var na=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ra=Ko.map({b:function b(e){return e.toString(2);},c:function c(e){return String.fromCharCode(e);},o:function o(e){return e.toString(8);},x:function x(e){return e.toString(16);},X:function X(e){return e.toString(16).toUpperCase();},g:function g(e,t){return e.toPrecision(t);},e:function e(_e4,t){return _e4.toExponential(t);},f:function f(e,t){return e.toFixed(t);},r:function r(e,t){return(e=Ko.round(e,Pt(e,t))).toFixed(Math.max(0,Math.min(20,Pt(e*(1+1e-15),t))));}}),ia=Ko.time={},sa=Date;Ft.prototype={getDate:function getDate(){return this._.getUTCDate();},getDay:function getDay(){return this._.getUTCDay();},getFullYear:function getFullYear(){return this._.getUTCFullYear();},getHours:function getHours(){return this._.getUTCHours();},getMilliseconds:function getMilliseconds(){return this._.getUTCMilliseconds();},getMinutes:function getMinutes(){return this._.getUTCMinutes();},getMonth:function getMonth(){return this._.getUTCMonth();},getSeconds:function getSeconds(){return this._.getUTCSeconds();},getTime:function getTime(){return this._.getTime();},getTimezoneOffset:function getTimezoneOffset(){return 0;},valueOf:function valueOf(){return this._.valueOf();},setDate:function setDate(){oa.setUTCDate.apply(this._,arguments);},setDay:function setDay(){oa.setUTCDay.apply(this._,arguments);},setFullYear:function setFullYear(){oa.setUTCFullYear.apply(this._,arguments);},setHours:function setHours(){oa.setUTCHours.apply(this._,arguments);},setMilliseconds:function setMilliseconds(){oa.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function setMinutes(){oa.setUTCMinutes.apply(this._,arguments);},setMonth:function setMonth(){oa.setUTCMonth.apply(this._,arguments);},setSeconds:function setSeconds(){oa.setUTCSeconds.apply(this._,arguments);},setTime:function setTime(){oa.setTime.apply(this._,arguments);}};var oa=Date.prototype;ia.year=It(function(e){return e=ia.day(e),e.setMonth(0,1),e;},function(e,t){e.setFullYear(e.getFullYear()+t);},function(e){return e.getFullYear();}),ia.years=ia.year.range,ia.years.utc=ia.year.utc.range,ia.day=It(function(e){var t=new sa(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t;},function(e,t){e.setDate(e.getDate()+t);},function(e){return e.getDate()-1;}),ia.days=ia.day.range,ia.days.utc=ia.day.utc.range,ia.dayOfYear=function(e){var t=ia.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5);},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=ia[e]=It(function(e){return(e=ia.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e;},function(e,t){e.setDate(e.getDate()+7*Math.floor(t));},function(e){var n=ia.year(e).getDay();return Math.floor((ia.dayOfYear(e)+(n+t)%7)/7)-(n!==t);});ia[e+"s"]=n.range,ia[e+"s"].utc=n.utc.range,ia[e+"OfYear"]=function(e){var n=ia.year(e).getDay();return Math.floor((ia.dayOfYear(e)+(n+t)%7)/7);};}),ia.week=ia.sunday,ia.weeks=ia.sunday.range,ia.weeks.utc=ia.sunday.utc.range,ia.weekOfYear=ia.sundayOfYear;var ua={"-":"",_:" ",0:"0"},aa=/^\s*\d+/,fa=/^%/;Ko.locale=function(e){return{numberFormat:Bt(e),timeFormat:Rt(e)};};var la=Ko.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Ko.format=la.numberFormat,Ko.geo={},fn.prototype={s:0,t:0,add:function add(e){ln(e,this.t,ca),ln(ca.s,this.s,this),this.s?this.t+=ca.t:this.s=ca.t;},reset:function reset(){this.s=this.t=0;},valueOf:function valueOf(){return this.s;}};var ca=new fn();Ko.geo.stream=function(e,t){e&&ha.hasOwnProperty(e.type)?ha[e.type](e,t):cn(e,t);};var ha={Feature:function Feature(e,t){cn(e.geometry,t);},FeatureCollection:function FeatureCollection(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;){cn(n[r].geometry,t);}}},pa={Sphere:function Sphere(e,t){t.sphere();},Point:function Point(e,t){e=e.coordinates,t.point(e[0],e[1],e[2]);},MultiPoint:function MultiPoint(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;){e=n[r],t.point(e[0],e[1],e[2]);}},LineString:function LineString(e,t){hn(e.coordinates,t,0);},MultiLineString:function MultiLineString(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;){hn(n[r],t,0);}},Polygon:function Polygon(e,t){pn(e.coordinates,t);},MultiPolygon:function MultiPolygon(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;){pn(n[r],t);}},GeometryCollection:function GeometryCollection(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;){cn(n[r],t);}}};Ko.geo.area=function(e){return da=0,Ko.geo.stream(e,ma),da;};var da,va=new fn(),ma={sphere:function sphere(){da+=4*ku;},point:y,lineStart:y,lineEnd:y,polygonStart:function polygonStart(){va.reset(),ma.lineStart=dn;},polygonEnd:function polygonEnd(){var e=2*va;da+=0>e?4*ku+e:e,ma.lineStart=ma.lineEnd=ma.point=y;}};Ko.geo.bounds=function(){function e(e,t){b.push(w=[l=e,h=e]),c>t&&(c=t),t>p&&(p=t);}function t(t,n){var r=vn([t*_u,n*_u]);if(g){var i=gn(g,r),s=[i[1],-i[0],0],o=gn(s,i);wn(o),o=En(o);var a=t-d,f=a>0?1:-1,v=o[0]*Du*f,m=fu(a)>180;if(m^(v>f*d&&f*t>v)){var y=o[1]*Du;y>p&&(p=y);}else if(v=(v+360)%360-180,m^(v>f*d&&f*t>v)){var y=-o[1]*Du;c>y&&(c=y);}else c>n&&(c=n),n>p&&(p=n);m?d>t?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>d?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t);}else e(t,n);g=r,d=t;}function n(){E.point=t;}function r(){w[0]=l,w[1]=h,E.point=e,g=null;}function i(e,n){if(g){var r=e-d;y+=fu(r)>180?r+(r>0?360:-360):r;}else v=e,m=n;ma.point(e,n),t(e,n);}function s(){ma.lineStart();}function o(){i(v,m),ma.lineEnd(),fu(y)>Ou&&(l=-(h=180)),w[0]=l,w[1]=h,g=null;}function u(e,t){return(t-=e)<0?t+360:t;}function a(e,t){return e[0]-t[0];}function f(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e;}var l,c,h,p,d,v,m,g,y,b,w,E={point:e,lineStart:n,lineEnd:r,polygonStart:function polygonStart(){E.point=i,E.lineStart=s,E.lineEnd=o,y=0,ma.polygonStart();},polygonEnd:function polygonEnd(){ma.polygonEnd(),E.point=e,E.lineStart=n,E.lineEnd=r,0>va?(l=-(h=180),c=-(p=90)):y>Ou?p=90:-Ou>y&&(c=-90),w[0]=l,w[1]=h;}};return function(e){p=h=-(l=c=1/0),b=[],Ko.geo.stream(e,E);var t=b.length;if(t){b.sort(a);for(var n,r=1,i=b[0],s=[i];t>r;++r){n=b[r],f(n[0],i)||f(n[1],i)?(u(i[0],n[1])>u(i[0],i[1])&&(i[1]=n[1]),u(n[0],i[1])>u(i[0],i[1])&&(i[0]=n[0])):s.push(i=n);}for(var o,n,d=-1/0,t=s.length-1,r=0,i=s[t];t>=r;i=n,++r){n=s[r],(o=u(i[1],n[0]))>d&&(d=o,l=n[0],h=i[1]);}}return b=w=null,1/0===l||1/0===c?[[0/0,0/0],[0/0,0/0]]:[[l,c],[h,p]];};}(),Ko.geo.centroid=function(e){ga=ya=ba=wa=Ea=Sa=xa=Ta=Na=Ca=ka=0,Ko.geo.stream(e,La);var t=Na,n=Ca,r=ka,i=t*t+n*n+r*r;return Mu>i&&(t=Sa,n=xa,r=Ta,Ou>ya&&(t=ba,n=wa,r=Ea),i=t*t+n*n+r*r,Mu>i)?[0/0,0/0]:[Math.atan2(n,t)*Du,et(r/Math.sqrt(i))*Du];};var ga,ya,ba,wa,Ea,Sa,xa,Ta,Na,Ca,ka,La={sphere:y,point:xn,lineStart:Nn,lineEnd:Cn,polygonStart:function polygonStart(){La.lineStart=kn;},polygonEnd:function polygonEnd(){La.lineStart=Nn;}},Aa=_n(Ln,Bn,Fn,[-ku,-ku/2]),Oa=1e9;Ko.geo.clipExtent=function(){var e,t,n,r,i,s,o={stream:function stream(e){return i&&(i.valid=!1),i=s(e),i.valid=!0,i;},extent:function extent(u){return arguments.length?(s=Un(e=+u[0][0],t=+u[0][1],n=+u[1][0],r=+u[1][1]),i&&(i.valid=!1,i=null),o):[[e,t],[n,r]];}};return o.extent([[0,0],[960,500]]);},(Ko.geo.conicEqualArea=function(){return Wn(Xn);}).raw=Xn,Ko.geo.albers=function(){return Ko.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070);},Ko.geo.albersUsa=function(){function e(e){var s=e[0],o=e[1];return t=null,n(s,o),t||(r(s,o),t)||i(s,o),t;}var t,n,r,i,s=Ko.geo.albers(),o=Ko.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=Ko.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a={point:function point(e,n){t=[e,n];}};return e.invert=function(e){var t=s.scale(),n=s.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&.234>i&&r>=-0.425&&-0.214>r?o:i>=.166&&.234>i&&r>=-0.214&&-0.115>r?u:s).invert(e);},e.stream=function(e){var t=s.stream(e),n=o.stream(e),r=u.stream(e);return{point:function point(e,i){t.point(e,i),n.point(e,i),r.point(e,i);},sphere:function sphere(){t.sphere(),n.sphere(),r.sphere();},lineStart:function lineStart(){t.lineStart(),n.lineStart(),r.lineStart();},lineEnd:function lineEnd(){t.lineEnd(),n.lineEnd(),r.lineEnd();},polygonStart:function polygonStart(){t.polygonStart(),n.polygonStart(),r.polygonStart();},polygonEnd:function polygonEnd(){t.polygonEnd(),n.polygonEnd(),r.polygonEnd();}};},e.precision=function(t){return arguments.length?(s.precision(t),o.precision(t),u.precision(t),e):s.precision();},e.scale=function(t){return arguments.length?(s.scale(t),o.scale(.35*t),u.scale(t),e.translate(s.translate())):s.scale();},e.translate=function(t){if(!arguments.length)return s.translate();var f=s.scale(),l=+t[0],c=+t[1];return n=s.translate(t).clipExtent([[l-.455*f,c-.238*f],[l+.455*f,c+.238*f]]).stream(a).point,r=o.translate([l-.307*f,c+.201*f]).clipExtent([[l-.425*f+Ou,c+.12*f+Ou],[l-.214*f-Ou,c+.234*f-Ou]]).stream(a).point,i=u.translate([l-.205*f,c+.212*f]).clipExtent([[l-.214*f+Ou,c+.166*f+Ou],[l-.115*f-Ou,c+.234*f-Ou]]).stream(a).point,e;},e.scale(1070);};var Ma,_a,Da,Pa,Ha,Ba,ja={point:y,lineStart:y,lineEnd:y,polygonStart:function polygonStart(){_a=0,ja.lineStart=Vn;},polygonEnd:function polygonEnd(){ja.lineStart=ja.lineEnd=ja.point=y,Ma+=fu(_a/2);}},Fa={point:$n,lineStart:y,lineEnd:y,polygonStart:y,polygonEnd:y},Ia={point:Qn,lineStart:Gn,lineEnd:Yn,polygonStart:function polygonStart(){Ia.lineStart=Zn;},polygonEnd:function polygonEnd(){Ia.point=Qn,Ia.lineStart=Gn,Ia.lineEnd=Yn;}};Ko.geo.path=function(){function e(e){return e&&("function"==typeof u&&s.pointRadius(+u.apply(this,arguments)),o&&o.valid||(o=i(s)),Ko.geo.stream(e,o)),s.result();}function t(){return o=null,e;}var n,r,i,s,o,u=4.5;return e.area=function(e){return Ma=0,Ko.geo.stream(e,i(ja)),Ma;},e.centroid=function(e){return ba=wa=Ea=Sa=xa=Ta=Na=Ca=ka=0,Ko.geo.stream(e,i(Ia)),ka?[Na/ka,Ca/ka]:Ta?[Sa/Ta,xa/Ta]:Ea?[ba/Ea,wa/Ea]:[0/0,0/0];},e.bounds=function(e){return Ha=Ba=-(Da=Pa=1/0),Ko.geo.stream(e,i(Fa)),[[Da,Pa],[Ha,Ba]];},e.projection=function(e){return arguments.length?(i=(n=e)?e.stream||nr(e):Ct,t()):n;},e.context=function(e){return arguments.length?(s=null==(r=e)?new Jn():new er(e),"function"!=typeof u&&s.pointRadius(u),t()):r;},e.pointRadius=function(t){return arguments.length?(u="function"==typeof t?t:(s.pointRadius(+t),+t),e):u;},e.projection(Ko.geo.albersUsa()).context(null);},Ko.geo.transform=function(e){return{stream:function stream(t){var n=new rr(t);for(var r in e){n[r]=e[r];}return n;}};},rr.prototype={point:function point(e,t){this.stream.point(e,t);},sphere:function sphere(){this.stream.sphere();},lineStart:function lineStart(){this.stream.lineStart();},lineEnd:function lineEnd(){this.stream.lineEnd();},polygonStart:function polygonStart(){this.stream.polygonStart();},polygonEnd:function polygonEnd(){this.stream.polygonEnd();}},Ko.geo.projection=sr,Ko.geo.projectionMutator=or,(Ko.geo.equirectangular=function(){return sr(ar);}).raw=ar.invert=ar,Ko.geo.rotation=function(e){function t(t){return t=e(t[0]*_u,t[1]*_u),t[0]*=Du,t[1]*=Du,t;}return e=lr(e[0]%360*_u,e[1]*_u,e.length>2?e[2]*_u:0),t.invert=function(t){return t=e.invert(t[0]*_u,t[1]*_u),t[0]*=Du,t[1]*=Du,t;},t;},fr.invert=ar,Ko.geo.circle=function(){function e(){var e="function"==typeof r?r.apply(this,arguments):r,t=lr(-e[0]*_u,-e[1]*_u,0).invert,i=[];return n(null,null,1,{point:function point(e,n){i.push(e=t(e,n)),e[0]*=Du,e[1]*=Du;}}),{type:"Polygon",coordinates:[i]};}var t,n,r=[0,0],i=6;return e.origin=function(t){return arguments.length?(r=t,e):r;},e.angle=function(r){return arguments.length?(n=dr((t=+r)*_u,i*_u),e):t;},e.precision=function(r){return arguments.length?(n=dr(t*_u,(i=+r)*_u),e):i;},e.angle(90);},Ko.geo.distance=function(e,t){var n,r=(t[0]-e[0])*_u,i=e[1]*_u,s=t[1]*_u,o=Math.sin(r),u=Math.cos(r),a=Math.sin(i),f=Math.cos(i),l=Math.sin(s),c=Math.cos(s);return Math.atan2(Math.sqrt((n=c*o)*n+(n=f*l-a*c*u)*n),a*l+f*c*u);},Ko.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()};}function t(){return Ko.range(Math.ceil(s/m)*m,i,m).map(h).concat(Ko.range(Math.ceil(f/g)*g,a,g).map(p)).concat(Ko.range(Math.ceil(r/d)*d,n,d).filter(function(e){return fu(e%m)>Ou;}).map(l)).concat(Ko.range(Math.ceil(u/v)*v,o,v).filter(function(e){return fu(e%g)>Ou;}).map(c));}var n,r,i,s,o,u,a,f,l,c,h,p,d=10,v=d,m=90,g=360,y=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e};});},e.outline=function(){return{type:"Polygon",coordinates:[h(s).concat(p(a).slice(1),h(i).reverse().slice(1),p(f).reverse().slice(1))]};},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent();},e.majorExtent=function(t){return arguments.length?(s=+t[0][0],i=+t[1][0],f=+t[0][1],a=+t[1][1],s>i&&(t=s,s=i,i=t),f>a&&(t=f,f=a,a=t),e.precision(y)):[[s,f],[i,a]];},e.minorExtent=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],u=+t[0][1],o=+t[1][1],r>n&&(t=r,r=n,n=t),u>o&&(t=u,u=o,o=t),e.precision(y)):[[r,u],[n,o]];},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep();},e.majorStep=function(t){return arguments.length?(m=+t[0],g=+t[1],e):[m,g];},e.minorStep=function(t){return arguments.length?(d=+t[0],v=+t[1],e):[d,v];},e.precision=function(t){return arguments.length?(y=+t,l=mr(u,o,90),c=gr(r,n,y),h=mr(f,a,90),p=gr(s,i,y),e):y;},e.majorExtent([[-180,-90+Ou],[180,90-Ou]]).minorExtent([[-180,-80-Ou],[180,80+Ou]]);},Ko.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),n||i.apply(this,arguments)]};}var t,n,r=yr,i=br;return e.distance=function(){return Ko.geo.distance(t||r.apply(this,arguments),n||i.apply(this,arguments));},e.source=function(n){return arguments.length?(r=n,t="function"==typeof n?null:n,e):r;},e.target=function(t){return arguments.length?(i=t,n="function"==typeof t?null:t,e):i;},e.precision=function(){return arguments.length?e:0;},e;},Ko.geo.interpolate=function(e,t){return wr(e[0]*_u,e[1]*_u,t[0]*_u,t[1]*_u);},Ko.geo.length=function(e){return qa=0,Ko.geo.stream(e,Ra),qa;};var qa,Ra={sphere:y,point:y,lineStart:Er,lineEnd:y,polygonStart:y,polygonEnd:y},Ua=Sr(function(e){return Math.sqrt(2/(1+e));},function(e){return 2*Math.asin(e/2);});(Ko.geo.azimuthalEqualArea=function(){return sr(Ua);}).raw=Ua;var za=Sr(function(e){var t=Math.acos(e);return t&&t/Math.sin(t);},Ct);(Ko.geo.azimuthalEquidistant=function(){return sr(za);}).raw=za,(Ko.geo.conicConformal=function(){return Wn(xr);}).raw=xr,(Ko.geo.conicEquidistant=function(){return Wn(Tr);}).raw=Tr;var Wa=Sr(function(e){return 1/e;},Math.atan);(Ko.geo.gnomonic=function(){return sr(Wa);}).raw=Wa,Nr.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Au];},(Ko.geo.mercator=function(){return Cr(Nr);}).raw=Nr;var Xa=Sr(function(){return 1;},Math.asin);(Ko.geo.orthographic=function(){return sr(Xa);}).raw=Xa;var Va=Sr(function(e){return 1/(1+e);},function(e){return 2*Math.atan(e);});(Ko.geo.stereographic=function(){return sr(Va);}).raw=Va,kr.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-Au];},(Ko.geo.transverseMercator=function(){var e=Cr(kr),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]]);},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90]);},n([0,0,90]);}).raw=kr,Ko.geom={},Ko.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,i=Nt(n),s=Nt(r),o=e.length,u=[],a=[];for(t=0;o>t;t++){u.push([+i.call(this,e[t],t),+s.call(this,e[t],t),t]);}for(u.sort(Mr),t=0;o>t;t++){a.push([u[t][0],-u[t][1]]);}var f=Or(u),l=Or(a),c=l[0]===f[0],h=l[l.length-1]===f[f.length-1],p=[];for(t=f.length-1;t>=0;--t){p.push(e[u[f[t]][2]]);}for(t=+c;t<l.length-h;++t){p.push(e[u[l[t]][2]]);}return p;}var n=Lr,r=Ar;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n;},t.y=function(e){return arguments.length?(r=e,t):r;},t);},Ko.geom.polygon=function(e){return du(e,$a),e;};var $a=Ko.geom.polygon.prototype=[];$a.area=function(){for(var e,t=-1,n=this.length,r=this[n-1],i=0;++t<n;){e=r,r=this[t],i+=e[1]*r[0]-e[0]*r[1];}return .5*i;},$a.centroid=function(e){var t,n,r=-1,i=this.length,s=0,o=0,u=this[i-1];for(arguments.length||(e=-1/(6*this.area()));++r<i;){t=u,u=this[r],n=t[0]*u[1]-u[0]*t[1],s+=(t[0]+u[0])*n,o+=(t[1]+u[1])*n;}return[s*e,o*e];},$a.clip=function(e){for(var t,n,r,i,s,o,u=Pr(e),a=-1,f=this.length-Pr(this),l=this[f-1];++a<f;){for(t=e.slice(),e.length=0,i=this[a],s=t[(r=t.length-u)-1],n=-1;++n<r;){o=t[n],_r(o,l,i)?(_r(s,l,i)||e.push(Dr(s,o,l,i)),e.push(o)):_r(s,l,i)&&e.push(Dr(s,o,l,i)),s=o;}u&&e.push(e[0]),l=i;}return e;};var Ja,Ka,Qa,Ga,Ya,Za=[],ef=[];Ur.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;){e=t[n].edge,e.b&&e.a||t.splice(n,1);}return t.sort(Wr),t.length;},ei.prototype={start:function start(){return this.edge.l===this.site?this.edge.a:this.edge.b;},end:function end(){return this.edge.l===this.site?this.edge.b:this.edge.a;}},ti.prototype={insert:function insert(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;){e=e.L;}e.L=t;}else e.R=t;n=e;}else this._?(e=si(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;){r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(ri(this,n),e=n,n=e.U),n.C=!1,r.C=!0,ii(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(ii(this,n),e=n,n=e.U),n.C=!1,r.C=!0,ri(this,r))),n=e.U;}this._.C=!1;},remove:function remove(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,i=e.U,s=e.L,o=e.R;if(n=s?o?si(o):s:o,i?i.L===e?i.L=n:i.R=n:this._=n,s&&o?(r=n.C,n.C=e.C,n.L=s,s.U=n,n!==o?(i=n.U,n.U=e.U,e=n.R,i.L=e,n.R=o,o.U=n):(n.U=i,i=n,e=n.R)):(r=e.C,e=n),e&&(e.U=i),!r){if(e&&e.C)return e.C=!1,void 0;do{if(e===this._)break;if(e===i.L){if(t=i.R,t.C&&(t.C=!1,i.C=!0,ri(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ii(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,ri(this,i),e=this._;break;}}else if(t=i.L,t.C&&(t.C=!1,i.C=!0,ii(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ri(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,ii(this,i),e=this._;break;}t.C=!0,e=i,i=i.U;}while(!e.C);e&&(e.C=!1);}}},Ko.geom.voronoi=function(e){function t(e){var t=new Array(e.length),r=u[0][0],i=u[0][1],s=u[1][0],o=u[1][1];return oi(n(e),u).cells.forEach(function(n,u){var a=n.edges,f=n.site,l=t[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y];}):f.x>=r&&f.x<=s&&f.y>=i&&f.y<=o?[[r,o],[s,o],[s,i],[r,i]]:[];l.point=e[u];}),t;}function n(e){return e.map(function(e,t){return{x:Math.round(s(e,t)/Ou)*Ou,y:Math.round(o(e,t)/Ou)*Ou,i:t};});}var r=Lr,i=Ar,s=r,o=i,u=tf;return e?t(e):(t.links=function(e){return oi(n(e)).edges.filter(function(e){return e.l&&e.r;}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]};});},t.triangles=function(e){var t=[];return oi(n(e)).cells.forEach(function(n,r){for(var i,s,o=n.site,u=n.edges.sort(Wr),a=-1,f=u.length,l=u[f-1].edge,c=l.l===o?l.r:l.l;++a<f;){i=l,s=c,l=u[a].edge,c=l.l===o?l.r:l.l,r<s.i&&r<c.i&&ai(o,s,c)<0&&t.push([e[r],e[s.i],e[c.i]]);}}),t;},t.x=function(e){return arguments.length?(s=Nt(r=e),t):r;},t.y=function(e){return arguments.length?(o=Nt(i=e),t):i;},t.clipExtent=function(e){return arguments.length?(u=null==e?tf:e,t):u===tf?null:u;},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):u===tf?null:u&&u[1];},t);};var tf=[[-1e6,-1e6],[1e6,1e6]];Ko.geom.delaunay=function(e){return Ko.geom.voronoi().triangles(e);},Ko.geom.quadtree=function(e,t,n,r,i){function s(e){function s(e,t,n,r,i,s,o,u){if(!isNaN(n)&&!isNaN(r))if(e.leaf){var a=e.x,l=e.y;if(null!=a){if(fu(a-n)+fu(l-r)<.01)f(e,t,n,r,i,s,o,u);else{var c=e.point;e.x=e.y=e.point=null,f(e,c,a,l,i,s,o,u),f(e,t,n,r,i,s,o,u);}}else e.x=n,e.y=r,e.point=t;}else f(e,t,n,r,i,s,o,u);}function f(e,t,n,r,i,o,u,a){var f=.5*(i+u),l=.5*(o+a),c=n>=f,h=r>=l,p=(h<<1)+c;e.leaf=!1,e=e.nodes[p]||(e.nodes[p]=ci()),c?i=f:u=f,h?o=l:a=l,s(e,t,n,r,i,o,u,a);}var l,c,h,p,d,v,m,g,y,b=Nt(u),w=Nt(a);if(null!=t)v=t,m=n,g=r,y=i;else if(g=y=-(v=m=1/0),c=[],h=[],d=e.length,o)for(p=0;d>p;++p){l=e[p],l.x<v&&(v=l.x),l.y<m&&(m=l.y),l.x>g&&(g=l.x),l.y>y&&(y=l.y),c.push(l.x),h.push(l.y);}else for(p=0;d>p;++p){var E=+b(l=e[p],p),S=+w(l,p);v>E&&(v=E),m>S&&(m=S),E>g&&(g=E),S>y&&(y=S),c.push(E),h.push(S);}var x=g-v,T=y-m;x>T?y=m+x:g=v+T;var N=ci();if(N.add=function(e){s(N,e,+b(e,++p),+w(e,p),v,m,g,y);},N.visit=function(e){hi(e,N,v,m,g,y);},p=-1,null==t){for(;++p<d;){s(N,e[p],c[p],h[p],v,m,g,y);}--p;}else e.forEach(N.add);return c=h=e=l=null,N;}var o,u=Lr,a=Ar;return(o=arguments.length)?(u=fi,a=li,3===o&&(i=n,r=t,n=t=0),s(e)):(s.x=function(e){return arguments.length?(u=e,s):u;},s.y=function(e){return arguments.length?(a=e,s):a;},s.extent=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),s):null==t?null:[[t,n],[r,i]];},s.size=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=n=0,r=+e[0],i=+e[1]),s):null==t?null:[r-t,i-n];},s);},Ko.interpolateRgb=pi,Ko.interpolateObject=di,Ko.interpolateNumber=vi,Ko.interpolateString=mi;var nf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rf=new RegExp(nf.source,"g");Ko.interpolate=gi,Ko.interpolators=[function(e,t){var n=_typeof(t);return("string"===n?Ju.has(t)||/^(#|rgb\(|hsl\()/.test(t)?pi:mi:t instanceof st?pi:Array.isArray(t)?yi:"object"===n&&isNaN(t)?di:vi)(e,t);}],Ko.interpolateArray=yi;var sf=function sf(){return Ct;},of=Ko.map({linear:sf,poly:Ni,quad:function quad(){return Si;},cubic:function cubic(){return xi;},sin:function sin(){return Ci;},exp:function exp(){return ki;},circle:function circle(){return Li;},elastic:Ai,back:Oi,bounce:function bounce(){return Mi;}}),uf=Ko.map({"in":Ct,out:wi,"in-out":Ei,"out-in":function outIn(e){return Ei(wi(e));}});Ko.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.slice(0,t):e,r=t>=0?e.slice(t+1):"in";return n=of.get(n)||sf,r=uf.get(r)||Ct,bi(r(n.apply(null,Qo.call(arguments,1))));},Ko.interpolateHcl=_i,Ko.interpolateHsl=Di,Ko.interpolateLab=Pi,Ko.interpolateRound=Hi,Ko.transform=function(e){var t=Yo.createElementNS(Ko.ns.prefix.svg,"g");return(Ko.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate();}return new Bi(n?n.matrix:af);})(e);},Bi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};var af={a:1,b:0,c:0,d:1,e:0,f:0};Ko.interpolateTransform=qi,Ko.layout={},Ko.layout.bundle=function(){return function(e){for(var t=[],n=-1,r=e.length;++n<r;){t.push(zi(e[n]));}return t;};},Ko.layout.chord=function(){function e(){var e,f,c,h,p,d={},v=[],m=Ko.range(s),g=[];for(n=[],r=[],e=0,h=-1;++h<s;){for(f=0,p=-1;++p<s;){f+=i[h][p];}v.push(f),g.push(Ko.range(s)),e+=f;}for(o&&m.sort(function(e,t){return o(v[e],v[t]);}),u&&g.forEach(function(e,t){e.sort(function(e,n){return u(i[t][e],i[t][n]);});}),e=(Lu-l*s)/e,f=0,h=-1;++h<s;){for(c=f,p=-1;++p<s;){var y=m[h],b=g[y][p],w=i[y][b],E=f,S=f+=w*e;d[y+"-"+b]={index:y,subindex:b,startAngle:E,endAngle:S,value:w};}r[y]={index:y,startAngle:c,endAngle:f,value:(f-c)/e},f+=l;}for(h=-1;++h<s;){for(p=h-1;++p<s;){var x=d[h+"-"+p],T=d[p+"-"+h];(x.value||T.value)&&n.push(x.value<T.value?{source:T,target:x}:{source:x,target:T});}}a&&t();}function t(){n.sort(function(e,t){return a((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2);});}var n,r,i,s,o,u,a,f={},l=0;return f.matrix=function(e){return arguments.length?(s=(i=e)&&i.length,n=r=null,f):i;},f.padding=function(e){return arguments.length?(l=e,n=r=null,f):l;},f.sortGroups=function(e){return arguments.length?(o=e,n=r=null,f):o;},f.sortSubgroups=function(e){return arguments.length?(u=e,n=null,f):u;},f.sortChords=function(e){return arguments.length?(a=e,n&&t(),f):a;},f.chords=function(){return n||e(),n;},f.groups=function(){return r||e(),r;},f;},Ko.layout.force=function(){function e(e){return function(t,n,r,i){if(t.point!==e){var s=t.cx-e.x,o=t.cy-e.y,u=i-n,a=s*s+o*o;if(a>u*u/m){if(d>a){var f=t.charge/a;e.px-=s*f,e.py-=o*f;}return!0;}if(t.point&&a&&d>a){var f=t.pointCharge/a;e.px-=s*f,e.py-=o*f;}}return!t.charge;};}function t(e){e.px=Ko.event.x,e.py=Ko.event.y,u.resume();}var n,r,i,s,o,u={},a=Ko.dispatch("start","tick","end"),f=[1,1],l=.9,c=ff,h=lf,p=-30,d=cf,v=.1,m=.64,g=[],y=[];return u.tick=function(){if((r*=.99)<.005)return a.end({type:"end",alpha:r=0}),!0;var t,n,u,c,h,d,m,b,w,E=g.length,S=y.length;for(n=0;S>n;++n){u=y[n],c=u.source,h=u.target,b=h.x-c.x,w=h.y-c.y,(d=b*b+w*w)&&(d=r*s[n]*((d=Math.sqrt(d))-i[n])/d,b*=d,w*=d,h.x-=b*(m=c.weight/(h.weight+c.weight)),h.y-=w*m,c.x+=b*(m=1-m),c.y+=w*m);}if((m=r*v)&&(b=f[0]/2,w=f[1]/2,n=-1,m))for(;++n<E;){u=g[n],u.x+=(b-u.x)*m,u.y+=(w-u.y)*m;}if(p)for(Qi(t=Ko.geom.quadtree(g),r,o),n=-1;++n<E;){(u=g[n]).fixed||t.visit(e(u));}for(n=-1;++n<E;){u=g[n],u.fixed?(u.x=u.px,u.y=u.py):(u.x-=(u.px-(u.px=u.x))*l,u.y-=(u.py-(u.py=u.y))*l);}a.tick({type:"tick",alpha:r});},u.nodes=function(e){return arguments.length?(g=e,u):g;},u.links=function(e){return arguments.length?(y=e,u):y;},u.size=function(e){return arguments.length?(f=e,u):f;},u.linkDistance=function(e){return arguments.length?(c="function"==typeof e?e:+e,u):c;},u.distance=u.linkDistance,u.linkStrength=function(e){return arguments.length?(h="function"==typeof e?e:+e,u):h;},u.friction=function(e){return arguments.length?(l=+e,u):l;},u.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,u):p;},u.chargeDistance=function(e){return arguments.length?(d=e*e,u):Math.sqrt(d);},u.gravity=function(e){return arguments.length?(v=+e,u):v;},u.theta=function(e){return arguments.length?(m=e*e,u):Math.sqrt(m);},u.alpha=function(e){return arguments.length?(e=+e,r?r=e>0?e:0:e>0&&(a.start({type:"start",alpha:r=e}),Ko.timer(u.tick)),u):r;},u.start=function(){function e(e,r){if(!n){for(n=new Array(a),u=0;a>u;++u){n[u]=[];}for(u=0;f>u;++u){var i=y[u];n[i.source.index].push(i.target),n[i.target.index].push(i.source);}}for(var s,o=n[t],u=-1,f=o.length;++u<f;){if(!isNaN(s=o[u][e]))return s;}return Math.random()*r;}var t,n,r,a=g.length,l=y.length,d=f[0],v=f[1];for(t=0;a>t;++t){(r=g[t]).index=t,r.weight=0;}for(t=0;l>t;++t){r=y[t],"number"==typeof r.source&&(r.source=g[r.source]),"number"==typeof r.target&&(r.target=g[r.target]),++r.source.weight,++r.target.weight;}for(t=0;a>t;++t){r=g[t],isNaN(r.x)&&(r.x=e("x",d)),isNaN(r.y)&&(r.y=e("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);}if(i=[],"function"==typeof c)for(t=0;l>t;++t){i[t]=+c.call(this,y[t],t);}else for(t=0;l>t;++t){i[t]=c;}if(s=[],"function"==typeof h)for(t=0;l>t;++t){s[t]=+h.call(this,y[t],t);}else for(t=0;l>t;++t){s[t]=h;}if(o=[],"function"==typeof p)for(t=0;a>t;++t){o[t]=+p.call(this,g[t],t);}else for(t=0;a>t;++t){o[t]=p;}return u.resume();},u.resume=function(){return u.alpha(.1);},u.stop=function(){return u.alpha(0);},u.drag=function(){return n||(n=Ko.behavior.drag().origin(Ct).on("dragstart.force",Vi).on("drag.force",t).on("dragend.force",$i)),arguments.length?(this.on("mouseover.force",Ji).on("mouseout.force",Ki).call(n),void 0):n;},Ko.rebind(u,a,"on");};var ff=20,lf=1,cf=1/0;Ko.layout.hierarchy=function(){function e(i){var s,o=[i],u=[];for(i.depth=0;null!=(s=o.pop());){if(u.push(s),(f=n.call(e,s,s.depth))&&(a=f.length)){for(var a,f,l;--a>=0;){o.push(l=f[a]),l.parent=s,l.depth=s.depth+1;}r&&(s.value=0),s.children=f;}else r&&(s.value=+r.call(e,s,s.depth)||0),delete s.children;}return Zi(i,function(e){var n,i;t&&(n=e.children)&&n.sort(t),r&&(i=e.parent)&&(i.value+=e.value);}),u;}var t=ns,n=es,r=ts;return e.sort=function(n){return arguments.length?(t=n,e):t;},e.children=function(t){return arguments.length?(n=t,e):n;},e.value=function(t){return arguments.length?(r=t,e):r;},e.revalue=function(t){return r&&(Yi(t,function(e){e.children&&(e.value=0);}),Zi(t,function(t){var n;t.children||(t.value=+r.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value);})),t;},e;},Ko.layout.partition=function(){function e(t,n,r,i){var s=t.children;if(t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i,s&&(o=s.length)){var o,u,a,f=-1;for(r=t.value?r/t.value:0;++f<o;){e(u=s[f],n,a=u.value*r,i),n+=a;}}}function t(e){var n=e.children,r=0;if(n&&(i=n.length))for(var i,s=-1;++s<i;){r=Math.max(r,t(n[s]));}return 1+r;}function n(n,s){var o=r.call(this,n,s);return e(o[0],0,i[0],i[1]/t(o[0])),o;}var r=Ko.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i;},Gi(n,r);},Ko.layout.pie=function(){function e(s){var o=s.map(function(n,r){return+t.call(e,n,r);}),u=+("function"==typeof r?r.apply(this,arguments):r),a=(("function"==typeof i?i.apply(this,arguments):i)-u)/Ko.sum(o),f=Ko.range(s.length);null!=n&&f.sort(n===hf?function(e,t){return o[t]-o[e];}:function(e,t){return n(s[e],s[t]);});var l=[];return f.forEach(function(e){var t;l[e]={data:s[e],value:t=o[e],startAngle:u,endAngle:u+=t*a};}),l;}var t=Number,n=hf,r=0,i=Lu;return e.value=function(n){return arguments.length?(t=n,e):t;},e.sort=function(t){return arguments.length?(n=t,e):n;},e.startAngle=function(t){return arguments.length?(r=t,e):r;},e.endAngle=function(t){return arguments.length?(i=t,e):i;},e;};var hf={};Ko.layout.stack=function(){function e(u,a){if(!(h=u.length))return u;var f=u.map(function(n,r){return t.call(e,n,r);}),l=f.map(function(t){return t.map(function(t,n){return[s.call(e,t,n),o.call(e,t,n)];});}),c=n.call(e,l,a);f=Ko.permute(f,c),l=Ko.permute(l,c);var h,p,d,v,m=r.call(e,l,a),g=f[0].length;for(d=0;g>d;++d){for(i.call(e,f[0][d],v=m[d],l[0][d][1]),p=1;h>p;++p){i.call(e,f[p][d],v+=l[p-1][d][1],l[p][d][1]);}}return u;}var t=Ct,n=us,r=as,i=os,s=is,o=ss;return e.values=function(n){return arguments.length?(t=n,e):t;},e.order=function(t){return arguments.length?(n="function"==typeof t?t:pf.get(t)||us,e):n;},e.offset=function(t){return arguments.length?(r="function"==typeof t?t:df.get(t)||as,e):r;},e.x=function(t){return arguments.length?(s=t,e):s;},e.y=function(t){return arguments.length?(o=t,e):o;},e.out=function(t){return arguments.length?(i=t,e):i;},e;};var pf=Ko.map({"inside-out":function insideOut(e){var t,n,r=e.length,i=e.map(fs),s=e.map(ls),o=Ko.range(r).sort(function(e,t){return i[e]-i[t];}),u=0,a=0,f=[],l=[];for(t=0;r>t;++t){n=o[t],a>u?(u+=s[n],f.push(n)):(a+=s[n],l.push(n));}return l.reverse().concat(f);},reverse:function reverse(e){return Ko.range(e.length).reverse();},"default":us}),df=Ko.map({silhouette:function silhouette(e){var t,n,r,i=e.length,s=e[0].length,o=[],u=0,a=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++){r+=e[t][n][1];}r>u&&(u=r),o.push(r);}for(n=0;s>n;++n){a[n]=(u-o[n])/2;}return a;},wiggle:function wiggle(e){var t,n,r,i,s,o,u,a,f,l=e.length,c=e[0],h=c.length,p=[];for(p[0]=a=f=0,n=1;h>n;++n){for(t=0,i=0;l>t;++t){i+=e[t][n][1];}for(t=0,s=0,u=c[n][0]-c[n-1][0];l>t;++t){for(r=0,o=(e[t][n][1]-e[t][n-1][1])/(2*u);t>r;++r){o+=(e[r][n][1]-e[r][n-1][1])/u;}s+=o*e[t][n][1];}p[n]=a-=i?s/i*u:0,f>a&&(f=a);}for(n=0;h>n;++n){p[n]-=f;}return p;},expand:function expand(e){var t,n,r,i=e.length,s=e[0].length,o=1/i,u=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++){r+=e[t][n][1];}if(r)for(t=0;i>t;t++){e[t][n][1]/=r;}else for(t=0;i>t;t++){e[t][n][1]=o;}}for(n=0;s>n;++n){u[n]=0;}return u;},zero:as});Ko.layout.histogram=function(){function e(e,s){for(var o,u,a=[],f=e.map(n,this),l=r.call(this,f,s),c=i.call(this,l,f,s),s=-1,h=f.length,p=c.length-1,d=t?1:1/h;++s<p;){o=a[s]=[],o.dx=c[s+1]-(o.x=c[s]),o.y=0;}if(p>0)for(s=-1;++s<h;){u=f[s],u>=l[0]&&u<=l[1]&&(o=a[Ko.bisect(c,u,1,p)-1],o.y+=d,o.push(e[s]));}return a;}var t=!0,n=Number,r=ds,i=hs;return e.value=function(t){return arguments.length?(n=t,e):n;},e.range=function(t){return arguments.length?(r=Nt(t),e):r;},e.bins=function(t){return arguments.length?(i="number"==typeof t?function(e){return ps(e,t);}:Nt(t),e):i;},e.frequency=function(n){return arguments.length?(t=!!n,e):t;},e;},Ko.layout.pack=function(){function e(e,s){var o=n.call(this,e,s),u=o[0],a=i[0],f=i[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t;};if(u.x=u.y=0,Zi(u,function(e){e.r=+l(e.value);}),Zi(u,bs),r){var c=r*(t?1:Math.max(2*u.r/a,2*u.r/f))/2;Zi(u,function(e){e.r+=c;}),Zi(u,bs),Zi(u,function(e){e.r-=c;});}return Ss(u,a/2,f/2,t?1:1/Math.max(2*u.r/a,2*u.r/f)),o;}var t,n=Ko.layout.hierarchy().sort(vs),r=0,i=[1,1];return e.size=function(t){return arguments.length?(i=t,e):i;},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t;},e.padding=function(t){return arguments.length?(r=+t,e):r;},Gi(e,n);},Ko.layout.tree=function(){function e(e,i){var l=o.call(this,e,i),c=l[0],h=t(c);if(Zi(h,n),h.parent.m=-h.z,Yi(h,r),f)Yi(c,s);else{var p=c,d=c,v=c;Yi(c,function(e){e.x<p.x&&(p=e),e.x>d.x&&(d=e),e.depth>v.depth&&(v=e);});var m=u(p,d)/2-p.x,g=a[0]/(d.x+u(d,p)/2+m),y=a[1]/(v.depth||1);Yi(c,function(e){e.x=(e.x+m)*g,e.y=e.depth*y;});}return l;}function t(e){for(var t,n={A:null,children:[e]},r=[n];null!=(t=r.pop());){for(var i,s=t.children,o=0,u=s.length;u>o;++o){r.push((s[o]=i={_:s[o],parent:t,children:(i=s[o].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=i);}}return n.children[0];}function n(e){var t=e.children,n=e.parent.children,r=e.i?n[e.i-1]:null;if(t.length){Ls(e);var s=(t[0].z+t[t.length-1].z)/2;r?(e.z=r.z+u(e._,r._),e.m=e.z-s):e.z=s;}else r&&(e.z=r.z+u(e._,r._));e.parent.A=i(e,r,e.parent.A||n[0]);}function r(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m;}function i(e,t,n){if(t){for(var r,i=e,s=e,o=t,a=i.parent.children[0],f=i.m,l=s.m,c=o.m,h=a.m;o=Cs(o),i=Ns(i),o&&i;){a=Ns(a),s=Cs(s),s.a=e,r=o.z+c-i.z-f+u(o._,i._),r>0&&(ks(As(o,e,n),e,r),f+=r,l+=r),c+=o.m,f+=i.m,h+=a.m,l+=s.m;}o&&!Cs(s)&&(s.t=o,s.m+=c-l),i&&!Ns(a)&&(a.t=i,a.m+=f-h,n=e);}return n;}function s(e){e.x*=a[0],e.y=e.depth*a[1];}var o=Ko.layout.hierarchy().sort(null).value(null),u=Ts,a=[1,1],f=null;return e.separation=function(t){return arguments.length?(u=t,e):u;},e.size=function(t){return arguments.length?(f=null==(a=t)?s:null,e):f?null:a;},e.nodeSize=function(t){return arguments.length?(f=null==(a=t)?null:s,e):f?a:null;},Gi(e,o);},Ko.layout.cluster=function(){function e(e,s){var o,u=t.call(this,e,s),a=u[0],f=0;Zi(a,function(e){var t=e.children;t&&t.length?(e.x=Ms(t),e.y=Os(t)):(e.x=o?f+=n(e,o):0,e.y=0,o=e);});var l=_s(a),c=Ds(a),h=l.x-n(l,c)/2,p=c.x+n(c,l)/2;return Zi(a,i?function(e){e.x=(e.x-a.x)*r[0],e.y=(a.y-e.y)*r[1];}:function(e){e.x=(e.x-h)/(p-h)*r[0],e.y=(1-(a.y?e.y/a.y:1))*r[1];}),u;}var t=Ko.layout.hierarchy().sort(null).value(null),n=Ts,r=[1,1],i=!1;return e.separation=function(t){return arguments.length?(n=t,e):n;},e.size=function(t){return arguments.length?(i=null==(r=t),e):i?null:r;},e.nodeSize=function(t){return arguments.length?(i=null!=(r=t),e):i?r:null;},Gi(e,t);},Ko.layout.treemap=function(){function e(e,t){for(var n,r,i=-1,s=e.length;++i<s;){r=(n=e[i]).value*(0>t?0:t),n.area=isNaN(r)||0>=r?0:r;}}function t(n){var s=n.children;if(s&&s.length){var o,u,a,f=c(n),l=[],h=s.slice(),d=1/0,v="slice"===p?f.dx:"dice"===p?f.dy:"slice-dice"===p?1&n.depth?f.dy:f.dx:Math.min(f.dx,f.dy);for(e(h,f.dx*f.dy/n.value),l.area=0;(a=h.length)>0;){l.push(o=h[a-1]),l.area+=o.area,"squarify"!==p||(u=r(l,v))<=d?(h.pop(),d=u):(l.area-=l.pop().area,i(l,v,f,!1),v=Math.min(f.dx,f.dy),l.length=l.area=0,d=1/0);}l.length&&(i(l,v,f,!0),l.length=l.area=0),s.forEach(t);}}function n(t){var r=t.children;if(r&&r.length){var s,o=c(t),u=r.slice(),a=[];for(e(u,o.dx*o.dy/t.value),a.area=0;s=u.pop();){a.push(s),a.area+=s.area,null!=s.z&&(i(a,s.z?o.dx:o.dy,o,!u.length),a.length=a.area=0);}r.forEach(n);}}function r(e,t){for(var n,r=e.area,i=0,s=1/0,o=-1,u=e.length;++o<u;){(n=e[o].area)&&(s>n&&(s=n),n>i&&(i=n));}return r*=r,t*=t,r?Math.max(t*i*d/r,r/(t*s*d)):1/0;}function i(e,t,n,r){var i,s=-1,o=e.length,u=n.x,f=n.y,l=t?a(e.area/t):0;if(t==n.dx){for((r||l>n.dy)&&(l=n.dy);++s<o;){i=e[s],i.x=u,i.y=f,i.dy=l,u+=i.dx=Math.min(n.x+n.dx-u,l?a(i.area/l):0);}i.z=!0,i.dx+=n.x+n.dx-u,n.y+=l,n.dy-=l;}else{for((r||l>n.dx)&&(l=n.dx);++s<o;){i=e[s],i.x=u,i.y=f,i.dx=l,f+=i.dy=Math.min(n.y+n.dy-f,l?a(i.area/l):0);}i.z=!1,i.dy+=n.y+n.dy-f,n.x+=l,n.dx-=l;}}function s(r){var i=o||u(r),s=i[0];return s.x=0,s.y=0,s.dx=f[0],s.dy=f[1],o&&u.revalue(s),e([s],s.dx*s.dy/s.value),(o?n:t)(s),h&&(o=i),i;}var o,u=Ko.layout.hierarchy(),a=Math.round,f=[1,1],l=null,c=Ps,h=!1,p="squarify",d=.5*(1+Math.sqrt(5));return s.size=function(e){return arguments.length?(f=e,s):f;},s.padding=function(e){function t(t){var n=e.call(s,t,t.depth);return null==n?Ps(t):Hs(t,"number"==typeof n?[n,n,n,n]:n);}function n(t){return Hs(t,e);}if(!arguments.length)return l;var r;return c=null==(l=e)?Ps:"function"==(r=_typeof(e))?t:"number"===r?(e=[e,e,e,e],n):n,s;},s.round=function(e){return arguments.length?(a=e?Math.round:Number,s):a!=Number;},s.sticky=function(e){return arguments.length?(h=e,o=null,s):h;},s.ratio=function(e){return arguments.length?(d=e,s):d;},s.mode=function(e){return arguments.length?(p=e+"",s):p;},Gi(s,u);},Ko.random={normal:function normal(e,t){var n=arguments.length;return 2>n&&(t=1),1>n&&(e=0),function(){var n,r,i;do{n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;}while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i);};},logNormal:function logNormal(){var e=Ko.random.normal.apply(Ko,arguments);return function(){return Math.exp(e());};},bates:function bates(e){var t=Ko.random.irwinHall(e);return function(){return t()/e;};},irwinHall:function irwinHall(e){return function(){for(var t=0,n=0;e>n;n++){t+=Math.random();}return t;};}},Ko.scale={};var vf={floor:Ct,ceil:Ct};Ko.scale.linear=function(){return Us([0,1],[0,1],gi,!1);};var mf={s:1,g:1,p:1,r:1,e:1};Ko.scale.log=function(){return Qs(Ko.scale.linear().domain([0,1]),10,!0,[1,10]);};var gf=Ko.format(".0e"),yf={floor:function floor(e){return-Math.ceil(-e);},ceil:function ceil(e){return-Math.floor(-e);}};Ko.scale.pow=function(){return Gs(Ko.scale.linear(),1,[0,1]);},Ko.scale.sqrt=function(){return Ko.scale.pow().exponent(.5);},Ko.scale.ordinal=function(){return Zs([],{t:"range",a:[[]]});},Ko.scale.category10=function(){return Ko.scale.ordinal().range(bf);},Ko.scale.category20=function(){return Ko.scale.ordinal().range(wf);},Ko.scale.category20b=function(){return Ko.scale.ordinal().range(Ef);},Ko.scale.category20c=function(){return Ko.scale.ordinal().range(Sf);};var bf=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(yt),wf=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(yt),Ef=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(yt),Sf=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(yt);Ko.scale.quantile=function(){return eo([],[]);},Ko.scale.quantize=function(){return to(0,1,[0,1]);},Ko.scale.threshold=function(){return no([.5],[0,1]);},Ko.scale.identity=function(){return ro([0,1]);},Ko.svg={},Ko.svg.arc=function(){function e(){var e=t.apply(this,arguments),s=n.apply(this,arguments),o=r.apply(this,arguments)+xf,u=i.apply(this,arguments)+xf,a=(o>u&&(a=o,o=u,u=a),u-o),f=ku>a?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=Tf?e?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+-s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+-e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+-s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":e?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+f+",0 "+e*l+","+e*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z";}var t=io,n=so,r=oo,i=uo;return e.innerRadius=function(n){return arguments.length?(t=Nt(n),e):t;},e.outerRadius=function(t){return arguments.length?(n=Nt(t),e):n;},e.startAngle=function(t){return arguments.length?(r=Nt(t),e):r;},e.endAngle=function(t){return arguments.length?(i=Nt(t),e):i;},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,s=(r.apply(this,arguments)+i.apply(this,arguments))/2+xf;return[Math.cos(s)*e,Math.sin(s)*e];},e;};var xf=-Au,Tf=Lu-Ou;Ko.svg.line=function(){return ao(Ct);};var Nf=Ko.map({linear:fo,"linear-closed":lo,step:co,"step-before":ho,"step-after":po,basis:wo,"basis-open":Eo,"basis-closed":So,bundle:xo,cardinal:go,"cardinal-open":vo,"cardinal-closed":mo,monotone:Ao});Nf.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e);});var Cf=[0,2/3,1/3,0],kf=[0,1/3,2/3,0],Lf=[0,1/6,2/3,1/6];Ko.svg.line.radial=function(){var e=ao(Oo);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e;},ho.reverse=po,po.reverse=ho,Ko.svg.area=function(){return Mo(Ct);},Ko.svg.area.radial=function(){var e=Mo(Oo);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e;},Ko.svg.chord=function(){function e(e,u){var a=t(this,s,e,u),f=t(this,o,e,u);return"M"+a.p0+r(a.r,a.p1,a.a1-a.a0)+(n(a,f)?i(a.r,a.p1,a.r,a.p0):i(a.r,a.p1,f.r,f.p0)+r(f.r,f.p1,f.a1-f.a0)+i(f.r,f.p1,a.r,a.p0))+"Z";}function t(e,t,n,r){var i=t.call(e,n,r),s=u.call(e,i,r),o=a.call(e,i,r)+xf,l=f.call(e,i,r)+xf;return{r:s,a0:o,a1:l,p0:[s*Math.cos(o),s*Math.sin(o)],p1:[s*Math.cos(l),s*Math.sin(l)]};}function n(e,t){return e.a0==t.a0&&e.a1==t.a1;}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>ku)+",1 "+t;}function i(e,t,n,r){return"Q 0,0 "+r;}var s=yr,o=br,u=_o,a=oo,f=uo;return e.radius=function(t){return arguments.length?(u=Nt(t),e):u;},e.source=function(t){return arguments.length?(s=Nt(t),e):s;},e.target=function(t){return arguments.length?(o=Nt(t),e):o;},e.startAngle=function(t){return arguments.length?(a=Nt(t),e):a;},e.endAngle=function(t){return arguments.length?(f=Nt(t),e):f;},e;},Ko.svg.diagonal=function(){function e(e,i){var s=t.call(this,e,i),o=n.call(this,e,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(r),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3];}var t=yr,n=br,r=Do;return e.source=function(n){return arguments.length?(t=Nt(n),e):t;},e.target=function(t){return arguments.length?(n=Nt(t),e):n;},e.projection=function(t){return arguments.length?(r=t,e):r;},e;},Ko.svg.diagonal.radial=function(){var e=Ko.svg.diagonal(),t=Do,n=e.projection;return e.projection=function(e){return arguments.length?n(Po(t=e)):t;},e;},Ko.svg.symbol=function(){function e(e,r){return(Af.get(t.call(this,e,r))||jo)(n.call(this,e,r));}var t=Bo,n=Ho;return e.type=function(n){return arguments.length?(t=Nt(n),e):t;},e.size=function(t){return arguments.length?(n=Nt(t),e):n;},e;};var Af=Ko.map({circle:jo,cross:function cross(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z";},diamond:function diamond(e){var t=Math.sqrt(e/(2*Df)),n=t*Df;return"M0,"+-t+"L"+n+",0"+" 0,"+t+" "+-n+",0"+"Z";},square:function square(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z";},"triangle-down":function triangleDown(e){var t=Math.sqrt(e/_f),n=t*_f/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z";},"triangle-up":function triangleUp(e){var t=Math.sqrt(e/_f),n=t*_f/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z";}});Ko.svg.symbolTypes=Af.keys();var Of,Mf,_f=Math.sqrt(3),Df=Math.tan(30*_u),Pf=[],Hf=0;Pf.call=bu.call,Pf.empty=bu.empty,Pf.node=bu.node,Pf.size=bu.size,Ko.transition=function(e){return arguments.length?Of?e.transition():e:Su.transition();},Ko.transition.prototype=Pf,Pf.select=function(e){var t,n,r,i=this.id,s=[];e=N(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]);for(var a=this[o],f=-1,l=a.length;++f<l;){(r=a[f])&&(n=e.call(r,r.__data__,f,o))?("__data__"in r&&(n.__data__=r.__data__),Ro(n,f,i,r.__transition__[i]),t.push(n)):t.push(null);}}return Fo(s,i);},Pf.selectAll=function(e){var t,n,r,i,s,o=this.id,u=[];e=C(e);for(var a=-1,f=this.length;++a<f;){for(var l=this[a],c=-1,h=l.length;++c<h;){if(r=l[c]){s=r.__transition__[o],n=e.call(r,r.__data__,c,a),u.push(t=[]);for(var p=-1,d=n.length;++p<d;){(i=n[p])&&Ro(i,p,o,s),t.push(i);}}}}return Fo(u,o);},Pf.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=j(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]);for(var n=this[s],u=0,a=n.length;a>u;u++){(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r);}}return Fo(i,this.id);},Pf.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):I(this,null==t?function(t){t.__transition__[n].tween.remove(e);}:function(r){r.__transition__[n].tween.set(e,t);});},Pf.attr=function(e,t){function n(){this.removeAttribute(u);}function r(){this.removeAttributeNS(u.space,u.local);}function i(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(u);return n!==e&&(t=o(n,e),function(e){this.setAttribute(u,t(e));});});}function s(e){return null==e?r:(e+="",function(){var t,n=this.getAttributeNS(u.space,u.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(u.space,u.local,t(e));});});}if(arguments.length<2){for(t in e){this.attr(t,e[t]);}return this;}var o="transform"==e?qi:gi,u=Ko.ns.qualify(e);return Io(this,"attr."+e,t,u.local?s:i);},Pf.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r&&function(e){this.setAttribute(i,r(e));};}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r&&function(e){this.setAttributeNS(i.space,i.local,r(e));};}var i=Ko.ns.qualify(e);return this.tween("attr."+e,i.local?r:n);},Pf.style=function(e,t,n){function r(){this.style.removeProperty(e);}function i(t){return null==t?r:(t+="",function(){var r,i=eu.getComputedStyle(this,null).getPropertyValue(e);return i!==t&&(r=gi(i,t),function(t){this.style.setProperty(e,r(t),n);});});}var s=arguments.length;if(3>s){if("string"!=typeof e){2>s&&(t="");for(n in e){this.style(n,e[n],t);}return this;}n="";}return Io(this,"style."+e,t,i);},Pf.styleTween=function(e,t,n){function r(r,i){var s=t.call(this,r,i,eu.getComputedStyle(this,null).getPropertyValue(e));return s&&function(t){this.style.setProperty(e,s(t),n);};}return arguments.length<3&&(n=""),this.tween("style."+e,r);},Pf.text=function(e){return Io(this,"text",e,qo);},Pf.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this);});},Pf.ease=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof e&&(e=Ko.ease.apply(Ko,arguments)),I(this,function(n){n.__transition__[t].ease=e;}));},Pf.delay=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:I(this,"function"==typeof e?function(n,r,i){n.__transition__[t].delay=+e.call(n,n.__data__,r,i);}:(e=+e,function(n){n.__transition__[t].delay=e;}));},Pf.duration=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:I(this,"function"==typeof e?function(n,r,i){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,r,i));}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e;}));},Pf.each=function(e,t){var n=this.id;if(arguments.length<2){var r=Mf,i=Of;Of=n,I(this,function(t,r,i){Mf=t.__transition__[n],e.call(t,t.__data__,r,i);}),Mf=r,Of=i;}else I(this,function(r){var i=r.__transition__[n];(i.event||(i.event=Ko.dispatch("start","end"))).on(e,t);});return this;},Pf.transition=function(){for(var e,t,n,r,i=this.id,s=++Hf,o=[],u=0,a=this.length;a>u;u++){o.push(e=[]);for(var t=this[u],f=0,l=t.length;l>f;f++){(n=t[f])&&(r=Object.create(n.__transition__[i]),r.delay+=r.duration,Ro(n,f,s,r)),e.push(n);}}return Fo(o,s);},Ko.svg.axis=function(){function e(e){e.each(function(){var e,f=Ko.select(this),l=this.__chart__||n,c=this.__chart__=n.copy(),h=null==a?c.ticks?c.ticks.apply(c,u):c.domain():a,p=null==t?c.tickFormat?c.tickFormat.apply(c,u):Ct:t,d=f.selectAll(".tick").data(h,c),v=d.enter().insert("g",".domain").attr("class","tick").style("opacity",Ou),m=Ko.transition(d.exit()).style("opacity",Ou).remove(),g=Ko.transition(d.order()).style("opacity",1),y=Math.max(i,0)+o,b=js(c),w=f.selectAll(".domain").data([0]),E=(w.enter().append("path").attr("class","domain"),Ko.transition(w));v.append("line"),v.append("text");var S,x,T,N,C=v.select("line"),k=g.select("line"),L=d.select("text").text(p),A=v.select("text"),O=g.select("text"),M="top"===r||"left"===r?-1:1;if("bottom"===r||"top"===r?(e=Uo,S="x",T="y",x="x2",N="y2",L.attr("dy",0>M?"0em":".71em").style("text-anchor","middle"),E.attr("d","M"+b[0]+","+M*s+"V0H"+b[1]+"V"+M*s)):(e=zo,S="y",T="x",x="y2",N="x2",L.attr("dy",".32em").style("text-anchor",0>M?"end":"start"),E.attr("d","M"+M*s+","+b[0]+"H0V"+b[1]+"H"+M*s)),C.attr(N,M*i),A.attr(T,M*y),k.attr(x,0).attr(N,M*i),O.attr(S,0).attr(T,M*y),c.rangeBand){var _=c,D=_.rangeBand()/2;l=c=function c(e){return _(e)+D;};}else l.rangeBand?l=c:m.call(e,c,l);v.call(e,l,c),g.call(e,c,c);});}var t,n=Ko.scale.linear(),r=Bf,i=6,s=6,o=3,u=[10],a=null;return e.scale=function(t){return arguments.length?(n=t,e):n;},e.orient=function(t){return arguments.length?(r=t in jf?t+"":Bf,e):r;},e.ticks=function(){return arguments.length?(u=arguments,e):u;},e.tickValues=function(t){return arguments.length?(a=t,e):a;},e.tickFormat=function(n){return arguments.length?(t=n,e):t;},e.tickSize=function(t){var n=arguments.length;return n?(i=+t,s=+arguments[n-1],e):i;},e.innerTickSize=function(t){return arguments.length?(i=+t,e):i;},e.outerTickSize=function(t){return arguments.length?(s=+t,e):s;},e.tickPadding=function(t){return arguments.length?(o=+t,e):o;},e.tickSubdivide=function(){return arguments.length&&e;},e;};var Bf="bottom",jf={top:1,right:1,bottom:1,left:1};Ko.svg.brush=function(){function e(s){s.each(function(){var s=Ko.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),o=s.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),s.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var u=s.selectAll(".resize").data(d,Ct);u.exit().remove(),u.enter().append("g").attr("class",function(e){return"resize "+e;}).style("cursor",function(e){return Ff[e];}).append("rect").attr("x",function(e){return /[ew]$/.test(e)?-3:null;}).attr("y",function(e){return /^[ns]/.test(e)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden"),u.style("display",e.empty()?"none":null);var l,c=Ko.transition(s),h=Ko.transition(o);a&&(l=js(a),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(c)),f&&(l=js(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),r(c)),t(c);});}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+l[+/e$/.test(e)]+","+c[+/^s/.test(e)]+")";});}function n(e){e.select(".extent").attr("x",l[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0]);}function r(e){e.select(".extent").attr("y",c[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",c[1]-c[0]);}function i(){function i(){32==Ko.event.keyCode&&(L||(y=null,O[0]-=l[1],O[1]-=c[1],L=2),E());}function d(){32==Ko.event.keyCode&&2==L&&(O[0]+=l[1],O[1]+=c[1],L=0,E());}function v(){var e=Ko.mouse(w),i=!1;b&&(e[0]+=b[0],e[1]+=b[1]),L||(Ko.event.altKey?(y||(y=[(l[0]+l[1])/2,(c[0]+c[1])/2]),O[0]=l[+(e[0]<y[0])],O[1]=c[+(e[1]<y[1])]):y=null),C&&m(e,a,0)&&(n(T),i=!0),k&&m(e,f,1)&&(r(T),i=!0),i&&(t(T),x({type:"brush",mode:L?"move":"resize"}));}function m(e,t,n){var r,i,u=js(t),a=u[0],f=u[1],d=O[n],v=n?c:l,m=v[1]-v[0];return L&&(a-=d,f-=m+d),r=(n?p:h)?Math.max(a,Math.min(f,e[n])):e[n],L?i=(r+=d)+m:(y&&(d=Math.max(a,Math.min(f,2*y[n]-r))),r>d?(i=r,r=d):i=d),v[0]!=r||v[1]!=i?(n?o=null:s=null,v[0]=r,v[1]=i,!0):void 0;}function g(){v(),T.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),Ko.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),x({type:"brushend"});}var y,b,w=this,S=Ko.select(Ko.event.target),x=u.of(w,arguments),T=Ko.select(w),N=S.datum(),C=!/^(n|s)$/.test(N)&&a,k=!/^(e|w)$/.test(N)&&f,L=S.classed("extent"),A=V(),O=Ko.mouse(w),M=Ko.select(eu).on("keydown.brush",i).on("keyup.brush",d);if(Ko.event.changedTouches?M.on("touchmove.brush",v).on("touchend.brush",g):M.on("mousemove.brush",v).on("mouseup.brush",g),T.interrupt().selectAll("*").interrupt(),L)O[0]=l[0]-O[0],O[1]=c[0]-O[1];else if(N){var _=+/w$/.test(N),D=+/^n/.test(N);b=[l[1-_]-O[0],c[1-D]-O[1]],O[0]=l[_],O[1]=c[D];}else Ko.event.altKey&&(y=O.slice());T.style("pointer-events","none").selectAll(".resize").style("display",null),Ko.select("body").style("cursor",S.style("cursor")),x({type:"brushstart"}),v();}var s,o,u=x(e,"brushstart","brush","brushend"),a=null,f=null,l=[0,0],c=[0,0],h=!0,p=!0,d=If[0];return e.event=function(e){e.each(function(){var e=u.of(this,arguments),t={x:l,y:c,i:s,j:o},n=this.__chart__||t;this.__chart__=t,Of?Ko.select(this).transition().each("start.brush",function(){s=n.i,o=n.j,l=n.x,c=n.y,e({type:"brushstart"});}).tween("brush:brush",function(){var n=yi(l,t.x),r=yi(c,t.y);return s=o=null,function(i){l=t.x=n(i),c=t.y=r(i),e({type:"brush",mode:"resize"});};}).each("end.brush",function(){s=t.i,o=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"});}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}));});},e.x=function(t){return arguments.length?(a=t,d=If[!a<<1|!f],e):a;},e.y=function(t){return arguments.length?(f=t,d=If[!a<<1|!f],e):f;},e.clamp=function(t){return arguments.length?(a&&f?(h=!!t[0],p=!!t[1]):a?h=!!t:f&&(p=!!t),e):a&&f?[h,p]:a?h:f?p:null;},e.extent=function(t){var n,r,i,u,h;return arguments.length?(a&&(n=t[0],r=t[1],f&&(n=n[0],r=r[0]),s=[n,r],a.invert&&(n=a(n),r=a(r)),n>r&&(h=n,n=r,r=h),(n!=l[0]||r!=l[1])&&(l=[n,r])),f&&(i=t[0],u=t[1],a&&(i=i[1],u=u[1]),o=[i,u],f.invert&&(i=f(i),u=f(u)),i>u&&(h=i,i=u,u=h),(i!=c[0]||u!=c[1])&&(c=[i,u])),e):(a&&(s?(n=s[0],r=s[1]):(n=l[0],r=l[1],a.invert&&(n=a.invert(n),r=a.invert(r)),n>r&&(h=n,n=r,r=h))),f&&(o?(i=o[0],u=o[1]):(i=c[0],u=c[1],f.invert&&(i=f.invert(i),u=f.invert(u)),i>u&&(h=i,i=u,u=h))),a&&f?[[n,i],[r,u]]:a?[n,r]:f&&[i,u]);},e.clear=function(){return e.empty()||(l=[0,0],c=[0,0],s=o=null),e;},e.empty=function(){return!!a&&l[0]==l[1]||!!f&&c[0]==c[1];},Ko.rebind(e,u,"on");};var Ff={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},If=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],qf=ia.format=la.timeFormat,Rf=qf.utc,Uf=Rf("%Y-%m-%dT%H:%M:%S.%LZ");qf.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Wo:Uf,Wo.parse=function(e){var t=new Date(e);return isNaN(t)?null:t;},Wo.toString=Uf.toString,ia.second=It(function(e){return new sa(1e3*Math.floor(e/1e3));},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t));},function(e){return e.getSeconds();}),ia.seconds=ia.second.range,ia.seconds.utc=ia.second.utc.range,ia.minute=It(function(e){return new sa(6e4*Math.floor(e/6e4));},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t));},function(e){return e.getMinutes();}),ia.minutes=ia.minute.range,ia.minutes.utc=ia.minute.utc.range,ia.hour=It(function(e){var t=e.getTimezoneOffset()/60;return new sa(36e5*(Math.floor(e/36e5-t)+t));},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t));},function(e){return e.getHours();}),ia.hours=ia.hour.range,ia.hours.utc=ia.hour.utc.range,ia.month=It(function(e){return e=ia.day(e),e.setDate(1),e;},function(e,t){e.setMonth(e.getMonth()+t);},function(e){return e.getMonth();}),ia.months=ia.month.range,ia.months.utc=ia.month.utc.range;var zf=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Wf=[[ia.second,1],[ia.second,5],[ia.second,15],[ia.second,30],[ia.minute,1],[ia.minute,5],[ia.minute,15],[ia.minute,30],[ia.hour,1],[ia.hour,3],[ia.hour,6],[ia.hour,12],[ia.day,1],[ia.day,2],[ia.week,1],[ia.month,1],[ia.month,3],[ia.year,1]],Xf=qf.multi([[".%L",function(e){return e.getMilliseconds();}],[":%S",function(e){return e.getSeconds();}],["%I:%M",function(e){return e.getMinutes();}],["%I %p",function(e){return e.getHours();}],["%a %d",function(e){return e.getDay()&&1!=e.getDate();}],["%b %d",function(e){return 1!=e.getDate();}],["%B",function(e){return e.getMonth();}],["%Y",Ln]]),Vf={range:function range(e,t,n){return Ko.range(Math.ceil(e/n)*n,+t,n).map(Vo);},floor:Ct,ceil:Ct};Wf.year=ia.year,ia.scale=function(){return Xo(Ko.scale.linear(),Wf,Xf);};var $f=Wf.map(function(e){return[e[0].utc,e[1]];}),Jf=Rf.multi([[".%L",function(e){return e.getUTCMilliseconds();}],[":%S",function(e){return e.getUTCSeconds();}],["%I:%M",function(e){return e.getUTCMinutes();}],["%I %p",function(e){return e.getUTCHours();}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate();}],["%b %d",function(e){return 1!=e.getUTCDate();}],["%B",function(e){return e.getUTCMonth();}],["%Y",Ln]]);$f.year=ia.year.utc,ia.scale.utc=function(){return Xo(Ko.scale.linear(),$f,Jf);},Ko.text=kt(function(e){return e.responseText;}),Ko.json=function(e,t){return Lt(e,"application/json",$o,t);},Ko.html=function(e,t){return Lt(e,"text/html",Jo,t);},Ko.xml=kt(function(e){return e.responseXML;}),"function"==typeof define&&define.amd?define("d3",Ko):"object"==(typeof module==="undefined"?"undefined":_typeof(module))&&module.exports&&(module.exports=Ko),this.d3=Ko;}(),typeof Object.create!="function"&&(Object.create=function(e){function t(){}return t.prototype=e,new t();}),function(e,t,n){var r={init:function init(t,n){var r=this;r.$elem=e(n),r.options=e.extend({},e.fn.owlCarousel.options,r.$elem.data(),t),r.userOptions=t,r.loadContent();},loadContent:function loadContent(){function r(e){var n,r="";if(typeof t.options.jsonSuccess=="function")t.options.jsonSuccess.apply(this,[e]);else{for(n in e.owl){e.owl.hasOwnProperty(n)&&(r+=e.owl[n].item);}t.$elem.html(r);}t.logIn();}var t=this,n;typeof t.options.beforeInit=="function"&&t.options.beforeInit.apply(this,[t.$elem]),typeof t.options.jsonPath=="string"?(n=t.options.jsonPath,e.getJSON(n,r)):t.logIn();},logIn:function logIn(){var e=this;e.$elem.data("owl-originalStyles",e.$elem.attr("style")),e.$elem.data("owl-originalClasses",e.$elem.attr("class")),e.$elem.css({opacity:0}),e.orignalItems=e.options.items,e.checkBrowser(),e.wrapperWidth=0,e.checkVisible=null,e.setVars();},setVars:function setVars(){var e=this;if(e.$elem.children().length===0)return!1;e.baseClass(),e.eventTypes(),e.$userItems=e.$elem.children(),e.itemsAmount=e.$userItems.length,e.wrapItems(),e.$owlItems=e.$elem.find(".owl-item"),e.$owlWrapper=e.$elem.find(".owl-wrapper"),e.playDirection="next",e.prevItem=0,e.prevArr=[0],e.currentItem=0,e.customEvents(),e.onStartup();},onStartup:function onStartup(){var e=this;e.updateItems(),e.calculateAll(),e.buildControls(),e.updateControls(),e.response(),e.moveEvents(),e.stopOnHover(),e.owlStatus(),e.options.transitionStyle!==!1&&e.transitionTypes(e.options.transitionStyle),e.options.autoPlay===!0&&(e.options.autoPlay=5e3),e.play(),e.$elem.find(".owl-wrapper").css("display","block"),e.$elem.is(":visible")?e.$elem.css("opacity",1):e.watchVisibility(),e.onstartup=!1,e.eachMoveUpdate(),typeof e.options.afterInit=="function"&&e.options.afterInit.apply(this,[e.$elem,e.visibleItems]);},eachMoveUpdate:function eachMoveUpdate(){var e=this;e.options.lazyLoad===!0&&e.lazyLoad(),e.options.autoHeight===!0&&e.autoHeight(),e.onVisibleItems(),typeof e.options.afterAction=="function"&&e.options.afterAction.apply(this,[e.$elem]);},updateVars:function updateVars(){var e=this;typeof e.options.beforeUpdate=="function"&&e.options.beforeUpdate.apply(this,[e.$elem]),e.watchVisibility(),e.updateItems(),e.calculateAll(),e.updatePosition(),e.updateControls(),e.eachMoveUpdate(),typeof e.options.afterUpdate=="function"&&e.options.afterUpdate.apply(this,[e.$elem]);},reload:function reload(){var e=this;t.setTimeout(function(){e.updateVars();},0);},watchVisibility:function watchVisibility(){var e=this;if(e.$elem.is(":visible")!==!1)return!1;e.$elem.css({opacity:0}),t.clearInterval(e.autoPlayInterval),t.clearInterval(e.checkVisible),e.checkVisible=t.setInterval(function(){e.$elem.is(":visible")&&(e.reload(),e.$elem.animate({opacity:1},200),t.clearInterval(e.checkVisible));},500);},wrapItems:function wrapItems(){var e=this;e.$userItems.wrapAll('<div class="owl-wrapper">').wrap('<div class="owl-item"></div>'),e.$elem.find(".owl-wrapper").wrap('<div class="owl-wrapper-outer">'),e.wrapperOuter=e.$elem.find(".owl-wrapper-outer"),e.$elem.css("display","block");},baseClass:function baseClass(){var e=this,t=e.$elem.hasClass(e.options.baseClass),n=e.$elem.hasClass(e.options.theme);t||e.$elem.addClass(e.options.baseClass),n||e.$elem.addClass(e.options.theme);},updateItems:function updateItems(){var t=this,n,r;if(t.options.responsive===!1)return!1;if(t.options.singleItem===!0)return t.options.items=t.orignalItems=1,t.options.itemsCustom=!1,t.options.itemsDesktop=!1,t.options.itemsDesktopSmall=!1,t.options.itemsTablet=!1,t.options.itemsTabletSmall=!1,t.options.itemsMobile=!1,!1;n=e(t.options.responsiveBaseWidth).width(),n>(t.options.itemsDesktop[0]||t.orignalItems)&&(t.options.items=t.orignalItems);if(t.options.itemsCustom!==!1){t.options.itemsCustom.sort(function(e,t){return e[0]-t[0];});for(r=0;r<t.options.itemsCustom.length;r+=1){t.options.itemsCustom[r][0]<=n&&(t.options.items=t.options.itemsCustom[r][1]);}}else n<=t.options.itemsDesktop[0]&&t.options.itemsDesktop!==!1&&(t.options.items=t.options.itemsDesktop[1]),n<=t.options.itemsDesktopSmall[0]&&t.options.itemsDesktopSmall!==!1&&(t.options.items=t.options.itemsDesktopSmall[1]),n<=t.options.itemsTablet[0]&&t.options.itemsTablet!==!1&&(t.options.items=t.options.itemsTablet[1]),n<=t.options.itemsTabletSmall[0]&&t.options.itemsTabletSmall!==!1&&(t.options.items=t.options.itemsTabletSmall[1]),n<=t.options.itemsMobile[0]&&t.options.itemsMobile!==!1&&(t.options.items=t.options.itemsMobile[1]);t.options.items>t.itemsAmount&&t.options.itemsScaleUp===!0&&(t.options.items=t.itemsAmount);},response:function response(){var n=this,r,i;if(n.options.responsive!==!0)return!1;i=e(t).width(),n.resizer=function(){e(t).width()!==i&&(n.options.autoPlay!==!1&&t.clearInterval(n.autoPlayInterval),t.clearTimeout(r),r=t.setTimeout(function(){i=e(t).width(),n.updateVars(),n.options.onWidthChange?n.options.onWidthChange():!1;},n.options.responsiveRefreshRate));},e(t).resize(n.resizer);},updatePosition:function updatePosition(){var e=this;e.jumpTo(e.currentItem),e.options.autoPlay!==!1&&e.checkAp();},appendItemsSizes:function appendItemsSizes(){var t=this,n=0,r=t.itemsAmount-t.options.items;t.$owlItems.each(function(i){var s=e(this);s.css({width:t.itemWidth}).data("owl-item",Number(i));if(i%t.options.items===0||i===r)i>r||(n+=1);s.data("owl-roundPages",n);});},appendWrapperSizes:function appendWrapperSizes(){var e=this,t=e.$owlItems.length*e.itemWidth;e.$owlWrapper.css({width:t*2,left:0}),e.appendItemsSizes();},calculateAll:function calculateAll(){var e=this;e.calculateWidth(),e.appendWrapperSizes(),e.loops(),e.max();},calculateWidth:function calculateWidth(){var e=this;e.itemWidth=Math.round(e.$elem.width()/e.options.items);},max:function max(){var e=this,t=(e.itemsAmount*e.itemWidth-e.options.items*e.itemWidth)*-1;return e.options.items>e.itemsAmount?(e.maximumItem=0,t=0,e.maximumPixels=0):(e.maximumItem=e.itemsAmount-e.options.items,e.maximumPixels=t),t;},min:function min(){return 0;},loops:function loops(){var t=this,n=0,r=0,i,s,o;t.positionsInArray=[0],t.pagesInArray=[];for(i=0;i<t.itemsAmount;i+=1){r+=t.itemWidth,t.positionsInArray.push(-r),t.options.scrollPerPage===!0&&(s=e(t.$owlItems[i]),o=s.data("owl-roundPages"),o!==n&&(t.pagesInArray[n]=t.positionsInArray[i],n=o));}},buildControls:function buildControls(){var t=this;if(t.options.navigation===!0||t.options.pagination===!0)t.owlControls=e('<div class="owl-controls"/>').toggleClass("clickable",!t.browser.isTouch).appendTo(t.$elem);t.options.pagination===!0&&t.buildPagination(),t.options.navigation===!0&&t.buildButtons();},buildButtons:function buildButtons(){var t=this,n=e('<div class="owl-buttons"/>');t.owlControls.append(n),t.buttonPrev=e("<div/>",{"class":"owl-prev",html:t.options.navigationText[0]||""}),t.buttonNext=e("<div/>",{"class":"owl-next",html:t.options.navigationText[1]||""}),n.append(t.buttonPrev).append(t.buttonNext),n.on("touchstart.owlControls mousedown.owlControls",'div[class^="owl"]',function(e){e.preventDefault();}),n.on("touchend.owlControls mouseup.owlControls",'div[class^="owl"]',function(n){n.preventDefault(),e(this).hasClass("owl-next")?t.next():t.prev();});},buildPagination:function buildPagination(){var t=this;t.paginationWrapper=e('<div class="owl-pagination"/>'),t.owlControls.append(t.paginationWrapper),t.paginationWrapper.on("touchend.owlControls mouseup.owlControls",".owl-page",function(n){n.preventDefault(),Number(e(this).data("owl-page"))!==t.currentItem&&t.goTo(Number(e(this).data("owl-page")),!0);});},updatePagination:function updatePagination(){var t=this,n,r,i,s,o,u;if(t.options.pagination===!1)return!1;t.paginationWrapper.html(""),n=0,r=t.itemsAmount-t.itemsAmount%t.options.items;for(s=0;s<t.itemsAmount;s+=1){s%t.options.items===0&&(n+=1,r===s&&(i=t.itemsAmount-t.options.items),o=e("<div/>",{"class":"owl-page"}),u=e("<span></span>",{text:t.options.paginationNumbers===!0?n:"","class":t.options.paginationNumbers===!0?"owl-numbers":""}),o.append(u),o.data("owl-page",r===s?i:s),o.data("owl-roundPages",n),t.paginationWrapper.append(o));}t.checkPagination();},checkPagination:function checkPagination(){var t=this;if(t.options.pagination===!1)return!1;t.paginationWrapper.find(".owl-page").each(function(){e(this).data("owl-roundPages")===e(t.$owlItems[t.currentItem]).data("owl-roundPages")&&(t.paginationWrapper.find(".owl-page").removeClass("active"),e(this).addClass("active"));});},checkNavigation:function checkNavigation(){var e=this;if(e.options.navigation===!1)return!1;e.options.rewindNav===!1&&(e.currentItem===0&&e.maximumItem===0?(e.buttonPrev.addClass("disabled"),e.buttonNext.addClass("disabled")):e.currentItem===0&&e.maximumItem!==0?(e.buttonPrev.addClass("disabled"),e.buttonNext.removeClass("disabled")):e.currentItem===e.maximumItem?(e.buttonPrev.removeClass("disabled"),e.buttonNext.addClass("disabled")):e.currentItem!==0&&e.currentItem!==e.maximumItem&&(e.buttonPrev.removeClass("disabled"),e.buttonNext.removeClass("disabled")));},updateControls:function updateControls(){var e=this;e.updatePagination(),e.checkNavigation(),e.owlControls&&(e.options.items>=e.itemsAmount?e.owlControls.hide():e.owlControls.show());},destroyControls:function destroyControls(){var e=this;e.owlControls&&e.owlControls.remove();},next:function next(e){var t=this;if(t.isTransition)return!1;t.currentItem+=t.options.scrollPerPage===!0?t.options.items:1;if(t.currentItem>t.maximumItem+(t.options.scrollPerPage===!0?t.options.items-1:0)){if(t.options.rewindNav!==!0)return t.currentItem=t.maximumItem,!1;t.currentItem=0,e="rewind";}t.goTo(t.currentItem,e);},prev:function prev(e){var t=this;if(t.isTransition)return!1;t.options.scrollPerPage===!0&&t.currentItem>0&&t.currentItem<t.options.items?t.currentItem=0:t.currentItem-=t.options.scrollPerPage===!0?t.options.items:1;if(t.currentItem<0){if(t.options.rewindNav!==!0)return t.currentItem=0,!1;t.currentItem=t.maximumItem,e="rewind";}t.goTo(t.currentItem,e);},goTo:function goTo(e,n,r){var i=this,s;if(i.isTransition)return!1;typeof i.options.beforeMove=="function"&&i.options.beforeMove.apply(this,[i.$elem]),e>=i.maximumItem?e=i.maximumItem:e<=0&&(e=0),i.currentItem=i.owl.currentItem=e;if(i.options.transitionStyle!==!1&&r!=="drag"&&i.options.items===1&&i.browser.support3d===!0)return i.swapSpeed(0),i.browser.support3d===!0?i.transition3d(i.positionsInArray[e]):i.css2slide(i.positionsInArray[e],1),i.afterGo(),i.singleItemTransition(),!1;s=i.positionsInArray[e],i.browser.support3d===!0?(i.isCss3Finish=!1,n===!0?(i.swapSpeed("paginationSpeed"),t.setTimeout(function(){i.isCss3Finish=!0;},i.options.paginationSpeed)):n==="rewind"?(i.swapSpeed(i.options.rewindSpeed),t.setTimeout(function(){i.isCss3Finish=!0;},i.options.rewindSpeed)):(i.swapSpeed("slideSpeed"),t.setTimeout(function(){i.isCss3Finish=!0;},i.options.slideSpeed)),i.transition3d(s)):n===!0?i.css2slide(s,i.options.paginationSpeed):n==="rewind"?i.css2slide(s,i.options.rewindSpeed):i.css2slide(s,i.options.slideSpeed),i.afterGo();},jumpTo:function jumpTo(e){var t=this;typeof t.options.beforeMove=="function"&&t.options.beforeMove.apply(this,[t.$elem]),e>=t.maximumItem||e===-1?e=t.maximumItem:e<=0&&(e=0),t.swapSpeed(0),t.browser.support3d===!0?t.transition3d(t.positionsInArray[e]):t.css2slide(t.positionsInArray[e],1),t.currentItem=t.owl.currentItem=e,t.afterGo();},afterGo:function afterGo(){var e=this;e.prevArr.push(e.currentItem),e.prevItem=e.owl.prevItem=e.prevArr[e.prevArr.length-2],e.prevArr.shift(0),e.prevItem!==e.currentItem&&(e.checkPagination(),e.checkNavigation(),e.eachMoveUpdate(),e.options.autoPlay!==!1&&e.checkAp()),typeof e.options.afterMove=="function"&&e.prevItem!==e.currentItem&&e.options.afterMove.apply(this,[e.$elem,e.visibleItems]);},stop:function stop(){var e=this;e.apStatus="stop",t.clearInterval(e.autoPlayInterval);},checkAp:function checkAp(){var e=this;e.apStatus!=="stop"&&e.play();},play:function play(){var e=this;e.apStatus="play";if(e.options.autoPlay===!1)return!1;t.clearInterval(e.autoPlayInterval),e.autoPlayInterval=t.setInterval(function(){e.next(!0);},e.options.autoPlay);},swapSpeed:function swapSpeed(e){var t=this;e==="slideSpeed"?t.$owlWrapper.css(t.addCssSpeed(t.options.slideSpeed)):e==="paginationSpeed"?t.$owlWrapper.css(t.addCssSpeed(t.options.paginationSpeed)):typeof e!="string"&&t.$owlWrapper.css(t.addCssSpeed(e));},addCssSpeed:function addCssSpeed(e){return{"-webkit-transition":"all "+e+"ms ease","-moz-transition":"all "+e+"ms ease","-o-transition":"all "+e+"ms ease",transition:"all "+e+"ms ease"};},removeTransition:function removeTransition(){return{"-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""};},doTranslate:function doTranslate(e){return{"-webkit-transform":"translate3d("+e+"px, 0px, 0px)","-moz-transform":"translate3d("+e+"px, 0px, 0px)","-o-transform":"translate3d("+e+"px, 0px, 0px)","-ms-transform":"translate3d("+e+"px, 0px, 0px)",transform:"translate3d("+e+"px, 0px,0px)"};},transition3d:function transition3d(e){var t=this;t.$owlWrapper.css(t.doTranslate(e));},css2move:function css2move(e){var t=this;t.$owlWrapper.css({left:e});},css2slide:function css2slide(e,t){var n=this;n.isCssFinish=!1,n.$owlWrapper.stop(!0,!0).animate({left:e},{duration:t||n.options.slideSpeed,complete:function complete(){n.isCssFinish=!0;}});},checkBrowser:function checkBrowser(){var e=this,r="translate3d(0px, 0px, 0px)",i=n.createElement("div"),s,o,u,a;i.style.cssText="  -moz-transform:"+r+"; -ms-transform:"+r+"; -o-transform:"+r+"; -webkit-transform:"+r+"; transform:"+r,s=/translate3d\(0px, 0px, 0px\)/g,o=i.style.cssText.match(s),u=o!==null&&o.length===1,a="ontouchstart"in t||t.navigator.msMaxTouchPoints,e.browser={support3d:u,isTouch:a};},moveEvents:function moveEvents(){var e=this;if(e.options.mouseDrag!==!1||e.options.touchDrag!==!1)e.gestures(),e.disabledEvents();},eventTypes:function eventTypes(){var e=this,t=["s","e","x"];e.ev_types={},e.options.mouseDrag===!0&&e.options.touchDrag===!0?t=["touchstart.owl mousedown.owl","touchmove.owl mousemove.owl","touchend.owl touchcancel.owl mouseup.owl"]:e.options.mouseDrag===!1&&e.options.touchDrag===!0?t=["touchstart.owl","touchmove.owl","touchend.owl touchcancel.owl"]:e.options.mouseDrag===!0&&e.options.touchDrag===!1&&(t=["mousedown.owl","mousemove.owl","mouseup.owl"]),e.ev_types.start=t[0],e.ev_types.move=t[1],e.ev_types.end=t[2];},disabledEvents:function disabledEvents(){var t=this;t.$elem.on("dragstart.owl",function(e){e.preventDefault();}),t.$elem.on("mousedown.disableTextSelect",function(t){return e(t.target).is("input, textarea, select, option");});},gestures:function gestures(){function s(e){if(e.touches!==undefined)return{x:e.touches[0].pageX,y:e.touches[0].pageY};if(e.touches===undefined){if(e.pageX!==undefined)return{x:e.pageX,y:e.pageY};if(e.pageX===undefined)return{x:e.clientX,y:e.clientY};}}function o(t){t==="on"?(e(n).on(r.ev_types.move,a),e(n).on(r.ev_types.end,f)):t==="off"&&(e(n).off(r.ev_types.move),e(n).off(r.ev_types.end));}function u(n){var u=n.originalEvent||n||t.event,a;if(u.which===3)return!1;if(r.itemsAmount<=r.options.items)return;if(r.isCssFinish===!1&&!r.options.dragBeforeAnimFinish)return!1;if(r.isCss3Finish===!1&&!r.options.dragBeforeAnimFinish)return!1;r.options.autoPlay!==!1&&t.clearInterval(r.autoPlayInterval),r.browser.isTouch!==!0&&!r.$owlWrapper.hasClass("grabbing")&&r.$owlWrapper.addClass("grabbing"),r.newPosX=0,r.newRelativeX=0,e(this).css(r.removeTransition()),a=e(this).position(),i.relativePos=a.left,i.offsetX=s(u).x-a.left,i.offsetY=s(u).y-a.top,o("on"),i.sliding=!1,i.targetElement=u.target||u.srcElement;}function a(o){var u=o.originalEvent||o||t.event,a,f;r.newPosX=s(u).x-i.offsetX,r.newPosY=s(u).y-i.offsetY,r.newRelativeX=r.newPosX-i.relativePos,typeof r.options.startDragging=="function"&&i.dragging!==!0&&r.newRelativeX!==0&&(i.dragging=!0,r.options.startDragging.apply(r,[r.$elem])),(r.newRelativeX>8||r.newRelativeX<-8)&&r.browser.isTouch===!0&&(u.preventDefault!==undefined?u.preventDefault():u.returnValue=!1,i.sliding=!0),(r.newPosY>10||r.newPosY<-10)&&i.sliding===!1&&e(n).off("touchmove.owl"),a=function a(){return r.newRelativeX/5;},f=function f(){return r.maximumPixels+r.newRelativeX/5;},r.newPosX=Math.max(Math.min(r.newPosX,a()),f()),r.browser.support3d===!0?r.transition3d(r.newPosX):r.css2move(r.newPosX);}function f(n){var s=n.originalEvent||n||t.event,u,a,f;s.target=s.target||s.srcElement,i.dragging=!1,r.browser.isTouch!==!0&&r.$owlWrapper.removeClass("grabbing"),r.newRelativeX<0?r.dragDirection=r.owl.dragDirection="left":r.dragDirection=r.owl.dragDirection="right",r.newRelativeX!==0&&(u=r.getNewPosition(),r.goTo(u,!1,"drag"),i.targetElement===s.target&&r.browser.isTouch!==!0&&(e(s.target).on("click.disable",function(t){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault(),e(t.target).off("click.disable");}),a=e._data(s.target,"events").click,f=a.pop(),a.splice(0,0,f))),o("off");}var r=this,i={offsetX:0,offsetY:0,baseElWidth:0,relativePos:0,position:null,minSwipe:null,maxSwipe:null,sliding:null,dargging:null,targetElement:null};r.isCssFinish=!0,r.$elem.on(r.ev_types.start,".owl-wrapper",u);},getNewPosition:function getNewPosition(){var e=this,t=e.closestItem();return t>e.maximumItem?(e.currentItem=e.maximumItem,t=e.maximumItem):e.newPosX>=0&&(t=0,e.currentItem=0),t;},closestItem:function closestItem(){var t=this,n=t.options.scrollPerPage===!0?t.pagesInArray:t.positionsInArray,r=t.newPosX,i=null;return e.each(n,function(s,o){r-t.itemWidth/20>n[s+1]&&r-t.itemWidth/20<o&&t.moveDirection()==="left"?(i=o,t.options.scrollPerPage===!0?t.currentItem=e.inArray(i,t.positionsInArray):t.currentItem=s):r+t.itemWidth/20<o&&r+t.itemWidth/20>(n[s+1]||n[s]-t.itemWidth)&&t.moveDirection()==="right"&&(t.options.scrollPerPage===!0?(i=n[s+1]||n[n.length-1],t.currentItem=e.inArray(i,t.positionsInArray)):(i=n[s+1],t.currentItem=s+1));}),t.currentItem;},moveDirection:function moveDirection(){var e=this,t;return e.newRelativeX<0?(t="right",e.playDirection="next"):(t="left",e.playDirection="prev"),t;},customEvents:function customEvents(){var e=this;e.$elem.on("owl.next",function(){e.next();}),e.$elem.on("owl.prev",function(){e.prev();}),e.$elem.on("owl.play",function(t,n){e.options.autoPlay=n,e.play(),e.hoverStatus="play";}),e.$elem.on("owl.stop",function(){e.stop(),e.hoverStatus="stop";}),e.$elem.on("owl.goTo",function(t,n){e.goTo(n);}),e.$elem.on("owl.jumpTo",function(t,n){e.jumpTo(n);});},stopOnHover:function stopOnHover(){var e=this;e.options.stopOnHover===!0&&e.browser.isTouch!==!0&&e.options.autoPlay!==!1&&(e.$elem.on("mouseover",function(){e.stop();}),e.$elem.on("mouseout",function(){e.hoverStatus!=="stop"&&e.play();}));},lazyLoad:function lazyLoad(){var t=this,n,r,i,s,o;if(t.options.lazyLoad===!1)return!1;for(n=0;n<t.itemsAmount;n+=1){r=e(t.$owlItems[n]);if(r.data("owl-loaded")==="loaded")continue;i=r.data("owl-item"),s=r.find(".lazyOwl");if(typeof s.data("src")!="string"){r.data("owl-loaded","loaded");continue;}r.data("owl-loaded")===undefined&&(s.hide(),r.addClass("loading").data("owl-loaded","checked")),t.options.lazyFollow===!0?o=i>=t.currentItem:o=!0,o&&i<t.currentItem+t.options.items&&s.length&&t.lazyPreload(r,s);}},lazyPreload:function lazyPreload(e,n){function o(){e.data("owl-loaded","loaded").removeClass("loading"),n.removeAttr("data-src"),r.options.lazyEffect==="fade"?n.fadeIn(400):n.show(),typeof r.options.afterLazyLoad=="function"&&r.options.afterLazyLoad.apply(this,[r.$elem]);}function u(){i+=1,r.completeImg(n.get(0))||s===!0?o():i<=100?t.setTimeout(u,100):o();}var r=this,i=0,s;n.prop("tagName")==="DIV"?(n.css("background-image","url("+n.data("src")+")"),s=!0):n[0].src=n.data("src"),u();},autoHeight:function autoHeight(){function s(){var r=e(n.$owlItems[n.currentItem]).height();n.wrapperOuter.css("height",r+"px"),n.wrapperOuter.hasClass("autoHeight")||t.setTimeout(function(){n.wrapperOuter.addClass("autoHeight");},0);}function o(){i+=1,n.completeImg(r.get(0))?s():i<=100?t.setTimeout(o,100):n.wrapperOuter.css("height","");}var n=this,r=e(n.$owlItems[n.currentItem]).find("img"),i;r.get(0)!==undefined?(i=0,o()):s();},completeImg:function completeImg(e){var t;return e.complete?(t=_typeof(e.naturalWidth),t!=="undefined"&&e.naturalWidth===0?!1:!0):!1;},onVisibleItems:function onVisibleItems(){var t=this,n;t.options.addClassActive===!0&&t.$owlItems.removeClass("active"),t.visibleItems=[];for(n=t.currentItem;n<t.currentItem+t.options.items;n+=1){t.visibleItems.push(n),t.options.addClassActive===!0&&e(t.$owlItems[n]).addClass("active");}t.owl.visibleItems=t.visibleItems;},transitionTypes:function transitionTypes(e){var t=this;t.outClass="owl-"+e+"-out",t.inClass="owl-"+e+"-in";},singleItemTransition:function singleItemTransition(){function a(e){return{position:"relative",left:e+"px"};}var e=this,t=e.outClass,n=e.inClass,r=e.$owlItems.eq(e.currentItem),i=e.$owlItems.eq(e.prevItem),s=Math.abs(e.positionsInArray[e.currentItem])+e.positionsInArray[e.prevItem],o=Math.abs(e.positionsInArray[e.currentItem])+e.itemWidth/2,u="webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend";e.isTransition=!0,e.$owlWrapper.addClass("owl-origin").css({"-webkit-transform-origin":o+"px","-moz-perspective-origin":o+"px","perspective-origin":o+"px"}),i.css(a(s,10)).addClass(t).on(u,function(){e.endPrev=!0,i.off(u),e.clearTransStyle(i,t);}),r.addClass(n).on(u,function(){e.endCurrent=!0,r.off(u),e.clearTransStyle(r,n);});},clearTransStyle:function clearTransStyle(e,t){var n=this;e.css({position:"",left:""}).removeClass(t),n.endPrev&&n.endCurrent&&(n.$owlWrapper.removeClass("owl-origin"),n.endPrev=!1,n.endCurrent=!1,n.isTransition=!1);},owlStatus:function owlStatus(){var e=this;e.owl={userOptions:e.userOptions,baseElement:e.$elem,userItems:e.$userItems,owlItems:e.$owlItems,currentItem:e.currentItem,prevItem:e.prevItem,visibleItems:e.visibleItems,isTouch:e.browser.isTouch,browser:e.browser,dragDirection:e.dragDirection};},clearEvents:function clearEvents(){var r=this;r.$elem.off(".owl owl mousedown.disableTextSelect"),e(n).off(".owl owl"),e(t).off("resize",r.resizer);},unWrap:function unWrap(){var e=this;e.$elem.children().length!==0&&(e.$owlWrapper.unwrap(),e.$userItems.unwrap().unwrap(),e.owlControls&&e.owlControls.remove()),e.clearEvents(),e.$elem.attr("style",e.$elem.data("owl-originalStyles")||"").attr("class",e.$elem.data("owl-originalClasses"));},destroy:function destroy(){var e=this;e.stop(),t.clearInterval(e.checkVisible),e.unWrap(),e.$elem.removeData();},reinit:function reinit(t){var n=this,r=e.extend({},n.userOptions,t);n.unWrap(),n.init(r,n.$elem);},addItem:function addItem(e,t){var n=this,r;if(!e)return!1;if(n.$elem.children().length===0)return n.$elem.append(e),n.setVars(),!1;n.unWrap(),t===undefined||t===-1?r=-1:r=t,r>=n.$userItems.length||r===-1?n.$userItems.eq(-1).after(e):n.$userItems.eq(r).before(e),n.setVars();},removeItem:function removeItem(e){var t=this,n;if(t.$elem.children().length===0)return!1;e===undefined||e===-1?n=-1:n=e,t.unWrap(),t.$userItems.eq(n).remove(),t.setVars();}};e.fn.owlCarousel=function(t){return this.each(function(){if(e(this).data("owl-init")===!0)return!1;e(this).data("owl-init",!0);var n=Object.create(r);n.init(t,this),e.data(this,"owlCarousel",n);});},e.fn.owlCarousel.options={items:5,itemsCustom:!1,itemsDesktop:[1199,4],itemsDesktopSmall:[979,3],itemsTablet:[768,2],itemsTabletSmall:!1,itemsMobile:[479,1],singleItem:!1,itemsScaleUp:!1,slideSpeed:200,paginationSpeed:800,rewindSpeed:1e3,autoPlay:!1,stopOnHover:!1,navigation:!1,navigationText:["prev","next"],rewindNav:!0,scrollPerPage:!1,pagination:!0,paginationNumbers:!1,responsive:!0,responsiveRefreshRate:200,responsiveBaseWidth:t,baseClass:"owl-carousel",theme:"owl-theme",lazyLoad:!1,lazyFollow:!0,lazyEffect:"fade",autoHeight:!1,jsonPath:!1,jsonSuccess:!1,dragBeforeAnimFinish:!0,mouseDrag:!0,touchDrag:!0,addClassActive:!1,transitionStyle:!1,beforeUpdate:!1,afterUpdate:!1,beforeInit:!1,afterInit:!1,beforeMove:!1,afterMove:!1,afterAction:!1,startDragging:!1,afterLazyLoad:!1,onWidthChange:!1};}(jQuery,window,document),define("owl.carousel",["jquery"],function(){}),define("carouselByOwl",["require","jquery","owl.carousel"],function(e){"use strict";function n(e,n){var r=this;this.$el=e,this.options=n||{},this.onMoveHandler=t.Callbacks(),this.lastVisible=undefined,this.options.onMove&&this.onMoveHandler.add(this.options.onMove),(this.options.$next||this.options.$prev)&&this.onMoveHandler.add(function(){r.checkNavigation();}),this.options.$next&&this.options.$next.mouseup(function(){r.next();}),this.options.$prev&&this.options.$prev.mouseup(function(){r.prev();}),t.extend(this.options,{afterMove:function afterMove(e,t){r.lastVisible=t;var n=e.find(r.options.itemsEl),i=[],s;for(var o=0,u=t.length;o<u;o++){s=n.eq(t[o]).data("index"),s&&i.push(s);}r.onMoveHandler.fire(i);},afterInit:function afterInit(e,t){r.lastVisible=t;var n=e.find(r.options.itemsEl),i=[],s;for(var o=0,u=t.length;o<u;o++){s=n.eq(t[o]).data("index"),s&&i.push(s);}r.onMoveHandler.fire(i);}}),e.owlCarousel(this.options);}var t=e("jquery");return e("owl.carousel"),n.prototype.next=function(){this.$el.find(".owl-pagination .owl-page.active").next().mouseup();},n.prototype.prev=function(){this.$el.find(".owl-pagination .owl-page.active").prev().mouseup();},n.prototype.checkNavigation=function(){var e=this.$el.find(".owl-pagination .owl-page"),t=e.filter(".active"),n=e.index(t);this.options.$next&&(n==e.length-1||e.length<2?this.options.$next.hide():this.options.$next.show()),this.options.$prev&&(this.lastVisible[0]==0?this.options.$prev.hide():this.options.$prev.show());},function(e,t){if(e&&e.length)return new n(e,t);};}),define("campaign.report.videoBlock",["require","jquery","d3","carouselByOwl","gallery"],function(e){"use strict";var t=e("jquery"),n=e("d3"),r=e("carouselByOwl"),i=e("gallery"),s=function s(){var e={containerEl:"#capmaignVideo",elements:{gallery:"div.js-videos-gallery",galleryItem:"div.js-videos-item",videoDisplay:"div.js-video-display",videoNumber:"span.js-video-number",bg:"div.campaign-video__bg",videoGallery:"div.campaign-video__stream"},blockWidth:860,blockHeight:484,blurDeviation:15,videoWidth:552,videoHeight:310};t.extend(this,{initialize:function initialize(){this.$container=t(e.containerEl),this.initVideos(),this.initVideoImage(),this.initVideoGallery();},initVideos:function initVideos(){var t=this.$container.find(e.elements.gallery);if(t.find(e.elements.galleryItem).length>1){var n=t.siblings(e.elements.videoDisplay).show(),i=n.find(e.elements.videoNumber);r(t,{singleItem:!0,itemsEl:"div.js-videos-item",$prev:t.siblings("a.js-button-prev"),$next:t.siblings("a.js-button-next"),onMove:function onMove(e){i.text(e);}});}},initVideoImage:function initVideoImage(){this.$container.find(e.elements.bg).each(function(){var r=t(this),i=n.select(r[0]).append("svg").attr("width",e.blockWidth).attr("height",e.blockHeight);i.append("defs").append("filter").attr("id","blur").append("feGaussianBlur").attr("stdDeviation",e.blurDeviation);var s=new Image();s.src=r.data("video-thumbnail"),s.onload=function(){i.append("image").attr("xlink:href",this.src).attr("width",e.blockWidth).attr("height",e.blockHeight).attr("filter","url(#blur)"),i.append("rect").attr("width",e.blockWidth).attr("height",e.blockHeight).style("fill","000000").style("opacity",.35);};});},initVideoGallery:function initVideoGallery(){this.$container.find(e.elements.videoGallery).each(function(){var n=t(this);new i({container:n,thumbnailUrls:[n.data("video-thumbnail")],videoUrl:n.data("video-url"),videoLength:n.data("video-length"),videoSize:n.data("video-size"),width:e.videoWidth,height:e.videoHeight});});}}),this.initialize();};return function(){new s();};}),define("campaign.report.graphic",["require","jquery","d3","tools","dates.adapter"],function(e){"use strict";var t=e("jquery"),n=e("d3"),r=e("tools"),i=e("dates.adapter"),s=function s(e,_s8){var o=this,u=t.extend({margin:{top:15,right:10,bottom:25,left:45},axisPositionX:"bottom",axisPositionY:"left",multipleColors:["#825225","#b48246","#dac38c","#f3e7c9","#cce8e4","#8bc8bf","#4c918a","#31625c"],singleColor:["#baaa92"],hasLegend:!0,legendWidth:150,legendMarginLeft:25,legendRectSize:9,tooltipClass:"graphics-tooltip"},_s8||{});t.extend(this,{initialize:function initialize(){switch(u.type){case"multiple":this.renderMultiple();break;case"simple":this.renderSimple();}},renderMultiple:function renderMultiple(){var a=u.width-u.margin.left-u.margin.right,f=u.height-u.margin.top-u.margin.bottom,l=0,c=0,h=0;u.hasLegend&&(l=u.legendWidth,c=u.legendMarginLeft,h=u.legendRectSize);var p=n.scale.ordinal().rangeRoundBands([0,a-l-c],.1),d=n.scale.linear().rangeRound([f,0]),v=n.svg.axis().scale(p).tickSize(5).tickPadding(0).orient(u.axisPositionX),m=n.svg.axis().scale(d).tickFormat(n.format("d")).orient(u.axisPositionY),g=n.scale.ordinal().range(u.multipleColors),y=[];r.list(u.data[0].Values).each(function(e,t){y[t]=e.Name;}),g.domain(y);var b=n.select(e[0]).append("svg").attr("width",a+u.margin.left+u.margin.right).attr("height",f+u.margin.top+u.margin.bottom).append("g").attr("transform","translate("+u.margin.left+","+u.margin.top+")"),w=this.renderTooltip();u.data.forEach(function(e){var t=0;e.Shows=g.domain().map(function(n){var o=0,u=0;r.list(e.Values).each(function(e){e.Name===n&&(o=e.Shows),u+=e.Shows;});var a={period:e.Period,values:e.Values,total:u,name:n,y0:t,y1:t+=+o};return _s8.state==="ByPeriod"&&(a.periodFullDate=r.date(i.getDate(e.Period)).format("d MM yy")),a;}),e.Total=e.Shows[e.Shows.length-1].y1;}),p.domain(u.data.map(function(e){return e.Period;})),d.domain([0,n.max(u.data,function(e){return e.Total;})]),b.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(v).selectAll("text").text(function(e){return _s8.state=="ByPeriod"?r.date(i.getDate(e)).format("d M"):e;}).attr("dx",0).attr("dy","12px").style("font-size","11px").attr("opacity",function(e,n){return!_s8.labelVisibleIndex||n%_s8.labelVisibleIndex==0?(t(this).siblings("line").attr("stroke-width",2).attr("class","tick-main"),1):(t(this).siblings("line").attr("class","tick-helper"),0);}),b.append("g").attr("class","y axis").call(m).selectAll("text").style("font-size","11px");var E=b.selectAll(".date").data(u.data).enter().append("g").attr("class","g").attr("transform",function(e){return"translate("+p(e.Period)+",0)";});E.selectAll("rect").data(function(e){return e.Shows;}).enter().append("rect").attr("width",p.rangeBand()).attr("y",function(e){return d(e.y1);}).attr("height",function(e){return d(e.y0)-d(e.y1);}).style("fill",function(e){return g(e.name);}).on("mouseover",function(e){o.showTooltip(w,e);}).on("mousemove",function(){w.style("left",n.event.pageX+"px").style("top",n.event.pageY-28+"px");}).on("mouseout",function(){o.hideTooltip(w);});if(u.hasLegend){var S=b.selectAll(".legend").data(g.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+(f-t*(h+10)-10)+")";});S.append("rect").attr("x",a-l).attr("width",h).attr("height",h).style("fill",g),S.append("text").attr("x",a-l+h+5).attr("y",9).text(function(e){return e;});}},renderSimple:function renderSimple(){var a=u.width-u.margin.left-u.margin.right,f=u.height-u.margin.top-u.margin.bottom,l=n.scale.ordinal().rangeRoundBands([0,a],.1),c=n.scale.linear().rangeRound([f,0]),h=n.svg.axis().scale(l).tickSize(4).tickPadding(0).orient(u.axisPositionX),p=n.svg.axis().scale(c).tickFormat(n.format("d")).orient(u.axisPositionY),d=n.scale.ordinal().range(u.singleColor),v=[];r.list(u.data[0].Values).each(function(e,t){v[t]=e.Name;}),d.domain(v);var m=n.select(e[0]).append("svg").attr("width",a+u.margin.left+u.margin.right).attr("height",f+u.margin.top+u.margin.bottom).append("g").attr("transform","translate("+u.margin.left+","+u.margin.top+")"),g=this.renderTooltip();u.data.forEach(function(e){var t=0;e.Shows=d.domain().map(function(n){var o=0,u=0;r.list(e.Values).each(function(e){e.Name===n&&(o=e.Shows),u+=e.Shows;});var a={period:e.Period,values:e.Values,total:u,name:n,y0:t,y1:t+=+o};return _s8.state=="ByPeriod"&&(a.periodFullDate=r.date(i.getDate(e.Period)).format("d MM yy")),a;}),e.Total=e.Shows[e.Shows.length-1].y1;}),l.domain(u.data.map(function(e){return e.Period;})),c.domain([0,n.max(u.data,function(e){return e.Total;})]),m.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(h).selectAll("text").text(function(e){var n=e;return _s8.state=="ByPeriod"&&(n=r.date(i.getDate(e)).format("d M")),_s8.state=="ByWeekDay"&&r.list(t.datepicker._defaults.dayNames).each(function(r,i){if(r==e.toLowerCase())return n=t.datepicker._defaults.dayNamesMin[i],!1;}),n;}).attr("dx",0).attr("dy","10px").style("font-size","11px").attr("opacity",function(e,n){return _s8.state=="ByWeekDay"||!_s8.labelVisibleIndex||n%_s8.labelVisibleIndex==0?(t(this).siblings("line").attr("stroke-width",2).attr("class","tick-main"),1):(t(this).siblings("line").attr("class","tick-helper"),0);}),m.append("g").attr("class","y axis").call(p).selectAll("text").style("font-size","11px");var y=m.selectAll(".date").data(u.data).enter().append("g").attr("class","g").attr("transform",function(e){return"translate("+l(e.Period)+",0)";});y.selectAll("rect").data(function(e){return e.Shows;}).enter().append("rect").attr("width",l.rangeBand()).attr("y",function(e){return c(e.y1);}).attr("height",function(e){return c(e.y0)-c(e.y1);}).style("fill",function(e){return d(e.name);}).on("mouseover",function(e){o.showTooltip(g,e);}).on("mousemove",function(){g.style("left",n.event.pageX+"px").style("top",n.event.pageY-28+"px");}).on("mouseout",function(){o.hideTooltip(g);}),e.append(t('<span class="city-name" />').text(e.data("name")).css({marginLeft:u.margin.left}));},renderTooltip:function renderTooltip(){return n.select("body").append("div").attr("class",u.tooltipClass);},showTooltip:function showTooltip(e,t){this.setTooltipContent(e,t),e.transition().duration(100).style("opacity",.9);},hideTooltip:function hideTooltip(e){e.transition().duration(300).style("opacity",0);},setTooltipContent:function setTooltipContent(e,t){var n='<span class="period">'+(t.periodFullDate||t.period)+"</span>";n+="<table><tbody>",n+="<tr><td></td><td>"+this.formatNumber(t.total)+"</td></tr>",t.values.length>1&&r.list(t.values).each(function(e){n+="<tr><td>"+e.Name+"</td><td>"+o.formatNumber(e.Shows)+"</td></tr>";}),n+="</tbody></table>",e.html(n);},formatNumber:function formatNumber(e){return r.number(e).chain().formatToNumber().range().changeSep(".",",").value();}}),this.initialize();};return function(e,t){e&&e.length&&new s(e,t);};}),define("campaign.report.tabs",["require","jquery","tools","templates.storage","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("templates.storage");e("jquery.designForms");var i="#template_graphic_tabs",s={graphicTab:"div.js-graphic-tab",monthText:".js-month-text",monthButtonPrev:".js-month-prev",monthButtonNext:".js-month-next"},o={hidden:"is-hidden",disabled:"disabled"},u=function u(e,_u2){var a=this,f=r.get(i);t.extend(this,{initialize:function initialize(){this.render(),this.initTabButtons(),this.initMonthButtons(),this.selectTab(0),this.runCallback("onRender",this.$tabsContent,this.$tabs);},render:function render(){this.$tabsContent=t(f(e)),this.$tabs=this.$tabsContent.find(s.graphicTab);},initTabButtons:function initTabButtons(){this.$radios=this.$tabsContent.find("input:radio").designForms().change(function(){var e=a.$tabs.addClass(o.hidden).eq(this.value).removeClass(o.hidden),t=e.data("default-month");this.value==="0"&&t?(e.data("default-month",!1),a.runCallback("onChangeMonth",e,t)):a.runCallback("onSelect",e);});},initMonthButtons:function initMonthButtons(){if(e.Months.length<2)return;var t=this.$radios.eq(0).siblings("label");this.$monthText=t.find(s.monthText),this.$buttonPrev=t.find(s.monthButtonPrev).click(function(){if(!a.$buttonPrev.hasClass(o.disabled)){var e=a.getMonthIndex(a.$buttonPrev.data("current-month"));a.changeMonth(--e);}}),this.$buttonNext=t.find(s.monthButtonNext).click(function(){if(!a.$buttonNext.hasClass(o.disabled)){var e=a.getMonthIndex(a.$buttonPrev.data("current-month"));a.changeMonth(++e);}});},changeMonth:function changeMonth(t){var n=e.Months,r=n[t].Date;this.$monthText.text(n[t].Name),this.$buttonPrev.data("current-month",r)[t===0?"addClass":"removeClass"](o.disabled),this.$buttonNext.data("current-month",r)[t===n.length-1?"addClass":"removeClass"](o.disabled),a.runCallback("onChangeMonth",a.$tabs.eq(0),r);},getMonthIndex:function getMonthIndex(t){var r;return n.list(e.Months).each(function(e,n){if(e.Date===t)return r=n,!1;}),r;},runCallback:function runCallback(e){var r=t.makeArray(arguments);r.splice(0,1),_u2&&n.is(_u2[e]).fn()&&_u2[e].apply(undefined,r);},selectTab:function selectTab(e){this.$radios.eq(e).prop("checked",!0).change();}}),this.initialize();};return function(e,t){e&&t&&new u(e,t);};}),define("campaign.report.dataCollection",["require","backbone","urls","tools"],function(e){"use strict";var t=e("backbone"),n=e("urls"),r=e("tools");return t.Collection.extend({getModel:function getModel(e){var t=this.where({Id:e});return t.length?t[0]:null;},getCitiesData:function getCitiesData(e,t){this.models[0].get(e)?this.runCallback(t,this.getDataFormatted(e,"",this.toJSON())):this.loadCitiesData(e,t);},loadCitiesData:function loadCitiesData(e,t){var r=this,i=n.get("getTotalShowsResult",this.controller,e,this.reportId);$.get(i,function(n){var i=$.parseJSON(n),s,o,u,a,f,l;for(s=0,o=i.length;s<o;s++){for(u=0,a=i[s].Values.length;u<a;u++){f=r.getModel(i[s].Values[u].Id),f&&(l=f.get(e),l&&l.length?l.push({Period:i[s].Period,Shows:i[s].Values[u].Shows}):l=[{Period:i[s].Period,Shows:i[s].Values[u].Shows}],f.set(e,l));}}r.runCallback(t,r.getDataFormatted(e,"",r.toJSON()));});},getDataFormatted:function getDataFormatted(e,t,n){var i=[],s;r.list(n).each(function(t,n){r.list(t[e]).each(function(e,r){s={Id:t.Id,Name:t.Name||t.Title,Shows:e.Shows},n==0?i.push({Period:e.Period,Values:[s]}):i[r].Values.push(s);});});if(t)for(var o=i.length;o--;){t.substr(0,7)!=i[o].Period.substr(0,7)&&i.splice(o,1);}return i;},getDataFormattedById:function getDataFormattedById(e,t,n,i){var s=[];r.list(n).each(function(t){if(t.Id==i)return r.list(t[e]).each(function(e){s.push({Period:e.Period,Values:[{Id:t.Id,Name:t.Name||t.Title,Shows:e.Shows}]});}),!1;});if(t)for(var o=s.length;o--;){t.substr(0,7)!=s[o].Period.substr(0,7)&&s.splice(o,1);}return s;},getCityGroupsData:function getCityGroupsData(e,t,n,r){var i=this.getModel(e),s=i.get("Groups");s[0][t]?n&&!this.hasGroupsDataByState(e,t,n)?this.loadCityGroupsData(e,t,n,r):this.runCallback(r,this.getDataFormatted(t,n,s)):this.loadCityGroupsData(e,t,n,r);},loadCityGroupsData:function loadCityGroupsData(e,t,i,s){var o=this,u=n.get("getCityShowsResult",this.controller,t,this.reportId,e,i);$.get(u,function(n){var u=$.parseJSON(n),a,f=o.getModel(e),l=f.get("Groups");r.list(u).each(function(e){r.list(e.Values).each(function(n){r.list(l).each(function(r){if(r.Id==n.Id)return a=r[t],a&&a.length?a.push({Period:e.Period,Shows:n.Shows}):a=[{Period:e.Period,Shows:n.Shows}],r[t]=a,!1;});});}),f.set("Groups",l),o.runCallback(s,o.getDataFormatted(t,i,l));});},hasGroupsDataByState:function hasGroupsDataByState(e,t,n){var i=!1,s=this.getModel(e);return s&&r.list(s.get("Groups")[0][t]).each(function(e){if(e.Period===n)return i=!0,!1;}),i;},getGps:function getGps(e){this.gps?this.runCallback(e,this.gps):this.loadGps(e);},loadGps:function loadGps(e){var t=this,r=n.get("getGpsResult",this.controller,this.reportId);$.get(r,function(n){window.dataString=n;var r=$.parseJSON(n);t.gps=r,t.runCallback(e,r);});},runCallback:function runCallback(e,t){r.is(e).fn()&&e(t);}});}),define("googleMaps.markerClusterer.styles",[],function(){"use strict";var e="/images/cluster_imgs/";return[{width:53,height:53,url:e+"m1.png"},{width:56,height:56,url:e+"m2.png"},{width:66,height:66,url:e+"m3.png"},{width:78,height:78,url:e+"m4.png"},{width:90,height:90,url:e+"m5.png"}];}),MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m",MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png",MarkerClusterer.prototype.extend=function(e,t){return function(e){for(var t in e.prototype){this.prototype[t]=e.prototype[t];}return this;}.apply(e,[t]);},MarkerClusterer.prototype.onAdd=function(){this.setReady_(!0);},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){if(this.styles_.length)return;for(var e=0,t;t=this.sizes[e];e++){this.styles_.push({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t});}},MarkerClusterer.prototype.fitMapToMarkers=function(){var e=this.getMarkers(),t=new google.maps.LatLngBounds();for(var n=0,r;r=e[n];n++){t.extend(r.getPosition());}this.map_.fitBounds(t);},MarkerClusterer.prototype.setStyles=function(e){this.styles_=e;},MarkerClusterer.prototype.getStyles=function(){return this.styles_;},MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_;},MarkerClusterer.prototype.isAverageCenter=function(){return this.averageCenter_;},MarkerClusterer.prototype.getMarkers=function(){return this.markers_;},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length;},MarkerClusterer.prototype.setMaxZoom=function(e){this.maxZoom_=e;},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_;},MarkerClusterer.prototype.calculator_=function(e,t){var n=0,r=e.length,i=r;while(i!==0){i=parseInt(i/10,10),n++;}return n=Math.min(n,t),{text:r,index:n};},MarkerClusterer.prototype.setCalculator=function(e){this.calculator_=e;},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_;},MarkerClusterer.prototype.addMarkers=function(e,t){if(e.length)for(var n=0,r;r=e[n];n++){this.pushMarkerTo_(r);}else if(Object.keys(e).length)for(var r in e){this.pushMarkerTo_(e[r]);}t||this.redraw();},MarkerClusterer.prototype.pushMarkerTo_=function(e){e.isAdded=!1;if(e.draggable){var t=this;google.maps.event.addListener(e,"dragend",function(){e.isAdded=!1,t.repaint();});}this.markers_.push(e);},MarkerClusterer.prototype.addMarker=function(e,t){this.pushMarkerTo_(e),t||this.redraw();},MarkerClusterer.prototype.removeMarker_=function(e){var t=-1;if(this.markers_.indexOf)t=this.markers_.indexOf(e);else for(var n=0,r;r=this.markers_[n];n++){if(r==e){t=n;break;}}return t==-1?!1:(e.setMap(null),this.markers_.splice(t,1),!0);},MarkerClusterer.prototype.removeMarker=function(e,t){var n=this.removeMarker_(e);return!t&&n?(this.resetViewport(),this.redraw(),!0):!1;},MarkerClusterer.prototype.removeMarkers=function(e,t){var n=!1;for(var r=0,i;i=e[r];r++){var s=this.removeMarker_(i);n=n||s;}if(!t&&n)return this.resetViewport(),this.redraw(),!0;},MarkerClusterer.prototype.setReady_=function(e){this.ready_||(this.ready_=e,this.createClusters_());},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length;},MarkerClusterer.prototype.getMap=function(){return this.map_;},MarkerClusterer.prototype.setMap=function(e){this.map_=e;},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_;},MarkerClusterer.prototype.setGridSize=function(e){this.gridSize_=e;},MarkerClusterer.prototype.getMinClusterSize=function(){return this.minClusterSize_;},MarkerClusterer.prototype.setMinClusterSize=function(e){this.minClusterSize_=e;},MarkerClusterer.prototype.getExtendedBounds=function(e){var t=this.getProjection(),n=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),r=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),i=t.fromLatLngToDivPixel(n);i.x+=this.gridSize_,i.y-=this.gridSize_;var s=t.fromLatLngToDivPixel(r);s.x-=this.gridSize_,s.y+=this.gridSize_;var o=t.fromDivPixelToLatLng(i),u=t.fromDivPixelToLatLng(s);return e.extend(o),e.extend(u),e;},MarkerClusterer.prototype.isMarkerInBounds_=function(e,t){return t.contains(e.getPosition());},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers_=[];},MarkerClusterer.prototype.updateMarkers=function(e){var t=this.map_.getZoom(),n=this.getMaxZoom(),r=e.length!==this.markers_.length;for(var i=0,s;s=this.clusters_[i];i++){s.remove();}this.clusters_=[];if(this.markers_.length)for(var o=this.markers_.length-1;o>=0;o--){var u=this.markers_[o],a=u.markerId;u.isAdded=!1;var f=-1;for(var i=0,l=e.length;i<l;i++){if(e[i].markerId===a){f=i;break;}}f===-1?(u.setMap(null),this.markers_.splice(o,1)):e.splice(f,1);}e.length&&(r=!0,this.addMarkers(e,!0)),(r||n&&t<=n)&&this.redraw();},MarkerClusterer.prototype.resetViewport=function(e){for(var t=0,n;n=this.clusters_[t];t++){n.remove();}for(var t=0,r;r=this.markers_[t];t++){r.isAdded=!1,e&&r.setMap(null);}this.clusters_=[];},MarkerClusterer.prototype.repaint=function(){var e=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),window.setTimeout(function(){for(var t=0,n;n=e[t];t++){n.remove();}},0);},MarkerClusterer.prototype.redraw=function(){this.createClusters_();},MarkerClusterer.prototype.distanceBetweenPoints_=function(e,t){if(!e||!t)return 0;var n=6371,r=(t.lat()-e.lat())*Math.PI/180,i=(t.lng()-e.lng())*Math.PI/180,s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2),o=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),u=n*o;return u;},MarkerClusterer.prototype.addToClosestCluster_=function(e){var t=4e4,n=null,r=e.getPosition();for(var i=0,s;s=this.clusters_[i];i++){var o=s.getCenter();if(o){var u=this.distanceBetweenPoints_(o,e.getPosition());u<t&&(t=u,n=s);}}if(n&&n.isMarkerInClusterBounds(e))n.addMarker(e);else{var s=new Cluster(this);s.addMarker(e),this.clusters_.push(s);}},MarkerClusterer.prototype.createClusters_=function(){if(!this.ready_)return;var e=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),t=this.getExtendedBounds(e);for(var n=0,r;r=this.markers_[n];n++){!r.isAdded&&this.isMarkerInBounds_(r,t)&&this.addToClosestCluster_(r);}},Cluster.prototype.isMarkerAlreadyAdded=function(e){if(this.markers_.indexOf)return this.markers_.indexOf(e)!=-1;for(var t=0,n;n=this.markers_[t];t++){if(n==e)return!0;}return!1;},Cluster.prototype.addMarker=function(e){if(this.isMarkerAlreadyAdded(e))return!1;if(!this.center_)this.center_=e.getPosition(),this.calculateBounds_();else if(this.averageCenter_){var t=this.markers_.length+1,n=(this.center_.lat()*(t-1)+e.getPosition().lat())/t,r=(this.center_.lng()*(t-1)+e.getPosition().lng())/t;this.center_=new google.maps.LatLng(n,r),this.calculateBounds_();}e.isAdded=!0,this.markers_.push(e);var i=this.markers_.length;i<this.minClusterSize_&&e.getMap()!=this.map_&&e.setMap(this.map_);if(i==this.minClusterSize_)for(var s=0;s<i;s++){this.markers_[s].setMap(null);}return i>=this.minClusterSize_&&e.setMap(null),this.updateIcon(),!0;},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_;},Cluster.prototype.getBounds=function(){var e=new google.maps.LatLngBounds(this.center_,this.center_),t=this.getMarkers();for(var n=0,r;r=t[n];n++){e.extend(r.getPosition());}return e;},Cluster.prototype.remove=function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_;},Cluster.prototype.getSize=function(){return this.markers_.length;},Cluster.prototype.getMarkers=function(){return this.markers_;},Cluster.prototype.getCenter=function(){return this.center_;},Cluster.prototype.calculateBounds_=function(){var e=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(e);},Cluster.prototype.isMarkerInClusterBounds=function(e){return this.bounds_.contains(e.getPosition());},Cluster.prototype.getMap=function(){return this.map_;},Cluster.prototype.updateIcon=function(){var e=this.map_.getZoom(),t=this.markerClusterer_.getMaxZoom();if(t&&e>t){for(var n=0,r;r=this.markers_[n];n++){r.setMap(this.map_);}return;}if(this.markers_.length<this.minClusterSize_){this.clusterIcon_.hide();return;}var i=this.markerClusterer_.getStyles().length,s=this.markerClusterer_.getCalculator()(this.markers_,i);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(s),this.clusterIcon_.show();},ClusterIcon.prototype.triggerClusterClick=function(){var e=this.cluster_.getMarkerClusterer();google.maps.event.trigger(e,"clusterclick",this.cluster_),e.isZoomOnClick()&&this.map_.fitBounds(this.cluster_.getBounds());},ClusterIcon.prototype.onAdd=function(){this.div_=document.createElement("DIV");if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(e),this.div_.innerHTML=this.sums_.text;}var t=this.getPanes();t.overlayMouseTarget.appendChild(this.div_);var n=this;google.maps.event.addDomListener(this.div_,"click",function(){n.triggerClusterClick();});},ClusterIcon.prototype.getPosFromLatLng_=function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return t.x-=parseInt(this.width_/2,10),t.y-=parseInt(this.height_/2,10),t;},ClusterIcon.prototype.draw=function(){if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.top=e.y+"px",this.div_.style.left=e.x+"px";}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1;},ClusterIcon.prototype.show=function(){if(this.div_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(e),this.div_.style.display="";}this.visible_=!0;},ClusterIcon.prototype.remove=function(){this.setMap(null);},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null);},ClusterIcon.prototype.setSums=function(e){this.sums_=e,this.text_=e.text,this.index_=e.index,this.div_&&(this.div_.innerHTML=e.text),this.useStyle();},ClusterIcon.prototype.useStyle=function(){var e=Math.max(0,this.sums_.index-1);e=Math.min(this.styles_.length-1,e);var t=this.styles_[e];this.url_=t.url,this.height_=t.height,this.width_=t.width,this.textColor_=t.textColor,this.anchor_=t.anchor,this.textSize_=t.textSize,this.backgroundPosition_=t.backgroundPosition;},ClusterIcon.prototype.setCenter=function(e){this.center_=e;},ClusterIcon.prototype.createCss=function(e){var t=[];t.push("background-image:url("+this.url_+");");var n=this.backgroundPosition_?this.backgroundPosition_:"0 0";t.push("background-position:"+n+";"),_typeof(this.anchor_)=="object"?(typeof this.anchor_[0]=="number"&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?t.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):t.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),typeof this.anchor_[1]=="number"&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?t.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):t.push("width:"+this.width_+"px; text-align:center;")):t.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var r=this.textColor_?this.textColor_:"black",i=this.textSize_?this.textSize_:11;return t.push("cursor:pointer; top:"+e.y+"px; left:"+e.x+"px; color:"+r+"; position:absolute; font-size:"+i+"px; font-family:Arial,sans-serif; font-weight:bold"),t.join("");},window.MarkerClusterer=MarkerClusterer,MarkerClusterer.prototype.addMarker=MarkerClusterer.prototype.addMarker,MarkerClusterer.prototype.addMarkers=MarkerClusterer.prototype.addMarkers,MarkerClusterer.prototype.clearMarkers=MarkerClusterer.prototype.clearMarkers,MarkerClusterer.prototype.fitMapToMarkers=MarkerClusterer.prototype.fitMapToMarkers,MarkerClusterer.prototype.getCalculator=MarkerClusterer.prototype.getCalculator,MarkerClusterer.prototype.getGridSize=MarkerClusterer.prototype.getGridSize,MarkerClusterer.prototype.getExtendedBounds=MarkerClusterer.prototype.getExtendedBounds,MarkerClusterer.prototype.getMap=MarkerClusterer.prototype.getMap,MarkerClusterer.prototype.getMarkers=MarkerClusterer.prototype.getMarkers,MarkerClusterer.prototype.getMaxZoom=MarkerClusterer.prototype.getMaxZoom,MarkerClusterer.prototype.getStyles=MarkerClusterer.prototype.getStyles,MarkerClusterer.prototype.getTotalClusters=MarkerClusterer.prototype.getTotalClusters,MarkerClusterer.prototype.getTotalMarkers=MarkerClusterer.prototype.getTotalMarkers,MarkerClusterer.prototype.redraw=MarkerClusterer.prototype.redraw,MarkerClusterer.prototype.removeMarker=MarkerClusterer.prototype.removeMarker,MarkerClusterer.prototype.removeMarkers=MarkerClusterer.prototype.removeMarkers,MarkerClusterer.prototype.resetViewport=MarkerClusterer.prototype.resetViewport,MarkerClusterer.prototype.repaint=MarkerClusterer.prototype.repaint,MarkerClusterer.prototype.setCalculator=MarkerClusterer.prototype.setCalculator,MarkerClusterer.prototype.setGridSize=MarkerClusterer.prototype.setGridSize,MarkerClusterer.prototype.setMaxZoom=MarkerClusterer.prototype.setMaxZoom,MarkerClusterer.prototype.onAdd=MarkerClusterer.prototype.onAdd,MarkerClusterer.prototype.draw=MarkerClusterer.prototype.draw,Cluster.prototype.getCenter=Cluster.prototype.getCenter,Cluster.prototype.getSize=Cluster.prototype.getSize,Cluster.prototype.getMarkers=Cluster.prototype.getMarkers,ClusterIcon.prototype.onAdd=ClusterIcon.prototype.onAdd,ClusterIcon.prototype.draw=ClusterIcon.prototype.draw,ClusterIcon.prototype.onRemove=ClusterIcon.prototype.onRemove,Object.keys=Object.keys||function(e){var t=[];for(var n in e){e.hasOwnProperty(n)&&t.push(n);}return t;},define("googleMaps.markerClusterer",function(){}),define("campaign.report.graphicsBlock",["require","jquery","tools","campaign.report.graphic","campaign.report.tabs","templates.storage","googleMaps.circle","googleMaps.polygon","map.defaultLocation","campaign.report.dataCollection","googleMaps.markerClusterer.styles","googleMaps","googleMaps.markerClusterer"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("campaign.report.graphic"),i=e("campaign.report.tabs"),s=e("templates.storage"),o=e("googleMaps.circle"),u=e("googleMaps.polygon"),a=e("map.defaultLocation"),f=e("campaign.report.dataCollection"),l=e("googleMaps.markerClusterer.styles"),c=window.langResource,h={citiesHeaderText:c.campanyReport.citiesHeader},p={containerEl:"#capmaignGraphics",graphicBlockMultiple:"div.js-graphic-multiple",graphicBlockSingle:"div.js-graphic-single"},d={map:"#template_gps_map"},v=function v(c){var v=this;t.extend(this,{initialize:function initialize(){this.$container=t(p.containerEl);if(!this.$container.length)return;this.cities=this.$container.data("cities");if(!this.cities||!this.cities.length)return;this.months=this.$container.data("months"),this.initCitiesCollection(),this.cities.length>1&&this.renderAllCities(),n.list(this.cities).each(function(e){v.renderCity(e);});if(this.$container.data("type")==="GeoTargeting"){var e=t(s.get(d.map)());this.$container.append(e),this.citiesCollection.getGps(function(t){v.drawMap(e.find(">div"),t);});}},initCitiesCollection:function initCitiesCollection(){this.citiesCollection=new f(),this.citiesCollection.controller=c.controller,this.citiesCollection.reportId=this.$container.data("report-id"),n.list(this.cities).each(function(e){v.citiesCollection.add({Id:e.CityId,Name:e.CityName,Groups:e.Groups,Center:{lat:e.CityLatitude,lng:e.CityLongitude},Areas:e.Areas,PolygonAreas:e.PolygonAreas});});},renderTabs:function renderTabs(e,r){function s(e){var i=t.makeArray(arguments);i.splice(0,1),e&&n.is(r[e]).fn()&&r[e].apply(undefined,i);}i(e,{onRender:function onRender(e){v.$container.append(e);},onSelect:function onSelect(e){s("onSelect",e);},onChangeMonth:function onChangeMonth(e,t){s("onChangeMonth",e,t);}});},renderAllCities:function renderAllCities(){function e(e,r){var i=e.data("type");v.citiesCollection.getCitiesData(i,function(s){v.drawGraphicMultiple(e.find(p.graphicBlockMultiple),s,i);var o=v.citiesCollection.toJSON(),u=e.find(p.graphicBlockSingle);u.length>1&&n.list(u).each(function(e){v.drawGraphicSimple(t(e),v.citiesCollection.getDataFormattedById(i,r,o,t(e).data("id")),i);});});}this.renderTabs({HeaderText:h.citiesHeaderText,ReportId:this.citiesCollection.reportId,Items:this.cities,Months:this.months,CurrentMonth:this.months[this.months.length-1]},{onSelect:function onSelect(t){t.data("isDrawn")||(t.data("isDrawn",!0),e(t,""));},onChangeMonth:function onChangeMonth(t,n){t.data("isDrawn",!0),e(t,n);}});},renderCity:function renderCity(e){function r(r,i){var s=r.data("type");v.citiesCollection.getCityGroupsData(e.CityId,s,i,function(o){v.drawGraphicMultiple(r.find(p.graphicBlockMultiple),o,s);var u=e.Groups,a=r.find(p.graphicBlockSingle);a.length>1&&n.list(a).each(function(e){v.drawGraphicSimple(t(e),v.citiesCollection.getDataFormattedById(s,i,u,t(e).data("id")),s);});});}this.renderTabs({HeaderText:e.CityName,ReportId:this.citiesCollection.reportId,CityId:e.CityId,Items:e.Groups,Months:this.months,CurrentMonth:this.months[this.months.length-1]},{onSelect:function onSelect(e){e.data("isDrawn")||(e.data("isDrawn",!0),r(e,""));},onChangeMonth:function onChangeMonth(e,t){e.data("isDrawn",!0),r(e,t);}});},drawGraphicMultiple:function drawGraphicMultiple(e,t,n){var i={type:"multiple",data:t,state:n,width:e.width(),height:e.height()};if(n==="ByPeriod"||n==="ByDayHour")i.labelVisibleIndex=3;r(e.html(""),i);},drawGraphicSimple:function drawGraphicSimple(e,t,n){var i={type:"simple",data:t,state:n,width:e.width(),height:e.height()};n==="ByPeriod"&&(i.labelVisibleIndex=5),n==="ByWeekDay"&&(i.labelVisibleIndex=2),n==="ByDayHour"&&(i.labelVisibleIndex=4),r(e.html(""),i);},drawMap:function drawMap(t,r){e("googleMaps")(function(t){function h(e){var n=new t.googleMaps.Marker({position:e,map:s,icon:"http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png",zIndex:Math.round(e.lat()*-1e5)<<5});c.push(n);}e("googleMaps.markerClusterer");if(v.citiesCollection.length>1)var i={center:t.createPoint(a.Latitude,a.Longitude),zoom:a.Zoom};else var i={center:v.citiesCollection.models[0].get("Center"),zoom:10};var s=t.render({containerId:"#gpsMap",center:i.center,zoom:i.zoom});n.list(v.citiesCollection.toJSON()).each(function(e){e.Areas&&n.list(e.Areas).each(function(e){new o(t.googleMaps,{map:s,center:t.createPoint(e.CenterLatitude,e.CenterLongitude),radius:e.Radius});}),e.PolygonAreas&&n.list(e.PolygonAreas).each(function(e){n.list(e.LatLngs).each(function(e){e.lat=e.Lat,e.lng=e.Lng;}),new u(t.googleMaps,{map:s,paths:e.LatLngs});});});var f=new MarkerClusterer(s,[],{gridSize:50,maxZoom:30,styles:l}),c=[];n.list(r).each(function(e){h(t.createPoint(e.Latitude,e.Longitude));}),f.addMarkers(c,!0);});}}),this.initialize();};return function(e){new v(e);};}),define("campaign.report.action",["require","base","campaign.report.campaignStopper","campaign.report.buttonToArchive","campaign.report.videoBlock","campaign.report.graphicsBlock"],function(e){"use strict";var t=e("base");return new t.Action({initialize:function initialize(){e("campaign.report.campaignStopper")(),e("campaign.report.buttonToArchive")(),e("campaign.report.videoBlock")(),e("campaign.report.graphicsBlock")({controller:"Campaign"});}});}),define("campaign.printReport.graphicsBlock",["require","jquery","tools","campaign.report.graphic","templates.storage","googleMaps.circle","googleMaps.polygon","map.defaultLocation","campaign.report.dataCollection","googleMaps.markerClusterer.styles","googleMaps","googleMaps.markerClusterer"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("campaign.report.graphic"),i=e("templates.storage"),s=e("googleMaps.circle"),o=e("googleMaps.polygon"),u=e("map.defaultLocation"),a=e("campaign.report.dataCollection"),f=e("googleMaps.markerClusterer.styles"),l=window.langResource,c={citiesHeaderText:l.campanyReport.citiesHeader},h={containerEl:"#capmaignGraphics",graphicEl:"div.js-graphic-multiple",graphicContainer:"div.js-graphic-tab"},p={graphic:"#template_print_graphic",map:"#template_gps_map"},d=function d(l){var d=this;t.extend(this,{initialize:function initialize(){this.$container=t(h.containerEl);if(!this.$container.length)return;this.cities=this.$container.data("cities");if(!this.cities||!this.cities.length)return;this.months=this.$container.data("months"),this.initCitiesCollection(),this.totalBlocksCount=0,this.loadedBlocksCount=0,this.$container.data("type")==="GeoTargeting"&&this.totalBlocksCount++,this.cities.length>1&&this.renderAllCities(),n.list(this.cities).each(function(e){d.renderCity(e);});if(this.$container.data("type")==="GeoTargeting"){var e=t(i.get(p.map)());this.$container.append(e),this.citiesCollection.getGps(function(t){d.drawMap(e.find(">div"),t),d.checkLoadedBlocks();});}},initCitiesCollection:function initCitiesCollection(){this.citiesCollection=new a(),this.citiesCollection.controller=l.controller,this.citiesCollection.reportId=this.$container.data("report-id"),n.list(this.cities).each(function(e){d.citiesCollection.add({Id:e.CityId,Name:e.CityName,Groups:e.Groups,Center:{lat:e.CityLatitude,lng:e.CityLongitude},Areas:e.Areas,PolygonAreas:e.PolygonAreas});});},renderAllCities:function renderAllCities(){var e=i.get(p.graphic),n=t(e({HeaderText:c.citiesHeaderText,Months:this.months}));this.$container.append(n),this.totalBlocksCount+=this.months.length+2,n.find(h.graphicContainer).each(function(e){var n=t(this),r=n.data("type");d.citiesCollection.getCitiesData(r,function(e){d.drawGraphic(n.find(h.graphicEl),e,r),d.checkLoadedBlocks();});});},renderCity:function renderCity(e){var r=i.get(p.graphic),s=t(r({HeaderText:e.CityName,Months:this.months,CityId:e.CityId}));this.$container.append(s),this.totalBlocksCount+=this.months.length+2,n.list(s.find(h.graphicContainer)).each(function(n){var r=t(n),i=r.data("type"),s=r.data("month")||"";d.citiesCollection.getCityGroupsData(e.CityId,i,s,function(e){d.drawGraphic(r.find(h.graphicEl),e,i),d.checkLoadedBlocks();});});},drawGraphic:function drawGraphic(e,t,n){var i={type:"multiple",data:t,state:n,width:e.width(),height:e.height()};if(n==="ByPeriod"||n==="ByDayHour")i.labelVisibleIndex=3;r(e.html(""),i);},drawMap:function drawMap(t,r){e("googleMaps")(function(t){function h(e){var n=new t.googleMaps.Marker({position:e,map:a,icon:"http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png",zIndex:Math.round(e.lat()*-1e5)<<5});c.push(n);}e("googleMaps.markerClusterer");if(d.citiesCollection.length>1)var i={center:t.createPoint(u.Latitude,u.Longitude),zoom:u.Zoom};else var i={center:d.citiesCollection.models[0].get("Center"),zoom:10};var a=t.render({containerId:"#gpsMap",center:i.center,zoom:i.zoom});n.list(d.citiesCollection.toJSON()).each(function(e){e.Areas&&n.list(e.Areas).each(function(e){new s(t.googleMaps,{map:a,center:t.createPoint(e.CenterLatitude,e.CenterLongitude),radius:e.Radius});}),e.PolygonAreas&&n.list(e.PolygonAreas).each(function(e){n.list(e.LatLngs).each(function(e){e.lat=e.Lat,e.lng=e.Lng;}),new o(t.googleMaps,{map:a,paths:e.LatLngs});});});var l=new MarkerClusterer(a,[],{gridSize:50,maxZoom:30,styles:f}),c=[];n.list(r).each(function(e){h(t.createPoint(e.Latitude,e.Longitude));}),l.addMarkers(c,!0);});},checkLoadedBlocks:function checkLoadedBlocks(){this.loadedBlocksCount++,this.totalBlocksCount===this.loadedBlocksCount&&setTimeout(function(){window.print();},1e3);}}),this.initialize();};return function(e){new d(e);};}),define("campaign.printReport.action",["require","base","campaign.report.videoBlock","campaign.printReport.graphicsBlock"],function(e){"use strict";var t=e("base");return new t.Action({initialize:function initialize(){e("campaign.report.videoBlock")(),e("campaign.printReport.graphicsBlock")({controller:"Campaign"});}});}),define("googleMaps.infobox",[],function(){"use strict";return function(e){function t(e){e=e||{},google.maps.OverlayView.apply(this,arguments),this.content_=e.content||"",this.disableAutoPan_=e.disableAutoPan||!1,this.maxWidth_=e.maxWidth||0,this.pixelOffset_=e.pixelOffset||new google.maps.Size(0,0),this.position_=e.position||new google.maps.LatLng(0,0),this.zIndex_=e.zIndex||null,this.boxClass_=e.boxClass||"infoBox",this.boxStyle_=e.boxStyle||{},this.closeBoxMargin_=e.closeBoxMargin||"2px",this.closeBoxURL_=e.closeBoxURL||"//www.google.com/intl/en_us/mapfiles/close.gif",e.closeBoxURL===""&&(this.closeBoxURL_=""),this.closeBoxTitle_=e.closeBoxTitle||" Close ",this.infoBoxClearance_=e.infoBoxClearance||new google.maps.Size(1,1),typeof e.visible=="undefined"&&(typeof e.isHidden=="undefined"?e.visible=!0:e.visible=!e.isHidden),this.isHidden_=!e.visible,this.alignBottom_=e.alignBottom||!1,this.pane_=e.pane||"floatPane",this.enableEventPropagation_=e.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null;}return t.prototype=new google.maps.OverlayView(),t.prototype.createInfoBoxDiv_=function(){var e,t,n,r=this,i=function i(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();},s=function s(e){e.returnValue=!1,e.preventDefault&&e.preventDefault(),r.enableEventPropagation_||i(e);};if(!this.div_){this.div_=document.createElement("div"),this.setBoxStyle_(),typeof this.content_.nodeType=="undefined"?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.div_.innerHTML+='<i class="beak"></i>',this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(n=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-n.left-n.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_);if(!this.enableEventPropagation_){this.eventListeners_=[],t=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"];for(e=0;e<t.length;e++){this.eventListeners_.push(google.maps.event.addDomListener(this.div_,t[e],i));}this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(e){this.style.cursor="default";}));}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",s),google.maps.event.trigger(this,"domready");}},t.prototype.getCloseBoxImg_=function(){var e='<span class="infobox__close"><i></i></span>';return this.closeBoxURL_?e:"";},t.prototype.addClickHandler_=function(){var e;this.closeBoxURL_!==""?(e=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(e,"click",this.getCloseClickHandler_())):this.closeListener_=null;},t.prototype.getCloseClickHandler_=function(){var e=this;return function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),google.maps.event.trigger(e,"closeclick"),e.close();};},t.prototype.panBox_=function(e){var t,n,r=0,i=0;if(!e){t=this.getMap();if(t instanceof google.maps.Map){t.getBounds().contains(this.position_)||t.setCenter(this.position_);var s=this.pixelOffset_.width,o=this.pixelOffset_.height,u=this.div_.offsetWidth,a=this.div_.offsetHeight,f=this.infoBoxClearance_.width,l=this.infoBoxClearance_.height;if(t.panToBounds.length==2){var c={left:0,right:0,top:0,bottom:0};c.left=-s+f,c.right=s+u+f,this.alignBottom_?(c.top=-o+l+a,c.bottom=o+l):(c.top=-o+l,c.bottom=o+a+l),t.panToBounds(new google.maps.LatLngBounds(this.position_),c);}else{var h=t.getDiv(),p=h.offsetWidth,d=h.offsetHeight,v=this.getProjection().fromLatLngToContainerPixel(this.position_);v.x<-s+f?r=v.x+s-f:v.x+u+s+f>p&&(r=v.x+u+s+f-p),this.alignBottom_?v.y<-o+l+a?i=v.y+o-l-a:v.y+o+l>d&&(i=v.y+o+l-d):v.y<-o+l?i=v.y+o-l:v.y+a+o+l>d&&(i=v.y+a+o+l-d);if(r!==0||i!==0){var m=t.getCenter();t.panBy(r,i);}}}}},t.prototype.setBoxStyle_=function(){var e,t;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",t=this.boxStyle_;for(e in t){t.hasOwnProperty(e)&&(this.div_.style[e]=t[e]);}if(typeof this.div_.style.WebkitTransform=="undefined"||this.div_.style.WebkitTransform.indexOf("translateZ")===-1&&this.div_.style.WebkitTransform.indexOf("matrix")===-1)this.div_.style.WebkitTransform="translateZ(0)";typeof this.div_.style.opacity!="undefined"&&this.div_.style.opacity!==""&&(this.div_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+this.div_.style.opacity*100+')"',this.div_.style.filter="alpha(opacity="+this.div_.style.opacity*100+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",this.zIndex_!==null&&(this.div_.style.zIndex=this.zIndex_);}},t.prototype.getBoxWidths_=function(){var e,t={top:0,bottom:0,left:0,right:0},n=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(e=n.ownerDocument.defaultView.getComputedStyle(n,""),e&&(t.top=parseInt(e.borderTopWidth,10)||0,t.bottom=parseInt(e.borderBottomWidth,10)||0,t.left=parseInt(e.borderLeftWidth,10)||0,t.right=parseInt(e.borderRightWidth,10)||0)):document.documentElement.currentStyle&&n.currentStyle&&(t.top=parseInt(n.currentStyle.borderTopWidth,10)||0,t.bottom=parseInt(n.currentStyle.borderBottomWidth,10)||0,t.left=parseInt(n.currentStyle.borderLeftWidth,10)||0,t.right=parseInt(n.currentStyle.borderRightWidth,10)||0),t;},t.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null);},t.prototype.draw=function(){this.createInfoBoxDiv_();var e=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=e.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(e.y+this.pixelOffset_.height)+"px":this.div_.style.top=e.y+this.pixelOffset_.height+"px",this.isHidden_?this.div_.style.visibility="hidden":this.div_.style.visibility="visible";},t.prototype.setOptions=function(e){typeof e.boxClass!="undefined"&&(this.boxClass_=e.boxClass,this.setBoxStyle_()),typeof e.boxStyle!="undefined"&&(this.boxStyle_=e.boxStyle,this.setBoxStyle_()),typeof e.content!="undefined"&&this.setContent(e.content),typeof e.disableAutoPan!="undefined"&&(this.disableAutoPan_=e.disableAutoPan),typeof e.maxWidth!="undefined"&&(this.maxWidth_=e.maxWidth),typeof e.pixelOffset!="undefined"&&(this.pixelOffset_=e.pixelOffset),typeof e.alignBottom!="undefined"&&(this.alignBottom_=e.alignBottom),typeof e.position!="undefined"&&this.setPosition(e.position),typeof e.zIndex!="undefined"&&this.setZIndex(e.zIndex),typeof e.closeBoxMargin!="undefined"&&(this.closeBoxMargin_=e.closeBoxMargin),typeof e.closeBoxURL!="undefined"&&(this.closeBoxURL_=e.closeBoxURL),typeof e.closeBoxTitle!="undefined"&&(this.closeBoxTitle_=e.closeBoxTitle),typeof e.infoBoxClearance!="undefined"&&(this.infoBoxClearance_=e.infoBoxClearance),typeof e.isHidden!="undefined"&&(this.isHidden_=e.isHidden),typeof e.visible!="undefined"&&(this.isHidden_=!e.visible),typeof e.enableEventPropagation!="undefined"&&(this.enableEventPropagation_=e.enableEventPropagation),this.div_&&this.draw();},t.prototype.setContent=function(e){this.content_=e,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),typeof e.nodeType=="undefined"?this.div_.innerHTML=this.getCloseBoxImg_()+e:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(e)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px",typeof e.nodeType=="undefined"?this.div_.innerHTML=this.getCloseBoxImg_()+e:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(e))),this.div_.innerHTML+='<i class="beak"></i>',this.addClickHandler_()),google.maps.event.trigger(this,"content_changed");},t.prototype.setPosition=function(e){this.position_=e,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed");},t.prototype.setZIndex=function(e){this.zIndex_=e,this.div_&&(this.div_.style.zIndex=e),google.maps.event.trigger(this,"zindex_changed");},t.prototype.setVisible=function(e){this.isHidden_=!e,this.div_&&(this.div_.style.visibility=this.isHidden_?"hidden":"visible");},t.prototype.getContent=function(){return this.content_;},t.prototype.getPosition=function(){return this.position_;},t.prototype.getZIndex=function(){return this.zIndex_;},t.prototype.getVisible=function(){var e;return typeof this.getMap()=="undefined"||this.getMap()===null?e=!1:e=!this.isHidden_,e;},t.prototype.getWidth=function(){var e=null;return this.div_&&(e=this.div_.offsetWidth),e;},t.prototype.getHeight=function(){var e=null;return this.div_&&(e=this.div_.offsetHeight),e;},t.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible");},t.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden");},t.prototype.open=function(e,t){var n=this;t&&this.setPosition(t.getPosition()),this.setMap(e),this.div_&&this.panBox_(this.disableAutoPan_);},t.prototype.close=function(){var e;this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null);if(this.eventListeners_){for(e=0;e<this.eventListeners_.length;e++){google.maps.event.removeListener(this.eventListeners_[e]);}this.eventListeners_=null;}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null);},new t(e);};}),define("monitor.monitorsMap.markersCollection",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Collection.extend({getById:function getById(e){var t=this.where({markerId:Number(e)});return t.length?t[0]:null;}});}),define("googleMaps.markerIcons",["require","tools"],function(e){"use strict";function r(e,t,r,i,s){return{iconName:e,url:n,size:new google.maps.Size(t,r),origin:new google.maps.Point(i,s),anchor:new google.maps.Point(Math.round(t/2),Math.round(t/2))};}function i(e,t,n){return{iconName:e,iconAngle:45,path:"M3.85318226,3.37213613 C3.85318226,3.37213613 12.9697725,3.44995722 15.8873837,6.19239197 C18.8049949,8.93482672 18.1908701,13.1028512 15.8873837,15.4063376 C13.5838973,17.709824 9.63916343,18.1006582 6.6734381,15.4063376 C3.70771278,12.712017 3.85318226,3.37213613 3.85318226,3.37213613 Z",anchor:new google.maps.Point(Math.round(t/2),Math.round(n/2)),size:new google.maps.Size(t,n),fillOpacity:1,strokeWeight:1,strokeColor:"#ffffff"};}function s(e,t,r,i){return{iconName:e,url:n,size:new google.maps.Size(t,t),origin:new google.maps.Point(r,i),anchor:new google.maps.Point(Math.round(t/2),Math.round(t/2))};}var t=e("tools"),n="/images/sprites20.png",o={stationaryGreen16:function stationaryGreen16(){return r("stationaryGreen16",16,25,60,0);},stationaryRed16:function stationaryRed16(){return r("stationaryRed16",16,25,80,0);},stationaryGrey16:function stationaryGrey16(){return r("stationaryGrey16",16,25,100,0);},circleGreen6:function circleGreen6(){return s("circleGreen6",6,160,40);},circleGreen10:function circleGreen10(){return s("circleGreen10",10,140,40);},circleRed10:function circleRed10(){return s("circleRed10",10,120,40);},circleGrey10:function circleGrey10(){return s("circleGrey10",10,100,40);},circleBlue18:function circleBlue18(){return s("circleBlue18",18,200,60);},circleGreen13:function circleGreen13(){return s("circleGreen13",13,220,60);},circleGreen13Vectored:function circleGreen13Vectored(){var e=i("circleGreen13Vectored",20,20);return e.fillColor="#46a000",e;},circleGrey7:function circleGrey7(){return s("circleGrey7",7,200,40);},circleBlue7:function circleBlue7(){return s("circleBlue7",7,180,40);},circleGrey13:function circleGrey13(){return s("circleGrey13",13,240,60);},circleGrey13Vectored:function circleGrey13Vectored(){var e=i("circleGrey13Vectored",20,20);return e.fillColor="#666666",e;},circleRed13:function circleRed13(){return s("circleRed13",13,260,60);},circleRed13Vectored:function circleRed13Vectored(){var e=i("circleRed13Vectored",20,20);return e.fillColor="#ed4a30",e;},circleStriped14:function circleStriped14(){return s("circleStriped14",14,280,60);},circleStriped14Vectored:function circleStriped14Vectored(){var e=i("circleStriped14Vectored",18,18);return e.fillOpacity=0,e.strokeWeight=2,e.strokeColor="#46a000",e;},circleTransportStop14:function circleTransportStop14(){return s("circleTransportStop14",14,220,40);},circleTransportStopPlay14:function circleTransportStopPlay14(){return s("circleTransportStopPlay14",14,340,60);},circleTransportStopDragging18:function circleTransportStopDragging18(){return s("circleTransportStopDragging18",18,200,60);}};return function(e){if(t.is(o[e]).fn())return new o[e]();return;};}),define("googleMaps.clustering.online.styles",[],function(){"use strict";var e="/images/cluster_imgs/";return[{width:54,height:54,url:e+"online1.png",textColor:"white"},{width:58,height:57,url:e+"online2.png",textColor:"white"},{width:67,height:66,url:e+"online3.png",textColor:"white"},{width:77,height:76,url:e+"online4.png",textColor:"white"},{width:92,height:91,url:e+"online5.png",textColor:"white"}];}),define("googleMaps.clustering.offline.styles",[],function(){"use strict";var e="/images/cluster_imgs/";return[{width:54,height:54,url:e+"offline1.png",textColor:"white"},{width:58,height:57,url:e+"offline2.png",textColor:"white"},{width:67,height:66,url:e+"offline3.png",textColor:"white"},{width:77,height:76,url:e+"offline4.png",textColor:"white"},{width:92,height:91,url:e+"offline5.png",textColor:"white"}];}),define("campaign.reportForAdvertiser.monitors.map",["require","jquery","underscore","urls","tools","googleMaps.infobox","monitor.monitorsMap.markersCollection","googleMaps.markerIcons","googleMaps.clustering.online.styles","googleMaps.clustering.offline.styles","googleMaps","googleMaps.markerClusterer"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("urls"),i=e("tools"),s=e("googleMaps.infobox"),o=e("monitor.monitorsMap.markersCollection"),u=e("googleMaps.markerIcons"),a=e("googleMaps.clustering.online.styles"),f=e("googleMaps.clustering.offline.styles"),l=window.langResource,c=t("body"),h=14,p=12,d=1e4,v=160,m={Offline:"Offline",Online:"Online"},g=n.template('<div class="campaign-map-overlay" />'),y=n.template('<div class="campaign-map"><div class="campaign-map__button-close"><a class="button js-button-close" href="#" onClick="return false">'+l.campanyReport.returnOnReportButton+"</a>"+"</div>"+'<div class="js-map">'+'<i class="loading"></i>'+"</div>"+"</div>"),b=function b(l){var b=this,w={map:"js-map",buttonClose:"js-button-close",hidden:"is-hidden"},E=n.template('<span class="infobox__label"><%= text %></span>');t.extend(this,{initialize:function initialize(){this.markersCollection=new o(),this.initMap(),this.initLinks();},initMap:function initMap(){this.$overlay=t(g()).addClass(w.hidden),c.append(this.$overlay),this.$mapContainer=t(y()).addClass(w.hidden),c.append(this.$mapContainer),this.$mapContainer.find("."+w.buttonClose).click(function(){b.hideMap();}),this.$map=this.$mapContainer.find("."+w.map),this.isMapVisible=!1;},initLinks:function initLinks(){l.click(function(){return b.showMap(),!1;}).removeClass(w.hidden);},showMap:function showMap(){this.isMapVisible||(this.isMapVisible=!0,this.$overlay.removeClass(w.hidden),this.$mapContainer.removeClass(w.hidden),this.isMapInitialized?this.load():e("googleMaps")(function(t){e("googleMaps.markerClusterer"),b.isMapInitialized=!0,b.maps=t,b.load();}));},hideMap:function hideMap(){this.isMapVisible&&(this.stopTimer(),this.isMapVisible=!1,this.$overlay.addClass(w.hidden),this.$mapContainer.addClass(w.hidden));},load:function load(){t.get(r.get("monitorsForAdvertiser",l.data("report-token"))).done(function(e){b.isMapInitialized&&!b.map&&b.renderMap(e.MapLatitude,e.MapLongitude,e.MapScale),b.map&&b.renderMarkers(e.MonitorsList),b.startTimer();}).fail(function(){throw new Error("Advertiser monitors not loaded!!!");});},renderMap:function renderMap(e,t,n){this.map=this.maps.render({$container:this.$map,center:{lat:e,lng:t},zoom:n,onChangeScale:function onChangeScale(e){var t=e.getZoom();b.mapZoom!==t&&(b.stopTimer(),b.updateMarkerIcons(),b.startTimer());}}),this.mapZoom=n;},renderMarkers:function renderMarkers(e){this.markersCollection.models.length?i.list(e).each(function(e){var t=b.markersCollection.getById(e.Id);if(t){var n=t.get("marker"),r=b.maps.createPoint(e.LastLatitude,e.LastLongitude);n.setPosition(r),b.updateMarkerIcon(n,e),t.set(e),i.is(b.selectedMarker).defined()&&n.markerId==b.selectedMarker.markerId&&b.infoBox.getMap()&&b.infoBox.setPosition(r);}}):i.list(e).each(function(e){var t=b.createMarker(e);e.marker=t,e.markerId=e.Id,b.markersCollection.add(e);}),this.redrawMarkers();},redrawMarkers:function redrawMarkers(){var e=this.filterMarkers();this.markerClusterer?i.object(m).each(function(t){b.markerClusterer[t].updateMarkers(e[t]);}):(this.markerClusterer={},i.object(m).each(function(t){b.markerClusterer[t]=b.createClusterer(t,e[t]);}));},createClusterer:function createClusterer(e,t){var n=f;return e===m.Online&&(n=a),new MarkerClusterer(this.map,t,{gridSize:30,maxZoom:p,styles:n});},filterMarkers:function filterMarkers(e){var t=[],n=[];return i.list(this.markersCollection.models).each(function(e){var r=e.get("marker");e.get("IsOnline")?t.push(r):e.get("HasError")||n.push(r);}),{Online:t,Offline:n};},updateMarkerIcons:function updateMarkerIcons(){this.markersCollection.each(function(e){b.updateMarkerIcon(e.get("marker"),e.toJSON());});},updateMarkerIcon:function updateMarkerIcon(e,t){var n=this.getMapkerIcon(t);if(e.iconName!==n.iconName||e.rotation!==n.rotation)e.iconName=n.iconName,e.rotation=n.rotation,e.setIcon(n);},createMarker:function createMarker(e){var t=new this.maps.googleMaps.LatLng(e.LastLatitude,e.LastLongitude),n=this.getMapkerIcon(e),r=new this.maps.googleMaps.Marker({position:t,icon:n,zIndex:Math.round(t.lat()*-1e5)<<5});return r.markerId=e.Id,r.label=e.Label,r.iconName=n.iconName,r.rotation=n.rotation,this.maps.googleMaps.event.addListener(r,"click",function(){b.selectMarker(r);}),r;},getMapkerIcon:function getMapkerIcon(e){var t=this.map.getZoom()<=h,n=t?!1:this.hasMarkerVector(e),r=this.getMarkerName(e,t,n),i=u(r);return n&&(i.rotation=this.getMarkerAngle(e.LastLongitude,e.LastLatitude,e.PreLastLongitude,e.PreLastLatitude)+i.iconAngle),i;},getMarkerName:function getMarkerName(e,t,n){var r=e.IsOnline?"Green":"Grey",i="circle"+r+(t?"10":"13");return!t&&n&&(i+="Vectored"),i;},hasMarkerVector:function hasMarkerVector(e){var t=e.LastLatitude,n=e.LastLongitude,r=e.PreLastLatitude,i=e.PreLastLongitude;return t&&n&&r&&i&&(t!==r||n!==i);},getMarkerAngle:function getMarkerAngle(e,t,n,r){if(e===n)return r>t?180:0;if(t===r)return n>e?-90:90;var i=Math.PI,s=0,o=n<e,u=r<t,a=Math.atan((r-t)/(n-e));return o&&u||o?s=90-a*180/i:s=270-a*180/i,s;},selectMarker:function selectMarker(e){this.selectedMarker&&this.selectedMarker==e&&this.infoBox.getMap()?this.infoBox.panBox_():(this.showInfoBox(e),this.selectedMarker=e);},showInfoBox:function showInfoBox(e){var t=E({text:e.label});this.infoBox?this.setInfoBoxContent(t):this.infoBox=new s({content:t,boxClass:"infobox infobox_md short",pixelOffset:new this.maps.googleMaps.Size(-v/2,0),infoBoxClearance:new this.maps.googleMaps.Size(40,50),alignBottom:!0,maxWidth:0}),this.infoBox.open(this.map,e);},setInfoBoxContent:function setInfoBoxContent(e){this.infoBox&&this.infoBox.setContent(e);},startTimer:function startTimer(){this.timer=setTimeout(function(){b.isMapVisible&&b.load();},d);},stopTimer:function stopTimer(){this.timer&&(this.timer=clearTimeout(this.timer));}}),this.initialize();};return function(e){e&&e.length&&new b(e);};}),define("campaign.reportForAdvertiser.action",["require","base","jquery","campaign.reportForAdvertiser.monitors.map","campaign.report.videoBlock","campaign.report.graphicsBlock"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("campaign.reportForAdvertiser.monitors.map");return new t.Action({initialize:function initialize(){e("campaign.report.videoBlock")(),e("campaign.report.graphicsBlock")({controller:"Campaign"}),this.initMonitorsMap();},initMonitorsMap:function initMonitorsMap(){new r(n(".js-monitorsMap"));}});}),!function(e){function t(e,t,n){var r=e.children(),s=!1;e.empty();for(var o=0,u=r.length;u>o;o++){var a=r.eq(o);if(e.append(a),n&&e.append(n),i(e,t)){a.remove(),s=!0;break;}n&&n.detach();}return s;}function n(t,s,o,u,a){var f=t.contents(),l=!1;t.empty();for(var c="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",h=0,p=f.length;p>h&&!l;h++){var d=f[h],v=e(d);"undefined"!=typeof d&&(t.append(v),a&&t[t.is(c)?"after":"append"](a),3==d.nodeType?i(o,u)&&(l=r(v,s,o,u,a)):l=n(v,s,o,u,a),l||a&&a.detach());}return l;}function r(e,t,n,o,f){var l=!1,c=e[0];if("undefined"==typeof c)return!1;for(var h=a(c),p=-1!==h.indexOf(" ")?" ":"",d="letter"==o.wrap?"":p,v=h.split(d),m=-1,y=-1,b=0,w=v.length-1;w>=b&&(0!=b||0!=w);){var E=Math.floor((b+w)/2);if(E==y)break;y=E,u(c,v.slice(0,y+1).join(d)+o.ellipsis),i(n,o)?w=y:(m=y,b=y),w==b&&0==w&&o.fallbackToLetter&&(d="",v=v[0].split(d),m=-1,y=-1,b=0,w=v.length-1);}if(-1==m||1==v.length&&0==v[0].length){var S=e.parent();e.remove();var x=f?f.length:0;if(S.contents().size()>x){var T=S.contents().eq(-1-x);l=r(T,t,n,o,f);}else{var N=S.prev(),c=N.contents().eq(-1)[0];if("undefined"!=typeof c){var h=s(a(c),o);u(c,h),f&&N.append(f),S.remove(),l=!0;}}}else h=s(v.slice(0,m+1).join(d),o),l=!0,u(c,h);return l;}function i(e,t){return e.innerHeight()>t.maxHeight;}function s(t,n){for(;e.inArray(t.slice(-1),n.lastCharacter.remove)>-1;){t=t.slice(0,-1);}return e.inArray(t.slice(-1),n.lastCharacter.noEllipsis)<0&&(t+=n.ellipsis),t;}function o(e){return{width:e.innerWidth(),height:e.innerHeight()};}function u(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t);}function a(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:"";}function f(t,n){return"undefined"==typeof t?!1:t?"string"==typeof t?(t=e(t,n),t.length?t:!1):"object"==_typeof(t)?"undefined"==typeof t.jquery?!1:t:!1:!1;}function l(e){for(var t=e.innerHeight(),n=["paddingTop","paddingBottom"],r=0,i=n.length;i>r;r++){var s=parseInt(e.css(n[r]),10);isNaN(s)&&(s=0),t-=s;}return t;}function c(e,t){return e?(t="string"==typeof t?"dotdotdot: "+t:["dotdotdot:",t],"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(t),!1):!1;}if(!e.fn.dotdotdot){e.fn.dotdotdot=function(r){if(0==this.length)return r&&r.debug===!1||c(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){e(this).dotdotdot(r);});var s=this;s.data("dotdotdot")&&s.trigger("destroy.dot"),s.data("dotdotdot-style",s.attr("style")),s.css("word-wrap","break-word"),"nowrap"===s.css("white-space")&&s.css("white-space","normal"),s.bind_events=function(){return s.bind("update.dot",function(r,o){r.preventDefault(),r.stopPropagation(),a.maxHeight="number"==typeof a.height?a.height:l(s),a.maxHeight+=a.tolerance,"undefined"!=typeof o&&(("string"==typeof o||o instanceof HTMLElement)&&(o=e("<div />").append(o).contents()),o instanceof e&&(u=o)),g=s.wrapInner('<div class="dotdotdot" />').children(),g.empty().append(u.clone(!0)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var f=!1,c=!1;return p.afterElement&&(f=p.afterElement.clone(!0),p.afterElement.remove()),i(g,a)&&(c="children"==a.wrap?t(g,a,f):n(g,s,g,a,f)),g.replaceWith(g.contents()),g=null,e.isFunction(a.callback)&&a.callback.call(s[0],c,u),p.isTruncated=c,c;}).bind("isTruncated.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(s[0],p.isTruncated),p.isTruncated;}).bind("originalContent.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(s[0],u),u;}).bind("destroy.dot",function(e){e.preventDefault(),e.stopPropagation(),s.unwatch().unbind_events().empty().append(u).attr("style",s.data("dotdotdot-style")).data("dotdotdot",!1);}),s;},s.unbind_events=function(){return s.unbind(".dot"),s;},s.watch=function(){if(s.unwatch(),"window"==a.watch){var t=e(window),n=t.width(),r=t.height();t.bind("resize.dot"+p.dotId,function(){n==t.width()&&r==t.height()&&a.windowResizeFix||(n=t.width(),r=t.height(),v&&clearInterval(v),v=setTimeout(function(){s.trigger("update.dot");},10));});}else d=o(s),v=setInterval(function(){var e=o(s);(d.width!=e.width||d.height!=e.height)&&(s.trigger("update.dot"),d=o(s));},100);return s;},s.unwatch=function(){return e(window).unbind("resize.dot"+p.dotId),v&&clearInterval(v),s;};var u=s.contents(),a=e.extend(!0,{},e.fn.dotdotdot.defaults,r),p={},d={},v=null,g=null;return a.lastCharacter.remove instanceof Array||(a.lastCharacter.remove=e.fn.dotdotdot.defaultArrays.lastCharacter.remove),a.lastCharacter.noEllipsis instanceof Array||(a.lastCharacter.noEllipsis=e.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),p.afterElement=f(a.after,s),p.isTruncated=!1,p.dotId=h++,s.data("dotdotdot",!0).bind_events().trigger("update.dot"),a.watch&&s.watch(),s;},e.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},e.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","",",",";",".","!","?"],noEllipsis:[]}};var h=1,p=e.fn.html;e.fn.html=function(e){return"undefined"!=typeof e?this.data("dotdotdot")&&"function"!=typeof e?this.trigger("update",[e]):p.call(this,e):p.call(this);};var d=e.fn.text;e.fn.text=function(t){if("undefined"!=typeof t){if(this.data("dotdotdot")){var n=e("<div />");return n.text(t),t=n.html(),n.remove(),this.trigger("update",[t]);}return d.call(this,t);}return d.call(this);};}}(jQuery),define("jquery.dotdotdot",["jquery"],function(){}),define("campaignsList.item",["require","jquery","campaign.manager","videoLoader","gallery","jquery.dotdotdot"],function(e){"use strict";var t=e("jquery"),n=e("campaign.manager"),r=e("videoLoader"),i=e("gallery");e("jquery.dotdotdot");var s=function s(e){var s={videoContainer:"div.js-video-container",title:".js-campany-title",advertiser:".js-advertiser-title",buttonRemove:"a.js-link-remove",buttonStop:"span.js-button-stop",buttonConfirm:"span.js-button-confirm"},o={removeQuestion:"  "};t.extend(this,{initialize:function initialize(){var t=e.find(s.videoContainer);t.data("video-url")?this.initGallery(t):this.initVideoLoader(t),this.initTruncateTitles(),this.initToolsButtons(),this.initClicableContainer();},initClicableContainer:function initClicableContainer(){e.on("click",function(e){if(!t(e.target).closest(".video-container").length&&!t(e.target).closest(".gallery").length){var n=t(e.currentTarget).attr("data-href");n&&(window.location=n);}});},initGallery:function initGallery(e){new i({container:e,thumbnailUrls:e.data("video-thumbnails"),videoUrl:e.data("video-url"),videoLength:e.data("video-length"),videoSize:e.data("video-size")});},initVideoLoader:function initVideoLoader(e){r({containerEl:"#"+e[0].id,buttonBrowse:"browseVideo_"+e.data("id"),multiSelection:!1,additionalParams:{aci:e.data("id")},onAfterLoad:function onAfterLoad(e){window.location.reload();},onError:function onError(){}});},initTruncateTitles:function initTruncateTitles(){var t=e.find(s.title).html().trim();e.find(s.title).html(t),e.find(s.title).dotdotdot(),e.find(s.title).html().trim()==""&&e.find(s.title).html(t),e.find(s.advertiser).dotdotdot();},initToolsButtons:function initToolsButtons(){var t=e.find(s.buttonRemove);n(t,{action:"remove",onClick:function onClick(){var e=window.confirm(o.removeQuestion+'"'+t.data("campaign-title")+'"?');if(e!=1)return!1;},callback:function callback(){window.location.reload();}}),n(e.find(s.buttonStop),{action:"stop",callback:function callback(){window.location.reload();}}),n(e.find(s.buttonConfirm),{action:"confirm",callback:function callback(){window.location.reload();}});}}),this.initialize();};return function(e){new s(e);};}),define("campaignsList",["require","jquery","tools","campaignsList.item"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("campaignsList.item"),i=function i(){var e={campaignsListItemEl:"div.js-campaign-item"};n.list(t(e.campaignsListItemEl)).each(function(e){r(t(e));});};return function(){new i();};}),define("utilities.debounce",["require"],function(e){"use strict";return function(t,n){var r;return function(){var e=this,i=arguments,s=function s(){r=null,t.apply(e,i);};clearTimeout(r),r=setTimeout(s,n);};};}),define("campaignsList.nav",["require","jquery","utilities.debounce"],function(e){"use strict";var t=e("jquery"),n=e("utilities.debounce"),r=function r(){var e=t("html, body"),r=t(window),i={campaignsNavEl:"div.js-campaigns-nav",campaignsNavInnerEl:".js-campaigns-nav-i"},s={fixed:"is-fixed",selected:"is-selected",hidden:"is-hidden"},o=250,u=t(i.campaignsNavEl),a=t(i.campaignsNavInnerEl);if(u.length===1){var f=u.find("a"),l=[],c,h;f.each(function(){var n=t(this),r=n.data("type"),i=t("#"+r);r&&i.length&&(l.push(i),n.click(function(){f.removeClass(s.selected),n.addClass(s.selected),e.animate({scrollTop:i.offset().top},o);}));});var p=function p(){a[u.offset().top-r.scrollTop()<0?"addClass":"removeClass"](s.fixed);};p(),r.on("scroll.campaignsListNavPosition",p);var d=function d(){c=r.scrollTop()+r.height()/2;for(var e=0,t=l.length;e<t;e++){h=l[e].offset().top,f.filter("[data-type="+l[e][0].id+"]")[c>=h&&c<h+l[e].outerHeight()?"addClass":"removeClass"](s.selected);}};d(),r.on("scroll.campaignsListNavSelected",n(d,250)),a.removeClass(s.hidden);}};return function(){new r();};}),define("campaign.list.workload",["require","jquery","urls","tools","templates.storage","datePicker"],function(e){"use strict";function g(e,t){return r.date(e).getDateOffset(t);}var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("templates.storage"),s=e("datePicker"),o=window.langResource,u={datesLabel:".js-workload-period",buttonDatesPrev:".js-workload-dates-prev",buttonDatesNext:".js-workload-dates-next",table:"div.js-workload-table",cellDay:"i.js-workload-day",tooltip:"div.js-workload-tooltip",timeline:"div.js-workload-timeline"},a={visible:"is-visible"},f={workload:"#template_campaign_workload",datesContainer:"#template_campaign_workload_dates",graphicRow:"#template_campaign_workload_row",timeline:"#template_campaign_workload_timeline"},l=14,c=4,h=o.currentLocale==="ru-RU"?"d M":"M d",p=o.currentLocale==="ru-RU"?"d MM":"MM d",d=50,v=15,m=r.date(new Date()).chain().format("yy.mm.dd").parse("yy.mm.dd").value(),y=function y(e,_y){var b=this,w=new Date(),E=g(w,l-1);t.extend(this,{initialize:function initialize(){this.render(),this.initDatesPicker(),this.runChangeDatesCallback();},render:function render(){var t=i.get(f.workload);e.append(t()),this.rowTemplate=i.get(f.graphicRow),this.$table=e.find(u.table),this.$tooltip=e.find(u.tooltip),this.$timeline=e.find(u.timeline);},initDatesPicker:function initDatesPicker(){var e=i.get(f.datesContainer),t=o.currentLocale==="ru-RU"?"dd M yy":"M d, yy";_y.html(e({DatesString:this.getDatesRangeString(w,E)})),this.$datesLabel=_y.find(u.datesLabel),this.datepicker=new s(_y.find("input:text"),{onSelect:function onSelect(e){w=r.date(e).parse(),E=g(w,l-1),b.updateDatepicker();}}),_y.find(u.buttonDatesPrev).click(function(){E=g(w,-1),w=g(E,-(l-1)),b.updateDatepicker();}),_y.find(u.buttonDatesNext).click(function(){w=g(E,1),E=g(w,l-1),b.updateDatepicker();});},updateDatepicker:function updateDatepicker(){this.datepicker.setDate(w),this.$datesLabel.text(this.getDatesRangeString(w,E)),this.runChangeDatesCallback();},getDatesRangeString:function getDatesRangeString(e,t){function n(e,t){return r.date(e).format(t);}var i=e.getFullYear()===t.getFullYear(),s,u;return i?u=o.currentLocale==="ru-RU"?"dd M":"M d":u=o.currentLocale==="ru-RU"?"dd M yy":"M d, yy",s=n(e,u)+"  "+n(t,u),i&&(s+=", "+e.getFullYear()),s;},runChangeDatesCallback:function runChangeDatesCallback(){this.loadData(function(e){b.workloadData=e,b.renderGraphic(),b.renderTimeline();});},loadData:function loadData(e){var i={DateStart:r.date(w).format("yy.mm.dd"),DateEnd:r.date(E).format("yy.mm.dd")};t.get(n.get("campaignWorkload"),i).done(function(t){r.list(t).each(function(e){e.MonitorCountString=r.number(e.MonitorCount).range(),e.RevenueString=b.abbreviateNumber(e.Revenue),e.RemainRevenueString=b.abbreviateNumber(e.RemainRevenue),e.IsRevenueDeltaNegative=e.RevenueDelta<0,e.RevenueDeltaString=b.abbreviateNumber(Math.abs(e.RevenueDelta),1);}),r.is(t).array()&&t.length&&e(t);}).fail(function(){});},abbreviateNumber:function abbreviateNumber(e,t){var n=["","K","M","B","T","q"],r=Math.log(e)/Math.LN10/3|0;if(r===0)return e;var i=n[r],s=Math.pow(10,r*3),o=e/s;return Number(o.toFixed(t!==undefined?t:2))+i;},renderGraphic:function renderGraphic(){var e=this.workloadData[0].MonitorCount;this.$table.html(""),r.list(this.workloadData).each(function(t,n){t.Height=Math.max(v,t.MonitorCount/e*d),r.list(t.Days).each(function(e){e.DateString=r.date(e.Date).chain().parse("dd.mm.yy").format(p).value();}),b.$table.append(b.rowTemplate(t));}),this.$table.find(u.cellDay).hover(function(){b.showTooltip(t(this));},function(){b.hideTooltip();});},showTooltip:function showTooltip(e){var t=e.data(),n=e.position(),i="<p><b>"+t.dateString+"</b></p><p>"+t.workload+"%  "+".</p>";r.date(t.date).parse("dd.mm.yy")>=m&&(i+="<p>  "+r.number(t.seconds).range()+" "+"  30 .</p>"),this.$tooltip.find(">div").html(i),this.$tooltip.css({top:e.parent().position().top,left:e.position().left+e.outerWidth()/2}).addClass(a.visible);},hideTooltip:function hideTooltip(){this.$tooltip.removeClass(a.visible);},renderTimeline:function renderTimeline(){var e=i.get(f.timeline),t=[];r.list(this.workloadData[0].Days).each(function(e,n){n%c===0?t.push(r.date(e.Date).chain().parse("dd.mm.yy").format(h).value()):t.push("");}),this.$timeline.html(e(t));}}),this.initialize();};return function(e,t){e&&e.length&&t&&t.length&&new y(e,t);};}),define("campaign.list.action",["require","base","jquery","campaignsList","campaignsList.nav","campaign.list.workload"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("campaignsList"),i=e("campaignsList.nav"),s=e("campaign.list.workload");return new t.Action({initialize:function initialize(){r(),i(),s(n("#workload"),n("#workloadDates"));}});}),define("campaign.controller",["require","base","campaign.create.action","campaign.report.action","campaign.printReport.action","campaign.reportForAdvertiser.action","campaign.list.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{createadscampaign:function createadscampaign(t){e("campaign.create.action").initialize(t);},adscampaignreport:function adscampaignreport(t){e("campaign.report.action").initialize(t);},adscampaignprintreport:function adscampaignprintreport(t){e("campaign.printReport.action").initialize(t);},adscampaignreportforadvertiser:function adscampaignreportforadvertiser(t){e("campaign.reportForAdvertiser.action").initialize(t);},list:function list(t){e("campaign.list.action").initialize(t);}}});}),define("customer.details.action",["require","base","jquery"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=window.langResource;return new t.Action({initialize:function initialize(){n("#linkAdvertiserDelete").click(function(e){e.preventDefault(),window.confirm(r.advertiser.removeAdvertiser)&&n.post(this.href).done(function(){window.location.reload();});});}});}),define("customer.list.action",["require","base","jquery","customer.form.builder"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=window.langResource;return new t.Action({initialize:function initialize(){var t=n("#advertisersList");t.find(".button_remove").click(function(){window.confirm(r.advertiser.removeAdvertiser)&&n.post(n(this).data("url")).done(function(){window.location.reload();});}),e("customer.form.builder")({type:"add",$linkOpen:n("#btnCreateAdvertiser"),onSuccess:function onSuccess(){window.location.reload();}});}});}),define("customer.controller",["require","base","customer.form.builder","customer.details.action","customer.list.action","campaignsList","campaignsList"],function(e){"use strict";function n(){e("customer.form.builder")({type:"edit",$linkOpen:$("#linkAdvertiserEdit"),onSuccess:function onSuccess(){window.location.reload();}});}function r(){e("customer.details.action").initialize();}var t=e("base");return new t.Controller({actions:{list:function list(t){e("customer.list.action").initialize(t);},advertiserarchivecampaigns:function advertiserarchivecampaigns(){e("campaignsList")(),n(),r();},advertiseractivecampaigns:function advertiseractivecampaigns(){e("campaignsList")(),n(),r();},advertiserfinanceoperations:function advertiserfinanceoperations(){n(),r();}}});}),define("tooltipConfirm",["require","jquery","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("templates.storage"),r=t(document),i=function i(e,_i5){var s=this,o="#template_tooltip_confirm",u={buttonApply:"a.js-button-apply",buttonCancel:"a.js-button-cancel"},a="is-hidden";return t.extend(this,{initialize:function initialize(){this.template=n.get(o),this.template&&(this.index=this.createIndex(),this.render(),this.initControls(),r.on("click.tooltipConfirm"+this.index,function(n){if(s.isVisible&&n.target!==e[0]&&n.target!==s.$el[0]){var r=t(n.target).parents();!r.filter(s.$el[0]).length&&!r.filter(e[0]).length&&s.hide();}}));},render:function render(){this.$el=t(this.template(_i5)),e.after(this.$el);},show:function show(){this.isVisible=!0,this.$el.removeClass(a);},hide:function hide(){this.isVisible=!1,this.$el.addClass(a);},initControls:function initControls(){this.$el.find(u.buttonApply).click(function(){return s.runCallback("onApply"),s.hide(),!1;}),this.$el.find(u.buttonCancel).click(function(){return s.runCallback("onCancel"),s.hide(),!1;});},runCallback:function runCallback(e){typeof _i5[e]=="function"&&_i5[e]();},createIndex:function createIndex(){return Math.round(Math.random()*Math.random()*1e8);}}),this.initialize(),{show:function show(){s.show();}};};return function(e,t){if(e&&e.length&&t)return new i(e,t);};}),define("federalagent.addoredit.form.model",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone");return n.Model.extend({defaults:{Email:"",Password:"",Name:"",Phone:"",IsDoubleAuthEnabled:!1,PartnerIdsWithGroupIds:[]},isValid:function isValid(){var e=this.toJSON();return e.Email===null||t.string(e.Email).trim()===""?!1:e.Password===null||t.string(e.Password).trim()===""?!1:e.Name===null||t.string(e.Name).trim()===""?!1:!e.IsDoubleAuthEnabled||e.Phone!==null&&t.string(e.Phone).trim()!==""?e.PartnerIdsWithGroupIds.length?!0:!1:!1;},getData:function getData(){var e=this.toJSON();return delete e.Errors,e;}});}),define("federalagent.addoredit.form.staff",["require","tools","utilities.debounce"],function(e){"use strict";var t=window.langResource,n=e("tools"),r=e("utilities.debounce"),i="input.js-federalAgent-email",s="input.js-federalAgent-password",o="input.js-federalAgent-name",u="input.js-federalAgent-phone",a={hidden:"is-hidden",error:"error"},f={email:t.federalAgent.emailIsRequired,password:t.federalAgent.passwordIsRequired,name:t.federalAgent.nameIsRequired,phone:t.federalAgent.phoneIsRequired};return function(e,t){function l(i,s){var o=e.find(i),u=o.next();s&&o.val(s),o.on("focus",function(){o.removeClass(a.error),u.addClass(a.hidden);}).on("keydown",r(function(){t.set(o.get(0).name,n.string(o.val()).trim());},500));}function c(e,t){if(!e||!e.length)return;var n=e.next();t?(e.addClass(a.error),n.text(t).removeClass(a.hidden)):$.trim(e.val())||(e.addClass(a.error),n.text(f[e.get(0).name.toLowerCase()]).removeClass(a.hidden));}if(!e||!e.length||!t)return;l(i,t.get("Email")),l(s),l(o,t.get("Name")),l(u,t.get("Phone")),t.on("showErrors",function(r){var a=t.get("IsDoubleAuthEnabled"),f=[e.find(i),e.find(s),e.find(o),e.find(u)];r?n.list(r).each(function(e){if(e.Field&&e.Message){var t=f.filter(function(t){return t.get(0).name.indexOf(e.Field)!==-1;});c(t[0],e.Message);}else f.forEach(function(e){(e.get(0).name==="Email"||e.get(0).name==="Name"||e.get(0).name==="Password"||e.get(0).name==="Phone"&&a)&&c(e);});}):f.forEach(function(e){(e.get(0).name==="Email"||e.get(0).name==="Name"||e.get(0).name==="Password"||e.get(0).name==="Phone"&&a)&&c(e);});});};}),define("federalagent.addoredit.form.partner.model",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Model.extend({defaults:{Groups:[]},setGroupChecked:function setGroupChecked(e,t){this.get("Groups").forEach(function(n){if(n.Id==e){n.Checked=t;return;}});},setAllGroupsChecked:function setAllGroupsChecked(e){this.get("Groups").forEach(function(t){t.Checked=e;});},isAnyGroupChecked:function isAnyGroupChecked(){var e=!1;return this.get("Groups").forEach(function(t){t.Checked&&(e=!0);}),e;}});}),define("federalagent.addoredit.form.partners",["require","tools","backbone","templates.storage","federalagent.addoredit.form.partner.model","jquery.designForms"],function(e){"use strict";var t=e("tools"),n=e("backbone"),r=e("templates.storage"),i=e("federalagent.addoredit.form.partner.model");e("jquery.designForms");var s="div.js-federalAgent-partners",o="#template_federalAgent_form_partner",u={error:"error-message",hidden:"is-hidden"};return function(e,a,f){function d(){var e=a.get("PartnerIdsWithGroupIds");e&&t.list(f).each(function(n){t.list(e).each(function(e){if(n.Id==e.PartnerId)return n.Checked=!0,t.list(n.Groups).each(function(n){t.list(e.GroupIds).each(function(e){if(e==n.Id)return n.Checked=!0,!1;});}),!1;});});}function v(){for(var e=0;e<f.length;e++){var t=m(f[e]);c.add(t.model);var n=t.$el;l.append(n);}}function m(e){var t=$(h(e)),n=t.find("input:checkbox#partner"+e.Id),r=t.find("input:checkbox.js-partnerGroupCheckbox"),s=new i(e);return n.designForms().change(function(){var e=$(this).is(":checked");e?(r.prop("checked","checked").trigger("design:update"),s.setAllGroupsChecked(!0)):(r.removeAttr("checked").trigger("design:update"),s.setAllGroupsChecked(!1)),s.set("Checked",e);}),r.designForms().change(function(){var e=$(this).val(),t=s.isAnyGroupChecked();s.setGroupChecked(e,$(this).is(":checked"));var r=s.isAnyGroupChecked();t==0&&r?(n.prop("checked","checked").trigger("design:update"),s.set("Checked",!0)):t&&r==0?(n.removeAttr("checked","checked").trigger("design:update"),s.set("Checked",!1)):s.trigger("change");}),{$el:t,model:s};}if(!(e&&e.length&&a&&f))return;var l=e.find(s),c=new n.Collection(),h=r.get(o);d();var p=$("<div>").text("     ").addClass(u.error).addClass(u.hidden);l.append(p),a.on("showErrors",function(e){if(!e){var t=c.where({Checked:!0});t.length||p.removeClass(u.hidden);}}),v(),c.on("change",function(){p.addClass(u.hidden);var e=c.filter(function(e){return e.get("Checked");}).map(function(e){var t=e.get("Id"),n=[];return e.get("Groups").forEach(function(e){e.Checked&&n.push(e.Id);}),{PartnerId:t,GroupIds:n};});a.set("PartnerIdsWithGroupIds",e);});};}),define("federalagent.addoredit.form.doubleAuth",["require","jquery","jquery.designForms"],function(e){"use strict";var t=e("jquery");e("jquery.designForms");var n="input.js-federalAgent-double-auth";return function(e,r){if(!e||!e.length||!r)return;e.find(n).prop("checked",r.get("IsDoubleAuthEnabled")===!0).designForms().trigger("design:update").change(function(){r.set("IsDoubleAuthEnabled",t(this).is(":checked"));});};}),define("federalagent.addoredit.form",["require","jquery","urls","tools","backbone","tooltipConfirm","federalagent.addoredit.form.model","federalagent.addoredit.form.staff","federalagent.addoredit.form.partners","federalagent.addoredit.form.doubleAuth"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("backbone"),s=e("tooltipConfirm"),o=e("federalagent.addoredit.form.model"),u=e("federalagent.addoredit.form.staff"),a=e("federalagent.addoredit.form.partners"),f=e("federalagent.addoredit.form.doubleAuth"),l=window.langResource,c=n.get("federalAgentList"),h="#formAddEditFederalAgent",p={buttonSave:"a.js-federalAgent-save",buttonRemove:"a.js-federalAgent-remove"},d={hidden:"is-hidden",disabled:"is-disabled"},v=i.View.extend({initialize:function initialize(){var e=window.formData;this.model=new o(e.FederalAgentForm),f(this.$el,this.model),a(this.$el,this.model,e.PartnersWithGroups),u(this.$el,this.model),this.initButtonSave(),this.initButtonRemove();},initButtonSave:function initButtonSave(){var e=this,i=this.model,s=this.$el.find(p.buttonSave);s[i.isValid()?"removeClass":"addClass"](d.disabled),i.on("change",function(){s[i.isValid()?"removeClass":"addClass"](d.disabled);}),s.click(function(){return e.isSaving||(i.isValid()?(e.isSaving=!0,s.addClass(d.disabled),t.post(n.get("federalAgentAddOrEdit"),i.getData()).done(function(t){if(t)if(t.success)window.location.href=c;else{var n=[];r.object(t.errors).each(function(e,t){n.push({Field:e,Message:t});}),e.showErrors(n),e.isSaving=!1,s.removeClass(d.disabled);}}).fail(function(t){e.isSaving=!1,s.removeClass(d.disabled);})):e.showErrors()),!1;});},showErrors:function showErrors(e){this.model.trigger("showErrors",e);},initButtonRemove:function initButtonRemove(){var e=this,i=this.model.get("Id");if(!r.is(i).defined())return;var o=this.$el.find(p.buttonRemove),u=s(o,{headerText:l.federalAgent.tooltipConfirmRemoveHeading,contentText:l.federalAgent.tooltipConfirmRemoveText,buttonApplyText:l.federalAgent.tooltipConfirmRemoveButtonApply,buttonCancelText:l.federalAgent.tooltipConfirmRemoveButtonCancel,onApply:function onApply(){e.isRemoving=!0,o.addClass(d.disabled),t.post(n.get("federalAgentRemove"),{Id:i}).done(function(){window.location.href=c;}).fail(function(){e.isRemoving=!1,o.removeClass(d.disabled);});}});o.removeClass(d.hidden).click(function(){return e.isRemoving||u.show(),!1;});}});return function(){window.formData&&new v({el:h});};}),define("federalagent.addoredit.action",["require","base","federalagent.addoredit.form"],function(e){"use strict";var t=e("base"),n=e("federalagent.addoredit.form");return new t.Action({initialize:function initialize(){new n();}});}),define("federalagent.controller",["require","base","federalagent.addoredit.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{addoredit:function addoredit(t){e("federalagent.addoredit.action").initialize(t);}}});}),define("emergency.addoredit.form.model",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone");return n.Model.extend({defaults:{CabinetType:1,Name:"",PartnerIdsWithGroupIds:[],IsDoubleAuthEnabled:!1,Users:[],MessageTemplates:[],MapLatitude:64.02989520313211,MapLongitude:92.724609375,MapScale:3},isValid:function isValid(){var e=this.toJSON(),n=!0;return e.Name||(n=!1),t.is(e.CabinetType).defined()||(n=!1),e.PartnerIdsWithGroupIds.length?(e.MessageTemplates.length||(n=!1),e.Users.length||(n=!1),n):!1;},getData:function getData(){var e=this.toJSON();return delete e.Errors,e;}});}),define("emergency.addoredit.form.types",["require","tools","templates.storage","jquery.designDropdowns"],function(e){"use strict";var t=e("tools"),n=e("templates.storage");e("jquery.designDropdowns");var r="div.js-emergency-types",i="#template_emergency_form_types";return function(e,s,o){if(!(e&&e.length&&s&&o))return;var u=e.find(r),a=n.get(i),f=s.get("CabinetType");u.append(a({Selected:s.get("CabinetType"),CabinetTypes:o})).find("select").prop("disabled",t.is(s.get("EmergencyId")).defined()).chosen().change(function(){s.set("CabinetType",this.value);});};}),define("emergency.addoredit.form.name",["require","tools"],function(e){"use strict";var t=e("tools"),n="input.js-emergency-name",r={hidden:"is-hidden",error:"error"};return function(e,i){if(!e||!e.length||!i)return;var s=e.find(n),o=s.next();s.val(i.get("Name")).removeClass(r.hidden).on("focus",function(){s.removeClass(r.error),o.addClass(r.hidden);}).on("keydown",function(){setTimeout(function(){i.set("Name",t.string(s.val()).trim());},10);}),i.on("showErrors",function(e){!e&&!t.string(s.val()).trim()&&(s.addClass(r.error),o.removeClass(r.hidden));});};}),define("emergency.addoredit.form.partner.model",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Model.extend({defaults:{Groups:[]},setGroupChecked:function setGroupChecked(e,t){this.get("Groups").forEach(function(n){if(n.GroupId==e){n.Checked=t;return;}});},setAllGroupsChecked:function setAllGroupsChecked(e){this.get("Groups").forEach(function(t){t.Checked=e;});},isAnyGroupChecked:function isAnyGroupChecked(){var e=!1;return this.get("Groups").forEach(function(t){t.Checked&&(e=!0);}),e;}});}),define("emergency.addoredit.form.partners",["require","tools","backbone","templates.storage","emergency.addoredit.form.partner.model","jquery.designForms"],function(e){"use strict";var t=e("tools"),n=e("backbone"),r=e("templates.storage"),i=e("emergency.addoredit.form.partner.model");e("jquery.designForms");var s="div.js-emergency-partners",o="#template_emergency_form_partner",u={error:"error-message",hidden:"is-hidden"};return function(e,a,f){function d(e){var t=$(p(e)),n=t.find("input:checkbox#partner"+e.Id),r=t.find("input:checkbox.js-partnerGroupCheckbox"),s=new i(e);return n.designForms().change(function(){var e=$(this).is(":checked");e?(r.prop("checked","checked").trigger("design:update"),s.setAllGroupsChecked(!0)):(r.removeAttr("checked").trigger("design:update"),s.setAllGroupsChecked(!1)),s.set("Checked",e);}),r.designForms().change(function(){var e=$(this).val(),t=s.isAnyGroupChecked();s.setGroupChecked(e,$(this).is(":checked"));var r=s.isAnyGroupChecked();t==0&&r?(n.prop("checked","checked").trigger("design:update"),s.set("Checked",!0)):t&&r==0?(n.removeAttr("checked","checked").trigger("design:update"),s.set("Checked",!1)):s.trigger("change");}),{$el:t,model:s};}function v(){var e=a.get("PartnerIdsWithGroupIds");e&&t.list(f).each(function(n){t.list(e).each(function(e){if(n.Id==e.PartnerId)return n.Checked=!0,t.list(n.Groups).each(function(n){t.list(e.GroupIds).each(function(e){if(e==n.GroupId)return n.Checked=!0,!1;});}),!1;});});}function g(){for(var e=0;e<f.length;e++){var t=d(f[e]);c.add(t.model);var n=t.$el;l.append(n);}}if(!(e&&e.length&&a&&f))return;var l=e.find(s),c=new n.Collection(),h=a.get("PartnerIds"),p=r.get(o);v(),h&&t.list(f).each(function(e){t.list(h).each(function(t){if(t==e.Id)return e.Checked=!0,!1;});});var m=$("<div>").text("     ").addClass(u.error).addClass(u.hidden);l.append(m),a.on("showErrors",function(e){if(!e){var t=c.where({Checked:!0});t.length||m.removeClass(u.hidden);}}),g(),c.on("change",function(){m.addClass(u.hidden);var e=c.filter(function(e){return e.get("Checked");}).map(function(e){var t=e.get("Id"),n=[];return e.get("Groups").forEach(function(e){e.Checked&&n.push(e.GroupId);}),{PartnerId:t,GroupIds:n};});a.set("PartnerIdsWithGroupIds",e);});};}),define("emergency.addoredit.form.doubleAuth",["require","jquery","jquery.designForms"],function(e){"use strict";var t=e("jquery");e("jquery.designForms");var n="input.js-emergency-double-auth";return function(e,r){if(!e||!e.length||!r)return;e.find(n).prop("checked",r.get("IsDoubleAuthEnabled")===!0).designForms().trigger("design:update").change(function(){r.set("IsDoubleAuthEnabled",t(this).is(":checked"));});};}),define("emergency.addoredit.staff.collection",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Collection.extend({updateOrder:function updateOrder(){this.each(function(e,t){e.set("Index",t+1);});},updateButtonsRemove:function updateButtonsRemove(){var e=this;this.each(function(t,n){t.set("CanBeRemoved",e.length!==1);});},getValidData:function getValidData(){var e=this.filter(function(e){var t=e.isFieldValid("Email")&&e.isFieldValid("FullName");return e.get("IsChanged")&&!e.isFieldValid("Password")&&(t=!1),t&&e.get("isPhoneRequired")&&!e.isFieldValid("Phone")&&(t=!1),t;});return this.length===e.length?e.map(function(e){return e.getData();}):[];}});}),define("emergency.addoredit.staff.person.model",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone");return n.Model.extend({defaults:{Email:null,FullName:null,Password:null,Phone:null,isPhoneRequired:!1,IsChanged:!0,CanBeRemoved:!0},isFieldValid:function isFieldValid(e){var n=this.get(e);return n===null||t.string(n).trim()===""?!1:!0;},getData:function getData(){var e=this.toJSON();return delete e.Index,delete e.CanBeRemoved,delete e.isPhoneRequired,e;}});}),define("emergency.addoredit.staff.person",["require","jquery","utilities.debounce","backbone","templates.storage","emergency.addoredit.staff.person.model"],function(e){"use strict";var t=e("jquery"),n=e("utilities.debounce"),r=e("backbone"),i=e("templates.storage"),s=e("emergency.addoredit.staff.person.model"),o="#template_emergency_person",u={index:".js-person-index",textField:"input.js-text-field",buttonRemove:"span.js-person-remove"},a={hidden:"is-hidden",error:"error"},f={fullname:"  ",email:"   ",password:"  ",phone:"  "};return r.View.extend({template:i.get(o),initialize:function initialize(e){var t=this;this.model=new s(e),this.model.on("change:Email change:FullName change:Password change:Phone",function(e){e.set("IsChanged",!0);}).on("change:Index",function(){t.changeIndex();}).on("change:CanBeRemoved",function(){t.changeVisibleButtonRemove();}).on("destroy",function(){t.destroy();}).on("showErrors",function(e,n){t.showErrors(e,n);}),this.render(),this.initControls();},render:function render(){this.$el=t(this.template(this.model.toJSON()));},initControls:function initControls(){this.initTextFields(),this.initButtonRemove();},initTextFields:function initTextFields(){var e=this;this.$fields=this.$el.find(u.textField),this.$fields.focus(function(){t(this).removeAttr("readonly").removeClass(a.error).next().addClass(a.hidden);}).each(function(){var r=this;t(r).on("keydown",n(function(){e.model.set(r.name,r.value);},500));});},initButtonRemove:function initButtonRemove(){var e=this;this.$buttonRemove=this.$el.find(u.buttonRemove).click(function(){e.model.get("CanBeRemoved")&&e.model.destroy();});},changeIndex:function changeIndex(){this.$el.find(u.index).text("#"+this.model.get("Index"));},changeVisibleButtonRemove:function changeVisibleButtonRemove(){this.$buttonRemove[this.model.get("CanBeRemoved")?"removeClass":"addClass"](a.hidden);},showErrors:function showErrors(e,n){var r=this,i=this.model;if(e&&n){var s=this.$fields.filter(function(){return this.name.indexOf(e)!==-1;});r.showFieldError(s,n);}else this.$fields.each(function(){(this.name==="Email"||this.name==="FullName"||this.name==="Password"&&i.get("IsChanged")||this.name==="Phone"&&i.get("isPhoneRequired"))&&r.showFieldError(t(this));});},showFieldError:function showFieldError(e,n){if(!e||!e.length)return;var r=e.next();n?(e.addClass(a.error),r.text(n?n:f[e[0].name.toLowerCase()]).removeClass(a.hidden)):t.trim(e.val())||(e.addClass(a.error),r.text(f[e[0].name.toLowerCase()]).removeClass(a.hidden));},destroy:function destroy(){this.$el.remove();}});}),define("emergency.addoredit.staff",["require","jquery","tools","backbone","emergency.addoredit.staff.collection","emergency.addoredit.staff.person"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("backbone"),i=e("emergency.addoredit.staff.collection"),s=e("emergency.addoredit.staff.person"),o=window.langResource,u={hidden:"is-hidden"},a={error:".js-staff-error"},f=function f(e,r,a){var f=this,l=new i();return t.extend(this,{initialize:function initialize(){this.initErrorMessage(),this.renderButtonAdd(),this.renderPersons(),this.isPhoneRequired=a.isPhoneRequired,l.updateButtonsRemove(),l.on("add remove change",function(){f.runCallback();}).on("add remove",function(){l.updateButtonsRemove();}).on("remove",function(){l.updateOrder();});},renderButtonAdd:function renderButtonAdd(){this.$buttonAdd=t("<a>",{"class":"button",text:o.emergency.buttonAddPerson}),this.$buttonAdd.click(function(){return f.createPerson(),!1;}),e.append(this.$buttonAdd);},renderPersons:function renderPersons(){r.length?this.renderExistPersons():f.createPerson();},renderExistPersons:function renderExistPersons(){n.list(r).each(function(e){f.createPerson(e);});},createPerson:function createPerson(e){var n=t.extend({Index:l.length+1,isPhoneRequired:this.isPhoneRequired},e||{}),r=new s(n);l.add(r.model),this.$buttonAdd.before(r.$el);},setPhoneRequired:function setPhoneRequired(e){this.isPhoneRequired=e,l.each(function(t){t.set("isPhoneRequired",e);}),this.runCallback();},initErrorMessage:function initErrorMessage(){this.$errorMessage=t("<span>",{"class":u.hidden+" error-message common",text:"     "}),e.append(this.$errorMessage),l.on("change",function(){f.$errorMessage.addClass(u.hidden);});},runCallback:function runCallback(){n.is(a.onChanage).fn()&&a.onChanage(l.getValidData());},showUserErrors:function showUserErrors(e){e?n.list(e).each(function(e){e.Name==="Users"&&l.models[e.Index].trigger("showErrors",e.Field,e.Message);}):l.each(function(e){e.trigger("showErrors");});},showCommonError:function showCommonError(){l.length||this.$errorMessage.removeClass(u.hidden),l.each(function(e){e.trigger("showErrors");});}}),this.initialize(),{setPhoneRequired:function setPhoneRequired(e){f.setPhoneRequired(e);},showUserErrors:function showUserErrors(e){f.showUserErrors(e);},showCommonError:function showCommonError(){f.showCommonError();}};};return function(e,t,n){if(e&&e.length&&t)return new f(e,t,n);};}),define("emergency.addoredit.form.staff",["require","tools","emergency.addoredit.staff"],function(e){"use strict";var t=e("tools"),n=e("emergency.addoredit.staff"),r="div.js-emergency-staff",i="#template_emergency_form_types";return function(e,t){if(!(e&&e.length&&t))return;var i=t.get("Users"),s=new n(e.find(r),i,{isPhoneRequired:t.get("IsDoubleAuthEnabled"),onChanage:function onChanage(e){t.set("Users",e);}});t.on("change:IsDoubleAuthEnabled",function(e,t){s.setPhoneRequired(t);}),t.on("showErrors",function(e){e&&e.length?s.showUserErrors(e):(t.get("Users").length||s.showCommonError(),s.showUserErrors());});};}),define("emergency.addoredit.form.mapSettings",["require","googleMaps"],function(e){"use strict";var t="#mapSettings";return function(n,r){if(!n||!n.length||!r)return;var i=r.toJSON();e("googleMaps")(function(e){e.render({$container:n.find(t),center:{lat:i.MapLatitude,lng:i.MapLongitude},zoom:i.MapScale,onChangeCenter:function onChangeCenter(e){r.set("MapLatitude",e.getCenter().lat()),r.set("MapLongitude",e.getCenter().lng());},onChangeScale:function onChangeScale(e){r.set("MapScale",e.getZoom());}});});};}),define("emergency.addoredit.messageTemplate.model",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone"),r=window.langResource;return n.Model.extend({defaults:{Caption:"",Color:2,CornerCaption:"",DurationOfShow:10,DurationOfVideo:20,Frequency:60,IsCanAddImage:!1,Name:r.emergency.templateNameByDefault,Priority:5},initialize:function initialize(){this.set({BgStyle:this.get("ImageId")?"image":"color",templateIndex:t.random().number()},{silent:!0});},isFieldValid:function isFieldValid(e){return t.string(this.get(e)).trim()!=="";},getData:function getData(){var e=this.toJSON();return e.BgStyle==="color"&&(delete e.ImageId,delete e.ImageUrl),delete e.BgStyle,delete e.IsAnotherCabinet,delete e.templateIndex,e;}});}),define("colorGroup",["require","jquery","tools","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("templates.storage"),i=function i(e,_i6){var s=this,o="#template_color_group";return t.extend(this,{initialize:function initialize(){this.render(),this.initControls();},render:function render(){var t=r.get(o);e.append(t({colors:_i6.colors,selected:_i6.selected}));},initControls:function initControls(){this.$radios=e.find("input:radio").change(function(){s.runCallback("onChange",this.value);});},runCallback:function runCallback(e,t){_typeof(_i6[e]==="function")&&_i6[e](t);},selectColor:function selectColor(e){n.is(e).defined()&&this.$radios.filter('[value="'+e+'"]').prop("checked",!0);}}),this.initialize(),{selectColor:function selectColor(e){s.selectColor(e);}};};return function(e,t){if(e&&e.length&&t&&t.colors)return new i(e,t);};}),define("image",["require","jquery"],function(e){"use strict";var t=e("jquery"),n=function n(e,_n4){var r={el:"image",buttonRemove:"image__remove"},i=t('<div class="'+r.el+'">');_n4.additionalClass&&i.addClass(_n4.additionalClass),e.append(i);var s=t('<img src="'+_n4.src+'">');_n4.width&&s.css("width",_n4.width+"px"),i.append(s);var o=t("<span>",{"class":r.buttonRemove}).append('<i class="icon_cross8x9">').click(function(){e.html(""),typeof _n4.onRemove=="function"&&_n4.onRemove();});i.append(o);};return function(e,t){e&&e.length&&t&&t.src&&new n(e,t);};}),define("imageLoader",["require","jquery","urls","tools","templates.storage","image","plupload"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("templates.storage"),s=e("image");e("plupload");var o=function o(e,_o4){var u=this,a="#template_image_loader",f="#template_image_loader_states",l={container:i.get(a),states:i.get(f)},c=t.extend({maxFileSize:"10mb",mimeTypes:[{title:"Image files",extensions:"jpg,jpeg,png"}],preventDuplicates:!0,multiSelection:!1,dragdrop:!0},_o4||{}),h={container:"div.js-file-container",blockProcess:"div.js-file-process",blockImage:"div.js-file-image",buttonBrowse:".js-file-browse"},p={process:"file-loader__process",dragover:"dragover",fileAdded:"with-file",fileLoaded:"is-loaded",errorLoading:"with-error"};e.html(l.container(c));var d=e.find(h.container);return t.extend(this,{initialize:function initialize(){this.initContainers(),this.initUploader();},initContainers:function initContainers(){this.$blockProcess=d.find(h.blockProcess),this.$blockImage=d.find(h.blockImage);},initUploader:function initUploader(){var e={browse_button:d.find(h.buttonBrowse)[0],url:n.get("uploadImage"),multipart_params:c.additionalParams||{},multi_selection:c.multiSelection,headers:{"X-Requested-With":"XMLHttpRequest"},filters:{mime_types:c.mimeTypes,max_file_size:c.maxFileSize,prevent_duplicates:c.preventDuplicates}};c.dragdrop&&(e.drop_element=d[0]),this.uploader=new plupload.Uploader(e),this.uploader.init(),this.uploader.bind("Init",function(e){u.runCallback("onInit",e),u.uploader.features.dragdrop&&d.on("dragenter",function(){u.isDragging||(u.isDragging=!0,d.addClass(p.dragover));}).on("dragleave",function(e){e.relatedTarget!==d[0]&&!t(e.relatedTarget).parents(h.container).length&&(u.isDragging=!1,d.removeClass(p.dragover));});}),this.uploader.bind("FilesAdded",function(e){d.removeClass(p.dragover);if(!c.multiSelection)while(e.files.length>1){e.removeFile(e.files[0]);}if(r.is(c.onFilesAdded).fn()&&c.onFilesAdded(e)===!1)return!1;d.addClass(p.fileAdded),u.uploader.start();}),this.uploader.bind("BeforeUpload",function(e){d.removeClass(p.fileLoaded).removeClass(p.errorLoading),u.$blockImage.html("");if(r.is(c.onBeforeLoad).fn()&&c.onBeforeLoad(e)===!1)return!1;u.state="loading",u.render(u.state,{Percent:0,Filename:e.files[0].name});}),this.uploader.bind("UploadProgress",function(e,t){u.state==="loading"&&(t.percent==100&&(u.state="processing"),u.render(u.state,{Percent:t.percent,Filename:e.files[0].name}));}),this.uploader.bind("FileUploaded",function(e,t,n){n.responseHeaders.indexOf("X-Unauthorized: True")!==-1&&window.location.reload();var r=JSON.parse(n.response);!r.Errors&&r.length?(u.$blockProcess.html(""),u.renderImage(r[0].ImageUrl),u.runCallback("onAfterLoad",r)):u.runErrorState(r.Errors);}),this.uploader.bind("Error",function(e,t){if(t.code==-602)return;var n=t.message;t.code==-600&&(n="   "+c.maxFileSize),u.runErrorState([{errorText:n}]);});},render:function render(e,n){var r=t.extend({state:e},n||{});this.$blockProcess.html(l.states(r));},runCallback:function runCallback(e,t){r.is(c[e]).fn()&&c[e](t);},runErrorState:function runErrorState(e){this.state="error",this.render(this.state,e),d.removeClass(p.fileAdded).removeClass(p.fileLoaded).addClass(p.errorLoading),this.runCallback("onError");},renderImage:function renderImage(e){d.addClass(p.fileAdded).addClass(p.fileLoaded),s(this.$blockImage,{src:e,onRemove:function onRemove(){d.removeClass(p.fileAdded).removeClass(p.fileLoaded);while(u.uploader.files.length){u.uploader.removeFile(u.uploader.files[0]);}u.runCallback("onRemove");}});},updateImage:function updateImage(e){this.renderImage(e);}}),this.initialize(),{update:function update(e){e&&u.updateImage(e);}};};return function(e,t){if(e&&e.length&&t)return new o(e,t);};}),define("emergency.addoredit.messageTemplate",["require","jquery","tools","utilities.debounce","backbone","templates.storage","emergency.addoredit.messageTemplate.model","colorGroup","imageLoader"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("utilities.debounce"),i=e("backbone"),s=e("templates.storage"),o=e("emergency.addoredit.messageTemplate.model"),u=e("colorGroup"),a=e("imageLoader"),f=window.langResource,l="#template_emergency_message_template",c="#template_emergency_message_template_resilt",h={result:"div.js-template-result",textField:"input.js-text-field",checkbox:"input.js-checkbox",radio:"input.js-radio",bgStyle:"input.js-bg-style",colorGroup:"div.js-color-group",imageContainer:"div.js-image-container",image:"div.js-image",imageBrowse:".js-image-browse",buttonRemove:"a.js-template-remove"},p={hidden:"is-hidden",error:"error"},d=["#061F7B","#FFC500","#8A0101","#FD0404","#000"],v=[{Bg:"#4C6FF3",Text:"#fff"},{Bg:"#FFF88C",Text:"#000"},{Bg:"#C20202",Text:"#fff"},{Bg:"#8A0101",Text:"#fff"},{Bg:"#5C5C5D",Text:"#fff"}],m={Bg:"#ffc500",Text:"#000"};return i.View.extend({template:s.get(l),templateResult:s.get(c),initialize:function initialize(e){var t=this;this.model=new o(e||{}),this.model.on("change:Caption change:CornerCaption change:BgStyle change:Color change:ImageId",function(){t.renderResult();}).on("destroy",function(){t.destroy();}),this.render(),this.initControls();},render:function render(){this.$el=t(this.template(this.model.toJSON())),this.renderResult();},renderResult:function renderResult(){this.$result||(this.$result=this.$el.find(h.result));var e=this.model.toJSON();e.BgStyle==="color"?(e.BgColor=d[e.Color-1],e.CornerColor=v[e.Color-1]):e.CornerColor=m,this.$result.html(this.templateResult(e));},initControls:function initControls(){this.initTextFields(),this.initCheckboxes(),this.initRadioGroups(),this.initBgStyle(),this.initBgColor(),this.initBgImage(),this.initButtonRemove();},getFieldName:function getFieldName(e){return e.split("_")[0];},initTextFields:function initTextFields(){var e=this,n=this.$el.find(h.textField);n.each(function(){var n=this;t(n).on("keydown",r(function(){e.model.set(e.getFieldName(n.name),n.value);},500)).on("blur",function(){t(this).removeClass(p.error);});}),this.model.on("showErrors",function(){n.each(function(){var n=e.getFieldName(this.name);(n==="Name"||n==="Caption"||n==="CornerCaption")&&e.showFieldError(t(this));});});},showFieldError:function showFieldError(e){t.trim(e.val())||e.addClass(p.error);},initCheckboxes:function initCheckboxes(){var e=this;this.$el.find(h.checkbox).designForms().change(function(){e.model.set(e.getFieldName(this.name),t(this).is(":checked"));});},initRadioGroups:function initRadioGroups(){var e=this,t=this.$el.find(h.radio);t.designForms().change(function(){e.model.set(e.getFieldName(this.name),this.value);});},initBgStyle:function initBgStyle(){var e=this;this.$el.find(h.bgStyle).change(function(){e.model.set("BgStyle",this.value);});},initBgColor:function initBgColor(){var e=this,t=[],r=this.$el.find(h.colorGroup);n.list(d).each(function(e,n){t.push({Name:n+1,Color:e});}),new u(r,{colors:t,selected:this.model.get("Color"),onChange:function onChange(t){e.model.set("Color",t);}}),this.showHideBlock(r,this.model.get("BgStyle")==="color"),this.model.on("change:BgStyle",function(t,n){e.showHideBlock(r,n==="color");});},initBgImage:function initBgImage(){var e=this,t=this.$el.find(h.imageContainer),r=a(t,{textNormal:f.imageLoader.textNormal,textDrag:f.imageLoader.textDrop,textBrowse:f.imageLoader.buttonBrowse,mimeTypes:[{title:"Image files",extensions:"jpg,jpeg,png"}],onAfterLoad:function onAfterLoad(t){e.model.set(t[0]);},onBeforeLoad:function onBeforeLoad(){e.removeImage();},onRemove:function onRemove(){e.removeImage();}}),i=this.model.get("ImageUrl");n.is(i).defined()&&i!==null&&r.update(i),this.showHideBlock(t,this.model.get("BgStyle")==="image"),this.model.on("change:BgStyle",function(n,r){e.showHideBlock(t,r==="image");});},removeImage:function removeImage(){this.model.set({ImageId:null,ImageUrl:null});},initButtonRemove:function initButtonRemove(){var e=this.model;this.$el.find(h.buttonRemove).click(function(){e.destroy();});},showHideBlock:function showHideBlock(e,t){e[t?"removeClass":"addClass"](p.hidden);},destroy:function destroy(){this.$el.remove();}});}),define("emergency.addoredit.messageTemplate.collection",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Collection.extend({clear:function clear(){for(var e=this.models.length-1;e>=0;e--){this.at(e).destroy();}},getValidData:function getValidData(){var e=this.filter(function(e){var t=e.isFieldValid("Name")&&e.isFieldValid("Caption")&&e.isFieldValid("CornerCaption");return e.get("BgStyle")==="image"&&e.get("ImageId")===null&&(t=!1),t;});return this.length===e.length?e.map(function(e){return e.getData();}):[];}});}),define("emergency.addoredit.form.messageTemplates",["require","tools","emergency.addoredit.messageTemplate","emergency.addoredit.messageTemplate.collection"],function(e){"use strict";var t=e("tools"),n=e("emergency.addoredit.messageTemplate"),r=e("emergency.addoredit.messageTemplate.collection"),i="div.js-emergency-add-template",s={errorMessage:"error-message",hidden:"is-hidden"},o={empty:"      ",wrong:"    "},u=4,a=function a(e,_a2,f){var l=this,c=new r(),h=e.find(i);c.on("add remove change",function(){_a2.set("MessageTemplates",c.getValidData());}),h.removeClass(s.hidden).click(function(){l.addTemplate();}),$.extend(this,{initialize:function initialize(){this.initErrorMessage(),this.addExistTemplates(),this.setEvents();},initErrorMessage:function initErrorMessage(){var e=$("<p>",{"class":s.errorMessage+" "+s.hidden});h.before(e),_a2.on("showErrors",function(t){c.length?c.length!==c.getValidData().length&&(e.text(o.wrong).removeClass(s.hidden),c.each(function(e){e.trigger("showErrors");})):e.text(o.empty).removeClass(s.hidden);}),c.on("add remove change",function(){e.addClass(s.hidden);});},addExistTemplates:function addExistTemplates(){var e=_a2.get("MessageTemplates");e.length?t.list(e).each(function(e){l.addTemplate(e);}):this.addDefaultTemplates(_a2.get("CabinetType"));},setEvents:function setEvents(){_a2.on("change:CabinetType",function(e,t){c.clear(),l.addDefaultTemplates(t);});},addTemplate:function addTemplate(e){var t=$.extend({IsAnotherCabinet:_a2.get("CabinetType")==u},e),r=new n(t);h.before(r.$el),c.add(r.model);},addDefaultTemplates:function addDefaultTemplates(e){f[e]&&t.list(f[e]).each(function(e){l.addTemplate(e);});}}),this.initialize();};return function(e,t,n){e&&e.length&&t&&n&&new a(e,t,n);};}),define("emergency.addoredit.form",["require","jquery","urls","tools","backbone","templates.storage","tooltipConfirm","emergency.addoredit.form.model","emergency.addoredit.form.types","emergency.addoredit.form.name","emergency.addoredit.form.partners","emergency.addoredit.form.doubleAuth","emergency.addoredit.form.staff","emergency.addoredit.form.mapSettings","emergency.addoredit.form.messageTemplates"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("backbone"),s=e("templates.storage"),o=e("tooltipConfirm"),u=e("emergency.addoredit.form.model"),a=e("emergency.addoredit.form.types"),f=e("emergency.addoredit.form.name"),l=e("emergency.addoredit.form.partners"),c=e("emergency.addoredit.form.doubleAuth"),h=e("emergency.addoredit.form.staff"),p=e("emergency.addoredit.form.mapSettings"),d=e("emergency.addoredit.form.messageTemplates"),v=window.langResource,m="#formAddEditEmergency",g="/Emergency/List",y={buttonSave:"a.js-emergency-save",buttonRemove:"a.js-emergency-remove"},b={hidden:"is-hidden",disabled:"is-disabled"},w=t("html,body"),E=i.View.extend({initialize:function initialize(){var e=window.formData;this.model=new u(e.EmergencyForm),a(this.$el,this.model,e.CabinetTypes),f(this.$el,this.model),l(this.$el,this.model,e.Partners),c(this.$el,this.model),h(this.$el,this.model),p(this.$el,this.model),d(this.$el,this.model,e.StandardTemplates),this.initButtonSave(),this.initButtonRemove();},initButtonSave:function initButtonSave(){var e=this,i=this.model,s=this.$el.find(y.buttonSave);s[i.isValid()?"removeClass":"addClass"](b.disabled),i.on("change",function(){s[i.isValid()?"removeClass":"addClass"](b.disabled);}),s.click(function(){return e.isSaving||(i.isValid()?(e.isSaving=!0,s.addClass(b.disabled),t.post(n.get("emergencyAddOrEdit"),i.getData()).done(function(){window.location.href=g;}).fail(function(t){e.isSaving=!1,s.removeClass(b.disabled);var n=t.responseText?JSON.parse(t.responseText):null;if(n){var i=[];r.object(n).each(function(e,t){i.push({Index:e.match(/[0-9]/i)[0],Name:e.match(/^(\w*)\[/i)[1],Field:e.match(/\]\.(\S*)/i)[1],Message:t});}),e.showErrors(i),e.scrollToFirstError();}})):(e.showErrors(),e.scrollToFirstError())),!1;});},showErrors:function showErrors(e){this.model.trigger("showErrors",e);},scrollToFirstError:function scrollToFirstError(){var e=this.$el.find(".error-message:not(."+b.hidden+")").eq(0);e.length&&w.animate({scrollTop:e.offset().top-50},250);},initButtonRemove:function initButtonRemove(){var e=this,i=this.model.get("EmergencyId");if(!r.is(i).defined())return;var s=this.$el.find(y.buttonRemove),u=o(s,{headerText:v.emergency.tooltipConfirmRemoveHeading,contentText:v.emergency.tooltipConfirmRemoveText,buttonApplyText:v.emergency.tooltipConfirmRemoveButtonApply,buttonCancelText:v.emergency.tooltipConfirmRemoveButtonCancel,onApply:function onApply(){e.isRemoving=!0,s.addClass(b.disabled),t.post(n.get("emergencyRemove"),{EmergencyId:i}).done(function(){window.location.href=g;}).fail(function(){e.isRemoving=!1,s.removeClass(b.disabled);});}});s.removeClass(b.hidden).click(function(){return e.isRemoving||u.show(),!1;});}});return function(){window.formData&&new E({el:m});};}),define("emergency.addoredit.action",["require","base","emergency.addoredit.form"],function(e){"use strict";var t=e("base"),n=e("emergency.addoredit.form");return new t.Action({initialize:function initialize(){new n();}});}),define("emergency.messagelist.list.message",["require","jquery","backbone","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=e("templates.storage"),i="#template_emergency_message",s="/Emergency/MessageDetails";return n.View.extend({template:r.get(i),initialize:function initialize(e){var t=this;this.model.on("destroy",function(){t.destroy();}),this.render(e),this.initControls();},render:function render(){this.$el=t(this.template(this.model.toJSON()));},initControls:function initControls(){this.$el.click(function(){window.location.href=s+"/"+t(this).data("id");});},destroy:function destroy(){this.$el.remove();}});}),define("emergency.messagelist.list.collection",["require","urls","tools","backbone"],function(e){"use strict";var t=e("urls"),n=e("tools"),r=e("backbone");return r.Collection.extend({url:t.get("emergencyMessagesList"),dateFormat:"d M yy",clear:function clear(){for(var e=this.models.length-1;e>=0;e--){this.at(e).destroy();}},parse:function parse(e){var t=this;return n.list(e).each(function(e){e.StartDateText=t.convertDate(e.StartDate),e.FinishDateText=t.convertDate(e.FinishDate);}),e;},convertDate:function convertDate(e){return n.date(e).chain().parse("dd.mm.yy").format(this.dateFormat).value();}});}),define("emergency.messagelist.list",["require","jquery","urls","tools","backbone","templates.storage","emergency.messagelist.list.message","emergency.messagelist.list.collection"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("backbone"),s=e("templates.storage"),o=e("emergency.messagelist.list.message"),u=e("emergency.messagelist.list.collection"),a=window.langResource,f=function f(e,n){var i=this,f={body:"tbody"},l="#template_emergency_messages_empty",c=function c(){alert(a.requestError);};return t.extend(this,{initialize:function initialize(){this.$body=e.find(f.body),this.collection=new u(),this.collection.on("sync",function(){i[i.collection.length?"renderList":"renderEmpty"]();}).on("error",c),this.update(n);},update:function update(e){this.collection.length?this.collection.clear():this.$body.html(""),this.collection.fetch({data:e});},renderList:function renderList(e){r.list(this.collection.models).each(function(e){var t=new o({model:e});i.$body.append(t.$el);});},renderEmpty:function renderEmpty(){this.templateEmpty||(this.templateEmpty=s.get(l)),this.$body.append(this.templateEmpty());}}),this.initialize(),{update:this.update.bind(this)};};return function(e,t){if(e&&e.length)return new f(e,t);};}),define("emergency.messagelist.filter.types",["require","jquery","tools","events","jquery.designDropdowns"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events");e("jquery.designDropdowns");var i=window.langResource,s=function s(e,r){var s=this,o={hidden:"is-hidden"};t.extend(this,{initialize:function initialize(){this.render();},render:function render(){this.$dropdown=t("<select>").append('<option value="">'+i.emergency.messagesListAllTypes+"</option>"),e.append(this.$dropdown).removeClass(o.hidden),this.$dropdown.chosen(),n.list(r.typesList).each(function(e){s.$dropdown.append(s.renderOption(e));}),this.$dropdown.trigger("chosen:updated").change(function(){s.runCallback("onChange",this.value);});},renderOption:function renderOption(e){return'<option value="'+e.Id+'">'+e.Name+"</option>";},runCallback:function runCallback(e,t){typeof r[e]=="function"&&r[e](t);}}),this.initialize();};return function(e,t){e&&e.length&&t&&t.typesList&&new s(e,t);};}),define("rangeDatePicker",["require","jquery","tools","templates.storage","dates.adapter","jqueryUI.DatePicker"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("templates.storage"),i=e("dates.adapter"),s=window.langResource;return e("jqueryUI.DatePicker"),new function(){var e=this,o={templateId:"#template_rangeDatePicker",calendarEl:"div.rd__calendar",dateStartEl:"input.rd__date-start",dateEndEl:"input.rd__date-end",classHighlighted:"ui-state-highlighted",dateFormatForServer:i.getFormat(),minDate:null,showButtonDay:!0,showButtonWeek:!0,buttonSelectText:s.datePicker.buttonSelectText,changeMonth:!1,changeYear:!1,showOtherMonths:!0,selectOtherMonths:!0};return t.extend(this,{initialize:function initialize(){this.$bufferInput=t("<input/>").datepicker({dateFormat:o.dateFormatForServer});},show:function show(e){if(this.shown){this.hide();return;}if(!e.$target||!e.$target.length)return;e.minDate&&(this.$calendar?this.$calendar.datepicker("option","minDate",e.minDate):o.minDate=e.minDate),this.$target=e.$target,this.resultDatesFormat=e.resultDatesFormat||o.dateFormatForServer,this.callbacks={onSelect:e.onSelect||""},this.isCreated||(this.isCreated=!0,this.render(),this.setContents(),this.setEvents(),this.initDatePicker()),this.updateDatePicker(e.dateStart,e.dateEnd),this.checkButtonChange(),this.setPosition(),this.shown=!0;},hide:function hide(){this.$container.css({top:"-9999em",left:0}),this.shown=!1;},setPosition:function setPosition(){this.$container.css({left:this.$target.offset().left+this.$target.innerWidth()/2-this.$container.width()/2,top:this.$target.offset().top+this.$target.height()});},render:function render(){this.template=r.get(o.templateId),this.$container=t(this.template({ShowButtonDay:o.showButtonDay,ShowButtonWeek:o.showButtonWeek,ButtonSelectText:o.buttonSelectText})),t(document.body).append(this.$container);},setContents:function setContents(){this.$dateStart=this.$container.find(o.dateStartEl),this.$dateEnd=this.$container.find(o.dateEndEl),this.$calendar=this.$container.find(o.calendarEl);},setEvents:function setEvents(){this.$container.click(function(e){return e.stopPropagation(),!1;}),t(document).on("click.rangeCalendar",function(n){var r=t(n.target);e.shown&&!r.parents("."+e.$target[0].className).length&&e.$target[0]!=n.target&&e.hide();});},initDatePicker:function initDatePicker(){var n,r,s;this.$calendar.datepicker({changeMonth:o.changeMonth,changeYear:o.changeYear,showOtherMonths:o.showOtherMonths,selectOtherMonths:o.selectOtherMonths,dateFormat:o.dateFormatForServer,minDate:o.minDate,numberOfMonths:[1,1],beforeShowDay:function beforeShowDay(t){return n=i.getDate(e.$dateStart.val()),r=i.getDate(e.$dateEnd.val()),[!0,n&&(t.getTime()==n.getTime()||r&&t>=n&&t<=r)?o.classHighlighted:""];},onSelect:function onSelect(o){n=i.getDate(e.$dateStart.val()),r=i.getDate(e.$dateEnd.val()),s=i.getDate(o),!n||r?(e.$dateStart.val(o),e.$dateEnd.val(""),t(this).datepicker()):s<n?(e.$dateEnd.val(e.$dateStart.val()),e.$dateStart.val(o),t(this).datepicker()):(e.$dateEnd.val(o),t(this).datepicker()),e.checkButtonChange();}});var u=this.$container.find("input:button");this.$buttonChange=u.filter("[data-action=selectCompleted]"),u.click(function(){if(!t(this).is(":disabled")){var n=t(this).data("action");typeof e.actions[n]=="function"&&e.actions[n]();}return!1;});},updateDatePicker:function updateDatePicker(e,t){e&&(this.$calendar.datepicker("setDate",e),this.$dateStart.val(e)),t&&this.$dateEnd.val(t),this.isCreated&&(e||t)&&this.$calendar.datepicker("refresh");},checkButtonChange:function checkButtonChange(){this.$dateStart.val()&&this.$dateEnd.val()?this.$buttonChange.prop("disabled",!1):this.$buttonChange.prop("disabled",!0);},getDateOffset:function getDateOffset(e){return this.$bufferInput.datepicker("setDate",e).val();},actions:{selectDay:function selectDay(){var t=e.$dateStart.val(),n=t?t:e.getDateOffset("+1d");e.updateDatePicker(n,n),e.checkButtonChange();},selectWeek:function selectWeek(){var t=e.$dateStart.val(),n=new Date(t),r=t?t:e.getDateOffset("+1d"),i=t?e.getDateOffset(new Date(n.setDate(n.getDate()+6))):e.getDateOffset("+7d");e.updateDatePicker(r,i),e.checkButtonChange();},selectCompleted:function selectCompleted(){var t=e.$dateStart.val(),n=e.$dateEnd.val();e.runCallback("onSelect",[t,n,e.getRangeString(t,n,e.resultDatesFormat)]),e.hide();}},getFormattedDate:function getFormattedDate(e,t){return n.date(e).chain().parse(o.dateFormatForServer).format(t).value();},getRangeString:function getRangeString(t,n,r){return e.getFormattedDate(t,r)+"&ndash;"+e.getFormattedDate(n,r);},runCallback:function runCallback(t,n){typeof this.callbacks[t]=="function"&&this.callbacks[t].apply(e,n);}}),this.initialize(),{show:function show(t){e.show(t||{});},getFormattedDate:function getFormattedDate(t,n){return e.getFormattedDate(t,n);},getDateOffset:function getDateOffset(t){return e.getDateOffset(t);},getRangeString:function getRangeString(t,n,r){return e.getRangeString(t,n,r);}};}();}),define("emergency.messagelist.filter.dates",["require","jquery","tools","dates.adapter","rangeDatePicker"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("dates.adapter"),i=e("rangeDatePicker"),s="dd M yy",o={field:".js-filter-field",icon:".js-filter-icon"},u={hidden:"is-hidden"},a=function a(e,_a3){var f=this,l=_a3.dateFormat?_a3.dateFormat:s,c=r.getFormat(),h=t("<input/>").datepicker({dateFormat:c}),p=new Date(),d=n.date(h.datepicker("setDate","-14d").val()).parse(c);t.extend(this,{initialize:function initialize(){this.$field=e.find(o.field);if(!this.$field.length)return;e.removeClass(u.hidden),this.setDefaultDates(),this.initDatesTooltip(),this.initFilterIcon(),this.runCallback(d,p);},setDefaultDates:function setDefaultDates(){this.setFieldDatesText(n.date(d).format(l),n.date(p).format(l));},initDatesTooltip:function initDatesTooltip(){this.$field.on("focus",function(){i.show({$target:e,resultDatesFormat:l,dateStart:f.isRendered?undefined:f.createComponentDate(d),dateEnd:f.isRendered?undefined:f.createComponentDate(p),onSelect:function onSelect(e,t,r){var i=r.split("&ndash;");f.setFieldDatesText(i[0],i[1]),f.runCallback(n.date(i[0]).parse(l),n.date(i[1]).parse(l));}}),f.isRendered=!0;});},setFieldDatesText:function setFieldDatesText(e,t){var n;e===t?n=e:n=e+"  "+t,this.$field.val(n);},createComponentDate:function createComponentDate(e){return h.datepicker("setDate",e).val();},initFilterIcon:function initFilterIcon(){e.find(o.icon).click(function(){f.$field.focus();});},runCallback:function runCallback(e,t){typeof _a3.onChange=="function"&&_a3.onChange(n.date(e).format(c),n.date(t).format(c));}}),this.initialize();};return function(e,t){e&&e.length&&new a(e,t);};}),define("emergency.monitors.map",["require","jquery","underscore","backbone","urls","tools","events","googleMaps.markerIcons","googleMaps.clustering.online.styles","googleMaps","googleMaps.markerClusterer"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("urls"),s=e("tools"),o=e("events"),u=e("googleMaps.markerIcons"),a=e("googleMaps.clustering.online.styles"),f=n.template('<div class="emergency-map-overlay" />'),l=n.template('<div class="emergency-map"><div class="emergency-map__button-close"><a class="button js-button-close" href="#" onClick="return false">   </a></div><div class="js-map"><i class="loading"></i></div></div>'),c=window.langResource,h=t("body"),p=14,d=12,v=1e4,m=function m(n){var r=this,o={map:"js-map",buttonClose:"js-button-close",hidden:"is-hidden"};t.extend(this,{initialize:function initialize(){this.initMap(),this.initLink();},initMap:function initMap(){this.$overlay=t(f()).addClass(o.hidden),h.append(this.$overlay),this.$mapContainer=t(l()).addClass(o.hidden),h.append(this.$mapContainer),this.$mapContainer.find("."+o.buttonClose).click(function(){r.hideMap();}),this.$map=this.$mapContainer.find("."+o.map),this.isMapVisible=!1;},initLink:function initLink(){n.click(function(){return r.showMap(),!1;}).removeClass(o.hidden);},showMap:function showMap(){this.isMapVisible||(this.isMapVisible=!0,this.$overlay.removeClass(o.hidden),this.$mapContainer.removeClass(o.hidden),this.isMapInitialized?this.load():e("googleMaps")(function(t){e("googleMaps.markerClusterer"),r.isMapInitialized=!0,r.maps=t,r.load();}));},hideMap:function hideMap(){this.isMapVisible&&(this.stopTimer(),this.isMapVisible=!1,this.$overlay.addClass(o.hidden),this.$mapContainer.addClass(o.hidden));},load:function load(){t.get(i.get("monitorsListForEmergency")).done(function(e){r.isMapInitialized&&!r.map&&r.renderMap(e.MapLatitude,e.MapLongitude,e.MapScale),r.map&&r.renderMarkers(e.MonitorsList),r.startTimer();}).fail(function(){throw new Error("Emergency monitors not loaded!!!");});},renderMap:function renderMap(e,t,n){this.map=this.maps.render({$container:this.$map,center:{lat:e,lng:t},zoom:n,onChangeScale:function onChangeScale(e){r.stopTimer(),r.updateMarkers(),r.startTimer();}});},createMarker:function createMarker(e){var t=new this.maps.googleMaps.LatLng(e.LastLatitude,e.LastLongitude),n=this.getMapkerIcon(e);return new this.maps.googleMaps.Marker({position:t,map:this.map,icon:n,zIndex:Math.round(t.lat()*-1e5)<<5});},getMapkerIcon:function getMapkerIcon(e){var t=this.map.getZoom()<=p,n=t?!1:this.hasMarkerVector(e),r=t?"circleGreen6":"circleGreen13";n&&(r+="Vectored");var i=u(r);return n&&(i.rotation=this.getMarkerAngle(e.LastLongitude,e.LastLatitude,e.PreLastLongitude,e.PreLastLatitude)+i.iconAngle),i;},hasMarkerVector:function hasMarkerVector(e){var t=e.LastLatitude,n=e.LastLongitude,r=e.PreLastLatitude,i=e.PreLastLongitude;return t&&n&&r&&i&&(t!==r||n!==i);},getMarkerAngle:function getMarkerAngle(e,t,n,r){if(e===n)return r>t?180:0;if(t===r)return n>e?-90:90;var i=Math.PI,s=0,o=n<e,u=r<t,a=Math.atan((r-t)/(n-e));return o&&u||o?s=90-a*180/i:s=270-a*180/i,s;},renderMarkers:function renderMarkers(e){var t=[];this.monitorsList=e,s.list(e).each(function(e){t.push(r.createMarker(e));}),this.markerClusterer?(this.markerClusterer.clearMarkers(),this.markerClusterer.addMarkers(t)):this.markerClusterer=new MarkerClusterer(this.map,t,{gridSize:30,maxZoom:d,styles:a});},updateMarkers:function updateMarkers(){this.renderMarkers(this.monitorsList);},startTimer:function startTimer(){this.timer=setTimeout(function(){r.isMapVisible&&r.load();},v);},stopTimer:function stopTimer(){this.timer&&(this.timer=clearTimeout(this.timer));}}),this.initialize();};return function(e){e&&e.length&&new m(e);};}),define("emergency.messagelist.action",["require","base","jquery","backbone","emergency.messagelist.list","emergency.messagelist.filter.types","emergency.messagelist.filter.dates","emergency.monitors.map"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("backbone"),i=e("emergency.messagelist.list"),s=e("emergency.messagelist.filter.types"),o=e("emergency.messagelist.filter.dates"),u=e("emergency.monitors.map"),a={list:"#messagesList",filterDates:"#filterDates",filterTypes:"#filterTypes"},f="dd M yy";return new t.Action({initialize:function initialize(){var e=this;this.model=new r.Model(),this.model.on("change",function(){e.renderList();}),this.initFilterTypes(),this.initFilterDates(),this.initMonitorsMap();},initFilterTypes:function initFilterTypes(){var e=this.model;new s(n(a.filterTypes),{typesList:window.dataTypesList,onChange:function onChange(t){e.set("TemplateId",t);}});},initFilterDates:function initFilterDates(){var e=this.model;new o(n(a.filterDates),{dateFormat:f,onChange:function onChange(t,n){e.set({DateStart:t,DateEnd:n});}});},renderList:function renderList(){this.list?this.list.update(this.model.toJSON()):this.list=new i(n(a.list),this.model.toJSON());},initMonitorsMap:function initMonitorsMap(){new u(n("#monitorsMap"));}});}),define("emergency.newmessage.form.model",["require","tools","backbone"],function(e){"use strict";var t=e("tools"),n=e("backbone");return n.Model.extend({defaults:{Text:"",MessageType:1,IsBlackText:!0,BgStyle:"color",ImageId:null,ImageUrl:null,IsShowCorner:!0,CornerColor:2,MapType:"circle",GpsAreas:[],GpsPolygonAreas:[],AudioId:null,AudioUrl:null,AudioDuration:null},initialize:function initialize(){var e=this,t=this.get("TemplateId");t||this.set("TemplateId",this.get("DefaultTemplates")[0].Id),this.setTemplateParams(),this.on("change:TemplateId",function(t,n){e.setTemplateParams();});},setTemplateParams:function setTemplateParams(){var e={},n=this.get("TemplateId");t.list(this.get("DefaultTemplates")).each(function(t){if(t.Id==n)return e=t,!1;}),this.set({TemplateParams:e},{silent:!0});},isValid:function isValid(){var e=this.toJSON();if(e.AudioDuration){var _n5=window.formData.Templates.find(function(t){if(t.Id==e.TemplateId)return t;});if(_n5.DurationOfVideo<e.AudioDuration)return this.set("IsAudioDurationFine",!1),!1;this.set("IsAudioDurationFine",!0);}if(t.string(e.Text).trim().length===0)return!1;if(e.IsAnotherCabinet)if(e.BgStyle==="color"){if(!t.is(e.Color).defined())return!1;}else if(!t.is(e.ImageId).defined())return!1;if(e.MessageType==2)if(e.MapType==="circle"){if(e.GpsAreas.length===0)return!1;}else if(e.GpsPolygonAreas.length===0)return!1;return!0;},canAddPhoto:function canAddPhoto(){return this.get("TemplateParams").IsCanAddImage;},getData:function getData(){var e=this.toJSON();return e.IsAnotherCabinet?this.deleteParams(e,e.BgStyle==="color"?["ImageId","ImageUrl"]:["Color"]):(this.deleteParams(e,["IsBlackText","IsShowCorner","CornerColor"]),this.canAddPhoto()||this.deleteParams(e,["ImageId","ImageUrl"])),e.MessageType==1?this.deleteParams(e,["GpsAreas","GpsPolygonAreas"]):delete e[e.MapType==="circle"?"GpsPolygonAreas":"GpsAreas"],this.deleteParams(e,["Cities","DefaultTemplates","IsAnotherCabinet","Images","TemplateParams","BgStyle","MapType"]),this.deleteEmptyParams(e),e;},deleteParams:function deleteParams(e,n){t.is(n).array()&&t.list(n).each(function(t){delete e[t];});},deleteEmptyParams:function deleteEmptyParams(e){t.is(e).object()&&t.object(e).each(function(n,r){t.is(r).array()?e[n].length||delete e[n]:r===null&&delete e[n];});}});}),define("form.helpers",[],function(){"use strict";var e={hidden:"is-hidden",disabled:"is-disabled"};return{showHideBlock:function showHideBlock(t,n){t[n?"removeClass":"addClass"](e.hidden);},enableDisableEl:function enableDisableEl(t,n){t[n?"addClass":"removeClass"](e.disabled);},selectRadioByValue:function selectRadioByValue(e,t){e.filter("[value="+t+"]").prop("checked",!0).change();}};}),define("emergency.newmessage.form.templates",["require","templates.storage","jquery.designDropdowns"],function(e){"use strict";var t=e("templates.storage");e("jquery.designDropdowns");var n="div.js-message-templates",r="#template_emergency_new_message_types";return function(e,i){if(!e||!e.length||!i)return;var s=t.get(r);e.find(n).append(s({Selected:i.get("TemplateId"),MessageTemplates:i.get("DefaultTemplates")})).find("select").chosen().change(function(){i.set("TemplateId",this.value);});};}),define("emergency.newmessage.form.text",["require"],function(e){"use strict";var t={field:"textarea.js-message-text",textLength:"span.js-message-text-length"},n=350;return function(e,r){function s(){var e=String(r.get("Text"));i.text((e?e.length:0)+"/"+n);}if(!e||!e.length||!r)return;e.find(t.field).attr("maxlength",n).val(r.get("Text")||"").on("keydown change cut copy paste",function(){var e=this;setTimeout(function(){r.set("Text",e.value);},10);});var i=e.find(t.textLength);s(),r.on("change:Text",function(){s();});};}),define("emergency.newmessage.form.photoContainer",["require","form.helpers"],function(e){"use strict";var t=e("form.helpers"),n="div.js-photo-container";return function(e,r){if(!e||!e.length||!r)return;var i=e.find(n);t.showHideBlock(i,r.canAddPhoto()),r.on("change:TemplateId",function(){t.showHideBlock(i,r.canAddPhoto());});};}),define("imagesGroup.view",["require","jquery","tools","backbone","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("backbone"),i=e("templates.storage"),s="#template_images_group_view";return r.View.extend({template:i.get(s),initialize:function initialize(e){this.$el=t(this.template(t.extend({templateIndex:n.random().number()},e)));}});}),define("imagesGroup",["require","jquery","tools","imagesGroup.view"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("imagesGroup.view"),i=function i(e,_i7){var s=this,o={main:"images-group"};return t.extend(this,{initialize:function initialize(){e.addClass(o.main),this.add(_i7.list);},add:function add(s){if(s&&s.length){var o=e.find("div:first");n.list(s).each(function(t,s){t.Name=_i7.name,t.IsSelected=n.is(_i7.selected).defined()&&_i7.selected==s;var u=new r(t);o.length?o.before(u.$el):e.append(u.$el);}),e.find("input:radio").off("change").on("change",function(){typeof _i7.onChange=="function"&&_i7.onChange({ImageId:this.value,ImageUrl:t(this).data("image-url")});});}},unselect:function unselect(){e.find("input:radio").prop("checked",!1);}}),this.initialize(),{add:function add(e){s.add(e);},unselect:function unselect(){s.unselect();}};};return function(e,t){if(e&&e.length&&t)return new i(e,t);};}),define("emergency.newmessage.form.photoLoader",["require","form.helpers","imageLoader","imagesGroup"],function(e){"use strict";var t=e("form.helpers"),n=e("imageLoader"),r=e("imagesGroup"),i={photo:"div.js-photo",photoLoader:"div.js-photo-loader",photoGroup:"div.js-photo-group"};return function(e,t){function o(){t.set({ImageId:null,ImageUrl:null});}function u(){s&&s.unselect();}if(!e||!e.length||!t)return;var s,a=n(e.find(i.photoLoader),{textNormal:"   <br> ",textDrag:"    ",textBrowse:"  ...",mimeTypes:[{title:"Image files",extensions:"jpg,jpeg,png"},{title:"Doc files",extensions:"doc,docx"}],onAfterLoad:function onAfterLoad(n){t.set(n[0]),n.length&&n.length>1&&(s?s.add(n):s=r(e.find(i.photoGroup),{name:"messagePhoto",list:n,selected:0,onChange:function onChange(e){t.set(e),a.update(e.ImageUrl);}}));},onBeforeLoad:function onBeforeLoad(){o();},onRemove:function onRemove(){o(),u();}}),f=t.get("ImageUrl");f&&a.update(f);};}),define("emergency.newmessage.form.bgStyle",["require","form.helpers"],function(e){"use strict";var t=e("form.helpers"),n={field:".js-bg-style",container:".js-bg-style-container"},r="is-hidden";return function(e,i){function o(e,n){i.set({BgStyle:e===null?"color":"image"},{silent:n===!0}),t.selectRadioByValue(s,i.get("BgStyle"));}if(!e||!e.length||!i)return;var s=e.find(n.field),u;window.formData.Form?u=i.get("ImageUrl"):u=i.get("TemplateParams").ImageUrl||null,o(u,!0),e.find(n.container).removeClass(r),s.change(function(){i.set("BgStyle",this.value);}),i.on("change:TemplateId",function(){o(i.get("TemplateParams").ImageUrl);});};}),define("emergency.newmessage.form.bgColor",["require","tools","colorGroup","form.helpers"],function(e){"use strict";var t=e("tools"),n=e("colorGroup"),r=e("form.helpers"),i=".js-bg-color-group",s=["#061F7B","#FFC500","#8A0101","#FD0404","#000"],o=2;return function(e,u){function c(e,n){u.set({Color:t.is(e).defined()&&e!==null?e:o},{silent:n}),f&&f.selectColor(u.get("Color"));}if(!e||!e.length||!u)return;var a=[],f,l=e.find(i);r.showHideBlock(l,u.get("BgStyle")==="color"),u.on("change:BgStyle",function(e,t){r.showHideBlock(l,t==="color");}),t.list(s).each(function(e,t){a.push({Name:t+1,Color:e});}),c(u.get("Color")||u.get("TemplateParams").Color,!0),f=new n(l,{colors:a,selected:u.get("Color"),onChange:function onChange(e){u.set("Color",e);}}),u.on("change:TemplateId",function(){c(u.get("TemplateParams").Color);});};}),define("emergency.newmessage.form.bgImage",["require","jquery","tools","form.helpers","imageLoader","imagesGroup"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("form.helpers"),i=e("imageLoader"),s=e("imagesGroup"),o={container:"div.js-image-container",loader:"div.js-image-loader",imagesGroup:"div.js-images-group"},u=function u(e,_u3){var a=this;t.extend(this,{initialize:function initialize(){this.$container=e.find(o.container),this.initBlockVisible(),this.initImageLoader(),this.initImage(),this.initImagesGroup();},initBlockVisible:function initBlockVisible(){r.showHideBlock(this.$container,_u3.get("BgStyle")==="image"),_u3.on("change:BgStyle",function(e,t){r.showHideBlock(a.$container,t==="image");});},initImageLoader:function initImageLoader(){this.image=i(this.$container.find(o.loader),{textNormal:"   <br> ",textDrag:"    ",textBrowse:"  ...",mimeTypes:[{title:"Image files",extensions:"jpg,jpeg,png"}],onAfterLoad:function onAfterLoad(e){_u3.set(e[0]);},onBeforeLoad:function onBeforeLoad(){a.removeImage();},onRemove:function onRemove(){a.removeImage(),a.unselectGroup();}});},initImage:function initImage(){var e=_u3.get("ImageId"),t=_u3.get("ImageUrl");e&&t?this.setImage(e,t,!0):this.setImage(_u3.get("TemplateParams").ImageId,_u3.get("TemplateParams").ImageUrl,!0),_u3.on("change:TemplateId",function(){a.unselectGroup(),a.setImage(_u3.get("TemplateParams").ImageId,_u3.get("TemplateParams").ImageUrl);});},initImagesGroup:function initImagesGroup(){var t=_u3.get("Images");if(!t||!t.length)return;var n=e.find(o.imagesGroup);r.showHideBlock(n,_u3.get("BgStyle")==="image"),_u3.on("change:BgStyle",function(e,t){r.showHideBlock(n,t==="image");}),this.imagesGroup=s(n,{name:"messageImages",list:t,onChange:function onChange(e){_u3.set(e),a.image.update(e.ImageUrl);}});},setImage:function setImage(e,t,r){n.is(t).defined()&&t!==null&&this.image.update(t),_u3.set({ImageId:e,ImageUrl:t},{silent:r});},removeImage:function removeImage(){_u3.set({ImageId:null,ImageUrl:null});},unselectGroup:function unselectGroup(){this.imagesGroup&&this.imagesGroup.unselect();}}),this.initialize();};return function(e,t){e&&e.length&&t&&new u(e,t);};}),define("emergency.newmessage.form.textColor",["require"],function(e){"use strict";var t="div.js-color-container",n="is-hidden";return function(e,r){if(!e||!e.length||!r)return;e.find(t).removeClass(n).find("input:radio").change(function(){r.set("IsBlackText",this.value=="true");}).eq(r.get("IsBlackText")?0:1).prop("checked",!0).trigger("design:update");};}),define("emergency.newmessage.form.cornerVisible",["require"],function(e){"use strict";var t="div.js-corner-visible",n="is-hidden";return function(e,r){if(!e||!e.length||!r)return;e.find(t).removeClass(n).find("input:checkbox").prop("checked",r.get("IsShowCorner")).change().change(function(){r.set("IsShowCorner",$(this).is(":checked"));});};}),define("emergency.newmessage.form.cornerColor",["require","tools","form.helpers","colorGroup"],function(e){"use strict";var t=e("tools"),n=e("form.helpers"),r=e("colorGroup"),i={container:"div.js-corner-color",colorGroup:"div.js-color-group"},s=["#d0021b","#ffdf33","#417505","#4a90e2","#023791"];return function(e,o){if(!e||!e.length||!o)return;var u=e.find(i.container),a=u.find(i.colorGroup),f=[];t.list(s).each(function(e,t){f.push({Name:t+1,Color:e});}),new r(a,{colors:f,selected:o.get("CornerColor"),onChange:function onChange(e){o.set("CornerColor",e);}}),o.on("change:IsShowCorner",function(){n.showHideBlock(u,o.get("IsShowCorner"));}),n.showHideBlock(u,o.get("IsShowCorner"));};}),define("emergency.newmessage.form.type",["require","form.helpers"],function(e){"use strict";var t=e("form.helpers"),n="input.js-message-type";return function(e,r){if(!e||!e.length||!r)return;var i=e.find(n);i.change(function(){r.set("MessageType",this.value);}),t.selectRadioByValue(i,r.get("MessageType")),i.trigger("design:update");};}),define("emergency.newmessage.form.map",["require","jquery","tools","form.helpers","partnerMap","googleMaps","map.defaultLocation"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("form.helpers"),i=e("partnerMap"),s=e("googleMaps"),o=e("map.defaultLocation"),u="div.js-emergency-map",a,f=function f(e,a){var f=this,l=a.get("Cities");if(!l.length)return;t.extend(this,{initialize:function initialize(){s(function(t){f.googleMaps=t.googleMaps,f.$map=e.find(u),f.initMapBlock(),f.initCities(),f.initMap();});},initMapBlock:function initMapBlock(){r.showHideBlock(this.$map,a.get("MessageType")==2),a.on("change:MessageType",function(e,t){r.showHideBlock(f.$map,t==2);});},initCities:function initCities(){this.cities=a.get("Cities"),n.list(this.cities).each(function(e){e.point=f.createPoint(e.Latitude,e.Longitude);});},createPoint:function createPoint(e,t){return new this.googleMaps.LatLng(e,t);},initMap:function initMap(){new i(this.$map,this.getMapParams(),{onChangeMapType:function onChangeMapType(e){a.set("MapType",e);},onChangeCircleAreas:function onChangeCircleAreas(e){f.setGpsParamsForCircle(e);},onChangePolygonAreas:function onChangePolygonAreas(e){f.setGpsParamsForPolygons(e);}});},getMapParams:function getMapParams(){var e={Id:1,GpsAreas:a.get("GpsAreas")||[],GpsPolygonAreas:a.get("GpsPolygonAreas")||[]};return this.cities.length>1?t.extend(e,{CityLatitude:o.Latitude,CityLongitude:o.Longitude,Zoom:o.Zoom}):t.extend(e,{CityLatitude:l[0].Latitude,CityLongitude:l[0].Longitude,Zoom:l[0].MapScale}),e;},setGpsParamsForCircle:function setGpsParamsForCircle(e){n.list(e).each(function(e){e.CityId=f.getNearestCityId(f.createPoint(e.CenterLatitude,e.CenterLongitude));}),a.set("GpsAreas",e);},setGpsParamsForPolygons:function setGpsParamsForPolygons(e){n.list(e).each(function(e){e.CityId=f.getNearestCityId(f.createPoint(e.latLngs[0].lat,e.latLngs[0].lng));}),a.set("GpsPolygonAreas",e);},getNearestCityId:function getNearestCityId(e){var t,r,i;return n.list(this.cities).each(function(n){t=f.googleMaps.geometry.spherical.computeDistanceBetween(n.point,e);if(!r||t<r)r=t,i=n;}),i.CityId;}}),this.initialize();};return function(e,t){e&&e.length&&t&&new f(e,t);};}),define("emergency.newmessage.form.displayOptions",["require"],function(e){"use strict";var t="div.js-display-options";return function(e,n){function i(){var e=n.get("TemplateParams");r.html("   "+e.DurationOfVideo+" "+""+".<br/>"+"   "+" "+e.Frequency+" "+"  "+" "+e.DurationOfShow+" "+""+".");}if(!e||!e.length||!n)return;var r=e.find(t);i(),n.on("change:TemplateId",function(){i();});};}),define("audioPlayer",["require","jquery"],function(e){"use strict";var t=e("jquery"),n=function n(e){var n=t.extend({controls:!0,autoplay:!1},e||{});t.extend(this,{initialize:function initialize(){_typeof(n.container)=="object"?this.$container=n.container:this.$container=t(n.container),this.render();},render:function render(){this.$container.length&&n.audioUrl&&(this.$audio=t('<audio preload="auto" src="'+n.audioUrl+'"'+(n.controls?" controls":"")+(n.autoplay?" autoplay":"")+(n.poster?' poster="'+n.poster+'"':"")+" />"),this.$container.html(this.$audio),this.$audio.on("contextmenu",function(e){return e.preventDefault(),!1;}));}}),this.initialize();};return function(e){return new n(e);};}),define("audioLoader",["require","jquery","tools","urls","audioPlayer","plupload","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("urls"),i=e("audioPlayer");e("plupload");var s=function s(_s9){var o=this,u=t.extend({maxFileSize:"30mb",extensions:"mp3",preventDuplicates:!0,multiSelection:!0,dragdrop:!0,templateResultsId:"#template_VideoLoaderResults",gapEl:"div.video-gap",buttonRemove:"a.js-remove-audio",classDragover:"dragover",classAddedAudio:"with-audio",classAudioLoaded:"is-loaded",classErrorLoading:"with-error"},_s9||{}),a=e("templates.storage").get(u.templateResultsId);t.extend(this,{initialize:function initialize(){this.$container=t(u.containerEl);if(!u.buttonBrowse||!this.$container.length)return;this.initUploader(),this.initButtonRemove();},initUploader:function initUploader(){var e={browse_button:u.buttonBrowse,url:r.get("uploadAudio"),multipart_params:u.additionalParams||{},multi_selection:u.multiSelection,headers:{"X-Requested-With":"XMLHttpRequest"},filters:{mime_types:[{title:"Audio files",extensions:u.extensions}],max_file_size:u.maxFileSize,prevent_duplicates:u.preventDuplicates}};u.dragdrop&&(e.drop_element=this.$container[0]),this.uploader=new plupload.Uploader(e),this.uploader.init(),this.uploader.bind("Init",function(e){n.is(u.onInit).fn()&&u.onInit(e),o.uploader.features.dragdrop&&o.$container.on("dragenter",function(){o.isDragging||(o.isDragging=!0,o.$container.addClass(u.classDragover));}).on("dragleave",function(e){e.relatedTarget!=o.$container[0]&&!t(e.relatedTarget).parents(u.containerEl).length&&(o.isDragging=!1,o.$container.removeClass(u.classDragover));});}),this.uploader.bind("FilesAdded",function(e){if(!u.multiSelection)while(e.files.length>1){e.removeFile(e.files[0]);}if(n.is(u.onFilesAdded).fn()&&u.onFilesAdded(e)===!1)return!1;o.$container.addClass(u.classAddedAudio),u.buttonLoad||o.uploader.start();}),this.uploader.bind("BeforeUpload",function(e){o.$container.removeClass(u.classErrorLoading);if(n.is(u.onBeforeLoad).fn()&&u.onBeforeLoad(e)===!1)return!1;o.state="loading",o.render("loading",{Percent:0,Filename:e.files[0].name});}),this.uploader.bind("UploadProgress",function(e,t){o.state==="loading"&&(t.percent==100?(o.state="loaded",o.render("processing",{Filename:e.files[0].name})):o.render("loading",{Percent:t.percent,Filename:e.files[0].name}));}),this.uploader.bind("FileUploaded",function(e,t,n){n.responseHeaders.indexOf("X-Unauthorized: True")!==-1&&window.location.reload();var r=JSON.parse(n.response);r.Errors?(o.$container.addClass(u.classErrorLoading),o.render("error",r.Errors),o.runCallback("onError")):(o.$container.addClass(u.classAudioLoaded),new i({container:o.$container.find(">div:first"),audioUrl:r.audioUrl}),o.runCallback("onAfterLoad",r));}),this.uploader.bind("Error",function(e,t){if(t.code==-602)return;var r=t.message;t.code==-600&&(r="   30"),o.render("error",{errorText:r}),o.$container.addClass(u.classErrorLoading),o.runCallback("onError"),n.is(u.onBeforeLoad).fn()&&u.onBeforeLoad();}),u.buttonLoad&&t("#"+u.buttonLoad).click(function(){o.uploader.start();});},render:function render(e,n){var r=t.extend({state:e},n||{});this.$container.find(">div:first").html(a(r));},runCallback:function runCallback(e,t){n.is(u[e]).fn()&&u[e](t);},initButtonRemove:function initButtonRemove(){this.$buttonRemove=this.$container.find(u.buttonRemove),this.$buttonRemove.length&&this.$buttonRemove.click(function(){return o.uploader.stop(),o.uploader.destroy(),o.runCallback("onRemove"),!1;});}}),this.initialize();};return function(e){return new s(e);};}),define("emergency.newmessage.form.audioAttachment",["require","tools","audioLoader","audioPlayer","templates.storage"],function(e){"use strict";var t=e("tools"),n=e("audioLoader"),r=e("audioPlayer"),i=e("templates.storage"),s={audioContainer:"#audioContainer",audioLoader:"#audioLoader",browseAudioLoader:"browseAudioLoader",linkRemoveAudio:"a.js-remove-audio",audioDurationIsOutOfRange:"    ",deattachBlock:"div.js-deattach-audio-file"};return function(e,o){function p(){u=!0;var r={audioId:o.get("AudioId"),audioUrl:o.get("AudioUrl")};r.audioId&&r.audioUrl&&(w(r),g(!0));var i=e.find(s.deattachBlock);i.click(function(){b();}),n({containerEl:s.audioLoader,buttonBrowse:s.browseAudioLoader,multiSelection:!1,onFilesAdded:function onFilesAdded(e){return v(d(),t.list(e.files).clone()[0]),setTimeout(function(){while(e.files.length>0){e.removeFile(e.files[0]);}},500),!1;}});}function d(){l++;var e=$(i.get(c)({Index:l}));return h.html(e),e;}function v(e,t){var r=e.data("index");n({containerEl:s.audioLoader+r,buttonBrowse:s.browseAudioLoader+r,multiSelection:!1,dragdrop:!1,onInit:function onInit(e){e.addFile(t);},onBeforeLoad:function onBeforeLoad(){},onAfterLoad:function onAfterLoad(e){w(e);},onRemove:function onRemove(){e.remove(),b();}});}function m(t){e.find("div.js-audio-attachment-error").html(t);}function g(t){var n=e.find(s.deattachBlock);t?n.show():n.hide();}function y(e,t){a.val(e||""),f.val(t||"");}function b(e,t){a.val(""),f.val(""),o.set({AudioId:null,AudioDuration:null,IsAudioDurationFine:!0});}function w(e){y(e.audioId,e.audioUrl);var t=d();o.set({AudioId:e.audioId,AudioDuration:e.audioLengthInSeconds}),t.addClass("with-audio").addClass("is-loaded").find(s.linkRemoveAudio).click(function(){return b(),!1;}),new r({container:t.find(">div:first"),audioUrl:e.audioUrl});}if(!e||!e.length||!o)return;var u=!1,a=e.find('input:hidden[name="audioId"]'),f=e.find('input:hidden[name="audioUrl"]'),l=0,c="#template_audio_item",h=e.find(s.audioContainer);o.on("change:IsAudioDurationFine",function(){var e=o.get("IsAudioDurationFine");e===!1?m(s.audioDurationIsOutOfRange):m("");}),o.on("change:AudioId",function(){var e=o.get("AudioId");e?(h.show(),g(!0)):(h.hide(),g(!1));}),u||p();};}),define("emergency.newmessage.form",["require","jquery","backbone","emergency.newmessage.form.model","form.helpers","partnerMap.mapTypes","emergency.newmessage.form.templates","emergency.newmessage.form.text","emergency.newmessage.form.photoContainer","emergency.newmessage.form.photoLoader","emergency.newmessage.form.bgStyle","emergency.newmessage.form.bgColor","emergency.newmessage.form.bgImage","emergency.newmessage.form.textColor","emergency.newmessage.form.cornerVisible","emergency.newmessage.form.cornerColor","emergency.newmessage.form.type","emergency.newmessage.form.map","emergency.newmessage.form.displayOptions","emergency.newmessage.form.audioAttachment"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=e("emergency.newmessage.form.model"),i=e("form.helpers"),s=e("partnerMap.mapTypes"),o=e("emergency.newmessage.form.templates"),u=e("emergency.newmessage.form.text"),a=e("emergency.newmessage.form.photoContainer"),f=e("emergency.newmessage.form.photoLoader"),l=e("emergency.newmessage.form.bgStyle"),c=e("emergency.newmessage.form.bgColor"),h=e("emergency.newmessage.form.bgImage"),p=e("emergency.newmessage.form.textColor"),d=e("emergency.newmessage.form.cornerVisible"),v=e("emergency.newmessage.form.cornerColor"),m=e("emergency.newmessage.form.type"),g=e("emergency.newmessage.form.map"),y=e("emergency.newmessage.form.displayOptions"),b=e("emergency.newmessage.form.audioAttachment"),w="#formEmergencyNewMessage",E={buttonSave:"a.js-message-save"},S="is-disabled",x="/Emergency/MessageList",T=n.View.extend({initialize:function initialize(){this.initModel();var e=this.$el,t=this.model;o(e,t),u(e,t),this.model.get("IsAnotherCabinet")?(l(e,t),c(e,t),h(e,t),p(e,t),d(e,t),v(e,t)):(a(e,t),f(e,t)),m(e,t),g(e,t),y(e,t),b(e,t),this.initButtonSave();},initModel:function initModel(){var e=this,n=window.formData,i={Cities:n.Cities,DefaultTemplates:n.Templates,IsAnotherCabinet:n.IsAnotherCabinet,Images:n.Images};n.Form!==null&&(t.extend(i,n.Form),i.GpsPolygonAreas.length&&(i.MapType=s.polygon)),this.model=new r(i),this.model.on("change",function(t){t.isValid()?e.runCallback("onValid",e.model.getData()):e.runCallback("onInvalid");});},initButtonSave:function initButtonSave(){var e=this,n=this.$el.find(E.buttonSave);n.click(function(){!n.hasClass(S)&&e.model.isValid()&&(n.addClass(S),t.post(e.$el.data("url"),e.model.getData()).done(function(){window.location.href=x;}).fail(function(){n.removeClass(S),alert("error");}));}),i.enableDisableEl(n,!this.model.isValid()),this.model.on("change",function(e){i.enableDisableEl(n,!e.isValid());});},runCallback:function runCallback(e,t){typeof this.options.callbacks[e]=="function"&&this.options.callbacks[e](t);}});return function(e){window.formData&&new T({el:w,callbacks:e});};}),define("debounce",["require"],function(e){"use strict";return function(t,n){var r;return function(){var e=this,i=arguments,s=function s(){r=null,t.apply(e,i);};clearTimeout(r),r=setTimeout(s,n);};};}),define("emergency.newmessage.screens",["require","jquery","urls","tools","debounce"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("debounce"),s=500;return function(e){var o=this;if(!e||!e.length)return;return t.extend(this,{render:function render(e){o.clear(),this.load(t.extend({isFirstPage:!0},e),function(n){o.addImage(n),o.load(t.extend({isFirstPage:!1},e),function(e){o.addImage(e);});});},load:function load(e,t){var r=new XMLHttpRequest();r.open("post",n.get("generateImage"),!0),r.responseType="blob",r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onload=function(){if(r.response.type==="image/png"){var e=URL.createObjectURL(r.response);t(e);}},r.send(this.serializeParams(e));},addImage:function addImage(n){n&&e.append(t("<img>",{src:n}));},serializeParams:function serializeParams(e){var t="";return r.object(e).each(function(e,n,r){r!==0&&(t+="&"),t+=e+"="+n;}),t;},clear:function clear(){e.html("");}}),{render:i(function(e){o.render(e);},s),clear:i(function(){o.clear();},s)};};}),define("emergency.newmessage.action",["require","base","emergency.newmessage.form","emergency.newmessage.screens"],function(e){"use strict";var t=e("base"),n=e("emergency.newmessage.form"),r=e("emergency.newmessage.screens");return new t.Action({initialize:function initialize(){var e=new r($("#messageScreens"));new n({onValid:function onValid(t){e.render(t);},onInvalid:function onInvalid(){e.clear();}});}});}),define("emergency.message.stopper",["require","jquery","urls"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r={buttonsContainer:"div.js-buttons-container",buttonStopContaiter:"div.js-button-stop-container",buttonStop:"a.js-button-stop",buttonStopConfirm:"a.js-button-stop-confirm"},i="is-hidden",s=window.langResource;return function(){var e=t(r.buttonsContainer),o=t(r.buttonStopContaiter),u=e.find(r.buttonStop);if(!u.length)return;u.click(function(){return e.addClass(i),o.removeClass(i),!1;});var a=o.find(r.buttonStopConfirm).click(function(){return a.hide(),t.post(n.get("emergencyFinishMessage"),{EmergencyMessageId:t(this).data("id")}).done(function(){window.location.reload();}).fail(function(){a.show(),alert(s.requestError);}),!1;});};}),define("emergency.message.gallery",["require","jquery","d3","carouselByOwl"],function(e){"use strict";var t=e("jquery"),n=e("d3"),r=e("carouselByOwl"),i={container:"#messageGallery",bg:"div.js-message-bg",gallery:"div.js-slides-gallery",galleryItem:"div.js-slides-gallery-item",galleryButtonPrev:"a.js-button-prev",galleryButtonNext:"a.js-button-next",display:"div.js-slides-display",displayNumber:"span.js-slides-display-number"},s=860,o=484,u=15,a="000",f=.35,l=function l(){t.extend(this,{initialize:function initialize(){this.$container=t(i.container),this.initBackground(),this.initSlides();},initBackground:function initBackground(){this.$container.find(i.bg).each(function(){var e=n.select(this).append("svg").attr("width",s).attr("height",o);e.append("defs").append("filter").attr("id","blur").append("feGaussianBlur").attr("stdDeviation",u);var r=new Image();r.src=t(this).data("thumbnail"),r.onload=function(){e.append("image").attr("xlink:href",this.src).attr("width",s).attr("height",o).attr("filter","url(#blur)"),e.append("rect").attr("width",s).attr("height",o).style("fill",a).style("opacity",f);};});},initSlides:function initSlides(){var e=this.$container.find(i.gallery);if(e.find(i.galleryItem).length>1){var t=e.siblings(i.display).show(),n=t.find(i.displayNumber);r(e,{singleItem:!0,itemsEl:i.galleryItem,$prev:e.siblings(i.galleryButtonPrev),$next:e.siblings(i.galleryButtonNext),onMove:function onMove(e){n.text(e);}});}}}),this.initialize();};return function(){new l();};}),define("emergency.messagedetails.action",["require","base","emergency.message.stopper","emergency.message.gallery","campaign.report.graphicsBlock"],function(e){"use strict";var t=e("base");return new t.Action({initialize:function initialize(){e("emergency.message.stopper")(),e("emergency.message.gallery")(),e("campaign.report.graphicsBlock")({controller:"Emergency"});}});}),define("emergency.printdetails.action",["require","base","emergency.message.gallery","campaign.printReport.graphicsBlock"],function(e){"use strict";var t=e("base");return new t.Action({initialize:function initialize(){e("emergency.message.gallery")(),e("campaign.printReport.graphicsBlock")({controller:"Emergency"});}});}),define("emergency.controller",["require","base","emergency.addoredit.action","emergency.messagelist.action","emergency.newmessage.action","emergency.messagedetails.action","emergency.printdetails.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{addoredit:function addoredit(t){e("emergency.addoredit.action").initialize(t);},messagelist:function messagelist(t){e("emergency.messagelist.action").initialize(t);},newmessage:function newmessage(t){e("emergency.newmessage.action").initialize(t);},messagedetails:function messagedetails(t){e("emergency.messagedetails.action").initialize(t);},printdetails:function printdetails(t){e("emergency.printdetails.action").initialize(t);}}});}),define("noncommercial.saveNewOrder",["require","base"],function(e){"use strict";var t=e("base");return new t.Action({initialize:function initialize(e){this.url=e.url;},save:function save(e){$.ajax({url:this.url,method:"POST",contentType:"application/json",data:JSON.stringify({orderedIds:e})}).done(function(){});}});}),define("noncommercial.videoBlock",["require","jquery","events","urls","templates.storage","gallery","rangeDatePicker","tooltipConfirm","videoLoader","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("events"),r=e("urls"),i=e("templates.storage"),s=e("gallery"),o=e("rangeDatePicker"),u=e("tooltipConfirm"),a=window.langResource,f=a.currentLocale,l={"en-US":"M dd","ru-RU":"dd M"};return new function(c,h){var p=this,d=t.extend({videoContainer:"div.video-container",galleryContainer:"div.nk-video",datesContainer:"div.nk-video-dates",buttonRemove:".js-remove-video",multiDatesEl:"span.multi-dates",datesEl:"div.nk-video-dates",stateEl:"span.nk-video-state",templateId:"#template_nk_video_item",dateFormatForUi:l[f],datesFormatForServer:"yy-mm-dd"},h||{}),v={datePicker:".non-commercial-datepicker"},m=1;return t.extend(this,{render:function render(e,n){return this.template||(this.template=i.get(d.templateId)),t(this.template(t.extend({State:e},n||{})));},renderVideo:function renderVideo(){return this.render("loading",{Index:m++});},initVideoLoading:function initVideoLoading(t,r){var i=t.find(d.videoContainer);e("videoLoader")({containerEl:"#videoStream"+i.data("index"),buttonBrowse:"browseVideo"+i.data("index"),dragdrop:!1,additionalParams:r.videoParams,onInit:function onInit(e){e.addFile(r.file);},onAfterLoad:function onAfterLoad(e){t.html(p.renderBlock({Id:e.ncId,StatusText:e.ncState,Type:r.videoParams.nonCommercialContentType,DateStart:r.datesParams.dateStart,DateStartText:o.getFormattedDate(r.datesParams.dateStart,d.dateFormatForUi),DateEnd:r.datesParams.dateEnd,DateEndText:o.getFormattedDate(r.datesParams.dateEnd,d.dateFormatForUi),IsEnableEditable:r.isEnableEditable,CanBeRemoved:r.canBeRemoved,Thumbnails:JSON.stringify(e.thumbnailUrls),VideoUrl:e.videoUrl,VideoLength:e.videoLengthInSeconds,VideoSize:e.videoSize})),t.attr("id",e.ncId),p.initControls(t,{datesParams:r.datesParams,startDate:r.datesParams.dateStart,endDate:r.datesParams.dateEnd}),n.trigger("nkVideoBlock:afterLoad");},onError:function onError(){}});},renderBlock:function renderBlock(e){return this.render("block",e);},initControls:function initControls(e,t){this.initButtonRemove(e),this.initGallery(e),this.initDateControl(e,t.datesParams),this.initStateControl(e);},initButtonRemove:function initButtonRemove(e){var i=e.find(d.buttonRemove),s=u(i,{headerText:a.nonCommercial.tooltipRemoveOneHeading,contentText:a.nonCommercial.tooltipRemoveOneText,buttonApplyText:a.nonCommercial.tooltipRemoveOneButtonApply,buttonCancelText:a.nonCommercial.tooltipRemoveOneButtonCancel,onApply:function onApply(){var i=e.find(d.galleryContainer).data("id");i&&t.post(r.get("nonCommercialRemoveVideo"),{id:i}).done(function(){e.remove(),n.trigger("nkVideoBlock:afterRemove");}).fail(function(){alert(a.requestError);});}});i.click(function(){s.show();});},initGallery:function initGallery(e){var t=e.find(d.galleryContainer);new s({container:t,thumbnailUrls:t.data("video-thumbnails"),videoUrl:t.data("video-url"),videoLength:t.data("video-length"),videoSize:t.data("video-size"),viewsCount:t.data("show-count")});},initDateControl:function initDateControl(e,r){var i=e.find(d.multiDatesEl),s=e.find(d.datesEl),u=s.data("date-start"),a=s.data("date-end"),f=e.find(d.galleryContainer).data("id");n.on("nk:filterByDate",function(t){if(s&&t){var n=new Date(t);if(n instanceof Date&&!isNaN(n)){var r=new Date(u)<=n&&n<=new Date(a);r||e.hide();}}}),i.click(function(){if(e.hasClass("not-enabled"))return;o.show({$target:i,dateStart:u,dateEnd:a,resultDatesFormat:d.dateFormatForUi,minDate:new Date(),onSelect:function onSelect(u,a,l){i.data("date-start",u),i.data("date-end",a),s.data("date-start",u),s.data("date-end",a),s.attr("data-date-start",u),s.attr("data-date-end",a),i.find("span").html(l);var c={ncId:f,startFromDate:o.getFormattedDate(u,d.datesFormatForServer),showUntilDate:o.getFormattedDate(a,d.datesFormatForServer)};r.adminDateTime&&(c.adminDateTime=r.adminDateTime);var h=t(v.datePicker);h.data("date")&&n.trigger("nk:filter",{filterName:"nk:filterByDate",params:h.data("date")}),t.post(r.url,c).done(function(t){if(!t.success)return;p.updateState(e,t.ncState);});}});});},initStateControl:function initStateControl(n){e("jquery.designForms");var i=n.find("input:checkbox");if(!i.length)return!1;n.find("input:checkbox").designForms().change(function(){var e=t(this),i=e.data("id"),s=e.is(":checked");s?n.removeClass("not-enabled"):n.addClass("not-enabled"),t.ajax({type:"POST",url:r.get("nonCommercialChangeEnabled"),poolName:"nkChangeEnable"+i,data:{ncId:i,isEnabled:s},success:function success(e){if(!e.success)return;p.updateState(n,e.ncState);}});});},updateState:function updateState(e,t){e.find(d.stateEl).html(t);}}),{renderVideo:function renderVideo(){return p.renderVideo();},initVideoLoading:function initVideoLoading(e,t){e&&e.length&&p.initVideoLoading(e,t||{});},initControls:function initControls(e,t){e&&e.length&&p.initControls(e,t||{});}};}();}),define("noncommercial.videoLoader",["require","jquery","tools","events","dates.adapter","rangeDatePicker","templates.storage","videoLoader"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("dates.adapter"),s=e("rangeDatePicker"),o=window.langResource,u=e("templates.storage"),a=o.currentLocale==="ru-RU"?"dd.mm":"mm.dd",f=function f(o,u){var f=this,l=t.extend({multiDatesEl:"span.multi-dates",buttonBrowseId:"browseVideo",callbacks:{}},u||{}),c=["News","Social","Fun"];t.extend(this,{initialize:function initialize(){this.initMultiDates(),r.on("nk:filterTypeChange",function(e){f.videoType=e;}),this.initLoader();},initMultiDates:function initMultiDates(){var e=o.find(l.multiDatesEl);this.dateStart=n.date(new Date()).format(i.getFormat()),this.dateEnd=s.getDateOffset("+6d"),e.find("span").html(s.getRangeString(this.dateStart,this.dateEnd,a)),e.removeClass("is-hidden").data("date-start",this.dateStart).data("date-end",this.dateEnd).click(function(){s.show({$target:e,dateStart:f.dateStart,dateEnd:f.dateEnd,resultDatesFormat:a,minDate:new Date(),onSelect:function onSelect(t,n,r){f.dateStart=t,f.dateEnd=n,e.find("span").html(r);}});});},initLoader:function initLoader(){e("videoLoader")({containerEl:"#videoStream",buttonBrowse:l.buttonBrowseId,onFilesAdded:function onFilesAdded(e){var t={files:n.list(e.files).clone(),dateStart:f.dateStart,dateEnd:f.dateEnd,isEnableEditable:o.data("enable-editable"),canBeRemoved:o.data("enable-remove")};return f.videoType!=="All"&&(t.nonCommercialContentType=f.videoType),f.runCallBack("onSelect",t),setTimeout(function(){while(e.files.length>0){e.removeFile(e.files[0]);}},500),!1;}});},runCallBack:function runCallBack(e,t){typeof l.callbacks[e]=="function"&&l.callbacks[e](t);}}),this.initialize();};return function(e,t){e&&e.length&&new f(e,t);};}),define("noncommercial.videoList",["require","jquery","tools","events","noncommercial.videoBlock","noncommercial.videoLoader"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("noncommercial.videoBlock"),s=e("noncommercial.videoLoader"),o=function o(e,_o5){var u=this,a=null,f=t.extend({videoLoaderEl:"div.js-nk-loader",videoBlockEl:"div.js-nk-video"},_o5||{});t.extend(this,{initialize:function initialize(){this.initVideoLoader(),this.initVideoItems(),this.filterConnector={},r.on("nk:filter",function(e){u.filterConnector[e.filterName]={filterName:e.filterName,params:e.params},u.resetVideoBlocks();var t=Object.keys(u.filterConnector);for(var n=0;n<t.length;n++){var i=u.filterConnector[t[n]];r.trigger(i.filterName,i.params);}}),r.on("nk:filterTypeChange",function(r){a=r;var i=e.find(f.videoBlockEl),s=e.find(f.videoLoaderEl);if(r==="InstantlyAll"){s.show(),n.list(i).each(function(e){t(e).show();});return;}s.show(),n.list(i).each(function(e){r!=="All"&&t(e).find(">div:first").data("type")!==r&&t(e).hide();});});},initVideoLoader:function initVideoLoader(){new s(e.find(f.videoLoaderEl),{callbacks:{onSelect:function onSelect(e){n.list(e.files).each(function(t){u.addNkVideoItem(t,e);});}}});},resetVideoBlocks:function resetVideoBlocks(){var r=e.find(f.videoBlockEl);n.list(r).each(function(e){t(e).show();});},initVideoItems:function initVideoItems(){var r=e.find(f.videoBlockEl);r.length&&n.list(r).each(function(e){i.initControls(t(e),{datesParams:f.datesParams});});},addNkVideoItem:function addNkVideoItem(n,r){var s=i.renderVideo(),o=e.find(f.videoBlockEl+":first");o.length?o.before(s):e.append(s),i.initVideoLoading(s,{file:n,isEnableEditable:r.isEnableEditable,canBeRemoved:r.canBeRemoved,videoParams:t.extend({startFromDate:r.dateStart,showUntilDate:r.dateEnd,nonCommercialContentType:r.nonCommercialContentType},f.videoParams),datesParams:t.extend({dateStart:r.dateStart,dateEnd:r.dateEnd},f.datesParams||{})});}}),this.initialize();};return function(e){var n=t(e.containerId);n.length&&new o(n,e);};}),define("utilities.urlParser",["require"],function(e){"use strict";return{parse:function parse(){var e=String(window.location.search);if(e&&e.length>1){var t=e.split("?")[1].split("&"),n={};return t.forEach(function(e){var t=e.split("=");n[t[0]]=t[1];}),n.hash=window.location.hash,n;}return{};}};}),define("noncommercial.regularlist.action",["require","base","events","tools","urls","noncommercial.saveNewOrder","noncommercial.videoList","datePicker","utilities.urlParser"],function(e){"use strict";var t=e("base"),n=e("events"),r=e("tools"),i=e("urls"),s=e("noncommercial.saveNewOrder"),o=e("noncommercial.videoList"),u=e("datePicker"),a=e("utilities.urlParser"),f={datePicker:".non-commercial-datepicker",regularButton:".js-non-commercial-regular",etherButton:".js-non-commercial-ether-button",etherDate:".js-non-commerial-ether-date",filterButtons:".js-nk-filter"};return new t.Action({initialize:function initialize(){var e=this;this.$regularButton=$(f.regularButton),this.$etherButton=$(f.etherButton),this.$datePicker=$(f.datePicker),this.$etherDate=$(f.etherDate),this.datePicker=new u($(f.datePicker),{dateFormatForUI:"dd.mm.yy",onSelect:function onSelect(t){e.setEtherDate(t),n.trigger("nk:filter",{filterName:"nk:filterByDate",params:t});}}),new o({containerId:"#nkVideoList",videoParams:{isNewNonCommercialContent:!0,isRepeatable:!1},datesParams:{url:i.get("nonCommercialSetDates")}}),this.initButtons(),isChangingOrderEnabled&&(s.initialize({url:"/Noncommercial/SaveOrder"}),$(".sortContainer").sortable({containment:"parent",items:".js-nk-video",placeholder:"b-empty-container",start:function start(e,t){t.placeholder.html('<div class="b-empty-container__line">&nbsp;</div><div class="b-empty-container__head">'+langResource.draggable.order+"</div>"+'<div class="b-empty-container__body">&nbsp;</div>'+'<div class="b-empty-container__footer">'+langResource.draggable.orderDirection+"</div>");},update:function update(){var e=$(".sortContainer").sortable("toArray");s.save(e);}}),n.on("nkVideoBlock:afterLoad",function(){var e=$(".sortContainer").sortable("toArray");$.inArray("",e)==-1&&s.save(e);}),n.on("nkVideoBlock:afterRemove",function(){var e=$(".sortContainer").sortable("toArray");s.save(e);}),n.on("nk:filterTypeChange",function(t){e.resetFilterButtons(),r.list(e.$filterButtons).each(function(e){$(e).data("id")===t&&$(e).addClass("current");});}),n.trigger("nk:filterTypeChange","All"));},initButtons:function initButtons(){if(window.location.pathname==="/NonCommercial/RegularList"){this.$filterButtons=$(f.filterButtons);var e=this.$regularButton,t=this.$etherButton,i=this.$datePicker,s=a.parse();s.hash&&s.hash==="#date=new"?(this.$etherButton.addClass("current"),$(this.$datePicker).show()):$(this.$regularButton).addClass("current"),$(e).click(function(){$(this).hasClass("current")===!1&&($(this).addClass("current"),t.removeClass("current"),i.hide(),n.trigger("nk:filter",{filterName:"nk:filterByDate",params:null}));}),t.click(function(){e.hasClass("current")&&!i.data("date")?i.show():e.hasClass("current")||(i.is(":hidden")?i.show():i.hide()),t.hasClass("current")||(t.addClass("current"),e.removeClass("current")),i.data("date")&&n.trigger("nk:filter",{filterName:"nk:filterByDate",params:i.data("date")});}),this.$filterButtons.length&&r.list(this.$filterButtons).each(function(e){$(e).click(function(t){n.trigger("nk:filter",{filterName:"nk:filterTypeChange",params:$(e).data("id")});});});}},setEtherDate:function setEtherDate(e){if(window.location.pathname==="/NonCommercial/RegularList"){var t=new Date(),n=new Date(e),i=r.date(new Date(e)).format("dd M");t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()&&(i=window.langResource.nonCommercial.etherTodayText),this.$etherDate.html(i),$(this.$datePicker).hide(),$(this.$datePicker).data("date",e);}},resetFilterButtons:function resetFilterButtons(){r.list(this.$filterButtons).each(function(e){$(e).removeClass("current");});}});}),define("noncommercial.breaklist.action",["require","base","events","urls","noncommercial.videoList"],function(e){"use strict";var t=e("base"),n=e("events"),r=e("urls"),i=e("noncommercial.videoList");return new t.Action({initialize:function initialize(){new i({containerId:"#nkVideoList",videoParams:{isNewNonCommercialContent:!0,isRepeatable:!0},datesParams:{url:r.get("nonCommercialSetDates")}}),n.trigger("nk:filterTypeChange","InstantlyAll");}});}),define("noncommercial.buttonRemoveArchive",["require","jquery","urls","tooltipConfirm"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tooltipConfirm"),i=window.langResource,s=function s(){window.location.reload();},o=function o(){alert(i.requestError);};return function(e){if(e&&e.length){var u=r(e,{headerText:i.nonCommercial.tooltipRemoveAllHeading,contentText:i.nonCommercial.tooltipRemoveAllText,buttonApplyText:i.nonCommercial.tooltipRemoveAllButtonApply,buttonCancelText:i.nonCommercial.tooltipRemoveAllButtonCancel,onApply:function onApply(){t.post(n.get("removeAllArchiveVideo")).done(function(e){e?s():o();}).fail(o);}});e.click(function(){return u.show(),!1;});}};}),define("noncommercial.archivelist.action",["require","base","urls","events","noncommercial.videoList","noncommercial.buttonRemoveArchive"],function(e){"use strict";var t=e("base"),n=e("urls"),r=e("events"),i=e("noncommercial.videoList"),s=e("noncommercial.buttonRemoveArchive");return new t.Action({initialize:function initialize(){new i({containerId:"#nkVideoList",datesParams:{url:n.get("nonCommercialSetDates")}}),new s($("#buttonRemoveArchive")),r.on("archive:clean",function(e){e.nonCommercial&&window.location.reload();});}});}),define("noncommercial.controller",["require","base","noncommercial.regularlist.action","noncommercial.breaklist.action","noncommercial.archivelist.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{regularlist:function regularlist(t){e("noncommercial.regularlist.action").initialize(t);},breaklist:function breaklist(t){e("noncommercial.breaklist.action").initialize(t);},archivelist:function archivelist(t){e("noncommercial.archivelist.action").initialize(t);}}});}),define("graphics.showsByPeriod",["require","jquery","d3"],function(e){"use strict";var t=e("jquery"),n=e("d3"),r=function r(e){var r=this,i=t.extend({width:500,height:300,margin:{left:20,right:40,top:40,bottom:125},showPercents:!1},e||{});t.extend(this,{initialize:function initialize(){this.$container=t(i.containerEl);if(!this.$container.length)return;this.load();},load:function load(){t.get(i.url,i.additionalParams||{},function(e){if(!e.length)return;r.render(e);});},render:function render(e){var t=i.width-i.margin.left-i.margin.right,s=i.height-i.margin.top-i.margin.bottom,o=n.scale.ordinal().rangeRoundBands([0,t],0),u=n.scale.linear().rangeRound([s,0]),a=n.svg.axis().scale(o).tickSize(5).tickPadding(0).orient("bottom"),f=n.svg.axis().scale(u).orient("right");i.showPercents&&f.tickFormat(n.format(".0%"));var l=n.scale.ordinal().range(["#dcd1c3"]),c=n.select(r.$container[0]).append("svg").attr("width",t+i.margin.left+i.margin.right).attr("height",s+i.margin.top+i.margin.bottom).append("g").attr("transform","translate("+i.margin.left+","+i.margin.top+")"),h=[];for(var p=0;p<e[0].Values.length;p++){h[p]=e[0].Values[p].Name;}l.domain(h),e.forEach(function(e){var t=0;e.Shows=l.domain().map(function(n){var r=0;for(var s=0;s<e.Values.length;s++){e.Values[s].Name===n&&(r=e.Values[s].Shows);}return{y0:t,y1:t+=i.showPercents?r/100:r};}),i.showPercents||(e.Total=e.Shows[e.Shows.length-1].y1);}),o.domain(e.map(function(e){return e.Period;})),i.showPercents||u.domain([0,n.max(e,function(e){return e.Total;})]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(a).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".2em").style("font-size","11px").attr("transform",function(){return"rotate(-65)";}),c.append("g").attr("class","y axis").attr("transform","translate("+t+", 0)").style("font-size","11px").call(f);var d=c.selectAll(".date").data(e).enter().append("g").attr("class","g").attr("transform",function(e){return"translate("+o(e.Period)+",0)";});d.selectAll("rect").data(function(e,t){return e.Values[0].Shows&&c.append("text").attr("class","title").attr("width",90).attr("x",t*o.rangeBand()).attr("dx","1em").attr("y",u(e.Shows[0].y1)).attr("dy","-.2em").text(e.Values[0].Shows).style("text-anchor","middle").style("font-size","10px"),e.Shows;}).enter().append("rect").attr("width",o.rangeBand()).attr("y",function(e){return u(e.y1);}).attr("height",function(e){return u(e.y0)-u(e.y1);}).style("fill",function(e){return l(e.name);});}}),this.initialize();};return function(e){new r(e);};}),define("monitor.history.action",["require","base","urls","graphics.showsByPeriod"],function(e){"use strict";var t=e("base"),n=e("urls");return new t.Action({initialize:function initialize(){var t=$("#graphicShowsByPeriod");e("graphics.showsByPeriod")({containerEl:"#graphicShowsByPeriod",url:n.get("monitorHistoryData",t.data("id")),additionalParams:{year:2014,month:11},width:2400,height:350});}});}),define("searchBox",["require","jquery","tools","utilities.debounce","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("utilities.debounce"),i=e("templates.storage"),s="#template_search_box",o=1e3;return function(e){var u=this,a={textField:"input[type=text]",buttonFilter:".js-button-filter",backlayer:".js-filter-monitor-backlayer",buttonClear:".js-button-clear",iconFind:".js-icon-find"},f={hidden:"is-hidden",focused:"is-focused"},l=i.get(s);if(!e.$container||!e.$container.length)return;t.extend(this,{text:"",isFilterOpened:!1,initialize:function initialize(){e.$container.append(l()),this.$text=e.$container.find(a.textField).val(this.text).on("focus",function(){u.focus();}).on("blur",function(){u.blur();}).on("keyup",function(e){e.keyCode===13&&u.search(),u.$buttonClear[t.trim(u.$text.val()).length>0?"removeClass":"addClass"](f.hidden);}).on("keydown",r(function(){u.search();},o)),e.$container.find(e.iconFind).click(function(){u.$text.focus();}),this.$buttonClear=e.$container.find(a.buttonClear).click(function(){u.$text.val(""),u.$buttonClear.addClass(f.hidden),u.search();}),this.$buttonFilter=e.$container.find(a.buttonFilter).click(function(){u.$isFilterOpened=!u.$isFilterOpened,u.$isFilterOpened?u.$buttonFilter.addClass("button_filter__active"):u.$buttonFilter.removeClass("button_filter__active"),u.runCallback("onFilterClick"),t(a.backlayer).click(function(){u.$buttonFilter.click();});});},focus:function focus(){e.$container.addClass(f.focused),u.runCallback("onFocus");},blur:function blur(){e.$container.removeClass(f.focused),u.runCallback("onBlur"),u.search();},search:function search(){var e=t.trim(this.$text.val());this.text!==e&&(this.text=e,u.runCallback("onSearch"));},runCallback:function runCallback(r){n.is(e[r]).fn()&&(r==="onFilterClick"?e[r](this.$isFilterOpened):e[r](t.trim(this.$text.val())));}}),this.initialize();};}),define("googleMaps.clustering.hasError.styles",[],function(){"use strict";var e="/images/cluster_imgs/";return[{width:54,height:54,url:e+"hasError1.png",textColor:"white"},{width:58,height:57,url:e+"hasError2.png",textColor:"white"},{width:67,height:66,url:e+"hasError3.png",textColor:"white"},{width:77,height:76,url:e+"hasError4.png",textColor:"white"},{width:92,height:91,url:e+"hasError5.png",textColor:"white"}];}),define("monitor.monitorDetails.window",["require","jquery"],function(e){"use strict";var t=e("jquery");return new function(){var e=this,n="is-opened",r="is-loading";return t.extend(this,{render:function render(){this.$window=t('<div style="width:1100px" class="md-window"><span class="md-window__loader"><i class="loading"></i></span></div>'),this.$buttonClose=t('<span class="md-window__close"><i></i></span>').click(function(){e.hide();}),this.$window.append(this.$buttonClose),this.$content=t('<div class="md-window__content"/>'),this.$window.append(this.$content),this.$overlay=t('<div class="md-window__overlay" />').click(function(){e.hide();}),t(document.body).append(this.$overlay).append(this.$window);},setContent:function setContent(e){this.$window||this.render(),this.$content.html(e);},show:function show(e){this.$window||this.render(),this.$content.html(e),this.$window.addClass(n),this.$overlay.addClass(n);},hide:function hide(){this.$window&&(this.$window.removeClass(n),this.$overlay.removeClass(n));},showLoader:function showLoader(){this.$window&&this.$window.addClass(r);},hideLoader:function hideLoader(){this.$window&&this.$window.removeClass(r);}}),{show:function show(t){e.show(t);},hide:function hide(){e.hide();},setContent:function setContent(t){e.setContent(t);},showLoader:function showLoader(){e.showLoader();},hideLoader:function hideLoader(){e.hideLoader();}};}();}),define("monitor.monitorDetails.showedVideos",["require","jquery","underscore","urls","tools","gallery","videoPlayer","googleMaps.markerIcons","googleMaps"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("urls"),i=e("tools"),s=e("gallery"),o=e("videoPlayer"),u=e("googleMaps.markerIcons"),a=new function(){var a=this,f={templateId_Frame:"#template_monitor_showed_videos",templateId_Video:"#template_monitor_showed_video_item",classes:{isSelected:"is-selected",isLoaded:"is-loaded",isEmpty:"is-empty"},list:{el:"tbody.js-msv-list"},videoInfo:{container:"div.msv__view-info"},video:{el:"div.js-msv-video",width:420,height:236},map:{id:"#msvMap",scale:14}};t.extend(this,{initialize:function initialize(e){this.$container=e;},renderFrame:function renderFrame(e){return this.templateFrame||(this.templateFrame=n.template(t(f.templateId_Frame).html())),t(this.templateFrame(e));},load:function load(e){var n;a.$container.length&&(a.dateString=e.dateString,a.monitorId=e.monitorId,n=a.renderFrame({Header:e.blockHeader}),a.$content&&a.$container.find(a.$content).length?a.$content.replaceWith(n):a.$container.append(n),a.$content=n,t.ajax({url:r.get("getMonitorTimelineHistory",e.monitorId),poolName:"getMonitorTimelineHistory",data:{hour:e.dateString},success:function success(e){e&&e.length?(a.$content.addClass(f.classes.isLoaded),a.renderVideoList(e)):a.$content.addClass(f.classes.isEmpty);}}));},renderVideoList:function renderVideoList(e){this.$list=this.$content.find(f.list.el),this.selectedRow=null,this.$videoContent=null,this.$videoInfo=null,this.isMapDrown=!1,i.list(e).each(function(e,t){e.Index=t,a.renderVideo(e);}),this.selectRow(this.$list.find("tr:first"));},renderVideo:function renderVideo(e){this.templateVideo||(this.templateVideo=n.template(t(f.templateId_Video).html()));var r=t(this.templateVideo(e));this.$list.append(r),r.data("thumbnail",e.VideoThumbnailUrl).click(function(){a.selectRow(r);});},selectRow:function selectRow(e){if(this.selectedRow==e.data("index"))return;this.selectedRow=e.data("index"),this.$content.find("tr."+f.classes.isSelected).removeClass(f.classes.isSelected),e.addClass(f.classes.isSelected),this.setVideoInfoPosition(e),this.$videoContent||(this.$videoContent=this.$content.find(f.video.el));var t=e.data();t.category==="McsVideo"?this.initVideoPlayer(t):t.category==="EmergencyMessage"||t.category==="PostedFile"?this.initSlidesGallery(t):this.initVideoGallery(t),this.initVideoLocation(t);},setVideoInfoPosition:function setVideoInfoPosition(e){this.$videoInfo||(this.$videoInfo=this.$content.find(f.videoInfo.container));var t=e.position().top,n=this.$videoInfo.height(),r=this.$videoInfo.parent().height();this.$videoInfo.css("top",Math.min(r-n,t));},initVideoPlayer:function initVideoPlayer(e){new o({containerEl:this.$videoContent,videoUrl:e.videoUrl,videoWidth:f.video.width,videoHeight:f.video.height});},initVideoGallery:function initVideoGallery(e){new s({container:this.$videoContent,thumbnailUrls:{0:e.thumbnail},videoUrl:e.videoUrl,width:f.video.width,height:f.video.height});},initSlidesGallery:function initSlidesGallery(e){var t={};i.list(e.thumbnails.split(",")).each(function(e,n){t[n]=e;}),new s({container:this.$videoContent,thumbnailUrls:t,width:f.video.width,height:f.video.height});},initVideoLocation:function initVideoLocation(t){e("googleMaps")(function(e){var n=e.createPoint(t.latitude,t.longitude);a.isMapDrown?(a.map.setCenter(n),a.marker.setPosition(n)):(a.isMapDrown=!0,a.map=e.render({containerId:f.map.id,center:{lat:t.latitude,lng:t.longitude},zoomControl:!1,zoom:f.map.scale}),a.marker=new e.googleMaps.Marker({position:n,map:a.map,icon:u("circleBlue18")}));});}});}();return{init:function init(e){e&&e.length&&a.initialize(e);},load:function load(e){a.load(e);}};}),define("monitorDetails.graphics",["require","jquery","urls","events","tools","d3","monitor.monitorDetails.showedVideos"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("events"),i=e("tools"),s=e("d3"),o=e("monitor.monitorDetails.showedVideos"),u=function u(e,_u4,a){var f=this,l=window.langResource,c={graphicSizes:{shortItemWidth:4,shortItemHeight:15,fullItemWidth:4,fullItemHeight:42,cellHeight:65,offsetTop:20},graphicWorking:{el:"div.work-graphic"},graphicCommon:{el:"div.graphs-graphic"}};t.extend(this,{initialize:function initialize(){i.is(this.graphicTypes[e]).fn()&&this.graphicTypes[e]();},graphicTypes:{workingShort:function workingShort(){t.ajax({url:n.get("monitorWorkingData",a.monitorId),poolName:"monitor"+e+"Data",success:function success(e){f.renderShort(_u4.find(c.graphicWorking.el)[0],e);}});},commonShort:function commonShort(){i.list(_u4.find(c.graphicCommon.el)).each(function(r,i){t.ajax({url:n.get("monitorHistoryData",a.monitorId,t(r).data("code")),poolName:"monitor"+e+"Data"+i,success:function success(e){f.renderShort(r,e);}});});},workingFull:function workingFull(){var r=_u4.find(c.graphicWorking.el);t.ajax({url:n.get("monitorFullWorkingData",a.monitorId),poolName:"monitor"+e+"Data",success:function success(t){o.load({dateString:t[t.length-1].Period,blockHeader:l.monitorsReport.forLastHour,monitorId:a.monitorId}),f.renderFull(r[0],t),f.decorateFull(r.parent(),t),f.initTimeLine(r.parent(),t,a.monitorId),f.initTimelineLabel(r.parent(),t,{type:e,"class":"g-countLabel",topPosition:c.graphicSizes.offsetTop});}});},commonFull:function commonFull(){var r;i.list(_u4.find(c.graphicCommon.el)).each(function(i,s){r=t(i),t.ajax({url:n.get("monitorHistoryFullData",a.monitorId,r.data("code")),poolName:"monitor"+e+"Data"+s,success:function success(t){f.renderFull(i,t),f.initTimelineLabel(r.parent(),t,{type:e+s,"class":"g-countLabel",topPosition:(s+1)*c.graphicSizes.cellHeight+c.graphicSizes.offsetTop});}});});}},renderShort:function renderShort(e,t){var n=t.length*c.graphicSizes.shortItemWidth,r=c.graphicSizes.shortItemHeight,i=s.max(t,function(e){return e.Values[0].Shows;}),o=s.select(e).append("svg").attr("width",n).attr("height",r),u=s.scale.ordinal().rangeRoundBands([0,n],0),a=s.scale.linear().rangeRound([r,0]);t.forEach(function(e){e.shows=[{y0:0,y1:e.Values[0].Color?i:e.Values[0].Shows,color:f.getGraphicItemColor(e.Values[0].Color)}];}),u.domain(t.map(function(e){return e.Period;})),a.domain([0,i]),o.selectAll(".date").data(t).enter().append("g").attr("transform",function(e){return"translate("+u(e.Period)+",0)";}).selectAll("rect").data(function(e){return e.shows;}).enter().append("rect").attr("width",c.graphicSizes.shortItemWidth).attr("y",function(e){return a(e.y1);}).attr("height",function(e){return a(e.y0)-a(e.y1);}).style("fill",function(e){return e.color;});},renderFull:function renderFull(e,t){var n=t.length*c.graphicSizes.fullItemWidth,r=c.graphicSizes.fullItemHeight,i=s.max(t,function(e){return e.Values[0].Shows;}),o=s.select(e).append("svg").attr("width",n).attr("height",r),u=s.scale.ordinal().rangeRoundBands([0,n],0),a=s.scale.linear().rangeRound([r,0]);t.forEach(function(e){e.shows=[{y0:0,y1:e.Values[0].Color?i:e.Values[0].Shows,color:f.getGraphicItemColor(e.Values[0].Color)}];}),u.domain(t.map(function(e){return e.Period;})),a.domain([0,i]),o.selectAll(".date").data(t).enter().append("g").attr("transform",function(e){return"translate("+u(e.Period)+",0)";}).selectAll("rect").data(function(e){return e.shows;}).enter().append("rect").attr("width",c.graphicSizes.fullItemWidth).attr("opacity",.8).attr("y",function(e){return a(e.y1);}).attr("height",function(e){return a(e.y0)-a(e.y1);}).style("fill",function(e){return e.color;});},getGraphicItemColor:function getGraphicItemColor(e){return e==="Red"?"#ed4a30":"#ddd1c2";},decorateFull:function decorateFull(e,n){var r,s;i.list(n).each(function(n,i){r=new Date(n.Period.replace(/\./g,"/")),i==0?s=r.getDate():r.getDate()!=s&&(s=r.getDate(),f.renderDecorateElements(e,t.datepicker.formatDate("d M",r),i*c.graphicSizes.fullItemWidth));});},renderDecorateElements:function renderDecorateElements(e,n,r){var i=t("<span>",{"class":"g-label"}).text(n).css("left",r),s=t("<i>",{"class":"g-line"}).css("left",r);e.append(i).append(i.clone().addClass("g-label_bottom")).append(s);},initTimeLine:function initTimeLine(e,n,i){function h(t){var n=t-e.offset().left;return n-=n%c.graphicSizes.fullItemWidth,n=Math.max(n,0),Math.min(n,e.width()-c.graphicSizes.fullItemWidth);}var s,u=t("<span>",{"class":"g-timeline"});e.append(u);var a=t("<span>",{"class":"g-timeline g-timeline_dragging"});e.append(a),f.initTimelineLabel(e,n,{type:"times","class":"g-timeLabel"});var p,d;e.on("mousedown",function(e){var r=h(e.clientX),s=r/c.graphicSizes.fullItemWidth;a.css({left:r}),p=n[s].Period,s+1==n.length?d=l.monitorsReport.forLastHour:d=l.monitorsReport.forTime+" "+t.datepicker.formatDate("d MM",new Date(p.replace(/\./g,"/")))+" "+p.split(" ")[1]+" &ndash; "+n[s+1==n.length?1:s+1].Period.split(" ")[1],o.load({dateString:p,blockHeader:d,monitorId:i});}).parent().on("mousemove",function(e){var t=h(e.clientX);u.css({left:t}),s=t/c.graphicSizes.fullItemWidth,r.broadcast("changeTimelinePosition",{leftPosition:t,dataIndex:t/c.graphicSizes.fullItemWidth});});},initTimelineLabel:function initTimelineLabel(e,n,s){var o=t("<span>").addClass(s["class"]);s.type!=="times"&&o.css({top:s.topPosition}),s.type==="times"?o.text(n[n.length-1].Period.split(" ")[1]+" &ndash; "+n[1].Period.split(" ")[1]):o.text(n[n.length-1].Values[0].Shows),e.append(o),r.off("changeTimelinePosition:"+s.type).on("changeTimelinePosition:"+s.type,function(e){var t="";s.type==="times"?t=n[e.dataIndex].Period.split(" ")[1]+" &ndash; "+n[e.dataIndex+1==n.length?1:e.dataIndex+1].Period.split(" ")[1]:t=i.number(n[e.dataIndex].Values[0].Shows).truncateFloat(1),o.html(t).css({left:e.leftPosition});});}}),this.initialize();};return{renderShort:function renderShort(e,t,n){new u(e,t,n);},renderFullAll:function renderFullAll(e,t){new u("workingFull",e,t),new u("commonFull",e,t);}};}),define("monitor.edit.form",["require","jquery","urls","tools","popup","jquery.designDropdowns","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("popup");return e("jquery.designDropdowns"),e("jquery.designForms"),new function(e){var s=this,o=window.langResource,u=t.extend({headerText:o.monitorsReport.editMonitor,linkCancel:"input.js-button-cancel",linkRemove:"input.js-button-remove",errorText:"div.error-text",hideByOverlay:!0,hideByEscape:!0},e||{});return t.extend(this,{show:function show(e,t){this.popup?this.popup.changeHeaderText(this.createHeaderText(e)):(this.popup=new i({containerClass:"popup_edit-monitor",headerText:this.createHeaderText(e),hideByOverlay:u.hideByOverlay,hideByEscape:u.hideByEscape}),this.$contentContainer=this.popup.$elBody.find(">div")),this.saveCallback=t.onSave,this.removeCallback=t.onRemove,this.currentMonitorId=e,this.$contentContainer.html(""),this.popup.showLoader(),this.load(e),this.popup.show();},createHeaderText:function createHeaderText(e){return u.headerText+" "+e;},load:function load(e){t.ajax({url:n.get("editMonitor",e),data:{id:e},poolName:"monitor.edit",success:function success(e){s.popup.hideLoader(),s.popup.addContent(e),s.popup.resize(),s.initControls(),s.initForm();}});},initControls:function initControls(){function p(e){r[e]?(a.show(),l.show(),h.data("hidden")==0&&h.show()):(f.val("").trigger("chosen:updated"),a.hide(),l.hide(),h.hide());}function d(e){i.prop("disabled",e!=="AutoUpdate").trigger("chosen:updated"),f.prop("disabled",e!=="Manual").trigger("chosen:updated");}this.$errorText=this.$contentContainer.find(u.errorText);var e=this.$contentContainer.find("select").chosen({placeholder_text:o.dropdowns.select,no_results_text:o.dropdowns.notFound}),n=e.filter('[name="GroupId"]'),r=n.data("routes"),i=e.filter('[name="VehicleId"]'),a=this.$contentContainer.find("#vehicleRow"),f=e.filter('[name="RouteId"]'),l=this.$contentContainer.find("#routeRow"),c=this.$contentContainer.find('input[name="RouteSelectionType"]'),h=this.$contentContainer.find("#selectionTypeRow");this.$errors=this.$contentContainer.find("[data-field-error]"),p(n.val()),n.change(function(){p(t(this).val());}),d(c.filter(":checked").val()),c.change(function(){d(t(this).val());}),this.$contentContainer.find("form").submit(function(){f.prop("disabled",!1);}),this.$contentContainer.find(u.linkCancel).click(function(){return s.popup.hide(),!1;}),this.$contentContainer.find(u.linkRemove).click(function(){return s.remove(),!1;});},initForm:function initForm(){var e=this.$contentContainer.find("form");e.submit(function(){return s.$errorText.hide(),s.$errors.empty(),t.post(n.get("editMonitor"),e.serialize()).success(function(t){t.success?(s.popup.hide(),r.is(s.saveCallback).fn()&&s.saveCallback({Label:e.find("#Label").val(),GroupTitle:e.find("#GroupId option:selected").text(),Description:e.find("#Description").val(),Type:e.find("#MonitorType").val()})):r.object(t.errors).each(function(e,t){this.$contentContainer.find('[data-field-error="'+e+'"]').html(t);},s);}),!1;});},remove:function remove(){var e=window.confirm(o.monitorsReport.removeMonitor);e==1&&(t.ajax({type:"POST",url:n.get("removeMonitor",this.currentMonitorId),success:function success(){r.is(s.removeCallback).fn()&&s.removeCallback(s.currentMonitorId);}}),this.popup.hide());}}),{show:function show(e,t){s.show(e,t);}};}();}),define("monitor.replace.form",["require","jquery","urls","tools","popup","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("popup");return e("jquery.designForms"),new function(e){var s=this,o=window.langResource,u=t.extend({headerText:o.monitorsReport.replaceMonitor,linkCancel:"input.js-button-cancel",hideByOverlay:!0,hideByEscape:!0},e||{});return t.extend(this,{show:function show(e,t){this.popup?this.popup.changeHeaderText(u.headerText):(this.popup=new i({containerClass:"popup_replace-monitor",headerText:u.headerText,hideByOverlay:u.hideByOverlay,hideByEscape:u.hideByEscape}),this.$contentContainer=this.popup.$elBody.find(">div")),this.saveCallback=t.onSave,this.currentMonitorId=e,this.$contentContainer.html(""),this.popup.showLoader(),this.load(e),this.popup.show();},load:function load(e){t.ajax({url:n.get("replaceMonitor",e),data:{id:e},poolName:"monitor.replace",success:function success(e){s.popup.hideLoader(),s.popup.addContent(e),s.popup.resize(),s.initControls(),s.initForm();}});},initControls:function initControls(){this.$errors=this.$contentContainer.find("[data-field-error]"),this.$contentContainer.find(u.linkCancel).click(function(){return s.popup.hide(),!1;});},initForm:function initForm(){var e=this.$contentContainer.find("form");e.submit(function(){return s.$errors.empty(),t.post(n.get("replaceMonitor"),e.serialize()).success(function(e){e.success?(s.popup.hide(),r.is(s.saveCallback).fn()&&s.saveCallback(s.currentMonitorId)):r.object(e.errors).each(function(e,t){this.$contentContainer.find('[data-field-error="'+e+'"]').html(t);},s);}),!1;});}}),{show:function show(e,t){s.show(e,t);}};}();}),define("monitor.monitorDetails",["require","jquery","underscore","urls","tools","events","monitor.monitorDetails.window","monitorDetails.graphics","monitor.monitorDetails.showedVideos","monitor.edit.form","monitor.replace.form"],function(e){"use strict";function l(e,t){var n=e.split(/\n/g).filter(function(e){return e.length>0;});return n.length<=f&&n.join("").length<t*f?null:(n=n.slice(0,f),n=n.join("<br />"),n.length>t*f&&(n=n.slice(0,t*f-3)+"..."),n);}var t=e("jquery"),n=e("underscore"),r=e("urls"),i=e("tools"),s=e("events"),o=e("monitor.monitorDetails.window"),u=e("monitorDetails.graphics"),a=e("monitor.monitorDetails.showedVideos"),f=3,c=new function(){var f=this,c={templateId_Minimal:"#template_monitor_details_minimal",templateId_Short:"#template_monitor_details",templateId_Full:"#template_monitor_details_full",elements:{buttonEdit:".js-monitor-edit",buttonReplace:".js-monitor-replace",buttonPrintScreen:".js-monitor-printscreen",buttonShowHistory:".js-button-history"}};t.extend(this,{load:function load(e,t){var n=r.get("monitorHistory",e);this.loadFromServer(n,e,t);},loadFull:function loadFull(e,t){var n=r.get("monitorFullHistory",e);this.loadFromServer(n,e,t);},loadFromServer:function loadFromServer(e,n,r){t.ajax({url:e,poolName:"monitor.getDetails",success:function success(e){var s=t.extend({Id:n},e);i.is(r).fn()&&r(s);}});},render:function render(e){var r=e.Details;return r.Description&&(r.ShortDescription=l(r.Description,30),r.Description=r.Description.replace(/\n/g,"<br/>")),r.IsNeedFullCard?(this.templateShort||(this.templateShort=n.template(t(c.templateId_Short).html())),this.templateShort(e)):(this.templateMinimal||(this.templateMinimal=n.template(t(c.templateId_Minimal).html())),this.templateMinimal(e));},renderFull:function renderFull(e){this.templateFull||(this.templateFull=n.template(t(c.templateId_Full).html()));var r=e.Details;return r.Description&&(r.ShortDescription=l(r.Description,100),r.Description=r.Description.replace(/\n/g,"<br/>")),this.templateFull(e);},initControls:function initControls(e,t){this.initEditMonitorLink(e,t),this.initMonitorPrintScreenLink(e,t),t.IsNeedFullCard&&(u.renderShort("workingShort",e,t),u.renderShort("commonShort",e,t)),this.initShowHistory(e,t),this.setEvents();},initControlsFull:function initControlsFull(e,t){a.init(e.find(">.md__content")),this.initEditMonitorLink(e,t),this.initReplaceMonitorLink(e,t),this.initMonitorPrintScreenLink(e,t),u.renderFullAll(e,t);},initEditMonitorLink:function initEditMonitorLink(t,n){t.find(c.elements.buttonEdit).click(function(){return e("monitor.edit.form").show(n.monitorId,{onSave:function onSave(e){i.is(n.onChangeDetails).fn()&&n.onChangeDetails(e);},onRemove:function onRemove(e){s.trigger("monitor:remove",e);}}),!1;});},initReplaceMonitorLink:function initReplaceMonitorLink(t,n){t.find(c.elements.buttonReplace).click(function(){return e("monitor.replace.form").show(n.monitorId,{onSave:function onSave(e){s.trigger("monitor:remove",e);}}),!1;});},initMonitorPrintScreenLink:function initMonitorPrintScreenLink(e,n){e.find(c.elements.buttonPrintScreen).click(function(){return t.ajax({type:"POST",url:r.get("monitorPrintScreen",n.monitorId)}),!1;});},initShowHistory:function initShowHistory(e,n){e.find(c.elements.buttonShowHistory).click(function(){return o.setContent(""),o.showLoader(),o.show(),f.loadFull(n.monitorId,function(e){o.hideLoader();var n=t(f.renderFull(e));o.setContent(n),f.initControlsFull(n,{monitorId:e.Id});}),!1;});},setEvents:function setEvents(){s.on("monitor:remove",function(){o.hide();});}});}();return{load:function load(e,t){c.load(e,t);},render:function render(e){return c.render(e);},initControls:function initControls(e,t){return c.initControls(e,t);}};}),define("monitor.filter.types.dictionary",[],function(){"use strict";return{none:"none",all:"all",inTransport:"inTransport",stationary:"stationary",before15Min:"before15Min",from15MinTo3Days:"from15MinTo3Days",more3Days:"more3Days"};}),define("monitor.monitorsMap",["require","jquery","underscore","urls","tools","events","googleMaps","googleMaps.infobox","googleMaps.markerIcons","googleMaps.clustering.hasError.styles","googleMaps.clustering.online.styles","googleMaps.clustering.offline.styles","monitor.monitorDetails","monitor.monitorsMap.markersCollection","monitor.filter.types.dictionary","googleMaps.markerClusterer"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("urls"),i=e("tools"),s=e("events"),o=e("googleMaps"),u=e("googleMaps.infobox"),a=e("googleMaps.markerIcons"),f=e("googleMaps.clustering.hasError.styles"),l=e("googleMaps.clustering.online.styles"),c=e("googleMaps.clustering.offline.styles"),h=e("monitor.monitorDetails"),p=e("monitor.monitorsMap.markersCollection"),d=e("monitor.filter.types.dictionary"),v=12,m=10,g={Offline:"Offline",HasError:"HasError",Online:"Online"},y=function y(_y2,b){var w=this,E=i.object(window.mapConfig).clone(),S=n.template('<span class="infobox__loader"><%= text %></span>'),x=window.langResource,T={fullOpened:"is-full-opened",buttonPressed:"is-pressed"},N={monitor:x.monitorsReport.monitor,loading:x.monitorsReport.loading},C=410,k=160;t.extend(this,{filterType:d.all,lastContact:[d.before15Min,d.from15MinTo3Days,d.more3Days],filterMapZoom:E.MapScale,initialize:function initialize(){this.markersCollection=new p(),this.setEvents(),this.renderMap();},setEvents:function setEvents(){s.on("monitors:changeType",function(e){w.filterType!==e&&(w.infoBox&&w.infoBox.getMap()&&w.infoBox.close(),w.filterType=e,w.filterMarkers());}).on("monitors:changeLastContact",function(e){w.lastContact.indexOf(e)===-1?w.lastContact.push(e):w.lastContact=w.lastContact.filter(function(t){if(t!==e)return t;}),w.filterMarkers();}).on("monitorsList:update",function(e){w.updateMarkers(e);}).on("monitorsList:selectMonitorByList",function(e){if(!w.isMapDrawn)return;var t=w.markersCollection.getById(e);t&&w.selectMarker(t.get("marker"));}).on("monitor:remove",function(e){var t=w.markersCollection.getById(e);t&&(w.selectedMarker.markerId==e&&(w.infoBox.close(),w.selectedMarker=undefined),t.get("marker").setMap(null),t.destroy());});},isVisible:function isVisible(e){var t=!0;if(w.filterType===d.inTransport&&e.IsStatic||w.filterType===d.stationary&&!e.IsStatic||w.filterType===d.none)t=!1;return t&&(w.lastContact.indexOf(d.more3Days)===-1&&e.HasError===!0?t=!1:w.lastContact.indexOf(d.from15MinTo3Days)===-1&&e.IsOnline===!1&&e.HasError===!1?t=!1:w.lastContact.indexOf(d.before15Min)===-1&&e.IsOnline===!0&&(t=!1)),t;},filterMarkers:function filterMarkers(){this.markersCollection.models.length&&(this.markersCollection.each(function(e){var t=w.isVisible(e.toJSON());e.set({isVisible:t});}),this.redrawMarkers());},renderMap:function renderMap(){o(function(t){e("googleMaps.markerClusterer"),w.maps=t,w.map=t.render({containerId:"#"+_y2[0].id,center:{lat:E.CityLatitude,lng:E.CityLongitude},zoomControl:!0,zoom:E.MapScale,onChangeScale:function onChangeScale(e){var t=e.getZoom();w.filterMapZoom!==t&&(t<=v&&w.infoBox&&w.infoBox.getMap()&&w.infoBox.close(),w.filterMapZoom=t,w.updateAllMarkerIcons());}});var n=t.createElement({"class":"btn-complete",text:'<a href="#" class="button-full-screen" onclick="return false"><i></i></a>',position:"TOP_RIGHT",map:w.map}).click(function(){var e=w.map.getCenter();return _y2.hasClass(T.fullOpened)?(_y2.removeClass(T.fullOpened),n.find(">a").removeClass(T.buttonPressed)):(_y2.addClass(T.fullOpened),n.find(">a").addClass(T.buttonPressed)),w.maps.resize(w.map),w.map.setCenter(e),!1;});w.isMapDrawn=!0;if(w.bufferMonitorsList&&w.bufferMonitorsList.length){var r=i.list(w.bufferMonitorsList).clone();w.renderMarkers(r),w.bufferMonitorsList=null;}});},updateMarkers:function updateMarkers(e){this.isMapDrawn?e&&e.length&&this.renderMarkers(e):this.bufferMonitorsList=e;},renderMarkers:function renderMarkers(e){this.markersCollection.models.length?(i.list(e).each(function(e){var t=w.markersCollection.getById(e.Id);if(t&&!t.get("marker").isDraggable){var n=t.get("marker"),r=w.maps.createPoint(e.LastLatitude,e.LastLongitude);n.setPosition(r),w.updateMarkerIcon(n,e),t.set(e),i.is(w.selectedMarker).defined()&&n.markerId==w.selectedMarker.markerId&&w.infoBox.getMap()&&w.infoBox.setPosition(r);}}),this.redrawMarkers()):(i.list(e).each(function(e){var t=w.createMarker(e);e.markerId=e.Id,e.marker=t,e.isVisible=w.isVisible(e),w.markersCollection.add(e);}),this.redrawMarkers());},redrawMarkers:function redrawMarkers(){var e=this.getVisibleMarkers();this.markerClusterer?i.object(g).each(function(t){w.markerClusterer[t].updateMarkers(e[t]);}):(this.markerClusterer={},i.object(g).each(function(t){w.markerClusterer[t]=w.createClusterer(t,e[t]);}));},createClusterer:function createClusterer(e,t){var n=c;return e===g.HasError?n=f:e===g.Online&&(n=l),new MarkerClusterer(this.map,t,{gridSize:30,maxZoom:m,styles:n});},getVisibleMarkers:function getVisibleMarkers(e){var t=this.markersCollection.filter(function(e){return e.get("isVisible")===!0;}),n=t.filter(function(e){return e.get("HasError")===!0;}).map(function(e){return e.get("marker");}),r=t.filter(function(e){return e.get("IsOnline")===!0;}).map(function(e){return e.get("marker");}),i=t.filter(function(e){return e.get("HasError")!==!0&&e.get("IsOnline")!==!0;}).map(function(e){return e.get("marker");});return{HasError:n,Online:r,Offline:i};},updateAllMarkerIcons:function updateAllMarkerIcons(){this.markersCollection.each(function(e){w.updateMarkerIcon(e.get("marker"),e.toJSON());});},updateMarkerIcon:function updateMarkerIcon(e,t){var n=this.getMapkerIcon(t);if(e.iconName!==n.iconName||e.rotation!==n.rotation)e.iconName=n.iconName,e.rotation=n.rotation,e.setIcon(n);},createMarker:function createMarker(e){var t=new this.maps.googleMaps.LatLng(e.LastLatitude,e.LastLongitude),n=this.getMapkerIcon(e),r=new this.maps.googleMaps.Marker({position:t,icon:n,zIndex:Math.round(t.lat()*-1e5)<<5});return r.markerId=e.Id,r.iconName=n.iconName,r.rotation=n.rotation,this.maps.googleMaps.event.addListener(r,"click",function(){s.trigger("monitorsList:selectMonitorByMap",r.markerId),w.selectMarker(r);}),this.setMarkerDragEvent(r),r;},setMarkerDragEvent:function setMarkerDragEvent(e){var t=this.maps.googleMaps.event;e.isDraggable=!1,t.addListener(e,"rightclick",function(){e.isDraggable?(e.setDraggable(!1),e.setIcon(a(e.iconName)),e.setZIndex(e.oldZIndex),t.clearListeners(e,"dragend")):(e.setDraggable(!0),e.setIcon(a("circleTransportStopDragging18")),e.oldZIndex=e.zIndex,e.setZIndex(1e6),t.addListener(e,"dragend",function(t){w.saveNewMarkerPosition(e.markerId,t.latLng.lat(),t.latLng.lng());})),e.isDraggable=!e.isDraggable;});},saveNewMarkerPosition:function saveNewMarkerPosition(e,n,i){t.ajax({url:r.get("changeMonitorPosition"),type:"POST",data:{id:e,latitude:n,longitude:i},success:function success(e){(!e||!e.success)&&alert("Unfortunately, new coordinates were not saved!");}});},getMapkerIcon:function getMapkerIcon(e){var t=this.map.getZoom()<=v,n=t?!1:this.hasMarkerVector(e),r=this.getMarkerName(e,t,n),i=a(r);return n&&(i.rotation=this.getMarkerAngle(e.LastLongitude,e.LastLatitude,e.PreLastLongitude,e.PreLastLatitude)+i.iconAngle),i;},getMarkerName:function getMarkerName(e,t,n){var r="",i="Grey";return e.HasError?i="Red":e.IsOnline&&(i="Green"),t?r="circle"+i+"10":e.IsStatic?r="stationary"+i+"16":(i==="Green"&&e.IsGpsIncorrect?r="circleStriped14":r="circle"+i+"13",n&&(r+="Vectored")),r;},hasMarkerVector:function hasMarkerVector(e){var t=e.LastLatitude,n=e.LastLongitude,r=e.PreLastLatitude,i=e.PreLastLongitude;return t&&n&&r&&i&&(t!==r||n!==i);},getMarkerAngle:function getMarkerAngle(e,t,n,r){if(e===n)return r>t?180:0;if(t===r)return n>e?-90:90;var i=Math.PI,s=0,o=n<e,u=r<t,a=Math.atan((r-t)/(n-e));return o&&u||o?s=90-a*180/i:s=270-a*180/i,s;},selectMarker:function selectMarker(e){this.selectedMarker&&this.selectedMarker==e&&w.infoBox.getMap()?w.infoBox.panBox_():(this.showInfoBox(e),b.isAgent||h.load(e.markerId,function(n){if(w.infoBox){var r=h.render(n);w.setInfoBoxContent(r),w.infoBox.panBox_(),setTimeout(function(){h.initControls(t(w.infoBox.div_).find(">div"),{monitorId:n.Id,IsNeedFullCard:n.Details.IsNeedFullCard,onChangeDetails:function onChangeDetails(t){setTimeout(function(){var n=e.markerId,r=w.markersCollection.getById(n),i=String(t.Type)==="2";r&&r.get("IsStatic")!==i&&(s.trigger("monitorsList:changeMonitorType",{monitorId:n,isStatic:i}),r.set("IsStatic",i),w.updateMarkerIcon(e,r.toJSON()));},750);}});},300);}}),this.selectedMarker=e),this.map.getZoom()<=v&&(this.filterMapZoom=v+1,this.map.setZoom(v+1),this.updateAllMarkerIcons());},showInfoBox:function showInfoBox(e){var t=b.isAgent,n=S({text:t?N.monitor+" "+e.markerId:N.loading});this.infoBox?this.setInfoBoxContent(n):this.infoBox=new u({content:n,boxClass:"infobox infobox_md"+(t?" short":""),pixelOffset:new this.maps.googleMaps.Size(-(t?k:C)/2,0),infoBoxClearance:new this.maps.googleMaps.Size(40,50),alignBottom:!0,maxWidth:0}),this.infoBox.open(this.map,e);},setInfoBoxContent:function setInfoBoxContent(e){this.infoBox&&this.infoBox.setContent(e);}}),this.initialize();};return function(e,t){e&&e.length&&window.mapConfig&&new y(e,t);};}),define("monitor.monitorsList.collection",["require","backbone","tools"],function(e){"use strict";var t=e("backbone"),n=e("tools");return t.Collection.extend({sortProperty:"LastContact",sortOrder:"Asc",getById:function getById(e){var t=this.where({monitorId:Number(e)});return t.length?t[0]:null;},getNew:function getNew(e){var t=n.list(e).clone(),r=this.toJSON();return n.list(r).each(function(e){n.list(t).each(function(n,r){if(e.monitorId==n.Id)return t.splice(r,1),!1;});}),t;},getObsoleteMonitors:function getObsoleteMonitors(e){var t=n.list(e).clone(),r=this.toJSON(),i=[];return n.list(t).each(function(e){n.list(r).each(function(t,n){if(t.monitorId==e.Id)return r.splice(n,1),!1;});}),r.length&&n.list(r).each(function(e){i.push(e.monitorId);}),i;}});}),define("monitor.monitorsList",["require","jquery","urls","tools","events","templates.storage","monitor.monitorsList.collection","monitor.filter.types.dictionary"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("events"),s=e("templates.storage"),o=e("monitor.monitorsList.collection"),u=e("monitor.filter.types.dictionary"),a=1e4,f=100,l=function l(e){var l=this,c="#template_monitor_list_item",h={sortCells:".js-sort",noSeach:".js-no-search"},p={hidden:"is-hidden",selected:"selected"};t.extend(this,{searchTerm:"",lastContact:[u.before15Min,u.from15MinTo3Days,u.more3Days],filterType:u.all,initialize:function initialize(){this.monitorsCollection=new o(),this.$headContainer=e.find(">thead"),this.$listContainer=e.find(">tbody"),this.$noSearch=e.find(h.noSeach),e.removeClass(p.hidden),this.setEvents(),this.load(function(){var e=window.location.href.split("?");e.length===2&&r.list(e[1].split("&")).each(function(e){var t=e.split("=");if(t.length===2&&t[0].toLowerCase()==="monitorid"){var n=t[1],r=l.monitorsCollection.getById(n);r&&(l.selectMonitorCell(n,r.get("$cell")),setTimeout(function(){i.trigger("monitorsList:selectMonitorByList",n);},1500));}});}),this.setUploadingTimer();},setEvents:function setEvents(){i.on("monitors:changeSearch",function(e){var t=e.toLowerCase();l.searchTerm!==t&&(l.searchTerm=t,l.filterMonitors());}).on("monitorsList:changeMonitorType",function(e){var t=l.monitorsCollection.getById(e.monitorId);t&&(l.setUploadingTimer(),t.set("isStatic",e.isStatic),l.filterMonitors());}).on("monitors:changeType",function(e){l.filterType!==e&&(l.filterType=e,l.filterMonitors());}).on("monitors:changeLastContact",function(e){l.lastContact.indexOf(e)===-1?l.lastContact.push(e):l.lastContact=l.lastContact.filter(function(t){if(t!==e)return t;}),l.filterMonitors();}).on("monitorsList:selectMonitorByMap",function(e){var t=l.monitorsCollection.getById(e);t&&l.selectMonitorCell(e,t.get("$cell"));}).on("monitor:remove",function(e){var t=l.monitorsCollection.getById(e);t&&(l.selectedMonitorId==e&&(l.selectedMonitorId=undefined),t.get("$cell").remove(),t.destroy());}),this.$headContainer.find(h.sortCells).click(function(){var e=t(this),n=e.data("sort-property");l.monitorsCollection.sortProperty==n?l.monitorsCollection.sortOrder=="Asc"?(l.monitorsCollection.sortOrder="Desc",e.removeClass("sort-asc").addClass("sort-desc")):(l.monitorsCollection.sortOrder="Asc",e.removeClass("sort-desc").addClass("sort-asc")):(l.$headContainer.find(h.sortCells).removeClass("sort-asc").removeClass("sort-desc"),l.monitorsCollection.sortProperty=n,l.monitorsCollection.sortOrder="Asc",e.addClass("sort-asc")),l.load();});},isVisible:function isVisible(e){var t=!0;if(l.filterType===u.inTransport&&e.isStatic||l.filterType===u.stationary&&!e.isStatic||l.filterType===u.none)t=!1;return t&&l.searchTerm.length>0&&!l.hasParamSearchTerm(e.monitorId)&&!l.hasParamSearchTerm(e.label)&&!l.hasParamSearchTerm(e.groupTitle)&&(t=!1),t&&(l.lastContact.indexOf(u.more3Days)===-1&&e.hasError===!0?t=!1:l.lastContact.indexOf(u.from15MinTo3Days)===-1&&e.isOnline===!1&&e.hasError===!1?t=!1:l.lastContact.indexOf(u.before15Min)===-1&&e.isOnline===!0&&(t=!1)),t;},load:function load(e){t.ajax({url:n.get("getMonitorsListInfo"),poolName:"monitorsList",data:{SortProperty:this.monitorsCollection.sortProperty,SortOrder:this.monitorsCollection.sortOrder},success:function success(t){t.Success&&t.MonitorsList&&(i.trigger("monitorsList:update",t.MonitorsList),l.updateMonitors(t.MonitorsList)),r.is(e).fn()&&e();}});},render:function render(e){return this.template||(this.template=s.get(c)),this.template(e);},updateMonitors:function updateMonitors(e){this.$listContainer.html(""),this.monitorsCollection.reset(),r.list(e).each(function(e){var n=r.object(e).clone();r.is(l.selectedMonitorId).defined()&&l.selectedMonitorId==n.Id&&(n.IsSelected=!0);var i={monitorId:n.Id,isStatic:n.IsStatic,label:n.Label,groupTitle:n.GroupTitle,hasError:n.HasError,isOnline:n.IsOnline},s=l.isVisible(i),o=t(l.render(n));s||o.addClass(p.hidden),l.$listContainer.append(o),l.initCellControls(n.Id,o),i.$cell=o,l.monitorsCollection.add(i);});},filterMonitors:function filterMonitors(){this.monitorsCollection.models.length&&(this.monitorsCollection.each(function(e){var t=l.isVisible(e.toJSON());e.set({isVisible:t});}),this.redrawMonotors());},redrawMonotors:function redrawMonotors(){var e=!1;this.monitorsCollection.each(function(t){var n=t.get("isVisible");n&&(e=!0),t.get("$cell")[n?"removeClass":"addClass"](p.hidden);}),this.$noSearch[e?"addClass":"removeClass"](p.hidden);},hasParamSearchTerm:function hasParamSearchTerm(e){return String(e).toLowerCase().indexOf(this.searchTerm)!==-1;},initCellControls:function initCellControls(e,t){t.click(function(){l.selectMonitorCell(e,t),i.trigger("monitorsList:selectMonitorByList",e);});},selectMonitorCell:function selectMonitorCell(e,t){if(this.selectedMonitorId){var n=this.monitorsCollection.getById(this.selectedMonitorId);n&&n.get("$cell").removeClass(p.selected);}t.addClass(p.selected),this.selectedMonitorId=e,this.scrollToCell(e);},scrollToCell:function scrollToCell(t){var n=this.monitorsCollection.getById(t);if(!n)return;var r=n.get("$cell"),i=r.position().top,s=e.parent(),o=s.scrollTop();i<0?s.animate({scrollTop:o+i-1},f):i+r.outerHeight()-s.height()>0&&s.animate({scrollTop:o+(i+r.outerHeight())-s.height()+1},f);},setUploadingTimer:function setUploadingTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){l.load(),l.setUploadingTimer();},a);}}),this.initialize();};return function(e){e&&e.length&&new l(e);};}),define("monitor.monitorFilterWindow",["require","jquery","tools","events","templates.storage","monitor.filter.types.dictionary"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("events"),i=e("templates.storage"),s=e("monitor.filter.types.dictionary"),o=function o(e,_o6){var u=this,a="#template_monitor_filter_window",f={checkbox:".js-monitor-checkbox",sortCells:".js-sort",noSeach:".js-no-search",backlayer:".js-filter-monitor-backlayer"},l={hidden:"is-hidden",selected:"selected"};t.extend(this,{checkboxChecked:"checkboxChecked",checkboxes:["inTransport","stationary","before15Min","from15MinTo3Days","more3Days"],initialize:function initialize(){this.initTemplateState(),this.render(),r.on("monitorsList:filterButtonClick",function(e){u.displayWindow(e);});},initTemplateState:function initTemplateState(){n.list(u.checkboxes).each(function(e){u[e]=!0;});},displayWindow:function displayWindow(t){t?e.show():e.hide();},render:function render(r){var s={};n.list(u.checkboxes).each(function(e){s[e]=u[e]===!0?"checkboxChecked":"";});var o=t(i.get(a)(s));e.html(o),this.initCheckboxEvents();},updateState:function updateState(e){this[e]=!this[e],this.inTransport&&this.stationary?r.trigger("monitors:changeType",s.all):this.inTransport||this.stationary?r.trigger("monitors:changeType",this.inTransport?s.inTransport:s.stationary):!this.inTransport&&!this.stationary&&r.trigger("monitors:changeType",s.none),e==="before15Min"?r.trigger("monitors:changeLastContact",s[e]):e==="from15MinTo3Days"?r.trigger("monitors:changeLastContact",s[e]):e==="more3Days"&&r.trigger("monitors:changeLastContact",s[e]),this.render();},initCheckboxEvents:function initCheckboxEvents(){n.list(e.find(f.checkbox)).each(function(e){t(e).click(function(n){u.updateState(t(e).find("input").attr("id"));});});}}),this.initialize();};return function(e){e&&e.length&&new o(e);};}),define("monitor.monitorsreport.action",["require","base","jquery","events","searchBox","monitor.monitorsMap","monitor.monitorsList","monitor.monitorFilterWindow"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("events"),i=e("searchBox"),s=e("monitor.monitorsMap"),o=e("monitor.monitorsList"),u=e("monitor.monitorFilterWindow");return new t.Action({initialize:function initialize(e){new i({$container:n("#searchBox"),onSearch:function onSearch(e){r.trigger("monitors:changeSearch",e);},onFilterClick:function onFilterClick(e){r.trigger("monitorsList:filterButtonClick",e);}}),s(n("#monitorsMap"),e),o(n("#monitorsList")),u(n("#filterMonitorWindow"));}});}),define("monitor.controller",["require","base","monitor.history.action","monitor.monitorsreport.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{history:function history(t){e("monitor.history.action").initialize(t);},monitorsreport:function monitorsreport(t){e("monitor.monitorsreport.action").initialize(t);}}});}),define("partner.list.list",["require","jquery","urls","tools","datePicker","rangeDatePicker","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("datePicker"),s=e("rangeDatePicker");e("jquery.designForms");var o=window.langResource,u={list:"#partnersList",formSwitch:".js-form-switch",buttonCharges:"#buttonCharges",panel:"#partnersPaymentPanel",buttonSaveCharges:"#buttonSaveCharges",buttonHideCharges:"#buttonHideCharges",fieldId:"input.js-field-id",fieldDate:"input.js-charges-date",fieldDateGap:".js-charges-date-gap",fieldSum:"input.js-charges-sum",fieldComment:"input.js-charges-comment"},a={pressed:"is-pressed",chargesVisible:"visible-charges",visible:"is-visible",today:"today"},f=function f(){var e=this,f=t(".filter-partners"),l=f.children(),c=t("#rangeDate"),h=t(".js-download-reports__form"),p=h.find(".js-download-reports__start"),d=h.find(".js-download-reports__finish"),v=h.find(".js-download-reports__is-filtered"),m=t(".js-button-download");t.extend(this,{initialize:function initialize(){this.initDownload(),this.$list=t(u.list),this.initEnableDisablePartner(),this.initCharges();},initDownload:function initDownload(){c.on("focus",this.onRangeDataFocus),f.on("click",this.onFilterCheckboxClick),m.on("click",this.onDownloadClick);},onRangeDataFocus:function onRangeDataFocus(){s.show({$target:c,resultDatesFormat:"dd M yy",onSelect:function onSelect(e,t,n){var r=n.split("&ndash;"),i="";r[0]===r[1]?i=r[0]:i=o.partnerGroup.from+" "+r[0]+" "+o.partnerGroup.to+" "+r[1],c.val(i),p.val(e),d.val(t),m[i?"removeClass":"addClass"]("is-disabled");}});},onFilterCheckboxClick:function onFilterCheckboxClick(){var e=v.val();e==="true"?(v.val(!1),l.removeClass("checkboxChecked")):(v.val(!0),l.addClass("checkboxChecked"));},onDownloadClick:function onDownloadClick(){var e=p.val(),t=d.val(),n=v.val();e.length&&t.length&&n.length&&h.submit();},initEnableDisablePartner:function initEnableDisablePartner(){this.$list.find(u.formSwitch).each(function(){var n=t(this),r=n.attr("action"),i=n.find('[name="Enabled"]'),s=n.find(":checkbox");e.enableDisableCheckbox(s,!1),s.change(function(){var u=i.val()==="true";e.enableDisableCheckbox(s,!0);var a=t.post(r,n.serialize()).done(function(e,t){if(a.getResponseHeader("X-Unauthorized")==="True"){window.location.reload();return;}t==="success"&&i.val(!u);}).fail(function(){alert(o.requestError);}).always(function(){e.enableDisableCheckbox(s,!1);});});});},enableDisableCheckbox:function enableDisableCheckbox(e,t){e.prop("disabled",t).trigger("design:update");},initCharges:function initCharges(){var s=t(u.buttonCharges),o=t(u.panel),f=!1,l=new Date();this.$list.find(u.fieldDate).each(function(){var e=t(this).siblings(u.fieldDateGap).addClass(a.today),n=new i(t(this),{$gapEl:e,maxDate:new Date(),dateFormatForUI:"dd.mm.yy",onSelect:function onSelect(t){e[t===r.date(new Date()).format("yy/mm/dd")?"addClass":"removeClass"](a.today);}});n.setDate(l);}),s.click(function(){e.$list[f?"removeClass":"addClass"](a.chargesVisible),s[f?"removeClass":"addClass"](a.pressed),o[f?"removeClass":"addClass"](a.visible),f=!f;});var c=o.find(u.buttonSaveCharges).prop("disabled",!1).click(function(){var r=e.getSerializedCharges();r.length&&(c.prop("disabled",!0),h.prop("disabled",!0),t.post(n.get("payForManyPartners"),{forms:r}).done(function(){window.location.reload();}).always(function(){c.prop("disabled",!1),h.prop("disabled",!1);}));}),h=o.find(u.buttonHideCharges).prop("disabled",!1).click(function(){s.click();});},getSerializedCharges:function getSerializedCharges(){var e=[];return this.$list.find("tr").each(function(){var n=t(this),r=n.find(u.fieldSum).val();r&&e.push({PartnerId:n.find(u.fieldId).val(),DateTime:n.find(u.fieldDate).val(),Amount:r,Comment:n.find(u.fieldComment).val()});}),e;}}),this.initialize();};return function(){new f();};}),define("partner.list.action",["require","base","jquery","partner.list.list"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("partner.list.list");return new t.Action({initialize:function initialize(e){r();}});}),define("partner.settings.form",["require","jquery","backbone","tools","jquery.inputMask","googleMaps"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=e("tools");e("jquery.inputMask");var i=function i(_i8,s){var o=this,u=t.extend({latitude:"#CityMapLatitude",longitude:"#CityMapLongitude",mapScale:"#CityMapScale",fields:{commonQuestionPart:" ,    ",maxAdsPercentEl:"#MaxAdsPercent",maxAdsPercentQuestion:"   ",maxAdsCountInRowEl:"#MaxAdsCountInRow",maxAdsCountInRowQuestion:"   ",emergency:".js-emergency"},map:{el:"#cityMap",depotRadius:100}},s||{});t.extend(this,{initialize:function initialize(){this.initMaxAdsPercent(),this.initMaxAdsCountInRow(),this.setContents(),this.initSubmit(),this.initMap(),this.initLogoUploadControls();},setContents:function setContents(){o.$cityLat=t(u.latitude).val(window.mapConfig.latitude),o.$cityLng=t(u.longitude).val(window.mapConfig.longitude),o.$mapScale=t(u.mapScale).val(window.mapConfig.scale);},initSubmit:function initSubmit(){_i8.submit(function(e){e.preventDefault();var t=[],n=Number(o.$maxAdsPercent.val());r.is(n).number()&&n>0&&n<o.maxAdsPercentValue&&t.push(u.fields.maxAdsPercentQuestion);var i=Number(o.$maxAdsCountInRow.val());r.is(i).number()&&i>0&&i<o.maxAdsCountInRowValue&&t.push(u.fields.maxAdsCountInRowQuestion);if(t.length){var s=window.confirm(u.fields.commonQuestionPart+t.join("  ")+"?");s===!0&&o.saveData();}else o.saveData();return!1;});},saveData:function saveData(){var e={Login:t("#Login").val(),Password:t("#Password").val(),IsSmsAuthEnabled:t("#IsSmsAuthEnabled").is(":checked"),PartnerId:t("#PartnerId").val(),MaxAdsPercent:t.trim(this.$maxAdsPercent.val()),MaxAdsCountInRow:t.trim(this.$maxAdsCountInRow.val()),CostPerSecond:t.trim(t("#CostPerSecond").val()),CostPerGpsSecond:t.trim(t("#CostPerGpsSecond").val()),IsMcsEnabled:t("#IsMcsEnabled").is(":checked"),SelectedCurrency:t.trim(t("#SelectedCurrency").val()),EmailForInfo:t.trim(t("#EmailForInfo").val()),Depots:o.getDepotsData(),CityMapLatitude:o.$cityLat.val(),CityMapLongitude:o.$cityLng.val(),CityMapScale:o.$mapScale.val(),GpsIntegrationHost:t.trim(t("#GpsIntegrationHost").val()),GpsIntegrationPort:t.trim(t("#GpsIntegrationPort").val())};e.Emergencies=[],t(u.fields.emergency).map(function(){e.Emergencies.push({EmergencyId:t(this).data("id"),IsEnabled:t(this).is(":checked")});}),t.ajax({url:_i8.attr("action"),type:"POST",data:e,dataType:"json",success:function success(e){e.success?window.location.href=e.redirect:(t("#"+e.errorKey).addClass("error"),t("#"+e.errorKey).next().html(e.errorMessage));}});},initMaxAdsPercent:function initMaxAdsPercent(){this.$maxAdsPercent=_i8.find(u.fields.maxAdsPercentEl),this.$maxAdsPercent.val(this.$maxAdsPercent.data("value")),this.maxAdsPercentValue=Number(this.$maxAdsPercent.val());},initMaxAdsCountInRow:function initMaxAdsCountInRow(){this.$maxAdsCountInRow=_i8.find(u.fields.maxAdsCountInRowEl),this.$maxAdsCountInRow.val(this.$maxAdsCountInRow.data("value")),this.maxAdsCountInRowValue=Number(this.$maxAdsCountInRow.val());},initMap:function initMap(){this.collectionDepots=new n.Collection(),e("googleMaps")(function(e){o.maps=e,o.map=e.render({containerId:u.map.el,center:{lat:Number(o.$cityLat.val()),lng:Number(o.$cityLng.val())},mapTypeControl:!0,navigationControl:!0,zoomControl:!0,zoom:Number(o.$mapScale.val())||1,onChangeCenter:function onChangeCenter(e){o.$cityLat.val(e.getCenter().lat()),o.$cityLng.val(e.getCenter().lng());},onChangeScale:function onChangeScale(e){o.$mapScale.val(e.getZoom());},onClick:function onClick(e,t){o.unselectAllDepots(),o.renderDepot(t.latLng,u.map.depotRadius);}}),o.renderDepotsList();});},renderDepotsList:function renderDepotsList(){var e;r.list(window.mapConfig.depots).each(function(t){e=o.maps.createPoint(t.CenterLatitude,t.CenterLongitude),o.renderDepot(e,t.Radius,!1);});},renderDepot:function renderDepot(e,t,r){var i=new n.Model(),s={map:this.map,center:e,radius:t,selected:r,fillColor:"#ed4a30",strokeColor:"#ed4a30",onClick:function onClick(e){e.isSelected||o.unselectAllDepots();},onRemove:function onRemove(){i.destroy();}};r===!1?s.fillOpacity=.35:s.fillOpacity=.6;var u=this.maps.createCircle(s);i.set({circle:u,isSelected:r}),this.collectionDepots.add(i);},unselectAllDepots:function unselectAllDepots(){var e;r.list(this.collectionDepots.models).each(function(t){e=t.get("circle"),e.isSelected&&(e.setOptions({fillOpacity:.35}),e.canEditable(!1),e.buttonRemove.hide(),e.swapSelection());});},getDepotsData:function getDepotsData(){var e=[],t;return r.list(this.collectionDepots.models).each(function(n){t=n.get("circle"),e.push({CenterLatitude:t.getCenter().lat(),CenterLongitude:t.getCenter().lng(),Radius:Math.round(t.getRadius())});}),e;},initLogoUploadControls:function initLogoUploadControls(){var e=t("#uploadLogoForm"),n=e.find("#File"),r=e.find(".logo-upload-validation-field");e.find(".logo-upload-submit").click(function(){var t=n[0].files[0];if(t==undefined){r.removeClass("field-validation-valid").addClass("field-validation-error"),r.text("   ");return;}var i=new FormData();i.append("File",t,t.name);var s=new XMLHttpRequest();s.open("POST",e.attr("action"),!0),s.onload=function(){var e=JSON.parse(s.response);e.success==0&&(r.removeClass("field-validation-valid").addClass("field-validation-error"),r.text(e.errMsg)),e.success==1&&(window.location.href=e.redirectUrl);},s.send(i);}),n.change(function(){var e=this.files[0];e==undefined?t(".js-upload-file-name").html(" "):t(".js-upload-file-name").html(e.name),r.removeClass("field-validation-error").addClass("field-validation-valid"),r.empty();});}}),this.initialize();};return function(e,t){e&&e.length&&window.mapConfig&&new i(e,t);};}),define("partner.settings.action",["require","base","jquery","partner.settings.form"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(t){e("partner.settings.form")(n("#partnerSettingsForm"),t),n("#SelectedCurrency").chosen();}});}),define("requisitions.form",["require","jquery","tools"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=function r(e){var r=this,i={field:"div.js-field",switcher:"div.js-person-type",tariffBlock:"#tariff",linkToOpenTariff:"a.js-link-to-tariff"},s={error:"error"},o=250;t.extend(this,{initialize:function initialize(){this.initSwitcher(),this.initForm(),this.initTariff();},initSwitcher:function initSwitcher(){this.$fields=e.find(i.field),this.$radios=e.find(i.switcher+" input:radio").prop("checked",!1).on("change",function(){r.$fields.hide().filter('[data-type="'+t(this).data("type")+'"]').show();}),this.$radios.filter('[data-current="true"]').prop("checked",!0).change();},initTariff:function initTariff(){var t=e.find(i.tariffBlock);e.find(i.linkToOpenTariff).click(function(){return t.is(":hidden")?t.slideDown(o):t.slideUp(o),!1;});},initForm:function initForm(){var i,o={},u;this.$fields.find("input:text").on("keydown",function(){var e=t(this);setTimeout(function(){t.trim(e.val())&&e.removeClass(s.error);},20);}),this.$agreeCheckbox=e.find("input:checkbox"),e.show().submit(function(){i=!0,o=r.getFormParams(),u=o.IsJuristicPerson==="true"?"juristic":"personal",n.list(r.$fields.filter('[data-type="'+u+'"]').find("input:text")).each(function(e){r.validateField(t(e))||(i=!1);}),r.$agreeCheckbox.length&&(r.$agreeCheckbox.is(":checked")?r.$agreeCheckbox.parent().removeClass(s.error):(r.$agreeCheckbox.parent().addClass(s.error),i=!1));if(!i)return!1;});},getFormParams:function getFormParams(){var t={};return n.list(e.serializeArray()).each(function(e){t[e.name]=e.value;}),t;},validateField:function validateField(e){var n=t.trim(e.val());return e[n?"removeClass":"addClass"](s.error),n!=="";}}),this.initialize();};return function(e){e&&e.length&&new r(e);};}),define("partner.requisitions.action",["require","base","jquery","requisitions.form"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(){e("requisitions.form")(n("#form"));}});}),function(e){function r(e,t,n){var r="([A-Za-z--0-9_])",i=new RegExp(r+(isNaN(parseInt(t,10))?"\\":"")+t+r,"g");return e.replace(i,function(e,r,i){return r+(n=="before"?"<wbr/>"+t:t+"<wbr/>")+i;});}function i(e,t){for(var n=0,i=t.length;n<i;n++){e=r(e,t[n].symbol,t[n].position);}return e;}function s(e,t){var r;if(e.indexOf(",")!=-1){r=e.split(",");for(var s=0,o=r.length;s<o;s++){r[s].length>n&&(r[s]=i(r[s],t));}return r.join(",<wbr/>");}return i(e,t);}function o(e){var t,n=[];for(var r=0,i=e.rules.length;r<i;r++){t=e.rules[r].symbols.replace(/\s+/g,"").split(",");for(var s=0,o=t.length;s<o;s++){n.push({symbol:t[s],position:e.rules[r].position});}}return n;}var t="wordWrapUsed",n=20;e.fn.wordWrap=function(r){var i=this,u={};if(!i.length)return i;if(r&&r.wordMaxLength&&r.wordPartLength)u=r,i.each(function(){var n=e(this);if(n.hasClass(t))return;var r=n.html().split(" ");if(!r.length)return;for(var i=0,s=r.length;i<s;i++){if(r[i].length>u.wordMaxLength){var o=0,a=[],f=r[i].length;while(o<f){a.push(r[i].substr(o,u.wordPartLength)),o+=u.wordPartLength;}r[i]=a.join('<wbr style="display:inline-block" />');}}n.addClass(t).html(r.join(" "));});else{u=e.extend({rules:[{symbols:'(, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, "',position:"before"},{symbols:"), @, |, /, -, +, _, .",position:"after"}]},r||{});var a,f=o(u),l,c,h,p,d,v;for(l=0,c=i.length;l<c;l++){d=i.eq(l);if(!d.hasClass(t)){d.addClass(t),v=e.trim(d.text()),a=v.split(" ");for(h=0,p=a.length;h<p;h++){a[h].length>n&&(a[h]=s(a[h],f));}d.html(a.join(" ")),d.find("wbr").css("display","inline-block");}}}return i;};}(jQuery),define("jquery.wordWrap",["jquery"],function(){}),define("partner.addoredit.action",["require","base","jquery","urls","tooltipConfirm","jquery.inputMask","jquery.designDropdowns","jquery.wordWrap"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("urls"),i=e("tooltipConfirm"),s=r.get("partnerList");e("jquery.inputMask"),e("jquery.designDropdowns"),e("jquery.wordWrap");var o=n("#IsSmsAuthEnabled"),u=n(".js-sms-auth-phone--tr"),a=n(".js-sms-auth-code--tr"),f=n(".js-sms-auth-get-code--tr"),l=n(".js-get-code-button"),c=n(".js-remain-sec"),h="a.js-partner-hide",p="is-disabled",d=window.langResource,v={placeholderText:d.dropdowns.select,emptySearchText:d.dropdowns.notFound};return new t.Action({initialize:function initialize(e){function t(){var e=this;l.on("click",function(){n.ajax({url:"/Authorization/ResendConfirmation",method:"POST",contentType:"application/json",data:JSON.stringify({userPhoneNumber:n("#UserPhoneNumber").inputmask("unmaskedvalue")})}).done(function(e){e.success==0&&n(".code-valid-ajax").text(e.errMsg);}).error(function(){n(".code-valid-ajax").text(" 500 error");}),l.addClass(p),l.off("click"),m();});}function m(){function s(){c.html(" "+Math.round((n-(Date.now()-r))/1e3)+" .");}var e=this,n=15e4,r=Date.now(),i=setInterval(s,1e3);setTimeout(function(){clearInterval(i),c.html(""),l.removeClass(p),t();},n);}function g(){var e=!1,t=n("#PartnerId").val();if(!t)return;var o=n(h),u=i(o,{headerText:d.partner.tooltipConfirmHideHeading,contentText:d.partner.tooltipConfirmHideText,buttonApplyText:d.partner.tooltipConfirmHideButtonApply,buttonCancelText:d.partner.tooltipConfirmHideButtonCancel,onApply:function onApply(){e=!0,o.addClass(p),n.post(r.get("partnerHide"),{Id:t}).done(function(){window.location.href=s;}).fail(function(){e=!1,o.removeClass(p);});}});o.removeClass("is-hidden").click(function(){return e||u.show(),!1;});}n("#formPartner").find("select").chosen({placeholder_text:v.placeholderText,no_results_text:v.emptySearchText}),n("#UserPhoneNumber").inputmask("+9-999-99-99-999",{oncomplete:function oncomplete(){n('[data-valmsg-for="UserPhoneNumber"]').text("").remove();}}),n("#UserPhoneConfirmCode").inputmask("999999"),n("form").submit(function(){if(n(".field-validation-error").length)return;n("#UserPhoneNumber").inputmask("remove"),n("#UserPhoneConfirmCode").inputmask("remove");}),o.is(":checked")||(u.hide(),a.hide(),f.hide()),o.click(function(){this.checked?(u.show(),a.show(),f.show()):(u.hide(),a.hide(),f.hide());}),g(),t(),n(".js-email").wordWrap();}});}),function(e){"use strict";function x(e){if(!e)return"";var t="",n;for(n=0;n<e.length;n+=1){t+=S[e.charAt(n)]||e.charAt(n);}return t;}function T(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");}function N(e){if(!e)return;if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n;}}function C(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select();}}function k(e){return e!==undefined;}function L(t,n,r,i){return k(t)&&!e.isArray(t)?e.isFunction(t)?t.apply(this,n):i:k(r)?L.call(this,r,n):i;}function A(e,t,n,r){var i;return L.call(this,k(this.source[t])&&Object.prototype.hasOwnProperty.call(this.source[t],e)?this.source[t][e]:i,n,function(){return L.call(this,k(this[e][t])?this[e][t]:k(this[e][0])?this[e][0]:Object.prototype.hasOwnProperty.call(this,e)?this[e]:i,n,g[e][t]||g[e][0]||g[e],r);},r);}function O(t,n){k(n)||(n=0);if(e.isArray(this.source)&&k(this.source[n])&&k(this.source[n][t]))return this.source[n][t];if(k(this[t]))return e.isArray(this[t])?k(this[t][n])?this[t][n]:k(this[t][0])?this[t][0]:null:this[t];return null;}function M(t,n,r,i){n.xhr&&n.xhr.abort(),n.xhr=e.ajax(e.extend(!0,{url:t,type:"GET",async:!0,cache:!1,dataType:"json"},n.ajax)).done(function(t){r&&r.apply(this,e.makeArray(arguments));}).fail(function(e,t){i&&console.log("Request failed: "+t);});}function _(e,t){var n=!1,r;for(r=0;r<e.length;r+=1){if(n=A.call(this,"findRight",r,[e[r],t,r]))return{right:n,source:r};}return!1;}function D(e,t){var n;H.call(this,e,t);for(n=0;n<e.length;n+=1){e[n]=A.call(this,"filter",n,[e[n],t,n],e[n]);}}function P(t,n,r){var i=this,s;if(e.isFunction(i.source))i.source.apply(i,[t,function(e){n=[e],L.call(i,r,[t]);},n,0]);else for(s=0;s<i.source.length;s+=1){if(e.isArray(i.source[s]))n[s]=i.source[s];else if(e.isFunction(i.source[s]))(function(s){i.source[s].apply(i,[t,function(o){n[s]||(n[s]=[]);if(o&&e.isArray(o))switch(i.appendMethod){case"replace":n[s]=o;break;default:n[s]=n[s].concat(o);}L.call(i,r,[t]);},n,s]);})(s);else switch(i.source[s].type){case"remote":if(k(i.source[s].url))if(!k(i.source[s].minLength)||t.length>=i.source[s].minLength){var o=A.call(i,"replace",s,[i.source[s].url,t],"");n[s]||(n[s]=[]),function(e){M(o,i.source[e],function(s){n[e]=s,L.call(i,r,[t]);},i.debug);}(s);}break;default:k(i.source[s].data)?n[s]=i.source[s].data:n[s]=i.source[s];}}L.call(i,r,[t]);}function H(e,t){for(var n=0;n<e.length;n++){e[n]=A.call(this,"preparse",n,[e[n],t],e[n]);}}function B(t,n){var r,i,s,o=[];for(r=0;r<t.length;r+=1){for(i=0;i<t[r].length;i+=1){if(o.length>=this.limit)break;s=e(A.call(this,"render",r,[t[r][i],r,i,n],"")),s.data("source",r),s.data("pid",i),s.data("item",t[r][i]),o.push(s);}}return o;}function j(e,t){return k(e.data("source"))&&k(e.data("pid"))&&k(t[e.data("source")])&&k(t[e.data("source")][e.data("pid")])?t[e.data("source")][e.data("pid")]:!1;}function F(e,t){var n=j(e,t);return n?A.call(this,"getValue",e.data("source"),[n,e.data("source")]):k(e.data("value"))?decodeURIComponent(e.data("value")):e.html();}function I(a,c){function U(){if(x.val()==H)return;H=x.val();if(H.length<c.minLength){x.trigger("close.xdsoft");return;}P.call(c,H,L,function(e){if(e!=H)return;var t;D.call(c,L,e),x.trigger("updateContent.xdsoft");if(c.showHint&&H.length&&H.length<=x.prop("size")&&(t=_.call(c,L,H))){var n=A.call(c,"getTitle",t.source,[t.right,t.source]);n=e+n.substr(e.length),S.val(n);}else S.val("");});return;}function z(e){var a=e.keyCode,g;switch(a){case h:case p:case d:case v:case m:if(e.shiftKey||e.ctrlKey)return!0;break;case u:case o:return!0;case n:case t:if(y||b||e.shiftKey||e.ctrlKey)return!0;M=x.val(),R=N(x[0]);if(a===n&&R===M.length)return(g=_.call(c,L,M))?x.trigger("pick.xdsoft",[A.call(c,"getValue",g.source,[g.right,g.source])]):x.trigger("pick.xdsoft"),e.preventDefault(),!1;return!0;case s:return!0;case f:return O?(x.trigger("pick.xdsoft"),e.preventDefault(),!1):!0;case l:return x.val(H).trigger("close.xdsoft"),e.preventDefault(),!1;case i:case r:if(!O)return x.trigger("open.xdsoft"),x.trigger("updateContent.xdsoft"),e.preventDefault(),!1;q=E.find("div.active");var w=a==i?"next":"prev",S=!0;return q.length?(q.removeClass("active"),q[w]().length?q[w]().addClass("active"):(x.val(H),S=!1)):E.children().eq(a==i?0:-1).addClass("active"),S&&x.trigger("timepick.xdsoft"),E.trigger("updatescroll.xdsoft"),e.preventDefault(),!1;}return;}if(e(a).hasClass("xdsoft_input"))return;var g=e('<div class="xdsoft_autocomplete"></div>'),E=e('<div class="xdsoft_autocomplete_dropdown"></div>'),S=e('<input readonly class="xdsoft_autocomplete_hint"/>'),x=e(a),T=0,L=[],O=!1,M="",H="",I="",q=null,R=0;x.data("autocomplete_options",c),E.on("mousedown",function(e){e.preventDefault(),e.stopPropagation();}).on("updatescroll.xdsoft",function(){var e=E.find(".active");if(!e.length)return;var t=e.position().top,n=e.outerHeight(!0),r=E.scrollTop(),i=E.height();t<0?E.scrollTop(r-Math.abs(t)):t+n>i&&E.scrollTop(r+t+n-i);}),g.css({display:x.css("display"),width:x.css("width")}),c.style&&g.css(c.style),x.addClass("xdsoft_input").attr("autocomplete","off"),E.on("mousemove","div",function(){if(e(this).hasClass("active"))return!0;E.find("div").removeClass("active"),e(this).addClass("active");}).on("mousedown touchstart","div",function(){E.find("div").removeClass("active"),e(this).addClass("active"),x.trigger("pick.xdsoft");}),x.data("xdsoft_autocomplete",L).after(g).on("pick.xdsoft",function(e,t){x.trigger("timepick.xdsoft",t),I=H=x.val(),x.trigger("close.xdsoft"),q=E.find("div.active").eq(0),q.length||(q=E.children().first()),x.trigger("selected.xdsoft",[j(q,L)]);}).on("timepick.xdsoft",function(e,t){q=E.find("div.active"),q.length||(q=E.children().first()),q.length&&(k(t)?x.val(t):x.val(F.call(c,q,L)),x.trigger("autocompleted.xdsoft",[j(q,L)]),S.val(""),C(x[0],x.val().length));}).on("keydown.xdsoft input.xdsoft cut.xdsoft paste.xdsoft",function(e){var t=z(e);if(t===!1||t===!0)return t;setTimeout(function(){U();},1),U();}).on("change.xdsoft",function(e){H=x.val();}),H=x.val(),P.call(c,x.val(),L,function(e){D.call(c,L,e);}),c.openOnFocus&&x.on("focusin.xdsoft",function(){x.trigger("open.xdsoft"),x.trigger("updateContent.xdsoft");}),c.closeOnBlur&&x.on("focusout.xdsoft",function(){x.trigger("close.xdsoft");}),g.append(x).append(E);var W=!1,X=0;x.on("updateHelperPosition.xdsoft",function(){clearTimeout(X),X=setTimeout(function(){g.css({display:x.css("display"),width:x.css("width")}),E.css(e.extend(!0,{left:x.position().left,top:x.position().top+parseInt(x.css("marginTop"))+parseInt(x[0].offsetHeight),marginLeft:x.css("marginLeft"),marginRight:x.css("marginRight"),width:c.dropdownWidth=="100%"?x[0].offsetWidth:c.dropdownWidth},c.dropdownStyle));if(c.showHint){var t=getComputedStyle(x[0],"");S[0].style.cssText=t.cssText,S.css({"box-sizing":t.boxSizing,borderStyle:"solid",borderCollapse:t.borderCollapse,borderLeftWidth:t.borderLeftWidth,borderRightWidth:t.borderRightWidth,borderTopWidth:t.borderTopWidth,borderBottomWidth:t.borderBottomWidth,paddingBottom:t.paddingBottom,marginBottom:t.marginBottom,paddingTop:t.paddingTop,marginTop:t.marginTop,paddingLeft:t.paddingLeft,marginLeft:t.marginLeft,paddingRight:t.paddingRight,marginRight:t.marginRight,maxHeight:t.maxHeight,minHeight:t.minHeight,maxWidth:t.maxWidth,minWidth:t.minWidth,width:t.width,letterSpacing:t.letterSpacing,lineHeight:t.lineHeight,outlineWidth:t.outlineWidth,fontFamily:t.fontFamily,fontVariant:t.fontVariant,fontStyle:x.css("fontStyle"),fontSize:x.css("fontSize"),fontWeight:x.css("fontWeight"),flex:t.flex,justifyContent:t.justifyContent,borderRadius:t.borderRadius,"-webkit-box-shadow":"none","box-shadow":"none"}),x.css("font-size",x.css("fontSize")),S.innerHeight(x.innerHeight()),S.css(e.extend(!0,{position:"absolute",zIndex:"1",borderColor:"transparent",outlineColor:"transparent",left:x.position().left,top:x.position().top,background:x.css("background")},c.hintStyle)),W!==!1?S.css("background",W):W=x.css("background");try{x[0].style.setProperty("background","transparent","important");}catch(n){x.css("background","transparent");}g.append(S);}},c.timeoutUpdate||1);}),x.is(":visible")?x.trigger("updateHelperPosition.xdsoft"):w=setInterval(function(){x.is(":visible")&&(x.trigger("updateHelperPosition.xdsoft"),clearInterval(w));},100),e(window).on("resize",function(){g.css({width:"auto"}),x.trigger("updateHelperPosition.xdsoft");}),x.on("close.xdsoft",function(){if(!O)return;E.hide(),S.val(""),c.autoselect||x.val(H),O=!1;}).on("updateContent.xdsoft",function(){var t=B.call(c,L,x.val()),n=10;if(!t.length){x.trigger("close.xdsoft");return;}x.trigger("open.xdsoft"),e(t).each(function(){this.css(e.extend(!0,{paddingLeft:x.css("paddingLeft"),paddingRight:x.css("paddingRight")},c.itemStyle));}),E.html(t),c.visibleHeight?n=c.visibleHeight:n=c.visibleLimit*((t[0]?t[0].outerHeight(!0):0)||c.defaultHeightItem)+5,E.css("maxHeight",n+"px");}).on("open.xdsoft",function(){if(O)return;E.show(),O=!0;}).on("destroy.xdsoft",function(){x.removeClass("xdsoft"),g.after(x),g.remove(),clearTimeout(T),x.data("xdsoft_autocomplete",null),x.off(".xdsoft");});}var t=37,n=39,r=38,i=40,s=9,o=17,u=16,a=46,f=13,l=27,c=8,h=65,p=67,d=86,v=90,m=89,g={},y=!1,b=!1,w,E={},S={"":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h",H:"h","":"h","":"h","":"h","":"h","":"h","":"h","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i",i:"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i",I:"i","":"i","":"i","":"i","":"j","":"j",J:"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"a","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n",N:"n","":"n",n:"n","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"p","":"p","":"p","":"p","":"p","":"p","":"p",P:"p","":"p",p:"p","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s",S:"s","":"s",s:"s","":"t","":"t","":"t","":"t",T:"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"w","":"w","":"w","":"w","":"w","":"w",W:"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y",Y:"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"2","":"6","":"B","":"F","":"J","":"N","":"R","":"V","":"Z","":"b","":"f","":"j","":"n","":"r","":"v","":"z","":"1","":"5","":"9","":"A","":"E","":"I","":"M","":"Q","":"U","":"Y","":"a","":"e","":"i","":"m","":"q","":"u","":"y","":"0","":"4","":"8","":"D","":"H","":"L","":"P","":"T","":"X","":"d","":"h","":"l","":"p","":"t","":"x","":"3","":"7","":"C","":"G","":"K","":"O","":"S","":"W","":"c","":"g","":"k","":"o","":"s","":"w","":"a","":"a","":"a","":"a","":"a","":"a","":"a"};window.getComputedStyle===undefined&&(window.getComputedStyle=function(){function e(t,n,r,i){var s=n[r],o=parseFloat(s),u=s.split(/\d/)[0],a;return i=i!==null?i:/%|em/.test(u)&&t.parentElement?e(t.parentElement,t.parentElement.currentStyle,"fontSize",null):16,a=r==="fontSize"?i:/width/i.test(r)?t.clientWidth:t.clientHeight,u==="em"?o*i:u==="in"?o*96:u==="pt"?o*96/72:u==="%"?o/100*a:o;}function t(e,t){var n=t==="border"?"Width":"",r=t+"Top"+n,i=t+"Right"+n,s=t+"Bottom"+n,o=t+"Left"+n;e[t]=(e[r]===e[i]===e[s]===e[o]?[e[r]]:e[r]===e[s]&&e[o]===e[i]?[e[r],e[i]]:e[o]===e[i]?[e[r],e[i],e[s]]:[e[r],e[i],e[s],e[o]]).join(" ");}function n(n){var r=n.currentStyle,i=this,s,o=e(n,r,"fontSize",null);for(s in r){Object.prototype.hasOwnProperty.call(r,s)&&(/width|height|margin.|padding.|border.+W/.test(s)&&i[s]!=="auto"?i[s]=e(n,r,s,o)+"px":s==="styleFloat"?i["float"]=r[s]:i[s]=r[s]);}return t(i,"margin"),t(i,"padding"),t(i,"border"),i.fontSize=o+"px",i;}function r(e){return new n(e);}return n.prototype={constructor:n,getPropertyPriority:function getPropertyPriority(){},getPropertyValue:function getPropertyValue(e){return this[e]||"";},item:function item(){},removeProperty:function removeProperty(){},setProperty:function setProperty(){},getPropertyCSSValue:function getPropertyCSSValue(){}},r;}(this)),e(document).on("keydown.xdsoftctrl",function(e){e.keyCode===o&&(y=!0),e.keyCode===u&&(y=!0);}).on("keyup.xdsoftctrl",function(e){e.keyCode===o&&(y=!1),e.keyCode===u&&(y=!1);}),g={minLength:0,valueKey:"value",titleKey:"title",highlight:!0,showHint:!0,dropdownWidth:"100%",dropdownStyle:{},itemStyle:{},hintStyle:!1,style:!1,debug:!0,openOnFocus:!1,closeOnBlur:!0,autoselect:!1,accents:!0,replaceAccentsForRemote:!0,limit:20,visibleLimit:20,visibleHeight:0,defaultHeightItem:30,timeoutUpdate:10,get:function get(e,t){return O.call(this,e,t);},replace:[function(e,t){return this.replaceAccentsForRemote&&(t=x(t)),e.replace("%QUERY%",encodeURIComponent(t));}],equal:function equal(e,t){return t.toLowerCase()==e.substr(0,t.length).toLowerCase();},findRight:[function(e,t,n){var r=[],i="",s;if(e)for(s=0;s<e.length;s+=1){i=A.call(this,"getValue",n,[e[s],n]);if(A.call(this,"equal",n,[i,t,n],!1))return e[s];}return!1;}],valid:[function(e,t){return this.accents&&(e=x(e),t=x(t)),e.toLowerCase().indexOf(t.toLowerCase())!=-1;}],filter:[function(e,t,n){var r=[],i="",s;if(e)for(s=0;s<e.length;s+=1){i=k(e[s][this.get("valueKey",n)])?e[s][this.get("valueKey",n)]:e[s].toString(),A.call(this,"valid",n,[i,t])&&r.push(e[s]);}return r;}],preparse:function preparse(e){return e;},getValue:[function(e,t){return k(e[this.get("valueKey",t)])?e[this.get("valueKey",t)]:e.toString();}],getTitle:[function(e,t){return k(e[this.get("titleKey",t)])?e[this.get("titleKey",t)]:e.toString();}],render:[function(e,t,n,r){var i=A.call(this,"getValue",t,[e,t],g.getValue[0].call(this,e,t)),s=A.call(this,"getTitle",t,[e,t],g.getTitle[0].call(this,e,t)),o="",u="",a="",f="",l="",c,h,p,d=0;if(this.highlight)if(!this.accents)s=s.replace(new RegExp("("+T(r)+")","i"),"<b>$1</b>");else{a=x(s).toLowerCase().replace(/[<>]+/g,""),u=x(r).toLowerCase().replace(/[<>]+/g,""),f=a.replace(new RegExp(T(u),"g"),"<"+u+">");for(p=0;p<f.length;p+=1){c=s.charAt(d),h=f.charAt(p),h==="<"?l+="<b>":h===">"?l+="</b>":(d+=1,l+=c);}s=l;}return"<div "+(i==r?'class="active"':"")+' data-value="'+encodeURIComponent(i)+'">'+s+"</div>";}],appendMethod:"concat",source:[]},E={destroy:function destroy(){return this.trigger("destroy.xdsoft");},update:function update(){return this.trigger("updateHelperPosition.xdsoft");},options:function options(t){return this.data("autocomplete_options")&&e.isPlainObject(t)&&this.data("autocomplete_options",e.extend(!0,this.data("autocomplete_options"),t)),this;},setSource:function setSource(t,n){if(this.data("autocomplete_options")&&(e.isPlainObject(t)||e.isFunction(t)||e.isArray(t))){var r=this.data("autocomplete_options"),i=this.data("xdsoft_autocomplete"),s=r.source;n!==undefined&&!isNaN(n)?e.isPlainObject(t)||e.isArray(t)?s[n]=e.extend(!0,e.isArray(t)?[]:{},t):s[n]=t:e.isFunction(t)?this.data("autocomplete_options").source=t:e.extend(!0,s,t),P.call(r,this.val(),i,function(e){D.call(r,i,e);});}return this;},getSource:function getSource(e){if(this.data("autocomplete_options")){var t=this.data("autocomplete_options").source;return e!==undefined&&!isNaN(e)&&t[e]?t[e]:t;}return null;}},e.fn.autocomplete=function(t,n,r){return e.type(t)==="string"&&E[t]?E[t].call(this,n,r):this.each(function(){var n=e.extend(!0,{},g,t);I(this,n);});};}(jQuery),define("jquery.autocomplete",["jquery"],function(){}),define("partner.registration.action",["require","base","jquery","urls","jquery.inputMask","jquery.autocomplete"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("urls");return e("jquery.inputMask"),e("jquery.autocomplete"),new t.Action({initialize:function initialize(){n("form").submit(function(){if(n(".field-validation-error").length)return;});var e=n("#CityId");n("#CityName").autocomplete({minLength:3,dropdownWidth:"auto",appendMethod:"replace",showHint:!1,valueKey:"Name",titleKey:"Name",source:[function(e,t){n.ajax({url:r.get("citySearch"),type:"POST",data:{term:e}}).done(function(e){var r=[];n.each(e.data,function(e,t){r.push(t);}),t(r);});}]}).on("selected.xdsoft",function(t,n){e.val(n.Id);}).on("input",function(){e.val(0);});}});}),define("partner.controller",["require","base","partner.list.action","partner.settings.action","partner.requisitions.action","partner.addoredit.action","partner.registration.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{list:function list(t){e("partner.list.action").initialize(t);},settings:function settings(t){e("partner.settings.action").initialize(t);},requisitions:function requisitions(t){e("partner.requisitions.action").initialize(t);},addoredit:function addoredit(t){e("partner.addoredit.action").initialize(t);},registration:function registration(t){e("partner.registration.action").initialize(t);}}});}),define("partnergroup.list.monitorsList",["require","jquery","tools","monitor.edit.form"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=function r(_r8){var i=n.object(_r8).clone();t.extend(this,{initialize:function initialize(){this.$container=t(i.containerId);if(!this.$container.length||!i.linkOpen)return;this.setEvents();},setEvents:function setEvents(){n.list(this.$container.find(i.linkOpen)).each(function(n){var r=t(n);r.click(function(){return e("monitor.edit.form").show(r.data("monitor-id"),{onSave:function onSave(){window.location.reload();},onRemove:function onRemove(){window.location.reload();}}),!1;});});}}),this.initialize();};return function(e){new r(e);};}),define("partnergroup.video.code.generator",["require","jquery","popup","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("popup"),r=e("templates.storage"),i=window.langResource;return new function(){var e=this,s=r.get("#template_video_code_generator"),o={popupHeader:i.partnerGroup.popupHeader};return t.extend(this,{initialize:function initialize(){this.popup=new n({containerClass:"popup_advertiser-create",headerText:o.popupHeader});},show:function show(e,t,n){this.popup.replaceContent(s({domain:window.location.protocol+"//"+window.location.host,partnerId:e,groupId:t,width:n})),this.popup.show();}}),this.initialize(),{show:function show(t,n,r){t&&n&&r&&e.show(t,n,r);}};}();}),define("partnergroup.list.action",["require","base","rangeDatePicker","partnergroup.list.monitorsList","partnergroup.video.code.generator"],function(e){"use strict";var t=e("base"),n=e("rangeDatePicker"),r=e("partnergroup.list.monitorsList"),i=e("partnergroup.video.code.generator"),s=window.langResource;return new t.Action({initialize:function initialize(){var e=$("#partnerGroupsList"),t=e.find(":checkbox"),o=$(".js-button-download"),u=$(".checkbox-switcher"),a=$("#rangeDate"),f=$(".js-download-reports__form"),l=f.find(".js-download-reports__start"),c=f.find(".js-download-reports__finish"),h=f.find(".js-download-reports__ids-box");new r({containerId:"#monitorsList",linkOpen:"a.js-button-edit"}),e.find("a.js-get-code").click(function(){return i.show($(this).data("partner-id"),$(this).data("group-id"),380),!1;}),e.find(".button_remove").click(function(){window.confirm(s.partnerGroup.removeGroup)&&$.post($(this).data("url")).done(function(){window.location.reload();});}),a.on("focus",function(){n.show({$target:a,resultDatesFormat:"dd M yy",onSelect:function onSelect(e,t,n){var r=n.split("&ndash;"),i="";r[0]===r[1]?i=r[0]:i=s.partnerGroup.from+" "+r[0]+" "+s.partnerGroup.to+" "+r[1],a.val(i),l.val(e),c.val(t);}});}),o.on("click",function(){var e=t.filter(":checked"),n=l.val(),r=c.val(),i;e.length&&n.length&&r.length?(i=$.map(e,function(e){return'<input type="hidden" name="GroupIds" value="'+$(e).data("id")+'" />';}),h.html(i.join("")),f.submit()):h.empty();}),t.on("change",function(){var e=t.filter(":checked");e.length===t.length?u.removeClass("is-partial").addClass("is-checked"):e.length>0?u.removeClass("is-checked").addClass("is-partial"):u.removeClass("is-checked is-partial"),o[e.length?"removeClass":"addClass"]("is-disabled");}),u.on("click",function(){var e=u.hasClass("is-checked");u[e?"removeClass":"addClass"]("is-checked"),$.each(t,function(n){t.eq(n).prop("checked",!e).trigger("change");});});}});}),define("partnergroup.controller",["require","base","partnergroup.list.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{list:function list(t){e("partnergroup.list.action").initialize(t);}}});}),define("subscription.regularsubscriptions.action",["require","base","events","tools","urls","noncommercial.saveNewOrder","noncommercial.videoList","datePicker","utilities.urlParser"],function(e){"use strict";var t=e("base"),n=e("events"),r=e("tools"),i=e("urls"),s=e("noncommercial.saveNewOrder"),o=e("noncommercial.videoList"),u=e("datePicker"),a=e("utilities.urlParser"),f={datePicker:".non-commercial-datepicker",regularButton:".js-non-commercial-regular",etherButton:".js-non-commercial-ether-button",etherDate:".js-non-commerial-ether-date",filterButtons:".js-nk-filter"};return new t.Action({initialize:function initialize(){var e=this;this.$regularButton=$(f.regularButton),this.$etherButton=$(f.etherButton),this.$datePicker=$(f.datePicker),this.$etherDate=$(f.etherDate),this.datePicker=new u($(f.datePicker),{dateFormatForUI:"dd.mm.yy",onSelect:function onSelect(t){e.setEtherDate(t),n.trigger("nk:filter",{filterName:"nk:filterByDate",params:t});}}),new o({containerId:"#nkVideoList",videoParams:{isNewNonCommercialContent:!0,isRepeatable:!1,isForSubscription:!0,adminDateTime:new Date().toUTCString()},datesParams:{url:i.get("nonCommercialSubscriptionSetDates"),adminDateTime:new Date().toUTCString()}}),this.initButtons(),s.initialize({url:"/Subscription/SaveOrder"}),$(".sortContainer").sortable({containment:"parent",items:".js-nk-video",placeholder:"b-empty-container",start:function start(e,t){t.placeholder.html('<div class="b-empty-container__line">&nbsp;</div><div class="b-empty-container__head">  </div><div class="b-empty-container__body">&nbsp;</div><div class="b-empty-container__footer"> ,  </div>');},update:function update(){var e=$(".sortContainer").sortable("toArray");s.save(e);}}),n.on("nkVideoBlock:afterLoad",function(){var e=$(".sortContainer").sortable("toArray");$.inArray("",e)==-1&&s.save(e);}),n.on("nkVideoBlock:afterRemove",function(){var e=$(".sortContainer").sortable("toArray");s.save(e);}),n.on("nk:filterTypeChange",function(t){e.resetFilterButtons(),r.list(e.$filterButtons).each(function(e){$(e).data("id")===t&&$(e).addClass("current");});}),n.trigger("nk:filter",{filterName:"nk:filterTypeChange",params:"All"});},initButtons:function initButtons(){if(window.location.pathname==="/Subscription/RegularSubscriptions"){this.$filterButtons=$(f.filterButtons),this.$etherButton=$(f.etherButton);var e=this.$regularButton,t=this.$etherButton,i=$(f.etherButton+" span"),s=this.$datePicker,o=a.parse();o.hash&&o.hash==="#date=new"?(this.$etherButton.addClass("current"),$(this.$datePicker).show()):$(this.$regularButton).addClass("current"),e.click(function(){$(this).hasClass("current")===!1&&($(this).addClass("current"),$(t).removeClass("current"),$(s).hide(),n.trigger("nk:filter",{filterName:"nk:filterByDate",params:null}));}),t.click(function(){e.hasClass("current")&&!s.data("date")?s.show():e.hasClass("current")||(s.is(":hidden")?s.show():s.hide()),t.hasClass("current")||(t.addClass("current"),e.removeClass("current")),s.data("date")&&n.trigger("nk:filter",{filterName:"nk:filterByDate",params:s.data("date")});}),this.$filterButtons.length&&r.list(this.$filterButtons).each(function(e){$(e).click(function(t){n.trigger("nk:filter",{filterName:"nk:filterTypeChange",params:$(e).data("id")});});});}},setEtherDate:function setEtherDate(e){if(window.location.pathname==="/Subscription/RegularSubscriptions"){var t=new Date(),n=new Date(e),i=r.date(new Date(e)).format("dd M");t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()&&(i=window.langResource.nonCommercial.etherTodayText),this.$etherDate.html(i),$(this.$datePicker).hide(),$(this.$datePicker).data("date",e);}},resetFilterButtons:function resetFilterButtons(){r.list(this.$filterButtons).each(function(e){$(e).removeClass("current");});}});}),define("subscription.breakssubscriptions.action",["require","base","events","urls","noncommercial.videoList"],function(e){"use strict";var t=e("base"),n=e("events"),r=e("urls"),i=e("noncommercial.videoList");return new t.Action({initialize:function initialize(){new i({containerId:"#nkVideoList",videoParams:{isNewNonCommercialContent:!0,isRepeatable:!0,isForSubscription:!0,adminDateTime:new Date().toUTCString()},datesParams:{url:r.get("nonCommercialSubscriptionSetDates"),adminDateTime:new Date().toUTCString()}}),n.trigger("nk:filterTypeChange","InstantlyAll");}});}),define("subscription.archivesubscriptions.action",["require","base","urls","noncommercial.videoList","noncommercial.buttonRemoveArchive"],function(e){"use strict";var t=e("base"),n=e("urls"),r=e("noncommercial.videoList"),i=e("noncommercial.buttonRemoveArchive");return new t.Action({initialize:function initialize(){new r({containerId:"#nkVideoList",datesParams:{url:n.get("nonCommercialSubscriptionSetDates"),adminDateTime:new Date().toUTCString()}}),new i($("#buttonRemoveArchive"));}});}),define("subscription.controller",["require","base","subscription.regularsubscriptions.action","subscription.breakssubscriptions.action","subscription.archivesubscriptions.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{regularsubscriptions:function regularsubscriptions(t){e("subscription.regularsubscriptions.action").initialize(t);},breakssubscriptions:function breakssubscriptions(t){e("subscription.breakssubscriptions.action").initialize(t);},archivesubscriptions:function archivesubscriptions(t){e("subscription.archivesubscriptions.action").initialize(t);}}});}),define("city.addoredit.form",["require","jquery","googleMaps"],function(e){"use strict";var t=e("jquery"),n=function n(_n6,r){var i=this,s=t.extend({mapEl:"#cityMap",mapCenterLat:"#cityCenterLat",mapCenterLng:"#cityCenterLng",mapScale:"#cityScale"},r||{});t.extend(this,{initialize:function initialize(){this.setContents(),this.initSubmit(),this.initMap();},setContents:function setContents(){this.$cityLat=t(s.mapCenterLat).val(window.cityData.Latitude),this.$cityLng=t(s.mapCenterLng).val(window.cityData.Longitude),this.$cityScale=t(s.mapScale).val(window.cityData.MapScale);},initSubmit:function initSubmit(){_n6.submit(function(e){e.preventDefault();var r={Name:t("#Name").val(),Mcs:t("#Mcs").val(),TotalViewers:t("#TotalViewers").val(),TimeZoneUtc:t("#TimeZoneUtc").val(),Latitude:i.$cityLat.val(),Longitude:i.$cityLng.val(),MapScale:i.$cityScale.val(),CityId:t("#CityId").val()};return t.ajax({url:_n6.attr("action"),type:"POST",data:r,dataType:"json",success:function success(e){window.location.href=e.redirect;}}),!1;});},initMap:function initMap(){if(!window.cityData)return;e("googleMaps")(function(e){i.maps=e,i.map=e.render({containerId:s.mapEl,center:{lat:Number(i.$cityLat.val()),lng:Number(i.$cityLng.val())},mapTypeControl:!0,navigationControl:!0,zoomControl:!0,zoom:Number(i.$cityScale.val())||1,onChangeCenter:function onChangeCenter(e){i.$cityLat.val(e.getCenter().lat()),i.$cityLng.val(e.getCenter().lng());},onChangeScale:function onChangeScale(e){i.$cityScale.val(e.getZoom());}});});}}),this.initialize();};return function(e,t){e&&e.length&&new n(e,t);};}),define("city.addoredit.action",["require","base","jquery","city.addoredit.form"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(t){e("city.addoredit.form")(n("#addOrEditCityForm"),t);}});}),define("city.controller",["require","base","city.addoredit.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{addoredit:function addoredit(t){e("city.addoredit.action").initialize(t);}}});}),define("authorization.signin.smsPopup",["require","jquery","jquery.inputMask"],function(e){"use strict";var t=e("jquery"),n=t(".js-sms-sec"),r=t(".js-sms-repeat");return e("jquery.inputMask"),new function(){t.extend(this,{initialize:function initialize(){t("#ConfirmationCode").val("").inputmask("999999",{removeMaskOnSubmit:!0,autoUnmask:!0}),this.hide(),this._startTimer();},show:function show(e,n,r){t(".popup_sms_signin--overlay").show(),t(".popup_sms_signin").show();},hide:function hide(){t(".popup_sms_signin--overlay").hide(),t(".popup_sms_signin").hide();},_startTimer:function _startTimer(){function o(){n.html(" "+Math.round((t-(Date.now()-i))/1e3)+" .");}var e=this,t=15e4,i=Date.now(),s=setInterval(o,1e3);setTimeout(function(){clearInterval(s),n.html(""),r.addClass("sms-repeat-link"),e._aviableNewSmsCode();},t);},_aviableNewSmsCode:function _aviableNewSmsCode(){var e=this;t(".js-sms-repeat").on("click",function(){t.ajax({url:"/Authorization/ResendConfirmation",method:"POST",contentType:"application/json",data:JSON.stringify({userId:t("#UserId").val()})}),r.removeClass("sms-repeat-link"),r.off("click"),e._startTimer();});}});}();}),define("authorization.signin.action",["require","base","authorization.signin.smsPopup"],function(e){"use strict";var t=e("base"),n=e("authorization.signin.smsPopup");return new t.Action({initialize:function initialize(){n.initialize(),smsPopupFlag&&n.show();}});}),define("authorization.controller",["require","base","authorization.signin.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{signin:function signin(t){e("authorization.signin.action").initialize(t);}}});}),define("administrator.monitorsapkupdate.apkBlock",["require","jquery","tools","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("tools"),r=e("templates.storage"),i="#template_monitors_apk_block",s={confirmQuestion:"  ?"};return function(e,o){if(!e||!e.length)return;var u=r.get(i),a=t(u(o));e.append(a);if(o.url){var f=e.find("select");f.data("current",f.val()).change(function(){var e=window.confirm(s.confirmQuestion);if(e===!0){var r={VersionId:f.val(),ApkType:f.data("type")};n.is(f.parent().data("id")).defined()&&(r.PartnerId=f.parent().data("id")),f.data("current",f.val()),t.post(o.url,r).done(function(){window.location.reload();});}else f.val(f.data("current"));});}};}),define("administrator.monitorsapkupdate.addPartnerDropdown",["require","jquery","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("templates.storage"),r="#template_monitors_apk_partners_dropdown",i={buttonAdd:".js-add-partner"};return function(e,s,o){if(!e||!e.length)return;var u=n.get(r),a=t(u({Partners:s})),f=a.find("select");e.append(a),a.find(i.buttonAdd).click(function(){return t.ajax({type:"POST",url:o,data:{PartnerId:f.val()},success:function success(){window.location.reload();}}),!1;});};}),define("administrator.monitorsapkupdate.partnersList",["require","jquery","templates.storage","administrator.monitorsapkupdate.apkBlock"],function(e){"use strict";var t=e("jquery"),n=e("templates.storage"),r=e("administrator.monitorsapkupdate.apkBlock"),i="#template_monitors_apk_special_partners",s={buttonAdd:"a.button",adBus:"div.js-ad-bus",busService:"div.js-bus-service",busUpdate:"div.js-bus-update",buttonRemove:".js-remove"};return function(e,o,u,a){if(!e||!e.length)return;var f=n.get(i),l=t(f({Partners:o})),c=l.filter("select");e.append(l),l.find(s.adBus).each(function(e){new r(t(this),{Header:"AdBus",DropDown:u.AdBusVersions,Selected:o[e].SelectedAdBusVersion,Monitors:o[e].AdBusVersionsAndMonitorsCount,url:"/Administrator/UpdateVersionForPartner"});}),l.find(s.busService).each(function(e){new r(t(this),{Header:"BusService",DropDown:u.BusServiceVersions,Selected:o[e].SelectedBusServiceVersion,Monitors:o[e].BusServiceVersionsAndMonitorsCount,url:"/Administrator/UpdateVersionForPartner"});}),l.find(s.busUpdate).each(function(e){new r(t(this),{Header:"BusUpdate",DropDown:u.BusUpdateVersions,Selected:o[e].SelectedBusUpdateVersion,Monitors:o[e].BusUpdateVersionsAndMonitorsCount,url:"/Administrator/UpdateVersionForPartner"});}),l.find(s.buttonRemove).click(function(){return t.ajax({type:"POST",url:a,data:{PartnerId:t(this).data("id")},success:function success(){window.location.reload();}}),!1;});};}),function(e){typeof define=="function"&&define.amd?define("jquery.cookie",["jquery"],e):e(jQuery);}(function(e){function n(e){if(i.raw)return e;try{return decodeURIComponent(e.replace(t," "));}catch(n){}}function r(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),e=n(e);try{return i.json?JSON.parse(e):e;}catch(t){}}var t=/\+/g,i=e.cookie=function(t,s,o){if(s!==undefined){o=e.extend({},i.defaults,o);if(typeof o.expires=="number"){var u=o.expires,a=o.expires=new Date();a.setDate(a.getDate()+u);}return s=i.json?JSON.stringify(s):String(s),document.cookie=[i.raw?t:encodeURIComponent(t),"=",i.raw?s:encodeURIComponent(s),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("");}var f=t?undefined:{},l=document.cookie?document.cookie.split("; "):[];for(var c=0,h=l.length;c<h;c++){var p=l[c].split("="),d=n(p.shift()),v=p.join("=");if(t&&t===d){f=r(v);break;}!t&&(v=r(v))!==undefined&&(f[d]=v);}return f;};i.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==undefined?(e.cookie(t,"",e.extend({},n,{expires:-1})),!0):!1;};}),define("site.cookie",["require","jquery","jquery.cookie"],function(e){"use strict";var t=e("jquery");e("jquery.cookie");var n=function n(e){var n=this;return this.read=function(n){return t.cookie(e+"_"+n);},this.write=function(n,r,i){t.cookie(e+"_"+n,r,{path:i&&i.path?i.path:"/",expires:i&&i.expires?i.expires:1e4});},{read:function read(e){return n.read(e);},write:function write(e,t,r){n.write(e,t,r);}};};return new n("1mt");}),define("administrator.monitorsapkupdate.apkList",["require","jquery","urls","tools","templates.storage","administrator.monitorsapkupdate.apkBlock","administrator.monitorsapkupdate.addPartnerDropdown","administrator.monitorsapkupdate.partnersList","site.cookie","jquery.designForms"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("templates.storage"),s=e("administrator.monitorsapkupdate.apkBlock"),o=e("administrator.monitorsapkupdate.addPartnerDropdown"),u=e("administrator.monitorsapkupdate.partnersList"),a=e("site.cookie");e("jquery.designForms");var f={partner:"#template_monitors_apk_partner"},l="is-hidden",c=function c(e){var c=this;t.extend(this,{initialize:function initialize(){this.load(function(e){c.renderAllPartners(e),c.initSpecialPartnersTabs(),c.renderSpecialPartners(e);});},initSpecialPartnersTabs:function initSpecialPartnersTabs(){var t=a.read("monitorsApk_specialPartnersTab")||0,n=e.find(".js-partner-tab"),r=e.find(".js-partner-nav");r.designForms().change(function(e){a.write("monitorsApk_specialPartnersTab",e.target.value),n.addClass(l).eq(e.target.value).removeClass(l);}),r.eq(t).prop("checked",!0).change();},renderSpecialPartners:function renderSpecialPartners(t){var n=[],i=[];r.list(t.PartnersMonitorsVersions).each(function(e){e.IsIndividual?n.push(e):i.push(e);});var s=e.find("div.js-partners-not-individual");o(s,t.NonSpecialPartners,"/Administrator/AddPartnerToSpecials"),i.length&&u(s,i,t,"/Administrator/DeletePartnerToSpecials");var a=e.find("div.js-partners-individual");o(a,t.NonSpecialPartners,"/Administrator/AddPartnerToIndividuals"),n.length&&u(a,n,t,"/Administrator/DeletePartnerFromIndividuals");},load:function load(e){t.get(n.get("getPartnersMonitorsVersions")).done(function(t){t&&e(t);});},renderAllPartners:function renderAllPartners(n){var r=i.get(f.partner),o=t(r({Header:" ",MonitorsCountFormatted:n.AllPartnersMonitorsVersions.MonitorsCountFormatted}));e.find("div.js-monitors-all").html(o),new s(o.find("div.js-ad-bus"),{Header:"AdBus",DropDown:n.AdBusVersions,Selected:n.AllPartnersMonitorsVersions.SelectedAdBusVersion,Monitors:n.AllPartnersMonitorsVersions.AdBusVersionsAndMonitorsCount,url:"/Administrator/UpdateVersionForAllPartners"}),new s(o.find("div.js-bus-service"),{Header:"BusService",DropDown:n.BusServiceVersions,Selected:n.AllPartnersMonitorsVersions.SelectedBusServiceVersion,Monitors:n.AllPartnersMonitorsVersions.BusServiceVersionsAndMonitorsCount,url:"/Administrator/UpdateVersionForAllPartners"}),new s(o.find("div.js-bus-update"),{Header:"BusUpdate",DropDown:n.BusUpdateVersions,Selected:n.AllPartnersMonitorsVersions.SelectedBusUpdateVersion,Monitors:n.AllPartnersMonitorsVersions.BusUpdateVersionsAndMonitorsCount,url:"/Administrator/UpdateVersionForAllPartners"});}}),this.initialize();};return function(e){e&&e.length&&new c(e);};}),define("administrator.monitorsapkupdate.action",["require","base","jquery","administrator.monitorsapkupdate.apkList"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(){e("administrator.monitorsapkupdate.apkList")(n("#monitorsApkList"));}});}),define("administrator.monitorsconsole.action",["require","base","jquery","urls","tools"],function(e){"use strict";function f(e){var t=document.getElementById("hideCont-"+e),n,r;document.createRange?(n=document.createRange(),n.selectNode(t),r=window.getSelection(),r.removeAllRanges(),r.addRange(n)):(n=document.body.createTextRange(),n.moveToElementText(t),n.select());}function l(){n("#PartnerId").on("change",function(){window.location="/Administrator/MonitorsConsole?partnerId="+this.value;}),n(s).on("click",o,function(){var e=n(this).data("command-id");return n("#hideCont-"+e).slideToggle("normal"),n(this).toggleClass("show"),f(e),!1;}),n(u).click(function(){return n.ajax({type:"GET",url:r.get("getMonitorCommands",a),success:function success(e){var t=n(s);i.list(e).each(function(e){var n=e.AnswerText?unescape(e.AnswerText.replace("\r\n","<br />")):"  ",r="<tr> <td>"+e.Id+"</td>"+" <td>"+e.MonitorId+"</td>"+" <td>"+e.CommandText+"</td>"+'<td colspan="4"> <input class="hideBtn button js-hide-button" data-command-id="'+e.Id+'" type="button" value=":"/> </td>'+"</tr>"+'<tr class="hideWrap"> <td colspan="4"> <div id="hideCont-'+e.Id+'" class="hideCont">'+n+"</div> </td >"+"</tr>";t.find("tr:last").after(r);}),a+=1;}}),!1;});}var t=e("base"),n=e("jquery"),r=e("urls"),i=e("tools"),s=".js-command-list",o=".js-hide-button",u=".js-next-button",a=1;return new t.Action({initialize:function initialize(){l();}});}),define("administrator.controller",["require","base","administrator.monitorsapkupdate.action","administrator.monitorsconsole.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{monitorsapkupdate:function monitorsapkupdate(t){e("administrator.monitorsapkupdate.action").initialize(t);},monitorsconsole:function monitorsconsole(t){e("administrator.monitorsconsole.action").initialize(t);}}});}),define("actionlog.list.action",["require","base","jquery","urls","tools"],function(e){"use strict";function f(){n(s).on("click",o,function(){var e=n(this).data("log-guid");return n("#hideCont-"+e).slideToggle("normal"),n(this).toggleClass("show"),!1;}),n(u).click(function(){return l(),!1;});}function l(){n.ajax({type:"GET",url:r.get("getLogEntries",a),success:function success(e){var t=n(s);i.list(e).each(function(e){var n="<tr> <td>"+e.CreatedAtString+"</td>"+" <td>"+e.UserLogin+"</td>"+" <td>"+e.SignedAsUserLogin+"</td>"+" <td>"+e.Type+"</td>"+'<td colspan="5"> <input class="hideBtn button js-hide-button" data-log-guid="'+e.Guid+'" type="button" value=":"/> </td>'+"</tr>"+'<tr class="hideWrap"> <td colspan="5"> <div id="hideCont-'+e.Guid+'" class="hideCont">'+e.Parameters+"</div> </td >"+"</tr>";t.find("tbody").append(n);}),a+=1;}});}var t=e("base"),n=e("jquery"),r=e("urls"),i=e("tools"),s=".js-log-list",o=".js-hide-button",u=".js-next-button",a=1;return new t.Action({initialize:function initialize(){f();}});}),define("actionlog.controller",["require","base","actionlog.list.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{list:function list(t){e("actionlog.list.action").initialize(t);}}});}),define("route.addoredit.formCreate",["require","tools","events"],function(e){"use strict";var t=e("tools"),n=e("events"),r=function r(e){e.submit(function(){var r=e.serializeArray(),i={};return t.list(r).each(function(e){i[e.name]=e.value;}),n.trigger("route:save",i),!1;});};return function(e){e&&e.length&&new r(e);};}),define("keys",{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,DECIMAL_POINT:110,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,COMMA:188,DOT:190}),define("form.transportStop",["require","jquery","keys","tools","events","popup","audioLoader","audioPlayer","templates.storage"],function(e){"use strict";var t=e("jquery"),n=e("keys"),r=e("tools"),i=e("events"),s=e("popup"),o=e("audioLoader"),u=e("audioPlayer"),a=e("templates.storage"),f=new function(){var e=this,f=window.langResource,l={headerText:f.routes.newTransportStop},c={buttonSave:".js-save-transportStop",buttonCancel:".js-cancel-save",audioContainer:"#audioContainer",audioLoader:"#audioLoader",browseAudioLoader:"browseAudioLoader",linkRemoveAudio:"a.js-remove-audio"},h=1,p="#template_form_add_transport_stop",d="#template_audio_item";return t.extend(this,{show:function show(e,t){this.popup||(this.renderPopup(),this.initControls(),this.initAudioLoader()),t.AudioId?(this.initAudioFile(t),this.$audioContainer.show()):this.$audioContainer.hide(),this.formType=e,this.params=t?r.object(t).clone():{},this.populatePosition(t),e==="edit"?this.populateForm(t):this.resetForm(),this.popup.show(),(e==="add"||t.TransportStopType==="new")&&this.$transportStop.focus();},renderPopup:function renderPopup(){this.popup=new s({containerClass:"popup_newTransportStop",headerText:l.headerText,hideByOverlay:!1,hideByEscape:!1});},initControls:function initControls(){this.$content=t(a.get(p)()),this.popup.addContent(this.$content),this.$content.find(":text").on("keydown",function(t){if(t.keyCode===n.ENTER)return e.$buttonSave.click(),!1;}),this.$transportStop=this.$content.find("#transportStopTitle"),this.$transportStopTranslation=this.$content.find("#transportStopTitleTranslation"),this.$transportStopTransferToRoutes=this.$content.find("#transportStopTransferToRoutes"),this.$transportStopLatitude=this.$content.find("#transportStopLatitude"),this.$transportStopLongitude=this.$content.find("#transportStopLongitude"),this.$audioId=this.$content.find('input:hidden[name="audioId"]'),this.$audioUrl=this.$content.find('input:hidden[name="audioUrl"]'),this.$buttonSave=this.$content.find(c.buttonSave).click(function(){var n=t.trim(e.$transportStop.val()),r=t.trim(e.$transportStopTranslation.val()),s=t.trim(e.$transportStopTransferToRoutes.val()),o=e.$audioId.val(),u=parseFloat(t.trim(e.$transportStopLatitude.val())),a=parseFloat(t.trim(e.$transportStopLongitude.val()));return n&&(e.params.TransportStopTitle=n,e.params.TransportStopTitleTranslation=r,e.params.TransportStopTransferToRoutes=s,e.params.TransportStopTitle=n,e.params.AudioId=o,e.params.AudioUrl=e.$audioUrl.val(),e.formType==="add"?(e.params.Latitude=u,e.params.Longitude=a):(e.params.NewLatitude=u,e.params.NewLongitude=a),i.trigger("transportStopForm:"+e.formType,e.params),e.popup.hide()),!1;}),this.$content.find(c.buttonCancel).click(function(){return e.popup.hide(),!1;});},initAudioLoader:function initAudioLoader(){this.$audioContainer=this.$content.find(c.audioContainer),this.$audioLoader=this.$content.find(c.audioLoader),o({containerEl:c.audioLoader,buttonBrowse:c.browseAudioLoader,multiSelection:!1,onFilesAdded:function onFilesAdded(t){return e.initLoadingAudio(e.renderAudioBlock(),r.list(t.files).clone()[0]),setTimeout(function(){while(t.files.length>0){t.removeFile(t.files[0]);}},500),!1;}});},initAudioFile:function initAudioFile(t){this.populateAudioParams(t.audioId,t.audioUrl);var n=this.renderAudioBlock();n.addClass("with-audio").addClass("is-loaded").find(c.linkRemoveAudio).click(function(){return e.resetAudioParams(),!1;}),new u({container:n.find(">div:first"),audioUrl:t.AudioUrl});},renderAudioBlock:function renderAudioBlock(){var e=t(a.get(d)({Index:h++}));return this.$audioContainer.html(e),e;},initLoadingAudio:function initLoadingAudio(t,n){var r=t.data("index");o({containerEl:c.audioLoader+r,buttonBrowse:c.browseAudioLoader+r,multiSelection:!1,dragdrop:!1,onInit:function onInit(e){e.addFile(n);},onBeforeLoad:function onBeforeLoad(){},onAfterLoad:function onAfterLoad(t){e.populateAudioParams(t.audioId,t.audioUrl);},onRemove:function onRemove(){t.remove(),e.resetAudioParams();}});},resetForm:function resetForm(){this.$transportStop.val(""),this.$transportStopTranslation.val(""),this.$transportStopTransferToRoutes.val(""),this.$transportStop.prop("disabled",!1),this.resetAudioParams();},resetAudioParams:function resetAudioParams(){this.$audioId.val(""),this.$audioUrl.val("");},populateAudioParams:function populateAudioParams(e,t){this.$audioId.val(e||""),this.$audioUrl.val(t||"");},populatePosition:function populatePosition(e){this.$transportStopLatitude.val(e.Latitude),this.$transportStopLongitude.val(e.Longitude);},populateForm:function populateForm(e){debugger;this.$transportStop.val(e.TransportStopTitle),this.$transportStopTranslation.val(e.TransportStopTitleTranslation),this.$transportStopTransferToRoutes.val(e.TransportStopTransferToRoutes),this.populateAudioParams(e.AudioId,e.AudioUrl);}}),{show:function show(){e.show.apply(e,arguments);}};}();return function(e,t){e&&f.show(e,t);};}),define("guid",["require"],function(e){"use strict";function t(){return((1+Math.random())*65536|0).toString(16).substring(1);}return function(){return(t()+t()+"-"+t()+"-4"+t().substr(0,3)+"-"+t()+"-"+t()+t()+t()).toLowerCase();};}),define("route.addoredit.map.markers",["require","jquery","tools","guid","googleMaps.markerIcons"],function(e){"use strict";function s(e){var r=t.makeArray(arguments);r.splice(0,1),n.is(e).fn()&&e.apply(undefined,r);}function o(e,t){var n,r;e.addListener("dragstart",function(){n=r=this.getPosition();}),e.addListener("drag",function(e){s(t.onDrag,e,r),r=this.getPosition();}),e.addListener("dragend",function(e){s(t.onDragEnd,e,r,n);});}function u(e,s,u){var a=new e.createPoint(u.Latitude,u.Longitude),f={position:a,map:s,draggable:!0,visible:u.visible!==undefined?u.visible:!0};switch(u.type){case"drive":t.extend(f,{icon:i("circleGrey7"),clickable:!1,zIndex:1});break;case"intermediate":t.extend(f,{icon:i("circleBlue7"),zIndex:4});break;case"transportStop":t.extend(f,{icon:i("circleTransportStop14"),zIndex:5});break;case"transportStopWithAudio":t.extend(f,{icon:i("circleTransportStopPlay14"),zIndex:5});}var l=new e.googleMaps.Marker(f);return l.tempId=r(),o(l,n.object(u).getProperties(["onDrag","onDragEnd"])),l;}var t=e("jquery"),n=e("tools"),r=e("guid"),i=e("googleMaps.markerIcons");return function(e,t,n){if(e&&t&&n)return u(e,t,n);};}),define("route.addoredit.map.transportStops",["require","jquery","urls","tools","route.addoredit.map.markers","debounce"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("route.addoredit.map.markers"),s=e("debounce"),o=16,u=function u(e,_u5){var a=this;return t.extend(this,{storage:[],loadAll:function loadAll(e,i){t.ajax({url:n.get("routeTransportStops"),data:{routeId:e},success:function success(e){var t=[],n;r.list(e).each(function(e){n=a.add("allRoutes",e),t.push(n);}),a.runCallback(i,e,t);}});},loadForRoute:function loadForRoute(e,r){t.ajax({url:n.get("routeWithStops"),data:{routeId:e},success:function success(e){a.parseRouteData(e,"FirstWayPoints"),a.parseRouteData(e,"SecondWayPoints"),a.runCallback(r,e);}});},parseRouteData:function parseRouteData(e,t){var n;r.list(e[t]).each(function(e){e.TransportStopId&&(n=a.getById(e.TransportStopId),n&&(e.TransportStopTitle=n.params.TransportStopTitle,e.TransportStopTitleTranslation=n.params.TransportStopTitleTranslation,e.TransportStopTransferToRoutes=n.params.TransportStopTransferToRoutes,e.AudioId=n.params.AudioId,e.AudioUrl=n.params.AudioUrl,e.TempId=n.marker.tempId));});},add:function add(t,n,r){var a=n.TransportStopId||n.Id,f=n.Latitude,l=n.Longitude,c=a?this.getById(a):this.getByPosition(f,l)[0];if(c&&(!c.params.TransportStopId||c.params.TransportStopId==a))return c.params.target.push(t),c.marker;var h=n.TransportStopTitle,p=n.TransportStopTitleTranslation,d=n.TransportStopTransferToRoutes,v=i(e,_u5,{type:n.AudioId?"transportStopWithAudio":"transportStop",Latitude:f,Longitude:l,visible:_u5.getZoom()>=o,onDrag:r?r.onDrag:null,onDragEnd:r?r.onDragEnd:null});function m(){var e=_u5.getZoom()>=o,t=_u5.getBounds().contains(v.getPosition());v.setVisible(e&&t);}return _u5.addNewEvent("zoom_changed",s(m,300)),_u5.addNewEvent("center_changed",s(m,300)),v.transportStopId=a,v.transportStopTitle=h,v.transportStopTitleTranslation=p,v.transportStopTransferToRoutes=d,v.audioId=n.AudioId,v.audioUrl=n.AudioUrl,this.storage.push({params:{target:[t],TransportStopId:a,TransportStopTitle:h,TransportStopTitleTranslation:p,TransportStopTransferToRoutes:d,Latitude:f,Longitude:l,TempId:v.tempId,AudioId:n.AudioId,AudioUrl:n.AudioUrl},marker:v}),v;},remove:function remove(e,t){var n=this.getByTempId(e),i=n[0],s=n[1];i&&(r.list(i.params.target).each(function(e,n){if(e==t)return i.params.target.splice(n,1),!1;}),i.params.target.length||(this.storage[s].marker.setMap(null),this.storage.splice[i[1]]));},getByPosition:function getByPosition(e,t){var n,i;return r.list(this.storage).each(function(r,s){if(r.params.Latitude===e&&r.params.Longitude===t)return i=r,n=s,!1;}),[i,n];},getByTempId:function getByTempId(e){var t,n;return r.list(this.storage).each(function(r,i){if(r.params.TempId===e)return n=r,t=i,!1;}),[n,t];},getById:function getById(e){var t;return r.list(this.storage).each(function(n){if((n.params["Id"]||n.params["TransportStopId"])==e)return t=n,!1;}),t;},updatePosition:function updatePosition(e,t){var n=this.getByTempId(e);n[0]&&(this.storage[n[1]].params.Latitude=t.lat(),this.storage[n[1]].params.Longitude=t.lng());},runCallback:function runCallback(e){var n=t.makeArray(arguments);n.splice(0,1),r.is(e).fn()&&e.apply(undefined,n);}}),{loadAll:function loadAll(e,t){a.loadAll(e,t);},loadForRoute:function loadForRoute(e,t){a.loadForRoute(e,t);},add:function add(e,t,n){return a.add(e,t,n);},remove:function remove(e,t){a.remove(e,t);},getByTempId:function getByTempId(e){return a.getByTempId(e);},updatePosition:function updatePosition(e,t){a.updatePosition(e,t);}};};return function(e,t){if(e&&t)return new u(e,t);};}),define("route.addoredit.map.collection",["require","backbone"],function(e){"use strict";var t=e("backbone");return t.Collection.extend({getByTempId:function getByTempId(e){var t=this.where({TempId:e});return t.length?t:null;},isLastPoint:function isLastPoint(e,t){var n=this.toJSON(),r=n.length,i=n[r-1];return r&&i.Latitude===e&&i.Longitude===t;},getPrevTSIndex:function getPrevTSIndex(e,t){var n=this.models,r;for(var i=t;i--;){if(n[i].get("isTransportStop")){r=n[i].get("pointIndex");break;}}return r;},getNextTSIndex:function getNextTSIndex(e,t){var n=this.models,r;if(t!==n.length)for(var i=t+1,s=n.length;i<s;i++){if(n[i].get("isTransportStop")){r=n[i].get("pointIndex");break;}}return r;}});}),define("route.addoredit.map",["require","jquery","urls","tools","events","form.transportStop","googleMaps","route.addoredit.map.markers","googleMaps.markerIcons","googleMaps.infobox","route.addoredit.map.transportStops","route.addoredit.map.collection"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("events"),s=e("form.transportStop"),o=e("googleMaps"),u=e("route.addoredit.map.markers"),a=e("googleMaps.markerIcons"),f=e("googleMaps.infobox"),l=e("route.addoredit.map.transportStops"),c=e("route.addoredit.map.collection"),h=0,p=function p(e,_p,d){var v=this,m=e.NewRouteCreating,g={active:"#517dda",notActive:"#aaaaaa"},y={FirstWayPoints:{collection:new c()},SecondWayPoints:{collection:new c()}},b,w,E,S=!1;t.extend(this,{initialize:function initialize(){this.setActiveRoute("FirstWayPoints"),o(function(t){v.maps=t,v.initMap(),v.setEvents(),r.is(d).fn()&&d(t,v.map),v.transportStops=l(t,v.map),v.transportStops.loadAll(e.RouteId,function(t,n){v.setAllMarkersEvents(n),m||v.transportStops.loadForRoute(e.RouteId,function(e){if(e.FirstWayPoints.length||e.SecondWayPoints.length&&e.FirstWayPoints.length+e.SecondWayPoints.length>=3){var t=new v.maps.googleMaps.LatLngBounds();e.FirstWayPoints&&r.list(e.FirstWayPoints).each(function(e){t.extend(v.maps.createPoint(e.Latitude,e.Longitude));}),v.map.fitBounds(t);}v.renderCurrentRouteWay("FirstWayPoints",e),v.renderCurrentRouteWay("SecondWayPoints",e);});});});},setEvents:function setEvents(){i.on("route:activate",function(e){v.setActiveRoute(e);}).on("routeTransportStop:mouseover",function(e){var t=v.transportStops.getByTempId(e.TempId)[0];t&&(E=!0,v.showInfoBox(t.marker));}).on("routeTransportStop:mouseout",function(){E=!1,setTimeout(function(){v.infoBox&&!w&&!E&&v.infoBox.close();},20);}).on("transportStopForm:add",function(e){v.addTransportStop(e);}).on("transportStopForm:edit",function(e){var t=v.transportStops.getByTempId(e.TempId)[0];if(t){t.marker.transportStopTitle=e.TransportStopTitle,t.marker.transportStopTitleTranslation=e.TransportStopTitleTranslation,t.marker.transportStopTransferToRoutes=e.TransportStopTransferToRoutes,t.marker.audioId=e.AudioId,t.marker.audioUrl=e.AudioUrl;var n=e.AudioId?"circleTransportStopPlay14":"circleTransportStop14";t.marker.getIcon().iconName!==n&&t.marker.setIcon(a(n));if(e.NewLatitude&&e.Latitude!==e.NewLatitude||e.NewLongitude&&e.Longitude!==e.NewLongitude){var r=v.maps.createPoint(e.NewLatitude,e.NewLongitude);t.marker.setPosition(r),v.updateMarkerPosition(["FirstWayPoints","SecondWayPoints"],e.TempId,r),i.trigger("mapTransportStop:rebase",{tempId:e.TempId,newPos:r});}v.updateTSParams("FirstWayPoints",e,["TransportStopTitle","TransportStopTitleTranslation","TransportStopTransferToRoutes","AudioId","AudioUrl"]),v.updateTSParams("SecondWayPoints",e,["TransportStopTitle","TransportStopTitleTranslation","TransportStopTransferToRoutes","AudioId","AudioUrl"]);}}).on("routeTransportStop:remove",function(e){v.removeTransportStop(e);}).on("route:save",function(e){v.save(e);});},updateTSParams:function updateTSParams(e,t,n){var i=y[e].collection,s=i.getByTempId(t.TempId);s&&r.list(s).each(function(e){e.set(r.object(t).getProperties(n));});},setActiveRoute:function setActiveRoute(e){b=e,y[e].lineColor=g.active,y[e==="FirstWayPoints"?"SecondWayPoints":"FirstWayPoints"].lineColor=g.notActive,this.updateRouteLine("FirstWayPoints"),this.updateRouteLine("SecondWayPoints");},initMap:function initMap(){var t=!1;this.map=this.maps.render({containerId:"#"+_p[0].id,center:{lat:e.CityLatitude,lng:e.CityLongitude},zoom:e.MapScale,draggableCursor:"default",disableDoubleClickZoom:!0});var n=new this.maps.googleMaps.LatLngBounds(new this.maps.googleMaps.LatLng(-85.5,-180),new this.maps.googleMaps.LatLng(85.5,180)),r=new this.maps.googleMaps.Rectangle({bounds:n,strokeColor:"#000",strokeOpacity:0,strokeWeight:0,fillColor:"#000",fillOpacity:0,cursor:"default",map:this.map});r.addListener("click",function(e){t=!1,setTimeout(function(){t||v.createWayPoint(b,e.latLng.lat(),e.latLng.lng());},300);}),r.addListener("dblclick",function(e){t=!0,s("add",{Latitude:e.latLng.lat(),Longitude:e.latLng.lng()});});},showInfoBox:function showInfoBox(e){this.infoBox||(this.infoBox=new f({content:"",boxClass:"ts-infobox",pixelOffset:new this.maps.googleMaps.Size(-10,11),infoBoxClearance:new this.maps.googleMaps.Size(0,0),alignBottom:!0,maxWidth:0})),this.infoBox.setContent(e.transportStopTitle),this.infoBox.open(this.map,e),setTimeout(function(){t(v.infoBox.div_).hover(function(){w=!0;},function(){w=!1,setTimeout(function(){v.infoBox&&!w&&!E&&v.infoBox.close();},20);}).click(function(){v.maps.googleMaps.event.trigger(e,"click");});},10);},renderCurrentRouteWay:function renderCurrentRouteWay(e,t){var n,s,o,u,a,f;r.list(t[e]).each(function(t){n=r.is(t.TransportStopId).defined(),a=t.Latitude,f=t.Longitude,s=t.TransportStopTitle,o=t.TransportStopTitleTranslation,u=t.TransportStopTransferToRoutes,n?(v.createWayPoint(e,a,f,!0,{TempId:t.TempId,TransportStopId:t.TransportStopId,TransportStopTitle:s,TransportStopTitleTranslation:o,TransportStopTransferToRoutes:u,AudioId:t.AudioId,AudioUrl:t.AudioUrl}),i.trigger("mapTransportStop:add",{RouteName:e,TransportStopType:"old",TransportStopId:t.TransportStopId,TransportStopTitle:s,TransportStopTitleTranslation:o,TransportStopTransferToRoutes:u,Latitude:a,Longitude:f,TempId:t.TempId,AudioId:t.AudioId,AudioUrl:t.AudioUrl,pointIndex:h-1})):v.createWayPoint(e,a,f,!1);});},createWayPoint:function createWayPoint(e,n,r,i,s,o){var u=y[e];if(!i&&!u.collection.length)return;if(u.collection.isLastPoint(n,r))return;var a=t.extend({point:new this.maps.createPoint(n,r),pointIndex:h++,Latitude:n,Longitude:r,isTransportStop:i===!0},s||{});i||(a.vector=this.createVector(e,n,r)),a.TempId=i?s.TempId:a.vector.tempId,u.collection.add(a,o?{at:o}:{}),this.updateRouteLine(e);},createVector:function createVector(e,t,n){var r=u(this.maps,this.map,{type:"intermediate",Latitude:t,Longitude:n,onDrag:function onDrag(t){v.updateMarkerPosition([e],r.tempId,t.latLng);},onDragEnd:function onDragEnd(t){v.updateMarkerPosition([e],r.tempId,t.latLng);}});return r.addListener("rightclick",function(){e===b&&(v.removeVector(r),v.updateRouteLine(e));}),r;},removeVector:function removeVector(e){e.setMap(null);var t=y[b].collection.getByTempId(e.tempId);t&&t.length===1&&t[0].destroy();},addDragEvents:function addDragEvents(e,n){function o(e){var n=t.makeArray(arguments);n.splice(0,1),r.is(e).fn()&&e.apply(undefined,n);}var i,s;e.addListener("dragstart",function(){i=s=this.getPosition();}),e.addListener("drag",function(e){o(n.onDrag,e,s),s=this.getPosition();}),e.addListener("dragend",function(e){o(n.onDragEnd,e,s,i);});},updateMarkerPosition:function updateMarkerPosition(e,t,n){this.infoBox&&(w=!1,E=!1,this.infoBox.close()),this.transportStops.updatePosition(t,n),r.list(e).each(function(e){var i=y[e].collection,s=i.getByTempId(t);s&&(r.list(s).each(function(e){e.set({Latitude:n.lat(),Longitude:n.lng(),point:n});}),v.updateRouteLine(e));});},addTransportStop:function addTransportStop(e){var n=e.Latitude,s=e.Longitude,o=e.TransportStopTitle,u=e.TransportStopTitleTranslation,a=e.TransportStopTransferToRoutes,f=r.object(e).getProperties(["Latitude","Longitude","Id","TransportStopId","TransportStopTitle","AudioId","AudioUrl","insertPointIndex","prevTSIndex"]),l=this.transportStops.add(b,f,{onDrag:function onDrag(e){v.updateMarkerPosition(["FirstWayPoints","SecondWayPoints"],l.tempId,e.latLng);},onDragEnd:function onDragEnd(e,t,n){v.updateMarkerPosition(["FirstWayPoints","SecondWayPoints"],l.tempId,e.latLng),i.trigger("mapTransportStop:rebase",{tempId:l.tempId,newPos:e.latLng});}});l.isNew=!0,this.setMarkerEvents(l),this.createWayPoint(b,n,s,!0,{TempId:l.tempId,TransportStopTitle:o,TransportStopTitleTranslation:u,TransportStopTransferToRoutes:a,AudioId:f.AudioId,AudioUrl:f.AudioUrl},f.insertPointIndex),i.trigger("mapTransportStop:add",t.extend({TempId:l.tempId,RouteName:b,TransportStopType:"new",pointIndex:h-1,prevTSIndex:f.prevTSIndex},f));},updateRouteLine:function updateRouteLine(e){var t=y[e];this.removeRouteLine(e),t.collection.length>1&&(t.routeLine=new this.maps.googleMaps.Polyline({path:t.collection.pluck("point"),strokeColor:t.lineColor,strokeOpacity:1,strokeWeight:4,zIndex:t.lineColor===g.active?3:2}),t.routeLine.setMap(this.map),this.setRouteLineEvents(e));},removeRouteLine:function removeRouteLine(e){var t=y[e];t.routeLine&&t.routeLine.setMap(null);},setRouteLineEvents:function setRouteLineEvents(e){var t=y[e],n=!1,r,i,o;t.routeLine.addListener("click",function(t){n=!1,setTimeout(function(){n||(i=t.latLng.lat(),o=t.latLng.lng(),r=v.getClosestLinePointIndex(e,i,o),r&&v.createWayPoint(b,i,o,!1,{},r));},300);}),t.routeLine.addListener("dblclick",function(u){n=!0,i=u.latLng.lat(),o=u.latLng.lng(),r=v.getClosestLinePointIndex(e,i,o),r&&s("add",{Latitude:u.latLng.lat(),Longitude:u.latLng.lng(),insertPointIndex:r,prevTSIndex:t.collection.getPrevTSIndex(e,r)});});},getClosestLinePointIndex:function getClosestLinePointIndex(e,t,n){var r=y[e],i=new v.maps.createPoint(t,n),s=r.collection.toJSON(),o=this.maps.googleMaps,u,a=null;for(var f=1,l=s.length;f<l;f++){u=new o.Polyline({path:[s[f-1].point,s[f].point]});if(o.geometry.poly.isLocationOnEdge(i,u,1e-5)){a=f;break;}}return a;},setAllMarkersEvents:function setAllMarkersEvents(e){r.list(e).each(function(e){e.isNew=!1,v.setMarkerEvents(e),v.addDragEvents(e,{onDrag:function onDrag(t){v.updateMarkerPosition(["FirstWayPoints","SecondWayPoints"],e.tempId,t.latLng);},onDragEnd:function onDragEnd(t,n,r){v.updateMarkerPosition(["FirstWayPoints","SecondWayPoints"],e.tempId,t.latLng),i.trigger("mapTransportStop:rebase",{tempId:e.tempId,newPos:t.latLng});}});});},setMarkerEvents:function setMarkerEvents(e){e.addListener("click",function(){var t=this.getPosition().lat(),n=this.getPosition().lng();if(!y[b].collection.isLastPoint(t,n)){var r={TempId:e.tempId,TransportStopTitle:e.transportStopTitle,TransportStopTitleTranslation:e.transportStopTitleTranslation,TransportStopTransferToRoutes:e.transportStopTransferToRoutes,AudioId:e.audioId,AudioUrl:e.audioUrl};e.transportStopId&&(r.TransportStopId=e.transportStopId),v.transportStops.add(b,{Latitude:t,Longitude:n,TransportStopId:r.TransportStopId||null,TransportStopTitle:e.transportStopTitle,TransportStopTitleTranslation:e.transportStopTitleTranslation,TransportStopTransferToRoutes:e.transportStopTransferToRoutes}),v.createWayPoint(b,t,n,!0,r),i.trigger("mapTransportStop:add",{RouteName:b,TransportStopType:e.isNew?"new":"old",TransportStopTitle:e.transportStopTitle,TransportStopTitleTranslation:e.transportStopTitleTranslation,TransportStopTransferToRoutes:e.transportStopTransferToRoutes,Latitude:t,Longitude:n,TempId:e.tempId,AudioId:e.audioId,AudioUrl:e.audioUrl,pointIndex:h-1});}}),e.addListener("mouseover",function(){E=!0,v.showInfoBox(e),i.trigger("mapTransportStop:mouseover",e.tempId);}),e.addListener("mouseout",function(){E=!1,i.trigger("mapTransportStop:mouseout",e.tempId);});},removeTransportStop:function removeTransportStop(e){this.infoBox&&(w=!1,E=!1,this.infoBox.close());var t=e.RouteName,n=y[t],i=n.collection.models;r.list(i).each(function(r,s){if(r.get("pointIndex")===e.pointIndex){if(s===0)while(i[1]&&!i[1].get("isTransportStop")){i[1].get("vector").setMap(null),i[1].destroy();}else if(!n.collection.getNextTSIndex(t,s))for(var o=i.length-1;o>s;o--){i[o].get("vector").setMap(null),i[o].destroy();}return v.transportStops.remove(e.TempId,t),r.destroy(),!1;}}),this.updateRouteLine(t);},save:function save(e){function s(e){for(var t=0,n=e.length;t<n;t++){e[t]=r.object(e[t]).getProperties(["Latitude","Longitude","Id","TransportStopId","TransportStopTitle","TransportStopTitleTranslation","TransportStopTransferToRoutes","isTransportStop","AudioId","AudioUrl"]);}}debugger;if(S)return!1;S=!0;var i=r.object(e).clone();i.FirstWayPoints=y.FirstWayPoints.collection.toJSON(),i.SecondWayPoints=y.SecondWayPoints.collection.toJSON(),s(i.FirstWayPoints),s(i.SecondWayPoints),t.ajax({type:"POST",url:n.get("routeAddOrEdit",i.RouteId),poolName:"route.addEdit",data:i,success:function success(){window.location.href=n.get("routesList");},error:function error(){alert("-   .   ..."),S=!1;}});}}),this.initialize();};return function(e,t){window.mapConfig&&e&&e.length&&new p(window.mapConfig,e,t);};}),define("route.addoredit.map.drivePoints",["require","jquery","urls","tools","events","route.addoredit.map.markers"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("events"),s=e("route.addoredit.map.markers"),o=function o(e,_o7){var u=this,a=[];t.extend(this,{initialize:function initialize(){this.setEvent();},setEvent:function setEvent(){i.on("monitorsList:setMonitor",function(e){u.loadDrivePoints(e);});},loadDrivePoints:function loadDrivePoints(e){t.ajax({url:n.get("monitorGpsCoordinates"),data:{monitorId:e},poolName:"monitor.getPoints",success:function success(e){u.renderDrivePoints(e);}});},renderDrivePoints:function renderDrivePoints(n){var i;this.removeOldDriveMarkers(),r.list(n).each(function(n){i=s(e,_o7,t.extend({type:"drive"},n)),a.push(i);});},removeOldDriveMarkers:function removeOldDriveMarkers(){r.list(a).each(function(e){e.setMap(null);}),a=[];}}),this.initialize();};return function(e,t){e&&t&&new o(e,t);};}),define("route.addoredit.monitorsList",["require","jquery","urls","tools","events"],function(e){"use strict";var t=e("jquery"),n=e("urls"),r=e("tools"),i=e("events"),s=function s(e){var s=this,o=window.langResource,u={SortOrder:"Asc",SortProperty:"LastContact"};t.extend(this,{initialize:function initialize(){this.loadMonitors();},loadMonitors:function loadMonitors(){t.ajax({url:n.get("getMonitorsListInfo"),poolName:"route.monitorsList",data:u,success:function success(e){e.Success&&e.MonitorsList&&s.renderDropdown(e.MonitorsList);}});},renderDropdown:function renderDropdown(n){this.$dropdown=t("<select>"),this.$dropdown.append(t('<option value="">'+o.routes.selectMonitor+"</option>")).change(function(){i.trigger("monitorsList:setMonitor",s.$dropdown.val());}),r.list(n).each(function(e){s.$dropdown.append('<option value="'+e.Id+'">'+e.Label+"</option>");}),e.append(this.$dropdown);}}),this.initialize();};return function(e){e&&e.length&&new s(e);};}),define("route.addoredit.routesList",["require","jquery","underscore","tools","events","form.transportStop","backbone"],function(e){"use strict";function a(e){return e&&e.length?!0:!1;}var t=e("jquery"),n=e("underscore"),r=e("tools"),i=e("events"),s=e("form.transportStop"),o=e("backbone"),u=function u(e,_u6){var a=this,f=window.langResource,l=window.mapConfig.NewRouteCreating,c={list:"ul.js-list",textItem:"li.js-list-text",listItemText:".js-text",buttonActivate:"a.js-list-activate"},h={active:"active",hover:"hover",transportStop:"ts__list-item"},p={removeTransportStop:f.routes.remove,removeTransportEdit:f.routes.edit},d="FirstWayPoints",v=n.template('<li class="'+h.transportStop+'"><i class="d-audio"></i>'+'<a href="#" class="link-remove" onclick="return false" data-action="remove" title="'+p.removeTransportStop+'"></a>'+'<a href="#" class="link-edit" onclick="return false" data-action="edit" title="'+p.removeTransportEdit+'"><i class="icon_edit"></i></a>'+'<span class="js-text" title="<%= TransportStopTitle %>"><%= TransportStopTitle %></span>'+"</li>");t.extend(this,{FirstWayPoints:{$container:e},SecondWayPoints:{$container:_u6},activeRoute:d,initialize:function initialize(){this.initTransportStopsList("FirstWayPoints",e),this.initTransportStopsList("SecondWayPoints",_u6),this.initRouteActivation("FirstWayPoints",e),this.initRouteActivation("SecondWayPoints",_u6),this.setEvents();},initTransportStopsList:function initTransportStopsList(e,t){this[e].collection=new o.Collection(),this[e].$list=t.find(c.list),this[e].$textItem=this[e].$list.find(c.textItem);},initRouteActivation:function initRouteActivation(e,n){this[e].$buttonActivate=n.find(c.buttonActivate).click(function(){return a.changeActiveRoute(t(this).data("route-name")),!1;});},changeActiveRoute:function changeActiveRoute(e){var t=e==="FirstWayPoints"?"SecondWayPoints":"FirstWayPoints",n="";this.activeRoute=e,l?this[t].collection.models.length?n=this[t].$buttonActivate.data("text-continue"):n=this[t].$buttonActivate.data("text-start"):n=this[t].$buttonActivate.data("text-show"),this[t].$buttonActivate.text(n),this[t].$container.removeClass(h.active),this[e].$container.addClass(h.active),i.trigger("route:activate",this.activeRoute);},setEvents:function setEvents(){i.on("mapTransportStop:add",function(e){a.addTransportStop(e);}).on("transportStopForm:edit",function(e){a.editTransportStop(e);}).on("mapTransportStop:rebase",function(e){a.rebaseTransportStop(e);}).on("mapTransportStop:mouseover",function(e){a.hoverByTransportStop("mouseover","FirstWayPoints",e),a.hoverByTransportStop("mouseover","SecondWayPoints",e);}).on("mapTransportStop:mouseout",function(e){a.hoverByTransportStop("mouseout","FirstWayPoints",e),a.hoverByTransportStop("mouseout","SecondWayPoints",e);});},hoverByTransportStop:function hoverByTransportStop(e,t,n){var i=this[t].collection.where({TempId:n});r.list(i).each(function(t){t.get("$el")[e==="mouseover"?"addClass":"removeClass"](h.hover);});},addTransportStop:function addTransportStop(e){debugger;var n=this[e.RouteName],u=new o.Model(e),a=t(v(e)).hover(function(){i.trigger("routeTransportStop:mouseover",{TempId:u.get("TempId")});},function(){i.trigger("routeTransportStop:mouseout");});e.AudioId&&a.addClass("with-audio"),a.find("a").click(function(){var n=t(this).data("action");return n==="edit"?s("edit",r.object(u.toJSON()).getProperties(["Latitude","Longitude","TransportStopType","TransportStopTitle","TransportStopTitleTranslation","TransportStopTransferToRoutes","AudioId","AudioUrl","TempId"])):n==="remove"&&(a.remove(),i.trigger("routeTransportStop:remove",e)),!1;}),u.set("$el",a),n.collection.add(u);if(r.is(e.prevTSIndex).defined()){var f=n.collection.where({pointIndex:e.prevTSIndex});f.length===1&&f[0].get("$el").after(a);}else n.$textItem.before(a);},updateTransportStopPos:function updateTransportStopPos(e,t,n){t&&e.get("Latitude")!==t&&e.set({Latitude:t}),n&&e.get("Longitude")!==n&&e.set({Longitude:n});},rebaseTransportStop:function rebaseTransportStop(e){this.rebaseTransportStopInRoute("FirstWayPoints",e),this.rebaseTransportStopInRoute("SecondWayPoints",e);},rebaseTransportStopInRoute:function rebaseTransportStopInRoute(e,t){var n=this[e].collection.where({TempId:t.tempId});r.list(n).each(function(e){a.updateTransportStopPos(e,t.newPos.lat(),t.newPos.lng());});},editTransportStop:function editTransportStop(e){debugger;this.editTransportStopInRoute("FirstWayPoints",e),this.editTransportStopInRoute("SecondWayPoints",e);},editTransportStopInRoute:function editTransportStopInRoute(e,t){debugger;var n=this[e].collection.where({Latitude:t.Latitude,Longitude:t.Longitude});r.list(n).each(function(e){e.set({TransportStopTitle:t.TransportStopTitle,TransportStopTitleTranslation:t.TransportStopTitleTranslation,TransportStopTransferToRoutes:t.TransportStopTransferToRoutes,AudioId:t.AudioId||"",AudioUrl:t.AudioUrl||""}),e.get("$el")[t.AudioId?"addClass":"removeClass"]("with-audio").find(c.listItemText).text(t.TransportStopTitle);});}}),this.initialize();};return function(e,t){a(e)&&a(t)&&new u(e,t);};}),define("route.list.action",["require","base","jquery","route.addoredit.formCreate","route.addoredit.map","route.addoredit.map.drivePoints","route.addoredit.monitorsList","route.addoredit.routesList"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(){var t=n("#routeList");t.find(".button_remove").click(function(){window.confirm(" ?")&&n.post(n(this).data("url")).done(function(){window.location.reload();});}),e("route.addoredit.formCreate")(n("#formCreateRoute")),e("route.addoredit.map")(n("#map"),function(t,r){e("route.addoredit.map.drivePoints")(t,r),e("route.addoredit.monitorsList")(n("#monitorsList")),e("route.addoredit.routesList")(n("#transportStopsFirstWay"),n("#transportStopsSecondWay"));});}});}),define("route.addoredit.action",["require","base","jquery","route.addoredit.formCreate","route.addoredit.map","route.addoredit.map.drivePoints","route.addoredit.monitorsList","route.addoredit.routesList"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(){e("route.addoredit.formCreate")(n("#formCreateRoute")),e("route.addoredit.map")(n("#map"),function(t,r){e("route.addoredit.map.drivePoints")(t,r),e("route.addoredit.monitorsList")(n("#monitorsList")),e("route.addoredit.routesList")(n("#transportStopsFirstWay"),n("#transportStopsSecondWay"));});}});}),define("route.controller",["require","base","route.list.action","route.addoredit.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{list:function list(t){e("route.list.action").initialize(t);},addoredit:function addoredit(t){e("route.addoredit.action").initialize(t);}}});}),define("widget.informer.Templates",["require"],function(e){var t='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-1cell js-informator-infoblock_drag"><span class="b-informator-infoblock-exchange-title"><h4><%= Title%></h4></span><span class="b-informator-infoblock-exchange-rate"><%= Rate%></span><% if (Dynamic =="Up"){ %><span class="b-informator-infoblock-exchange-delta_up">&nbsp;<%= Delta %>&nbsp;</span><span class="b-informator-infoblock-exchange-dynamic_up"></span><% } else { %><span class="b-informator-infoblock-exchange-delta_down">&nbsp;<%= Delta %>&nbsp;</span><span class="b-informator-infoblock-exchange-dynamic_down"></span><% } %></li>',n='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-1cell js-informator-infoblock_drag"><p class="b-informator-infoblock-datetime-time"><%= Time%></p><p class="b-informator-infoblock-datetime-date"><%= Date%></p></li>',r='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-1cell js-informator-infoblock_drag"><table class="b-informator-infoblock-weather-table"><tbody><tr><td><div class="b-infromator-weather-icon b-infromator-weather-icon-<%=WeatherCondition %>"></div><span><%= Today %></span></td><td><span class="b-informator-infoblock-weather-temperature"%>&nbsp;<%= DaytimeTemperatures%>&deg;</span><br><span class="b-informator-infoblock-weather-temperature">&nbsp;<%= NightTemperatures %>&deg;</span></td></tr></tbody></table></li>',i='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-2cell js-informator-infoblock_drag"><table  class="b-informator-infoblock-allweather-table"><tbody><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><div class="b-informator-infoblock-allweather-smallsun"></div></td><td><div class="b-informator-infoblock-allweather-smallmoon"></div></td></tr><% for( var dayWeather in allDayWeather) { %> <% if (allDayWeather[dayWeather] !== null) { %><tr>   <td><%= allDayWeather[dayWeather].Day%>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><%= allDayWeather[dayWeather].DaytimeTemperatures %>&deg;</td>   <td><%=allDayWeather[dayWeather].NightTemperatures %>&deg;</td></tr><% } %><% } %></tbody></table></li>',s='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-3cell js-informator-infoblock_drag"><%= Date%><br><%= Day%><br><%= DaytimeTemperatures%><br><%=WeatherCondition %></li>',o='<div class="b-informator-set"><div class="b-informator-set-content"><ul class="js-informator-set-inner" ></ul></div></div>',u='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-2cell b-informator-infoblock-company js-informator-infoblock_drag"><p class="b-informator-infoblock-company1-title"><%= fields.CompanyName%></p><p class="b-informator-infoblock-company1-phone"><%= fields.Phone%></p><p class="b-informator-infoblock-company1-website"><%= fields.Website%></p><p class="b-informator-infoblock-company1-email"><%= fields.Email%></p></li>',a='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-1cell b-informator-infoblock-company js-informator-infoblock_drag"><p class="b-informator-infoblock-company2-title"><%= langResource.informer.contactTitle %></p><p class="b-informator-infoblock-company2-phone"><%= fields.Phone%></p><p class="b-informator-infoblock-company2-email"><%= fields.Email%></p></li>',f='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-2cell b-informator-infoblock-company js-informator-infoblock_drag"><p class="b-informator-infoblock-company1-title"><%= fields.CompanyName%></p><p class="b-informator-infoblock-company3-phoneaddit"><%= fields.PhoneAdditional%></p><p class="b-informator-infoblock-company3-website"><%= fields.Website%></p><p class="b-informator-infoblock-company3-email"><%= fields.Email%></p></li>',l='<li data-block_id="<%= Id %>" class="b-informator-infoblock b-informator-infoblock-1cell b-informator-infoblock-company js-informator-infoblock_drag"><p class="b-informator-infoblock-company1-title"><%= langResource.informer.contactTitle %></p><p class="b-informator-infoblock-company4-phoneaddit"><%= fields.PhoneAdditional%></p><p class="b-informator-infoblock-company4-email"><%= fields.Email%></p></li>';return{ExchangeRateBlockTemplate:t,DateBlockTemplate:n,OneDayWeatherForecastBlockTemplate:r,AllDaysWeatherForecastBlockTemplate:i,CustomDaysWeatherForecastBlockTemplate:s,InfoblockSetTemplate:o,Company1BlockTemplate:u,Company2BlockTemplate:a,Company3BlockTemplate:f,Company4BlockTemplate:l};}),define("widget.informer.InfoBlock",["require","underscore","widget.informer.Templates"],function(e){"use strict";e("underscore");var t=e("widget.informer.Templates"),n=function n(e){this.Id="must_be_override",this.height=1,this.group="Default_Group",e&&_.extend(this,e);};n.prototype.getHeight=function(){return this.height;},n.prototype.render=function(){return"You must override infoBlock render method";},n.prototype.getId=function(){return this.Id;};var r=function r(e){n.apply(this,arguments),this.compiledTmpl=_.template(t.ExchangeRateBlockTemplate);};_.extend(r.prototype,n.prototype),r.prototype.render=function(){return this.compiledTmpl({Id:this.Id,Title:this.Title,Rate:this.Rate,Delta:this.Delta,Dynamic:this.Dynamic});};var i=function i(e){n.apply(this,arguments),this.compiledTmpl=_.template(t.DateBlockTemplate);};_.extend(i.prototype,n.prototype),i.prototype.render=function(){return this.compiledTmpl({Id:this.Id,Time:this.Time,Date:this.Date});};var s=function s(e){n.apply(this,arguments),this.compiledTmpl=_.template(t.OneDayWeatherForecastBlockTemplate);};_.extend(s.prototype,n.prototype),s.prototype.render=function(){return this.compiledTmpl({Id:this.Id,Date:this.Date,Day:this.Day,DaytimeTemperatures:this.DaytimeTemperatures,NightTemperatures:this.NightTemperatures,WeatherCondition:this.WeatherCondition,Today:langResource.informer.today});};var o=function o(e){n.apply(this,arguments),this.compiledTmpl=_.template(t.CustomDaysWeatherForecastBlockTemplate);};_.extend(o.prototype,n.prototype),o.prototype.render=function(){return this.compiledTmpl({Id:this.Id,Date:this.Date,Day:this.Day,DaytimeTemperatures:this.DaytimeTemperatures,NightTemperatures:this.NightTemperatures,WeatherCondition:this.WeatherCondition});};var u=function u(e,r){n.apply(this),this.Id=r,this.height=2,this.allDaysArray=e,this.compiledTmpl=_.template(t.AllDaysWeatherForecastBlockTemplate);};_.extend(u.prototype,n.prototype),u.prototype.render=function(){return this.compiledTmpl({Id:this.Id,allDayWeather:this.allDaysArray});};var a=function a(e){n.apply(this,arguments);};_.extend(a.prototype,n.prototype),a.prototype.render=function(){return'<li class="b-informator-infoblock b-informator-infoblock-1cell b-informator-infoblock-drop js-informator-placeholder">'+langResource.informer.dropBlockText+"</li>";};var f=function f(e,r){n.apply(this),this.Id=r,this.fields=e.fields,this.height=2,this.compiledTmpl=_.template(t.Company1BlockTemplate);};_.extend(f.prototype,n.prototype),f.prototype.render=function(){return this.compiledTmpl({Id:this.Id,fields:this.fields});};var l=function l(e,r){n.apply(this),this.Id=r,this.fields=e.fields,this.compiledTmpl=_.template(t.Company2BlockTemplate);};_.extend(l.prototype,n.prototype),l.prototype.render=function(){return this.compiledTmpl({Id:this.Id,fields:this.fields});};var c=function c(e,r){n.apply(this),this.height=2,this.Id=r,this.fields=e.fields,this.compiledTmpl=_.template(t.Company3BlockTemplate);};_.extend(c.prototype,n.prototype),c.prototype.render=function(){return this.compiledTmpl({Id:this.Id,fields:this.fields});};var h=function h(e,r){n.apply(this),this.Id=r,this.fields=e.fields,this.compiledTmpl=_.template(t.Company4BlockTemplate);};return _.extend(h.prototype,n.prototype),h.prototype.render=function(){return this.compiledTmpl({Id:this.Id,fields:this.fields});},{InfoBlock:n,ExchangeRateBlock:r,DateBlock:i,OneDayWeatherBlock:s,AllDaysWeatherBlock:u,DropBlock:a,Company1Block:f,Company2Block:l,Company3Block:c,Company4Block:h};}),define("widget.informer.DragAndDropLogic",["require"],function(e){var t,n=function n(e){t=e.manager;},r=function r(){$(".js-informator-infoblock_drag").draggable({appendTo:"body",helper:"clone"}),$(".js-informator-placeholder").droppable({over:function over(e,t){t.draggable.hasClass("b-informator-infoblock-2cell")&&$(this).data("cell_id")==3||t.draggable.hasClass("b-informator-infoblock-2cell")&&!$(this).next().hasClass("b-informator-infoblock-drop")?$(this).css({background:""}):$(this).css({backgroundColor:"#ccc"});},out:function out(){$(this).css({background:""});},drop:function drop(e,n){if(n.draggable.parent().hasClass("js-informator-set-inner")){if(!(n.draggable.hasClass("b-informator-infoblock-2cell")&&$(this).data("cell_id")==3||n.draggable.hasClass("b-informator-infoblock-2cell")&&!$(this).next().hasClass("b-informator-infoblock-drop"))){var r=$(this).data("set_id"),i=$(this).data("cell_id"),s=n.draggable.data("block_id");t.addDraggedBlock(s,i,r);var o=$(n.draggable).data("set_id"),u=$(n.draggable).data("cell_id"),a=$(n.draggable).data("block_id");t.deleteDraggedBlock(a,u,o);}}else r=$(this).data("set_id"),i=$(this).data("cell_id"),s=n.draggable.data("block_id"),t.addDraggedBlock(s,i,r);}}),$(".js-informator-delete").droppable({over:function over(e,t){t.draggable.parent().hasClass("js-informator-set-inner")&&(t.draggable.css({background:"#FAD2CB"}),$(this).css({background:"#FAD2CB"}),$(this).find(".js-informator-delete-title").text(langResource.informer.dropInfoblockText));},out:function out(e,t){t.helper.css({background:""}),t.draggable.css({background:""}),$(this).css({background:""}),$(this).find(".js-informator-delete-title").text(langResource.informer.deleteInfoblockText);},drop:function drop(e,n){$(this).css({background:""});var r=n.draggable.data("set_id"),i=n.draggable.data("cell_id"),s=n.draggable.data("block_id");n.draggable.parent().hasClass("js-informator-set-inner")&&t.deleteDraggedBlock(s,i,r),$(this).find(".js-informator-delete-title").text(langResource.informer.deletingInfoblockText);}});};return{setInfoSetsManager:n,LogicStart:r};}),define("widget.informer.DragManager",["require","widget.informer.Templates","widget.informer.InfoBlock","widget.informer.DragAndDropLogic"],function(e){"use strict";var t=e("widget.informer.Templates"),n=e("widget.informer.InfoBlock"),r=e("widget.informer.DragAndDropLogic"),i=function i(){var e=this;this.classElBlocks=".js-informator-blocks",this.blocksCorrespond={},this.blocks=[],this.blocksNames=[],this.addBlockCorrespond=function(e,t){this.blocksCorrespond[e]=t.infoBlock;},this.getHeightById=function(e){return this.blocksCorrespond[e].getHeight();},this.renderBlockById=function(e){return this.blocksCorrespond[e].render();},this.addGroupBlocks=function(e){this.blocksNames.push(e.groupName),this.blocks.push(e.blocks);},this.render=function(){$(e.classElBlocks).empty();var t='<table class="js-informator-infoblocks-right"><tbody>';t+="<tr><td><ul>";for(var n=0;n<this.blocks.length-1;n++){var r=this.blocksNames[n]||"No group name";t+="<h2>"+r+"</h2>",this.blocks[n].forEach(function(n){t+=e.renderBlockById(n);});}t+="</ul></td>",t+="<td><ul>",r=this.blocksNames[3]||"No group name",t+="<h2>"+r+"</h2>",this.blocks[3].forEach(function(n){t+=e.renderBlockById(n);}),t+="</ul></td></tr>",$(e.classElBlocks).append(t+"</tbody></table>");};},s=function s(e){var t=e.infoBlocksManager,r=e.setId,i=new n.DropBlock(),s="dropBlock";t.addBlockCorrespond(s,{infoBlock:i});var o=[];this.infoSetHeight=e.infoSetHeight||4,this.blocks=[],this.init=function(){for(var e=0;e<this.infoSetHeight;e++){this.blocks.push(s),o.push("drop");}},this.addBlockId=function(e,n){function s(e,t){var n=!0,r=1;do{o[e]!=="drop"&&(n=!1),e++,r++;}while(r<=t);return n;}if(e===undefined)throw new Error("You must get infoBlockId for added block");if(n===undefined)throw new Error("You must get position for added block");if(n<0||n>=o.length)throw new Error("Outbond setStructure array");var r=t.getHeightById(e);if(s(n,r)){o[n]="#_"+e;for(var i=1;i<r;i++){o[n+i]="@_"+e;}}},this.removeBlock=function(e,n){var r=t.getHeightById(e),i=n,s=1;do{o[i]="drop",i++,s++;}while(s<=r);},this.saveSetData=function(e){var t=[];return o.forEach(function(n,r){if(n.substr(0,2)==="#_"){var i=n.substr(2);t.push({WidgetNumber:e,PositionNumber:r,WidgetType:i});}}),t;},this.render=function(){var e="";return o.forEach(function(n,i){if(n==="drop"){var o=$(t.renderBlockById(s));o.attr("data-cell_id",i),o.attr("data-set_id",r);if(i===0)var u=o.wrap("<div>").parent().html();else var u=o.wrap("<div>").text("").parent().html();e+=u;}else if(n.substr(0,2)==="#_"){var a=$(t.renderBlockById(n.substr(2)));a.attr("data-cell_id",i),a.attr("data-set_id",r);var f=a.wrap("<div>").parent().html();e+=f;}}),e;},this.isEmpty=function(){var e=!0;for(var t=0,n=o.length;t<n;t++){if(o[t]!=="drop"){e=!1;break;}}return e;},this.renderNotEmpty=function(){var e="";return o.forEach(function(n,i){if(n.substr(0,2)==="#_"){var s=$(t.renderBlockById(n.substr(2)));s.attr("data-cell_id",i).attr("data-set_id",r),e+=s.wrap("<div>").parent().html();}}),e;};},o=function o(){var e=this;this.classElSets=".js-informator-sets",this.compiledTmpl=_.template(t.InfoblockSetTemplate),this.sets=[],this.pushSet=function(e){this.sets.push(e);},this.popSet=function(){return this.sets.pop();},this.init=function(e){var t=6;for(var n=0;n<t;n++){var r=new s({infoBlocksManager:e.infoBlocksManager,setId:n});r.init();var i="blockDateId",o="blockAllWeatherId";this.pushSet(r);}if(e.WidgetPositionsFromJSON.length>0){var u=e.WidgetPositionsFromJSON;this.setupSavedSets(u);}},this.saveSetsData=function(){var e=[];return this.sets.forEach(function(t,n){$.merge(e,t.saveSetData(n));}),e;},this.setupSavedSets=function(t){t.forEach(function(t){var n=t.WidgetNumber,r=t.WidgetType,i=t.PositionNumber;e.sets[n].addBlockId(r,i);});},this.render=function(){$(e.classElSets).empty(),this.sets.forEach(function(t){var n=$(e.compiledTmpl()),r=t.render();n.find(".js-informator-set-inner").append(r),$(e.classElSets).append(n);}),r.setInfoSetsManager({manager:this}),r.LogicStart();},this.renderNotEmpty=function(t){t.empty(),this.sets.forEach(function(n){if(!n.isEmpty()){var r=$(e.compiledTmpl());r.find(".js-informator-set-inner").append(n.renderNotEmpty()),t.append(r);}});},this.addDraggedBlock=function(e,t,n){this.sets[n].addBlockId(e,t),this.render();},this.deleteDraggedBlock=function(e,t,n){this.sets[n].removeBlock(e,t),this.render();};};return{InfoBlocksManager:i,InfoSet:s,InfoSetsManager:o};}),define("widget.informer.CompanyEditorBlocks",["require"],function(e){function r(e){t=e.blocks,n=e.infoBlocksManager;}function i(){var e=".js-informator-setup-company1 ul",r=$(n.renderBlockById(t[0])).removeClass("js-informator-infoblock_drag");$(e).html(r);var i=".js-informator-setup-company2 ul",s=$(n.renderBlockById(t[1])).removeClass("js-informator-infoblock_drag");$(i).html(s);var o=".js-informator-setup-company3 ul",u=$(n.renderBlockById(t[2])).removeClass("js-informator-infoblock_drag");$(o).html(u);var a=".js-informator-setup-company4 ul",f=$(n.renderBlockById(t[3])).removeClass("js-informator-infoblock_drag");$(a).html(f);}var t,n;return{init:r,render:i};}),define("widget.informer.action",["require","base","jquery","urls","templates.storage","widget.informer.InfoBlock","widget.informer.DragManager","widget.informer.CompanyEditorBlocks","popup","videoPlayer","jqueryUI"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("urls"),i=e("templates.storage"),s=e("widget.informer.InfoBlock"),o=e("widget.informer.DragManager"),u=e("widget.informer.CompanyEditorBlocks"),a=e("popup"),f=e("videoPlayer");return e("jqueryUI"),new t.Action({initialize:function initialize(){var e=this,t=new o.InfoBlocksManager(),i=new o.InfoSetsManager();n.get(r.get("getWidgetData")).done(function(o){var a=[],f="Clock",l=new Date(),c=langResource.informer.dayTitle,h=langResource.informer.monthTitle,p=l.getDay()===0?7:l.getDay()-1,d=langResource.getDayText(p,l.getDate(),l.getMonth()),v=new s.DateBlock({Id:f,Time:l.getHours()+":"+(l.getMinutes()<10?"0"+l.getMinutes():l.getMinutes()),Date:d});t.addBlockCorrespond(f,{infoBlock:v}),t.addGroupBlocks({groupName:langResource.informer.infoblockTitle.time,blocks:[f]});if(o.ExchangeRates){a=[];var m=["ExchangeRateUsd","ExchangeRateEur","ExchangeRateCny"];o.ExchangeRates.forEach(function(e,n){e.Id=m[n];var r=new s.ExchangeRateBlock(e);t.addBlockCorrespond(e.Id,{infoBlock:r}),a.push(e.Id);}),t.addGroupBlocks({groupName:langResource.informer.infoblockTitle.exchange,blocks:a});}if(o.WeatherWidget){a=[];if(o.WeatherWidget.Today){var g=o.WeatherWidget.Today,y="WeatherToday";g.Id=y;var b=new s.OneDayWeatherBlock(g);t.addBlockCorrespond(g.Id,{infoBlock:b}),a.push(y);}if(o.WeatherWidget.Forecast.length>0){var w="WeatherForecastFourDays",E=new s.AllDaysWeatherBlock(o.WeatherWidget.Forecast,w);t.addBlockCorrespond(w,{infoBlock:E}),a.push(w);}t.addGroupBlocks({groupName:langResource.informer.infoblockTitle.weather,blocks:a});}var S={};o.WidgetInfo.CompanyName?(S.CompanyName=o.WidgetInfo.CompanyName,S.Phone=o.WidgetInfo.Phone,S.PhoneAdditional=o.WidgetInfo.PhoneAdditional,S.Email=o.WidgetInfo.Email,S.Website=o.WidgetInfo.Website,S.PartnerId=null):(S.CompanyName=langResource.informer.companyBlockDefault.CompanyName,S.Phone=langResource.informer.companyBlockDefault.Phone,S.PhoneAdditional=langResource.informer.companyBlockDefault.PhoneAdditional,S.Email=langResource.informer.companyBlockDefault.Email,S.Website=langResource.informer.companyBlockDefault.Website,S.PartnerId=null),a=[];var x="CompanyInfo1",T=new s.Company1Block({fields:S},x);t.addBlockCorrespond(x,{infoBlock:T}),a.push(x);var N="CompanyInfo2",C=new s.Company2Block({fields:S},N);t.addBlockCorrespond(N,{infoBlock:C}),a.push(N);var k="CompanyInfo3",L=new s.Company3Block({fields:S},k);t.addBlockCorrespond(k,{infoBlock:L}),a.push(k);var A="CompanyInfo4",O=new s.Company4Block({fields:S},A);t.addBlockCorrespond(A,{infoBlock:O}),a.push(A),t.addGroupBlocks({groupName:langResource.informer.infoblockTitle.company,blocks:a}),n('[name="CompanyName"]').val(S.CompanyName),n('[name="Phone"]').val(S.Phone),n('[name="PhoneAdditional"]').val(S.PhoneAdditional),n('[name="Email"]').val(S.Email),n('[name="Website"]').val(S.Website);var M=a;u.init({blocks:M,infoBlocksManager:t}),n(".js-informator-setup").on("input","input",function(){var e=n(this).attr("name"),r=this.value;S[e]=r,u.render(),t.render(),i.render();}),n(".js-informator-save").on("click",function(){n(".js-informator-save").prop("disabled",!0).addClass("is-disabled").html('<i class="loading"></i><span>'+langResource.informer.saveAndStartText+"</span>");var e=S;e.WidgetPositions=i.saveSetsData(),n.post(r.get("saveWidget"),e).done(function(e){n(".js-informator-save").prop("disabled",!1).removeClass("is-disabled").html("<span>"+langResource.informer.saveAndStartText+"</span>");}).fail(function(e){});}),o.WidgetInfo.WidgetPositions=o.WidgetInfo.WidgetPositions||[],o.WidgetInfo.WidgetPositions&&i.init({WidgetPositionsFromJSON:o.WidgetInfo.WidgetPositions,infoBlocksManager:t}),u.render(),t.render(),i.render(),e.initDemoPopup(i);}).fail(function(){console.log("Failed GetWidgetData request");});},initDemoPopup:function initDemoPopup(e){var t=i.get("#template_monitor_demo"),r=window.langResource,s=new a({containerClass:"popup_monitorDemo",headerText:r.widget.monitorDemoHeader});n("button.js-informator-demo").click(function(){function v(){setTimeout(function(){m();},u+a+l);}function m(){if(p.length<2)return;p.eq(d).fadeOut(l,function(){p.eq(d).css("left",o+"px").fadeIn(0),d++,d>=p.length&&(d=0),p.eq(d).animate({left:0},function(){v();});});}var r=n(t()),i=560,o=120,u=5e3,a=500,l=500;s.replaceContent(r);var c=r.find(".js-monitor-demo");new f({containerEl:c,videoUrl:c.data("video-url"),videoWidth:i,videoHeight:Math.round(i*720/1280),controls:!1,autoplay:!0,loop:!0});var h=r.find(".js-monitors-widgets");e.renderNotEmpty(h);var p=h.find(">.b-informator-set"),d=0;return p.length>1&&(p.not(":eq(0)").css({position:"absolute",left:o+"px",top:0}),p.eq(0).css({position:"absolute",left:0,top:0}),v()),s.show(),!1;});}});}),define("widget.controller",["require","base","widget.informer.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{informer:function informer(t){e("widget.informer.action").initialize(t);}}});}),define("offer.acceptance.action",["require","base","jquery","requisitions.form"],function(e){"use strict";var t=e("base"),n=e("jquery");return new t.Action({initialize:function initialize(){e("requisitions.form")(n("#form"));}});}),define("offer.controller",["require","base","offer.acceptance.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{acceptance:function acceptance(t){e("offer.acceptance.action").initialize(t);}}});}),define("user.list.action",["require","base","jquery"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=window.langResource;return new t.Action({initialize:function initialize(){var e=n("#userList");e.find(".button_remove").click(function(){window.confirm(r.users.removeUser)&&n.post(n(this).data("url")).done(function(){window.location.reload();});});}});}),define("user.addoredit.action",["require","base","jquery.inputMask"],function(e){"use strict";var t=e("base"),n=$(".js-get-code-button"),r=$(".js-remain-sec");return e("jquery.inputMask"),new t.Action({initialize:function initialize(){function h(){var e=this;n.on("click",function(){$.ajax({url:"/Authorization/ResendConfirmation",method:"POST",contentType:"application/json",data:JSON.stringify({userId:$("#UserId").val(),userPhoneNumber:$("#Phone").inputmask("unmaskedvalue")})}).done(function(e){e.success==0&&$(".code-valid-ajax").text(e.errMsg);}).error(function(){$(".code-valid-ajax").text("500 error");}),n.addClass("is-disabled"),n.off("click"),p();});}function p(){function o(){r.html(" "+Math.round((t-(Date.now()-i))/1e3)+" .");}var e=this,t=15e4,i=Date.now(),s=setInterval(o,1e3);setTimeout(function(){clearInterval(s),r.html(""),n.removeClass("is-disabled"),h();},t);}$("#Phone").inputmask("+9-999-99-99-999",{oncomplete:function oncomplete(){$('[data-valmsg-for="Phone"]').text("").remove();}}),$("#ConfirmationCode").inputmask("999999");var e=$("#user_form"),t=e.find("#Role"),i=e.find("#partnerGroupsBlock"),s=i.find("table .checkbox-switcher"),o=i.find("table :checkbox"),u=e.find("#partnerGroupData"),a=t.data("roles-for-visible-groups"),f=function f(){var e=a.some(function(e){return t.val()==e;});e?i.show():i.hide();},l=function l(){var e=o.filter(":checked");u.empty(),e.each(function(e,t){var n=$(t).data("id");u.append($('<input type="hidden" name="GroupIdsForAgent" value="'+n+'" /input>'));});},c=function c(){var e=o.filter(":checked");e.length===o.length?s.removeClass("is-partial").addClass("is-checked"):e.length>0?s.removeClass("is-checked").addClass("is-partial"):s.removeClass("is-checked is-partial");};e.submit(function(){if($(".field-validation-error").length)return;$("#Phone").inputmask("remove"),$("#ConfirmationCode").inputmask("remove"),l();}),t.change(function(){f();}),o.change(function(){c();}),s.click(function(){var e=s.hasClass("is-checked");s[e?"removeClass":"addClass"]("is-checked"),$.each(o,function(t){o.eq(t).prop("checked",!e).trigger("change");});}),f(),c(),h();}});}),define("user.controller",["require","base","user.list.action","user.addoredit.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{list:function list(t){e("user.list.action").initialize(t);},addoredit:function addoredit(t){e("user.addoredit.action").initialize(t);}}});}),define("payment.index.pay",["require","jquery"],function(e){"use strict";var t=e("jquery"),n={buttonPayByCard:".js-pay-by-card-button",buttonGetBill:".js-get-bill-button",inputAmount:".js-amount",payForm:".f-payment"},r={visible:"is-visible"},i=function i(e){var r=this;t.extend(this,{initialize:function initialize(){this.initForm();},initForm:function initForm(){this.$buttonGetBill=e.find(n.buttonGetBill),this.$buttonPayByCard=e.find(n.buttonPayByCard),this.$inputAmount=e.find(n.inputAmount),this.$payForm=e.find(n.payForm),this.$inputAmount.keyup(function(){var e=t(this).val().length==0||t.isNumeric(t(this).val())==0||/^0*$/.test(t(this).val());r.$buttonGetBill&&r.$buttonGetBill.prop("disabled",e),r.$buttonPayByCard&&r.$buttonPayByCard.prop("disabled",e);}),this.$buttonGetBill.click(function(){var e=r.$payForm.attr("action"),t=r.$payForm.data("billurl");r.$payForm.attr("action",t),r.$payForm.submit(),r.$payForm.attr("action",e);}),this.$inputAmount.keyup();}}),this.initialize();};return function(e){e&&e.length&&new i(e);};}),define("payment.index.action",["require","base","jquery","urls","tools","datePicker","rangeDatePicker","tooltipConfirm","payment.index.pay"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("urls"),i=e("tools"),s=e("datePicker"),o=e("rangeDatePicker"),u=e("tooltipConfirm"),a=e("payment.index.pay"),f={fieldDate:"input.js-charges-date",fieldDateGap:".js-charges-date-gap",textDate:".js-created-date",textDateGap:".js-created-date-gap",filterDates:"#filterDates",filterDatesField:".js-filter-field",filterDatesIcon:".js-filter-icon",filterDatesDateStart:"#dateFrom",filterDatesDateEnd:"#dateTo",buttonDeletePayment:".js-payment-delete"},l={today:"today"};return new t.Action({initialize:function initialize(){a(n("#paymentPay"));var e=n(f.fieldDate),t=e.siblings(f.fieldDateGap).addClass(l.today),c=new s(e,{$gapEl:t,maxDate:new Date(),dateFormatForUI:"dd.mm.yy",onSelect:function onSelect(e){t[e===i.date(new Date()).format("yy/mm/dd")?"addClass":"removeClass"](l.today);}});c.setDate(new Date()),n(f.textDate).each(function(){var e=n(this),t=e.siblings(f.textDateGap).addClass(l.today),o=new s(e,{$gapEl:t,maxDate:new Date(),dateFormatForUI:"dd.mm.yy",onSelect:function onSelect(t){n.post(r.get("changePaymentDate"),{PaymentId:e.data("payment-id"),NewDate:t});}});o.setDate(i.date(e.data("date")).parse("dd.mm.yy"));});var h=n(f.filterDates);if(h.length){var p=h.find(f.filterDatesField),d=h.find("form"),v=d.find(f.filterDatesDateStart),m=d.find(f.filterDatesDateEnd);p.on("focus",function(){o.show({$target:h,resultDatesFormat:"dd M yy",onSelect:function onSelect(e,t,n){var r=n.split("&ndash;"),i="";r[0]===r[1]?i=r[0]:i=langResource.partnerGroup.from+" "+r[0]+" "+langResource.partnerGroup.to+" "+r[1],p.val(i),v.val(e),m.val(t),d.submit();}});}),h.find(f.filterDatesIcon).click(function(){p.focus();});}n(f.buttonDeletePayment).each(function(){var e=n(this),t=e.find("span"),r=u(t,{headerText:" ",contentText:"      ",buttonApplyText:"",buttonCancelText:"",onApply:function onApply(){e.submit();}});t.click(function(){return r.show(),!1;});});}});}),define("payment.controller",["require","base","payment.index.action","payment.index.action","payment.index.action"],function(e){"use strict";var t=e("base");return new t.Controller({actions:{index:function index(t){e("payment.index.action").initialize(t);},fail:function fail(t){e("payment.index.action").initialize(t);},success:function success(t){e("payment.index.action").initialize(t);}}});}),define("app",["require","base","jquery","adBlockMessage","archive","popup.notifications","ajaxPool","jquery.unobtrusive-ajax","jquery.designForms","campaign.controller","customer.controller","federalagent.controller","emergency.controller","noncommercial.controller","monitor.controller","partner.controller","partnergroup.controller","subscription.controller","city.controller","authorization.controller","administrator.controller","actionlog.controller","route.controller","widget.controller","offer.controller","user.controller","payment.controller"],function(e){"use strict";var t=e("base"),n=e("jquery"),r=e("adBlockMessage"),i=e("archive"),s=e("popup.notifications");return e("ajaxPool"),e("jquery.unobtrusive-ajax"),e("jquery.designForms"),new t.App({controllers:{adscampaign:e("campaign.controller"),advertiser:e("customer.controller"),federalagent:e("federalagent.controller"),emergency:e("emergency.controller"),noncommercial:e("noncommercial.controller"),monitor:e("monitor.controller"),partner:e("partner.controller"),partnergroup:e("partnergroup.controller"),subscription:e("subscription.controller"),city:e("city.controller"),authorization:e("authorization.controller"),administrator:e("administrator.controller"),actionlog:e("actionlog.controller"),route:e("route.controller"),widget:e("widget.controller"),offer:e("offer.controller"),user:e("user.controller"),payment:e("payment.controller")},beforeStart:function beforeStart(e){n("input:checkbox, input:radio").not(".js-radio-simple").designForms(),new r(),new i(),e.controller!=="authorization"&&e.controller!=="partner"&&e.action!=="registration"&&new s();}});});